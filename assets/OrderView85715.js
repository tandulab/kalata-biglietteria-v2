import{o as z,c as N,I as he,a as R,x as V,i as P,_ as I,r as _,J as pe,b as D,e as O,f as a,w,h as L,n as W,g as l,t as S,K as H,L as G,M as K,N as U,O as Z,u as ve}from"../index85715.js";import{u as j,a as ee,f as J,b as oe,c as ye,d as X,e as te,g as ge,h as be,i as ne,j as ke}from"./NewOrderDialog.vue_vue_type_style_index_0_lang85715.js";import{e as F,s as E,D as q,p as le,a as xe}from"./helpers85715.js";const we={props:["filters"],setup(t,o){z(()=>{d.value=!0,y.value={first:0,rows:s.value.rows,sortField:null,sortOrder:null},y.value.page=0,t.filters.location_permalink&&C()});const n=j(),e=ee(),b=N(()=>n.responseOrders),v=N(()=>n.status),i=he(),r=N(()=>i.submitDialog),h=N(()=>i.cancelDialog),f=N(()=>n.paymentStatus),c=R(),s=V(),u=V(),T=V(),d=V(!0),y=V(),g=V(0),x=V([]),p=V([]);function C(){d.value=!0;let m=new Map;for(const k in t.filters)k=="date"?J(t.filters.date)=="Invalid DateTime"?m.set("date",oe(t.filters.date)):m.set("date",J(t.filters.date)):t.filters.location_permalink&&m.set("location_permalink",t.filters.location_permalink),k=="course"&&t.filters.course.id!="-1"&&m.set("course",t.filters.course.id),k=="hour"&&t.filters.hour!="Tutti gli orari"&&m.set("hour",t.filters.hour),k=="name"&&m.set("name",t.filters.name);setTimeout(()=>{M(m)},Math.random()*1e3+250)}const M=async function(m){await n.fetchAllOrders(m).then(()=>{d.value=!1}).catch(k=>{d.value=!1,F(c,k)})},$=async function(){var k;d.value=!0;const m={order_id:u.value.id,order:{enabled:(k=u.value)==null?void 0:k.enabled}};Q(m)},Q=async function(m){await n.updateOrder(m).then(()=>{d.value=!1,E(c,{message:"Stato aggiornato correttamente",error:!1}),C()}).catch(k=>{d.value=!1,F(c,k)})},ae=function(m){return m!=null&&m.cluster?m.cluster:""},se=m=>{T.value.toggle(m)},ie=(m,k)=>{if(m>=(m+k)/2)return"green";if(m<=(m+k)/3)return"red"},re=function(m,k){k&&(T.value.note=k,T.value.toggle(m))},ce=async function(m,k){const A={id:m.id,check_in:k,location_permalink:t.filters.location_permalink};await n.checkInOrder(A).then(()=>{Y(m,k,"check_in"),E(c,{message:"Check-in registrato correttamente",error:!1})}).catch(B=>{F(c,B)})},de=async function(m,k){const A={id:m.id,no_show:k,location_permalink:t.filters.location_permalink};await n.noShowOrder(A).then(()=>{Y(m,k,"no_show"),E(c,{message:"No-show registrato correttamente",error:!1})}).catch(B=>{F(c,B)})},Y=function(m,k,A){m&&m.order_item_tickets.forEach(B=>{B[A]=k})},ue=async function(m,k){const A={id:m,check_in:k,location_permalink:t.filters.location_permalink};await n.checkInTicket(A).then(()=>{E(c,{message:"Check-in registrato correttamente",error:!1})}).catch(B=>{F(c,B)})},me=async function(m,k){const A={id:m,no_show:k,location_permalink:t.filters.location_permalink};await n.noShowTicket(A).then(()=>{E(c,{message:"No-show registrato correttamente",error:!1})}).catch(B=>{F(c,B)})},fe=function(m){const k={course_name:m.course_name,start_at:m.start_at};o.emit("updateFilters",k),e.setNewOrderDialogVisibility(!0)},_e=function(m){debugger;const k={order_id:u.value.id,order:{payment_method:""}};Q(k)};return P(r,()=>{$()}),P(h,()=>{u.value.enabled?u.value.enabled=!1:u.value.enabled=!0}),P(t.filters,()=>{t.filters.location_permalink&&C()}),{dt:s,responseOrders:b,loading:d,totalRecords:g,lazyParams:y,currentOrder:u,status:v,expandedRows:x,expandedRows1:p,op:T,dialogStore:e,paymentList:f,loadLazyData:C,onChangePaymentStatus:_e,getRowClass:ae,toggle:se,getProgressClass:ie,showNotes:re,checkAll:ce,noShowAll:de,openDialog:fe,checkInSingleTicket:ue,noShowSingleTicket:me,formatDataFromUnixTimestamps:ye}},components:{}};const Ce={class:"order-table"},Ve={style:{width:"15rem"}},De={class:"m-0 text-right",style:{"font-size":"12px"}},Te={style:{width:"15rem"}},Oe={class:"m-0 text-right",style:{"font-size":"12px"}},Se=["href"],Ne=l("i",{class:"pi pi-file-pdf"},null,-1),Ue=[Ne],Fe=["href"],Ae=l("i",{class:"pi pi-file-pdf"},null,-1),Be=[Ae];function Le(t,o,n,e,b,v){const i=_("Column"),r=_("ProgressBar"),h=_("Button"),f=_("Dropdown"),c=_("Checkbox"),s=_("OverlayPanel"),u=_("Badge"),T=_("DataTable"),d=pe("tooltip");return D(),O("div",Ce,[a(T,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",rowClass:e.getRowClass,expandedRows:e.expandedRows,"onUpdate:expandedRows":o[1]||(o[1]=y=>e.expandedRows=y)},{empty:w(()=>[L(" Nessuna prenotazione trovata. ")]),expansion:w(y=>[a(T,{value:y.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":o[0]||(o[0]=g=>e.expandedRows1=g)},{empty:w(()=>[L(" Nessuna prenotazione trovata. ")]),expansion:w(g=>[a(T,{value:g.data.order_item_tickets,class:"m-4 mx-5"},{default:w(()=>[a(i,{header:"Codice biglietto",field:"code"}),a(i,{header:"Tipo biglietto",field:"type"},{body:w(({data:x})=>[a(u,{value:x.type,class:W([x.type,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(i,{header:"PDF",field:"tickets_url"},{body:w(({data:x})=>[l("a",{href:x.tickets_url,target:"_blank"},Be,8,Fe)]),_:1}),a(i,{header:"Check-in"},{body:w(({data:x})=>[l("div",null,[a(c,{modelValue:x.check_in,"onUpdate:modelValue":p=>x.check_in=p,binary:!0,onChange:p=>e.checkInSingleTicket(x.id,x.check_in)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),a(i,{header:"No-show"},{body:w(({data:x})=>[l("div",null,[a(c,{modelValue:x.no_show,"onUpdate:modelValue":p=>x.no_show=p,binary:!0,onChange:p=>e.noShowSingleTicket(x.id,x.no_show)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1})]),_:2},1032,["value"])]),default:w(()=>[a(i,{header:"Codice",field:"code"}),a(i,{header:"Effettuato da",field:"created_by"}),a(i,{header:"Acquirente"},{body:w(({data:g})=>[L(S(g.user_name)+" "+S(g.user_surname),1)]),_:1}),a(i,{header:"Q.ta",field:"quantity"}),a(i,{header:"Pdf",field:"pdf"},{body:w(({data:g})=>[l("a",{href:g.tickets_url,target:"_blank"},Ue,8,Se)]),_:1}),a(i,{header:"Pagamento"},{body:w(({data:g})=>[a(f,{modelValue:g.status,"onUpdate:modelValue":x=>g.status=x,options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",disabled:!g.can_change_status,onChange:x=>e.onChangePaymentStatus(g)},null,8,["modelValue","onUpdate:modelValue","options","disabled","onChange"])]),_:1}),a(i,{header:"Check-in"},{body:w(({data:g})=>[l("div",null,[a(c,{modelValue:g.check_in,"onUpdate:modelValue":x=>g.check_in=x,binary:!0,onChange:x=>e.checkAll(g,g.check_in)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),a(i,{header:"No-show"},{body:w(({data:g})=>[l("div",null,[a(c,{modelValue:g.no_show,"onUpdate:modelValue":x=>g.no_show=x,binary:!0,onChange:x=>e.noShowAll(g,g.no_show)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),a(i,{header:"",style:{"padding-right":"0"}},{body:w(({data:g})=>[H(a(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-comment",text:"",rounded:"",onClick:x=>e.showNotes(x,g.notes),disabled:!g.notes},null,8,["onClick","disabled"]),[[d,"Note",void 0,{top:!0}]]),a(s,{ref:"op"},{default:w(()=>[L(S(e.op.note),1)]),_:1},512),H(a(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 pr-0",icon:"pi pi-trash",text:"",rounded:"",disabled:!g.can_cancel},null,8,["disabled"]),[[d,"Elimina",void 0,{top:!0}]])]),_:1}),a(i,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows"])]),default:w(()=>[a(i,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(i,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),a(i,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:w(({data:y})=>[l("div",Ve,[l("p",De,S(y.confirmed_seats)+"/"+S(y.remaing_seats+y.confirmed_seats),1),a(r,{value:y.confirmed_seats*100/(y.remaing_seats+y.confirmed_seats),showValue:!1,style:{height:"10px"},class:W(["available-progress",e.getProgressClass(y.confirmed_seats,y.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(i,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:w(({data:y})=>[l("div",Te,[l("p",Oe," 0 /"+S(y.confirmed_seats),1),a(r,{value:y.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(i,null,{body:w(({data:y})=>[H(a(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:g=>e.openDialog(y)},null,8,["onClick"]),[[d,"Prenota",void 0,{top:!0}]])]),_:1}),a(i,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","rowClass","expandedRows"])])}const Pe=I(we,[["render",Le]]),Ie={props:["filters"],setup(t,o){z(()=>{u();let p=q.now();n.value=t.filters,n.value.date=p.toFormat("dd/MM/yyyy"),y()});const n=V({}),e=X(),b=j(),v=R(),i=V([]),r=V(),h=N(()=>e.allLocations),f=N(()=>b.getCalendar),c=function(){},s=async function(p){await b.fetchCalendar(p).then(()=>{}).catch(C=>{F(v,C)})},u=async function(){await e.fetchAllLocations().then(()=>{T()}).catch(p=>{F(v,p)})},T=function(){if(t.filters.location_permalink){const p=h.value.find(C=>C.permalink===t.filters.location_permalink);i.value=p.courses}},d=function(p){let C={};C.month=q.fromJSDate(new Date(p)).month,C.year=q.fromJSDate(new Date(p)).year,C.location_permalink=t.filters.location_permalink,r.value={month:C.month,year:C.year},s(C)},y=function(){let p=q.now(),C={location_permalink:"",month:"",year:""};C.location_permalink=t.filters.location_permalink,C.month=p.month+"",C.year=p.year+"",s(C)},g=function(p){if(f.value.web_dates&&f.value.web_dates.length!=0){let C=p.month+1;C=p.month<10?"0"+C:C;let M=p.day<10?"0"+p.day:p.day,$=p.year+"-"+C+"-"+M;return f.value.web_dates.find(Q=>Q==$)}},x=function(p){let C={location_permalink:t.filters.location_permalink,month:p.month,year:p.year};s(C)};return P(t.filters,()=>{if(r.value){let p={location_permalink:t.filters.location_permalink,month:r.value.month,year:r.value.year};s(p)}else y()}),{form:n,courses:i,locations:h,calendar:f,resetField:c,getCourses:T,onDateChange:d,getDayFromDate:g,onMonthChange:x}}},Me={class:"flex calendar-filter"},ze={key:0,class:"special-day"};function Re(t,o,n,e,b,v){const i=_("Calendar");return D(),O("div",Me,[a(i,{modelValue:e.form.date,"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.date=r),inline:"",onDateSelect:o[1]||(o[1]=r=>e.onDateChange(r)),onMonthChange:o[2]||(o[2]=r=>e.onMonthChange(r))},{date:w(r=>[e.getDayFromDate(r.date)?(D(),O("div",ze,[l("span",null,S(r.date.day),1)])):(D(),O(G,{key:1},[L(S(r.date.day),1)],64))]),_:1},8,["modelValue"])])}const je=I(Ie,[["render",Re]]),Ee={props:["filters"],setup(t,o){z(()=>{n.value=Object.assign({},t.filters),n.value.date=q.now().toFormat("dd/MM/yyyy"),v.value=le(8,20),v.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=V({}),e=V([]),b=X();R();const v=V([]),i=j(),r=N(()=>b.allLocations),h=N(()=>i.responseOrders),f=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=v.value[0],o.emit("onSubmit",n.value)},c=function(){if(e.value=[],n.value.location_permalink){const s=r.value.find(u=>u.permalink===n.value.location_permalink);e.value=s.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}};return P(r,()=>{t.filters.location_permalink&&r.value&&(n.value=Object.assign({},t.filters),n.value.hour||(n.value.hour="Tutti gli orari"),c())}),P(t.filters,()=>{t.filters.location_permalink&&r.value&&n.value.location_permalink&&n.value.location_permalink!=t.filters.location_permalink&&(n.value=Object.assign({},t.filters),n.value.hour||(n.value.hour="Tutti gli orari"),c())}),P(h,()=>{}),{form:n,courses:e,hours:v,locations:r,responseOrders:h,resetField:f,getCourses:c}}},qe={class:"formgrid grid px-0 align-items-center"},Je={key:0,class:"field col-4 flex flex-column"},Ge=l("label",{for:"typology"},"Filtra per percorso",-1),Ke={key:1,class:"field col-3 flex flex-column"},Qe=l("label",{for:"typology"},"Filtra per orario (dalle)",-1),$e=l("div",{class:"col-12"},null,-1),He={class:"field col-4 flex flex-column"},We=l("label",{for:"typology"},"Filtra per nome acquirente",-1),Xe={class:"flex col-12 justify-content-end pt-1"};function Ye(t,o,n,e,b,v){const i=_("Dropdown"),r=_("InputText"),h=_("Button"),f=_("AccordionTab"),c=_("Accordion");return D(),K(c,{activeIndex:0},{default:w(()=>[a(f,{header:"FILTRI"},{default:w(()=>[l("div",qe,[e.form.location_permalink?(D(),O("div",Je,[Ge,a(i,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.course=s),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):U("",!0),e.responseOrders?(D(),O("div",Ke,[Qe,a(i,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.hour=s),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):U("",!0),$e,l("div",He,[We,a(r,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.name=s),placeholder:""},null,8,["modelValue"])])]),l("div",Xe,[a(h,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=s=>t.$emit("onSubmit",e.form))}),a(h,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=s=>e.resetField())})])]),_:1})]),_:1})}const Ze=I(Ee,[["render",Ye]]),eo={props:["form","price","index","ticket"],setup(t,o){const n=V(0),e=function(){n.value++,v()},b=function(){n.value>0&&n.value--,v()},v=function(){const i={counter:n.value,price:t.price,index:t.index,ticket:t.ticket};o.emit("changeCounter",i)};return{counter:n,decrement:b,increment:e}}},oo={class:"btn-plus-min flex align-items-center"},to={class:"counter"};function no(t,o,n,e,b,v){const i=_("Button");return D(),O("div",oo,[a(i,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),l("div",to,S(e.counter),1),a(i,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const lo=I(eo,[["render",no]]),ao={props:["tickets","form"],setup(t){const o=V(0),n=V([]),e=V(!1),b=V(),v=j(),i=R(),r=N(()=>v.getDiscount),h=function(u){n.value[u.index]={partial_total:u.price*u.counter,ticket:u.ticket,quantity:u.counter},o.value=0,n.value.forEach(T=>{T.partial_total==0&&n.value.splice(n.value.indexOf(T)),o.value+=T.partial_total})},f=function(){c()},c=async function(){let u=[];n.value.forEach(d=>{u.push({id:d.ticket.id,quantity:d.quantity})});const T={discount_code:b.value,location_permalink:t.form.location_permalink,tickets:u};await v.cost(T).then(()=>{}).catch(d=>{F(i,d)})};return{total:o,partialTotals:n,showDiscount:e,discountCode:b,discount:r,onChangeCounter:h,applyDiscount:f,checkDisabled:function(){return!n.value||n.value.length==0}}},components:{PlusMinusButton:lo}},so={key:0,class:"flex justify-content-between align-items-center"},io={class:"flex align-items-center col-9"},ro={class:"col-4 pl-0"},co={class:"text-right col-2"},uo={class:"col-3 flex justify-content-end"},mo=l("hr",{class:"mt-3"},null,-1),fo={class:"col-12 m-0 py-0 flex flex-column align-items-start"},_o={class:"flex align-items-center justify-content-between py-0"},ho={class:"col-9 flex"},po=l("b",null,"Totale",-1),vo=[po],yo={key:0,class:"text-right col-4"},go={class:"line-through text-sm mr-2"},bo={class:"font-bold"},ko={key:1,class:"col-2 text-right font-bold"},xo={class:"col-3 flex justify-content-end"};function wo(t,o,n,e,b,v){const i=_("PlusMinusButton"),r=_("Button"),h=_("InputText"),f=_("InputGroup");return D(),O(G,null,[(D(!0),O(G,null,Z(n.tickets,(c,s)=>{var u,T,d;return D(),O("div",{key:c.id},[((u=c.course)==null?void 0:u.id)==((T=n.form.course)==null?void 0:T.id)?(D(),O("div",so,[l("div",io,[l("b",ro,S(c.name),1),l("div",co,"€ "+S((d=c.price)==null?void 0:d.toFixed(2)),1)]),l("div",uo,[a(i,{onChangeCounter:o[0]||(o[0]=y=>e.onChangeCounter(y)),price:c.price,index:s,ticket:c},null,8,["price","index","ticket"])])])):U("",!0)])}),128)),mo,l("div",fo,[a(r,{label:"Codice sconto",link:"",onClick:o[1]||(o[1]=c=>e.showDiscount?e.showDiscount=!1:e.showDiscount=!0),class:"p-0"}),e.showDiscount?(D(),K(f,{key:0,class:"discount"},{default:w(()=>[a(h,{placeholder:"Inserisci codice",modelValue:e.discountCode,"onUpdate:modelValue":o[2]||(o[2]=c=>e.discountCode=c)},null,8,["modelValue"]),a(r,{label:"Applica",onClick:e.applyDiscount},null,8,["onClick"])]),_:1})):U("",!0)]),l("div",_o,[l("div",ho,[l("div",{class:W(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},vo,2),e.discount&&e.discount.total_amount?(D(),O("div",yo,[l("span",go,"€ "+S(e.total.toFixed(2)),1),l("span",bo,"€ "+S(e.discount.total_amount.toFixed(2)),1)])):(D(),O("div",ko,"€ "+S(e.total.toFixed(2)),1))]),l("div",xo,[a(r,{label:"Prosegui",onClick:o[3]||(o[3]=c=>t.$emit("nextTab",e.partialTotals)),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Co=I(ao,[["render",wo]]),Vo={props:["location_permalink"],setup(t){z(()=>{f()});const o=te(),n=ge(),e=j(),b=V({}),v=V([{label:"Digitale (POS)",id:"credit_card"},{label:"Digitale (Satispay)",id:"satispay"},{label:"Ecommerce",id:"ecommerce"},{label:"Contanti",id:"cash"},{label:"Bonifico",id:"credit_transfer"},{label:"Biglietto a data aperta (voucher)",id:"voucher"}]),i=N(()=>n.allCountries),r=N(()=>o.allOpenTickets),h=N(()=>e.paymentStatus),f=async function(){await n.fetchAllCountries().then(()=>{b.value.country_id=88,b.value.status={id:"to_pay",name:"Da pagare"}})};return{form:b,countries:i,paymentList:h,paymentModeList:v,open_tickets:r,fetchAllOpenTickets:async function(s){const u={code:s.query.toUpperCase(),location_permalink:t.location_permalink};await o.fetchAllOpenTickets(u)}}}},Do={key:0,class:"formgrid grid"},To={class:"field col-6"},Oo=l("label",{for:"user_name"},"Nome",-1),So={class:"field col-6"},No=l("label",{for:"user_surname"},"Cognome",-1),Uo={class:"field col-6"},Fo=l("label",{for:"user_email"},"Email",-1),Ao={class:"field col-6"},Bo=l("label",{for:"user_phone"},"Telefono",-1),Lo={class:"field col-6"},Po=l("label",{for:"country_id"},"Nazione",-1),Io={class:"field col-6"},Mo=l("label",{for:"user_zip"},"Cap",-1),zo={class:"field col-6"},Ro=l("label",{for:"status"},"Stato pagamento",-1),jo={class:"field col-6"},Eo=l("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),qo={key:0,class:"field col-6 flex flex-column"},Jo=l("label",{for:"user_zip"},"Codice biglietto",-1),Go={class:"field col-12"},Ko={class:"field flex flex-column"},Qo=l("label",{for:"notes"},"Note",-1),$o={class:"col-12 flex justify-content-end"};function Ho(t,o,n,e,b,v){const i=_("InputText"),r=_("Dropdown"),h=_("AutoComplete"),f=_("Textarea"),c=_("Button");return e.form?(D(),O("div",Do,[l("div",To,[Oo,a(i,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.user_name=s),class:"w-full"},null,8,["modelValue"])]),l("div",So,[No,a(i,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.user_surname=s),class:"w-full"},null,8,["modelValue"])]),l("div",Uo,[Fo,a(i,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.user_email=s),class:"w-full"},null,8,["modelValue"])]),l("div",Ao,[Bo,a(i,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":o[3]||(o[3]=s=>e.form.user_phone=s),class:"w-full"},null,8,["modelValue"])]),l("div",Lo,[Po,a(r,{modelValue:e.form.country_id,"onUpdate:modelValue":o[4]||(o[4]=s=>e.form.country_id=s),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),l("div",Io,[Mo,a(i,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":o[5]||(o[5]=s=>e.form.user_zip=s),class:"w-full"},null,8,["modelValue"])]),l("div",zo,[Ro,a(r,{modelValue:e.form.status,"onUpdate:modelValue":o[6]||(o[6]=s=>e.form.status=s),options:e.paymentList,optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])]),l("div",jo,[Eo,a(r,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[7]||(o[7]=s=>e.form.payment_mode=s),options:e.paymentModeList,optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode&&e.form.payment_mode.label=="Biglietto a data aperta (voucher)"?(D(),O("div",qo,[Jo,a(h,{modelValue:e.form.ticket_code,"onUpdate:modelValue":o[8]||(o[8]=s=>e.form.ticket_code=s),suggestions:e.open_tickets,class:"uppercase",onComplete:o[9]||(o[9]=s=>e.fetchAllOpenTickets(s)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"id"},null,8,["modelValue","suggestions"])])):U("",!0),l("div",Go,[l("div",Ko,[Qo,a(f,{modelValue:e.form.notes,"onUpdate:modelValue":o[10]||(o[10]=s=>e.form.notes=s),rows:"5",cols:"30"},null,8,["modelValue"])])]),l("div",$o,[a(c,{label:"Prosegui",onClick:o[11]||(o[11]=s=>t.$emit("nextTab",e.form))})])])):U("",!0)}const Wo=I(Vo,[["render",Ho]]),Xo={props:["form"],setup(t){z(()=>{f()});const o=V(0),n=V([]),e=V(!1),b=te(),v=j(),i=R(),r=N(()=>b.allTickets),h=N(()=>v.getCurrentOrder),f=async function(){const d={location_permalink:t.form.location_permalink,api_version:"v2",date:J(t.form.date),course_id:t.form.course.id};await b.fetchAllTickets(d).then(()=>{}).catch(y=>{F(i,y)})},c=function(d){o.value+=1,n.value=Object.assign([],d)},s=function(d){return J(d).includes("Invalid")?oe(d):J(d)},u=function(d){T(d)},T=async function(d){var x,p,C;const y=[{start_at:t.form.hour,tickets:[]}];n.value.forEach(M=>{y[0].tickets.push({id:M.ticket.id,quantity:M.quantity})});const g={location_permalink:t.form.location_permalink,country_id:d.country_id,status:d.status.id,user_email:d.user_email,user_name:d.user_name,user_phone:d.user_phone,user_surname:d.user_surname,user_zip:d.user_zip,api_version:"v2",date:t.form.date?s(t.form.date):"",note:d.notes,time_slots:y,payment_method:(x=d.payment_mode)==null?void 0:x.id,course_id:(C=(p=t.form)==null?void 0:p.course)==null?void 0:C.id};await v.createOrder(g).then(()=>{o.value+=1,e.value=!0}).catch(M=>{F(i,M)})};return{tickets:r,active:o,partialTotals:n,showOrderDetail:e,currentOrder:h,formatExplicitDate:be,formatDate:ne,onNextTab:c,onConfirmPayment:u}},components:{NewOrderTicketTab:Co,NewOrderFormTab:Wo}},Yo={key:0,class:"info-box"},Zo={class:"font-medium"},et=l("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),ot={class:"font-medium"},tt=l("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),nt={class:"capitalize"},lt={key:0,class:"flex pb-4"},at=l("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),st={class:"flex flex-column"},it={class:"py-5"},rt={class:"m-0 text-center font-bold line-height-3"},ct=l("br",null,null,-1),dt={class:"flex align-items-center justify-content-center mt-3"};function ut(t,o,n,e,b,v){var s;const i=_("NewOrderTicketTab"),r=_("TabPanel"),h=_("NewOrderFormTab"),f=_("Button"),c=_("TabView");return D(),O(G,null,[n.form?(D(),O("div",Yo,[l("p",Zo,[et,L(" "+S((s=n.form.course)==null?void 0:s.name),1)]),l("p",ot,[tt,l("span",nt,S(e.formatDate(n.form.date)),1),L(" - "+S(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(D(),O("div",lt,[at,l("div",st,[(D(!0),O(G,null,Z(e.partialTotals,u=>{var T;return D(),O("p",{class:"p-0 m-0 pb-1 font-medium",key:u.id},S((T=u.ticket)==null?void 0:T.name)+" x "+S(u.quantity)+" "+S(u.price),1)}),128))])])):U("",!0)])):U("",!0),a(c,{activeIndex:e.active,"onUpdate:activeIndex":o[3]||(o[3]=u=>e.active=u)},{default:w(()=>[a(r,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:w(()=>[a(i,{tickets:e.tickets,form:n.form,onNextTab:o[0]||(o[0]=u=>e.onNextTab(u))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(r,{header:"Inserisci i dati",disabled:e.showOrderDetail},{default:w(()=>[a(h,{onNextTab:o[1]||(o[1]=u=>e.onConfirmPayment(u)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(D(),K(r,{key:0,header:"Ordine completato"},{default:w(()=>[l("div",it,[l("div",rt,[L(" Ordine "+S(e.currentOrder.reservation_number)+" registrato correttamente!",1),ct,L(" Ti abbiamo inoltrato la conferma via mail. ")]),l("div",dt,[a(f,{label:"Stampa biglietti",outlined:"",onClick:o[2]||(o[2]=u=>t.$emit("closeDialog",u))})])])]),_:1})):U("",!0)]),_:1},8,["activeIndex"])],64)}const mt=I(Xo,[["render",ut]]),ft={props:["filters"],setup(t){z(()=>{c(),b.value=le(8,20),o.value=Object.assign({},t.filters),o.value.hour=xe(b.value)});const o=V({}),n=ke(),e=R(),b=V(),v=V(!1),i=ee(),r=V(!1),h=N(()=>n.allCourses),f=N(()=>i.showNewOrderDialog),c=async function(){const d={location_permalink:t.filters.location_permalink,api_version:"v2"};await n.fetchAllCourses(d).then(()=>{}).catch(y=>{F(e,y)})},s=function(){o.value={}},u=function(d){i.setNewOrderDialogVisibility(d)},T=function(){r.value=o.value.open_ticket};return P(t.filters,()=>{if((t.filters.location_permalink!=o.value.location_permalink||!o.value.course)&&c(),o.value.date=t.filters.date,o.value.location_permalink=t.filters.location_permalink,t.filters.hour&&t.filters.hour!="Tutti gli orari"&&(o.value.hour=t.filters.hour),t.filters.course&&!t.filters.course.id){let d=h.value.find(y=>y.name===t.filters.course.name);d&&(o.value.course=d)}}),P(h,()=>{o.value.course=h.value[0]}),{courses:h,form:o,hours:b,disableForm:r,visible:v,onCloseDialog:s,updateDialog:u,onChecked:T,dialogVisible:f,dialogStore:i}},components:{NewOrderDialog:mt}},_t=l("h2",{class:"mt-1"},"Nuova prenotazione",-1),ht={class:"formgrid grid px-0 align-items-center mt-4"},pt={key:0,class:"field flex flex-column w-full col-12"},vt=l("label",{for:"typology"},"Scegli il percorso",-1),yt={key:1,class:"field flex flex-column w-full col-12"},gt=l("label",{for:"typology"},"Seleziona l'orario",-1),bt={class:"flex justify-content-end align-items-center mt-2"},kt={class:"flex align-items-center justify-content-between w-full"},xt=l("h2",null,"Nuova prenotazione",-1);function wt(t,o,n,e,b,v){const i=_("Dropdown"),r=_("Button"),h=_("NewOrderDialog"),f=_("Dialog"),c=_("Card");return D(),K(c,{class:"mt-4"},{content:w(()=>[_t,l("div",ht,[n.filters.location_permalink?(D(),O("div",pt,[vt,a(i,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.course=s),options:e.courses,optionLabel:"name",disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):U("",!0),n.filters.location_permalink?(D(),O("div",yt,[gt,a(i,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.hour=s),options:e.hours,disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):U("",!0)]),l("div",bt,[a(r,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:o[2]||(o[2]=s=>e.updateDialog(!0))},null,8,["disabled"])]),a(f,{visible:e.dialogVisible,"onUpdate:visible":o[5]||(o[5]=s=>e.dialogVisible=s),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1},{header:w(()=>[l("div",kt,[xt,a(r,{icon:"pi pi-times",text:"",rounded:"",onClick:o[3]||(o[3]=s=>e.updateDialog(!1))})])]),default:w(()=>[a(h,{form:e.form,onCloseDialog:o[4]||(o[4]=s=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const Ct=I(ft,[["render",wt]]),Vt={setup(){z(()=>{v.value&&(t.value.location_permalink=v.value.location.permalink,r())});const t=V({}),o=V(),n=ve(),e=X(),b=R(),v=N(()=>n.currentUser),i=N(()=>e.allLocations),r=async function(){await e.fetchAllLocations().then(()=>{}).catch(f=>{F(b,f)})};return{filters:t,orderTable:o,user:v,locations:i,fetchAllLocations:r,formatDate:ne,onUpdateFilters:function(f){t.value.hour=f.start_at,t.value.course={name:f.course_name},f.course&&(t.value.course={id:f.course}),t.value.name=f.name,f.hour&&(f.hour.start_at?t.value.hour=f.hour.start_at:t.value.hour=f.hour)}}},components:{CalendarFilter:je,OrderTable:Pe,OrderFilter:Ze,NewOrderCard:Ct}};const Dt={class:"flex justify-content-between align-items-center"},Tt={class:"field flex flex-column mt-3"},Ot={key:0,style:{color:"#495057"}},St=l("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Nt={class:"capitalize text-xl"},Ut={class:"flex gap-4"},Ft={key:0,class:"col-3 mt-3"},At={class:"col-9 mt-3"};function Bt(t,o,n,e,b,v){const i=_("Dropdown"),r=_("CalendarFilter"),h=_("NewOrderCard"),f=_("OrderFilter"),c=_("OrderTable");return D(),O("div",null,[l("div",Dt,[l("div",Tt,[a(i,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=s=>e.filters.location_permalink=s),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(D(),O("div",Ot,[St,l("span",Nt,S(e.formatDate(e.filters.date)),1)])):U("",!0)]),l("div",Ut,[e.filters.location_permalink?(D(),O("div",Ft,[a(r,{filters:e.filters},null,8,["filters"]),a(h,{filters:e.filters},null,8,["filters"])])):U("",!0),l("div",At,[a(f,{filters:e.filters,onOnSubmit:o[1]||(o[1]=s=>e.onUpdateFilters(s))},null,8,["filters"]),e.filters.date?(D(),K(c,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:o[2]||(o[2]=s=>e.onUpdateFilters(s))},null,8,["filters"])):U("",!0)])])])}const Mt=I(Vt,[["render",Bt]]);export{Mt as default};
