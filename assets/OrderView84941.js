import{I,J as Y,K as fe,L as _e,M as R,o as $,c as S,N as pe,a as j,x as k,i as U,_ as P,r as p,O as he,b as w,e as V,f as l,w as g,h as A,n as Z,g as s,t as O,P as H,Q as E,R as q,S as N,T as te,u as ve}from"../index84941.js";import{D as L,f as ye,e as B,s as ge,p as oe,g as ke}from"./helpers84941.js";const be=function(t){return L.fromJSDate(new Date(t)).toFormat("yyyy-LL-dd")},ee=function(t){return L.fromFormat(t+"","dd/MM/yyyy").toFormat("yyyy-LL-dd")},we=function(t){return L.fromSeconds(t).toFormat("dd/MM/yyyy")},K=function(t){const e=L.fromJSDate(new Date(t)),n=e.setLocale("it").toFormat("cccc"),o=e.toFormat("d"),c=e.setLocale("it").toFormat("LLLL");return`${n} ${o} ${c}`},xe=function(t){const e=L.fromFormat(t,"dd/MM/yyyy"),n=e.setLocale("it").toFormat("cccc"),o=e.toFormat("d"),c=e.setLocale("it").toFormat("LLLL");return`${n} ${o} ${c}`},ne=function(t){return K(t).includes("Invalid DateTime")?xe(t):K(t)};class z{static async fetchAll(e){const n=new Map(e),o=n.get("location_permalink");return n.delete("location_permalink"),n.delete("name"),n.delete("course"),n.set("api_version","v2"),(await I(`/ticket_office/${o}/orders`,n)).data}static async calendar(e){const n=e.location_permalink;return delete e.location_peramlink,e.api_version="v2",(await Y(`/ticket_office/${n}/search/calendar`,e)).data}static async getOrderDetail(e){return(await I(`/orders/${e}`)).data.order}static async createOrder(e){const n=e.get("location_permalink");return e.delete("location_permalink"),(await fe(`/ticket_office/${n}/orders`,e)).data.order}static async deleteOrder(e){return(await _e(`/orders/${e}`)).data}static async updateOrder(e){return(await Y(`/orders/${e.id}/update`,e.formData)).data.order}}const J=R({id:"order",state:()=>({order:{},orders:[],response_orders:{},total_orders:Number,calendar:{}}),getters:{allOrders:t=>t.response_orders.orders,responseOrders:t=>t.response_orders,getTotalOrders:t=>t.response_orders?t.response_orders.total:0,getCurrentOrder:t=>t.order,status:()=>[{name:"Attivo",value:"true"},{name:"Disattivo",value:"false"}],getCalendar:t=>t.calendar},actions:{async fetchAllOrders(t){await z.fetchAll(t).then(e=>this.response_orders=this.filterOrder(e,t))},filterOrder(t,e){if(e.get("course")&&e.get("course")!="Tutti i percorsi"&&(t.time_slots=t.time_slots.filter(n=>n.course_name==e.get("course"))),e.get("hour")&&(t.time_slots=ye(e.get("hour"),t.time_slots)),e.get("name")&&e.get("name")!=null){const n={time_slots:[]};return t.time_slots&&t.time_slots.forEach(o=>{let c=!1;o.orders.forEach(_=>{(_.user_name.trim().toLowerCase()===e.get("name").trim().toLowerCase()||_.user_surname.trim().toLowerCase()===e.get("name").trim().toLowerCase())&&(c=!0)}),c&&n.time_slots.push(o)}),n}return t},async fetchOrderDetail(t){await z.getOrderDetail(t).then(e=>this.order=e)},async fetchCalendar(t){await z.calendar(t).then(e=>this.calendar=e)},async createOrder(t){await z.createOrder(t).then(e=>this.order=e)},async updateOrder(t){await z.updateOrder(t).then(e=>this.order=e)},async deleteOrder(t){await z.deleteOrder(t).then(e=>this.order=e)}}}),se=R({id:"newOrderDialog",state:()=>({_showNewOrderDialog:!1}),getters:{showNewOrderDialog:t=>t._showNewOrderDialog},actions:{setNewOrderDialogVisibility(t){this.updateNewOrderDialog(t)},updateNewOrderDialog(t){this._showNewOrderDialog=t}}}),Ce={props:["filters"],setup(t,e){$(()=>{h.value=!0,b.value={first:0,rows:i.value.rows,sortField:null,sortOrder:null},b.value.page=0,t.filters.location_permalink&&M()});const n=J(),o=se(),c=S(()=>n.responseOrders),_=S(()=>n.status),a=pe(),r=S(()=>a.submitDialog),u=S(()=>a.cancelDialog),f=j(),i=k(),d=k(),m=k(),T=k([{code:"2023795703",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!0},{code:"2023795704",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795705",type:"Biglietto ridotto",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795706",type:"Biglietto gratuito",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1}]),F=k(["Da pagare","Pagato","Gratuito"]),h=k(!0),b=k(),C=k(0),y=k([]),x=k([]);function M(){h.value=!0;let v=new Map;for(const D in t.filters)D=="date"?ee(t.filters.date)=="Invalid DateTime"?v.set("date",be(t.filters.date)):v.set("date",ee(t.filters.date)):t.filters.location_permalink&&v.set("location_permalink",t.filters.location_permalink),D=="course"&&t.filters.course.id!="-1"&&v.set("course",t.filters.course.id),D=="hour"&&t.filters.hour!="Tutti gli orari"&&v.set("hour",t.filters.hour),D=="name"&&v.set("name",t.filters.name);setTimeout(()=>{G(v)},Math.random()*1e3+250)}const G=async function(v){await n.fetchAllOrders(v).then(()=>{h.value=!1}).catch(D=>{h.value=!1,B(f,D)})},Q=function(v){},le=function(v,D){v.stopPropagation(),v.stopImmediatePropagation(),d.value=D;let W="Sei sicuro di voler disattivare l'utente <b>"+(D==null?void 0:D.email)+"</b> ?";a.setDialog("Cambia stato","Conferma","Annulla",W),a.setDynamicDialogVisibility(!0)},ae=async function(){var D;h.value=!0;const v={order_id:d.value.id,order:{enabled:(D=d.value)==null?void 0:D.enabled}};await n.updateOrder(v).then(()=>{h.value=!1,ge(f,{message:"Stato aggiornato correttamente",error:!1}),M()}).catch(W=>{h.value=!1,B(f,W)})},ie=function(v){return v!=null&&v.cluster?v.cluster:""},re=v=>{m.value.toggle(v)},ce=(v,D)=>{if(v>=(v+D)/2)return"green";if(v<=(v+D)/3)return"red"},de=function(v,D){D&&(m.value.note=D,m.value.toggle(v))},ue=function(v){},me=function(v){const D={course_name:v.course_name,start_at:v.start_at};e.emit("updateFilters",D),o.setNewOrderDialogVisibility(!0)};return U(r,()=>{ae()}),U(u,()=>{d.value.enabled?d.value.enabled=!1:d.value.enabled=!0}),U(t.filters,()=>{t.filters.location_permalink&&M()}),{dt:i,responseOrders:c,loading:h,totalRecords:C,lazyParams:b,currentOrder:d,status:_,expandedRows:y,expandedRows1:x,op:m,tmp_tickets:T,payments:F,dialogStore:o,showSidebar:Q,loadLazyData:M,onChangeStatus:le,getRowClass:ie,toggle:re,getProgressClass:ce,showNotes:de,checkAll:ue,openDialog:me,formatDataFromUnixTimestamps:we}},components:{}};const Ve={class:"order-table"},De={style:{width:"15rem"}},Oe={class:"m-0 text-right",style:{"font-size":"12px"}},Te={style:{width:"15rem"}},Fe={class:"m-0 text-right",style:{"font-size":"12px"}},Se=["href"],Ne=s("i",{class:"pi pi-file-pdf"},null,-1),Le=[Ne],Ae=["href"],Ue=s("i",{class:"pi pi-file-pdf"},null,-1),Pe=[Ue];function Be(t,e,n,o,c,_){const a=p("Column"),r=p("ProgressBar"),u=p("Button"),f=p("Dropdown"),i=p("Checkbox"),d=p("OverlayPanel"),m=p("Badge"),T=p("DataTable"),F=he("tooltip");return w(),V("div",Ve,[l(T,{value:o.responseOrders.time_slots,totalRecords:o.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:"",rowClass:o.getRowClass,expandedRows:o.expandedRows,"onUpdate:expandedRows":e[1]||(e[1]=h=>o.expandedRows=h)},{empty:g(()=>[A(" Nessuna prenotazione trovata. ")]),expansion:g(h=>[l(T,{value:h.data.orders,class:"m-4 mx-4",expandedRows:o.expandedRows1,"onUpdate:expandedRows":e[0]||(e[0]=b=>o.expandedRows1=b)},{empty:g(()=>[A(" Nessuna prenotazione trovata. ")]),expansion:g(b=>[l(T,{value:o.tmp_tickets,class:"m-4 mx-5"},{default:g(()=>[l(a,{header:"Codice biglietto",field:"code"}),l(a,{header:"Tipo biglietto",field:"type"},{body:g(({data:C})=>[l(m,{value:C.type,class:Z([C.type,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(a,{header:"PDF",field:"tickets_url"},{body:g(({data:C})=>[s("a",{href:C.tickets_url,target:"_blank"},Pe,8,Ae)]),_:1}),l(a,{header:"Check-in"},{body:g(({data:C})=>[s("div",null,[l(i,{modelValue:C.check_in,"onUpdate:modelValue":y=>C.check_in=y,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(a,{header:"No-show"},{body:g(({data:C})=>[s("div",null,[l(i,{modelValue:C.no_show_tickets,"onUpdate:modelValue":y=>C.no_show_tickets=y,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["value"])]),default:g(()=>[l(a,{header:"Codice",field:"code"}),l(a,{header:"Effettuato da",field:"created_by"}),l(a,{header:"Acquirente"},{body:g(({data:b})=>[A(O(b.user_name)+" "+O(b.user_surname),1)]),_:1}),l(a,{header:"Q.ta",field:"quantity"}),l(a,{header:"Pdf",field:"pdf"},{body:g(({data:b})=>[s("a",{href:b.tickets_url,target:"_blank"},Le,8,Se)]),_:1}),l(a,{header:"Pagamento"},{body:g(({data:b})=>[l(f,{modelValue:b.payment,"onUpdate:modelValue":C=>b.payment=C,options:o.payments,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),l(a,{header:"Check-in"},{body:g(({data:b})=>[s("div",null,[l(i,{modelValue:b.check_in,"onUpdate:modelValue":C=>b.check_in=C,binary:!0,onClick:C=>o.checkAll(b.time_slot)},null,8,["modelValue","onUpdate:modelValue","onClick"])])]),_:1}),l(a,{header:"No-show"},{body:g(({data:b})=>[s("div",null,[l(i,{modelValue:b.no_show_tickets,"onUpdate:modelValue":C=>b.no_show_tickets=C,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(a,{header:"",style:{"padding-right":"0"}},{body:g(({data:b})=>[H(l(u,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-comment",text:"",rounded:"",onClick:C=>o.showNotes(C,b.notes),disabled:!b.notes},null,8,["onClick","disabled"]),[[F,"Note",void 0,{top:!0}]]),l(d,{ref:"op"},{default:g(()=>[A(O(o.op.note),1)]),_:1},512),H(l(u,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-trash",text:"",rounded:"",disabled:!b.can_cancel},null,8,["disabled"]),[[F,"Elimina",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:2},1032,["value","expandedRows"])]),default:g(()=>[l(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),l(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:g(({data:h})=>[s("div",De,[s("p",Oe,O(h.confirmed_seats)+"/"+O(h.remaing_seats+h.confirmed_seats),1),l(r,{value:h.confirmed_seats*100/(h.remaing_seats+h.confirmed_seats),showValue:!1,style:{height:"10px"},class:Z(["available-progress",o.getProgressClass(h.confirmed_seats,h.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:g(({data:h})=>[s("div",Te,[s("p",Fe," 0 /"+O(h.confirmed_seats),1),l(r,{value:h.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(a,null,{body:g(({data:h})=>[H(l(u,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:b=>o.openDialog(h)},null,8,["onClick"]),[[F,"Prenota",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","rowClass","expandedRows"])])}const $e=P(Ce,[["render",Be]]);class Me{static async fetchAll(){return(await I("/locations/select?online=true")).data}}const X=R({id:"location",state:()=>({location:{},locations:[],response_locations:{}}),getters:{allLocations:t=>t.response_locations.locations,responseLocations:t=>t.response_locations,getTotalLocations:t=>t.response_locations?t.response_locations.total:0,getCurrentLocation:t=>t.location},actions:{async fetchAllLocations(){await Me.fetchAll().then(t=>this.response_locations=t)}}}),ze={props:["filters"],setup(t,e){$(()=>{m();let y=L.now();n.value=t.filters,n.value.date=y.toFormat("dd/MM/yyyy"),h()});const n=k({}),o=X(),c=J(),_=j(),a=k([]),r=k(),u=S(()=>o.allLocations),f=S(()=>c.getCalendar),i=function(){},d=async function(y){await c.fetchCalendar(y).then(()=>{}).catch(x=>{B(_,x)})},m=async function(){await o.fetchAllLocations().then(()=>{T()}).catch(y=>{B(_,y)})},T=function(){if(t.filters.location_permalink){const y=u.value.find(x=>x.permalink===t.filters.location_permalink);a.value=y.courses}},F=function(y){let x={};x.month=L.fromJSDate(new Date(y)).month,x.year=L.fromJSDate(new Date(y)).year,x.location_permalink=t.filters.location_permalink,r.value={month:x.month,year:x.year},d(x)},h=function(){let y=L.now(),x={location_permalink:"",month:"",year:""};x.location_permalink=t.filters.location_permalink,x.month=y.month+"",x.year=y.year+"",d(x)},b=function(y){if(f.value.web_dates&&f.value.web_dates.length!=0){let x=y.month+1;x=y.month<10?"0"+x:x;let M=y.day<10?"0"+y.day:y.day,G=y.year+"-"+x+"-"+M;return f.value.web_dates.find(Q=>Q==G)}},C=function(y){let x={location_permalink:t.filters.location_permalink,month:y.month,year:y.year};d(x)};return U(t.filters,()=>{if(r.value){let y={location_permalink:t.filters.location_permalink,month:r.value.month,year:r.value.year};d(y)}else h()}),{form:n,courses:a,locations:u,calendar:f,resetField:i,getCourses:T,onDateChange:F,getDayFromDate:b,onMonthChange:C}}};const Ie={class:"flex calendar-filter"},Re={key:0,class:"special-day"};function je(t,e,n,o,c,_){const a=p("Calendar");return w(),V("div",Ie,[l(a,{modelValue:o.form.date,"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.date=r),inline:"",onDateSelect:e[1]||(e[1]=r=>o.onDateChange(r)),onMonthChange:e[2]||(e[2]=r=>o.onMonthChange(r))},{date:g(r=>[o.getDayFromDate(r.date)?(w(),V("div",Re,[s("span",null,O(r.date.day),1)])):(w(),V(E,{key:1},[A(O(r.date.day),1)],64))]),_:1},8,["modelValue"])])}const Ee=P(ze,[["render",je]]),qe={props:["filters"],setup(t,e){$(()=>{n.value=Object.assign({},t.filters),n.value.date=L.now().toFormat("dd/MM/yyyy"),_.value=oe(8,20),_.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=k({}),o=k([]),c=X();j();const _=k([]),a=J(),r=S(()=>c.allLocations),u=S(()=>a.responseOrders),f=function(){n.value.name=null,n.value.course=o.value[0].name,n.value.hour=_.value[0],e.emit("onSubmit",n.value)},i=function(){if(o.value=[],n.value.location_permalink){const d=r.value.find(m=>m.permalink===n.value.location_permalink);o.value=d.courses,o.value[0].id!="-1"&&o.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=o.value[0].name}};return U(r,()=>{t.filters.location_permalink&&r.value&&(n.value=Object.assign({},t.filters),n.value.hour||(n.value.hour="Tutti gli orari"),i())}),U(t.filters,()=>{t.filters.location_permalink&&r.value&&n.value.location_permalink&&n.value.location_permalink!=t.filters.location_permalink&&(n.value=Object.assign({},t.filters),n.value.hour||(n.value.hour="Tutti gli orari"),i())}),U(u,()=>{}),{form:n,courses:o,hours:_,locations:r,responseOrders:u,resetField:f,getCourses:i}}},Je={class:"formgrid grid px-0 align-items-center"},Ge={key:0,class:"field col-4 flex flex-column"},Qe=s("label",{for:"typology"},"Filtra per percorso",-1),We={key:1,class:"field col-3 flex flex-column"},He=s("label",{for:"typology"},"Filtra per orario (dalle)",-1),Ke=s("div",{class:"col-12"},null,-1),Xe={class:"field col-4 flex flex-column"},Ye=s("label",{for:"typology"},"Filtra per nome acquirente",-1),Ze={class:"flex col-12 justify-content-end pt-1"};function et(t,e,n,o,c,_){const a=p("Dropdown"),r=p("InputText"),u=p("Button"),f=p("AccordionTab"),i=p("Accordion");return w(),q(i,{activeIndex:0},{default:g(()=>[l(f,{header:"FILTRI"},{default:g(()=>[s("div",Je,[o.form.location_permalink?(w(),V("div",Ge,[Qe,l(a,{modelValue:o.form.course,"onUpdate:modelValue":e[0]||(e[0]=d=>o.form.course=d),options:o.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):N("",!0),o.responseOrders?(w(),V("div",We,[He,l(a,{modelValue:o.form.hour,"onUpdate:modelValue":e[1]||(e[1]=d=>o.form.hour=d),options:o.hours,placeholder:""},null,8,["modelValue","options"])])):N("",!0),Ke,s("div",Xe,[Ye,l(r,{modelValue:o.form.name,"onUpdate:modelValue":e[2]||(e[2]=d=>o.form.name=d),placeholder:""},null,8,["modelValue"])])]),s("div",Ze,[l(u,{label:"Ricerca",class:"mr-2",onClick:e[3]||(e[3]=d=>t.$emit("onSubmit",o.form))}),l(u,{label:"Annulla",class:"p-button-outlined",onClick:e[4]||(e[4]=d=>o.resetField())})])]),_:1})]),_:1})}const tt=P(qe,[["render",et]]);class ot{static async fetchAll(e){const n=e.get("location_permalink");return e.delete("location_permalink"),e.set("api_version","v2"),(await I(`/ticket_office/${n}/courses`,e)).data}}const nt=R({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.response_courses.tickets,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await ot.fetchAll(t).then(e=>this.response_courses=e)}}});class st{static async fetchAll(e){const n=e.get("location_permalink");return e.delete("location_permalink"),e.set("api_version","v2"),(await I(`/ticket_office/${n}/tickets`,e)).data}}const lt=R({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.response_tickets.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await st.fetchAll(t).then(e=>this.response_tickets=e)}}}),at={props:["form","price","index","ticket"],setup(t,e){const n=k(0),o=function(){n.value++,_()},c=function(){n.value>0&&n.value--,_()},_=function(){const a={counter:n.value,price:t.price,index:t.index,ticket:t.ticket};e.emit("changeCounter",a)};return{counter:n,decrement:c,increment:o}}};const it={class:"btn-plus-min flex align-items-center"},rt={class:"counter"};function ct(t,e,n,o,c,_){const a=p("Button");return w(),V("div",it,[l(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:o.decrement,disabled:o.counter===0},null,8,["onClick","disabled"]),s("div",rt,O(o.counter),1),l(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:o.increment},null,8,["onClick"])])}const dt=P(at,[["render",ct]]),ut={props:["tickets","form"],setup(t){const e=k(0),n=k([]);return{total:e,partialTotals:n,onChangeCounter:function(c){n.value[c.index]={partial_total:c.price*c.counter,ticket:c.ticket,quantity:c.counter},e.value=0,n.value.forEach(_=>{_.partial_total==0&&n.value.splice(n.value.indexOf(_)),e.value+=_.partial_total})}}},components:{PlusMinusButton:dt}},mt={key:0,class:"flex justify-content-between align-items-center"},ft={class:"flex align-items-center col-9"},_t={class:"col-4 pl-0"},pt={class:"text-right col-2"},ht={class:"col-3 flex justify-content-end"},vt={key:0,class:"flex justify-content-between align-items-center"},yt=s("div",{class:"flex align-items-center col-9"},[s("b",{class:"col-5 pl-0"},"Biglietto a data aperta"),s("div",{class:"text-right col-2"},"€ 17.00")],-1),gt={class:"col-3 flex justify-content-end"},kt=s("hr",{class:"mt-3"},null,-1),bt={class:"flex align-items-center justify-content-between"},wt={class:"col-9 flex"},xt=s("div",{class:"col-4 pl-0"},[s("b",null,"Totale")],-1),Ct={class:"col-2 text-right"},Vt={class:"col-3 flex justify-content-end"};function Dt(t,e,n,o,c,_){const a=p("PlusMinusButton"),r=p("Button");return w(),V(E,null,[(w(!0),V(E,null,te(n.tickets,(u,f)=>{var i,d,m;return w(),V("div",{key:u.id},[((i=u.course)==null?void 0:i.id)==((d=n.form.course)==null?void 0:d.id)?(w(),V("div",mt,[s("div",ft,[s("b",_t,O(u.name),1),s("div",pt,"€ "+O((m=u.price)==null?void 0:m.toFixed(2)),1)]),s("div",ht,[l(a,{onChangeCounter:e[0]||(e[0]=T=>o.onChangeCounter(T)),price:u.price,index:f,ticket:u},null,8,["price","index","ticket"])])])):N("",!0)])}),128)),n.form.open_ticket?(w(),V("div",vt,[yt,s("div",gt,[l(a,{onChangeCounter:e[1]||(e[1]=u=>o.onChangeCounter(u)),price:"17.00",index:0,ticket:{}})])])):N("",!0),kt,s("div",bt,[s("div",wt,[xt,s("div",Ct,"€ "+O(o.total.toFixed(2)),1)]),s("div",Vt,[l(r,{label:"Prosegui",onClick:e[2]||(e[2]=u=>t.$emit("nextTab",o.partialTotals))})])])],64)}const Ot=P(ut,[["render",Dt]]);class Tt{static async fetchAll(){return(await I("/countries")).data.countries}}const Ft=R({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:t=>t.countries},actions:{async fetchAllCountries(){await Tt.fetchAll().then(t=>this.countries=t)}}}),St={setup(){$(()=>{c()});const t=Ft(),e=k({}),n=k([{id:"to_pay",name:"Da pagare"},{id:"payed",name:"Pagato"},{id:"free",name:"Gratuito"}]),o=S(()=>t.allCountries),c=async function(){await t.fetchAllCountries().then(()=>{e.value.country_id="88"})};return{form:e,countries:o,paymentList:n}}},Nt={class:"formgrid grid"},Lt={class:"field col-6"},At=s("label",{for:"user_name"},"Nome",-1),Ut={class:"field col-6"},Pt=s("label",{for:"user_surname"},"Cognome",-1),Bt={class:"field col-6"},$t=s("label",{for:"user_email"},"Email",-1),Mt={class:"field col-6"},zt=s("label",{for:"user_confirm_email"},"Conferma Email",-1),It={class:"field col-6"},Rt=s("label",{for:"user_phone"},"Telefono",-1),jt={class:"field col-6"},Et=s("label",{for:"country_id"},"Nazione",-1),qt={class:"field col-6"},Jt=s("label",{for:"user_zip"},"Cap",-1),Gt={class:"field col-6"},Qt=s("label",{for:"status"},"Pagamento",-1),Wt={class:"field col-12"},Ht={class:"field flex flex-column"},Kt=s("label",{for:"notes"},"Note",-1),Xt={class:"col-12 flex justify-content-end"};function Yt(t,e,n,o,c,_){const a=p("InputText"),r=p("Dropdown"),u=p("Textarea"),f=p("Button");return w(),V("div",Nt,[s("div",Lt,[At,l(a,{type:"text",modelValue:o.form.user_name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.user_name=i),class:"w-full"},null,8,["modelValue"])]),s("div",Ut,[Pt,l(a,{type:"text",modelValue:o.form.user_surname,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.user_surname=i),class:"w-full"},null,8,["modelValue"])]),s("div",Bt,[$t,l(a,{type:"text",modelValue:o.form.user_email,"onUpdate:modelValue":e[2]||(e[2]=i=>o.form.user_email=i),class:"w-full"},null,8,["modelValue"])]),s("div",Mt,[zt,l(a,{type:"text",modelValue:o.form.user_confirm_email,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.user_confirm_email=i),class:"w-full"},null,8,["modelValue"])]),s("div",It,[Rt,l(a,{type:"text",modelValue:o.form.user_phone,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.user_phone=i),class:"w-full"},null,8,["modelValue"])]),s("div",jt,[Et,l(r,{modelValue:o.form.country_id,"onUpdate:modelValue":e[5]||(e[5]=i=>o.form.country_id=i),options:o.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",qt,[Jt,l(a,{type:"text",modelValue:o.form.user_zip,"onUpdate:modelValue":e[6]||(e[6]=i=>o.form.user_zip=i),class:"w-full"},null,8,["modelValue"])]),s("div",Gt,[Qt,l(r,{modelValue:o.form.status,"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.status=i),options:o.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",Wt,[s("div",Ht,[Kt,l(u,{modelValue:o.form.notes,"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.notes=i),rows:"5",cols:"30"},null,8,["modelValue"])])]),s("div",Xt,[l(f,{label:"Prosegui",onClick:e[9]||(e[9]=i=>t.$emit("nextTab",o.form))})])])}const Zt=P(St,[["render",Yt]]),eo={props:["form"],setup(t){$(()=>{r()});const e=k(0),n=k([]),o=k(!1),c=lt();J();const _=j(),a=S(()=>c.allTickets),r=async function(){const i=new Map;i.set("location_permalink",t.form.location_permalink),await c.fetchAllTickets(i).then(()=>{}).catch(d=>{B(_,d)})};return{tickets:a,active:e,partialTotals:n,showOrderDetail:o,formatExplicitDate:K,formatDate:ne,onNextTab:function(i){e.value+=1,n.value=Object.assign([],i)},onConfirmPayment:function(i){e.value+=1,o.value=!0}}},components:{NewOrderTicketTab:Ot,NewOrderFormTab:Zt}};const to={key:0,class:"info-box"},oo={class:"font-medium"},no=s("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),so={class:"font-medium"},lo=s("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),ao={class:"capitalize"},io={key:0,class:"flex pb-4"},ro=s("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),co={class:"flex flex-column"},uo=s("div",{class:"m-0 text-center font-bold line-height-3"},[A(" Ordine #VIC_2023865090 registrato correttamente!"),s("br"),A(" Ti abbiamo inoltrato la conferma via mail. ")],-1),mo={class:"flex align-items-center justify-content-center mt-3"};function fo(t,e,n,o,c,_){var d;const a=p("NewOrderTicketTab"),r=p("TabPanel"),u=p("NewOrderFormTab"),f=p("Button"),i=p("TabView");return w(),V(E,null,[n.form&&!n.form.open_ticket?(w(),V("div",to,[s("p",oo,[no,A(" "+O((d=n.form.course)==null?void 0:d.name),1)]),s("p",so,[lo,s("span",ao,O(o.formatDate(n.form.date)),1),A(" - "+O(n.form.hour),1)]),o.partialTotals&&o.partialTotals.length>0?(w(),V("div",io,[ro,s("div",co,[(w(!0),V(E,null,te(o.partialTotals,m=>{var T;return w(),V("p",{class:"p-0 m-0 pb-1 font-medium",key:m.id},O((T=m.ticket)==null?void 0:T.name)+" x "+O(m.quantity)+" "+O(m.price),1)}),128))])])):N("",!0)])):N("",!0),l(i,{activeIndex:o.active,"onUpdate:activeIndex":e[3]||(e[3]=m=>o.active=m)},{default:g(()=>[l(r,{header:"Seleziona i biglietti",disabled:o.showOrderDetail},{default:g(()=>[l(a,{tickets:o.tickets,form:n.form,onNextTab:e[0]||(e[0]=m=>o.onNextTab(m))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(r,{header:"Inserisci i dati",disabled:o.showOrderDetail},{default:g(()=>[l(u,{onNextTab:e[1]||(e[1]=m=>o.onConfirmPayment(m))})]),_:1},8,["disabled"]),o.showOrderDetail?(w(),q(r,{key:0,header:"Ordine completato"},{default:g(()=>[uo,s("div",mo,[l(f,{label:"Stampa biglietti",outlined:"",onClick:e[2]||(e[2]=m=>t.$emit("closeDialog",m))})])]),_:1})):N("",!0)]),_:1},8,["activeIndex"])],64)}const _o=P(eo,[["render",fo]]),po={props:["filters"],setup(t){$(()=>{i(),c.value=oe(8,20),e.value=Object.assign({},t.filters),e.value.hour=ke(c.value)});const e=k({}),n=nt(),o=j(),c=k(),_=k(!1),a=se(),r=k(!1),u=S(()=>n.allCourses),f=S(()=>a.showNewOrderDialog),i=async function(){const F=new Map;F.set("location_permalink",t.filters.location_permalink),await n.fetchAllCourses(F).then(()=>{}).catch(h=>{B(o,h)})},d=function(){e.value={}},m=function(F){a.setNewOrderDialogVisibility(F)},T=function(){r.value=e.value.open_ticket};return U(t.filters,()=>{if((t.filters.location_permalink!=e.value.location_permalink||!e.value.course)&&i(),e.value.date=t.filters.date,e.value.location_permalink=t.filters.location_permalink,t.filters.hour&&t.filters.hour!="Tutti gli orari"&&(e.value.hour=t.filters.hour),t.filters.course&&!t.filters.course.id){let F=u.value.find(h=>h.name===t.filters.course.name);F&&(e.value.course=F)}}),U(u,()=>{e.value.course=u.value[0]}),{courses:u,form:e,hours:c,disableForm:r,visible:_,onCloseDialog:d,updateDialog:m,onChecked:T,dialogVisible:f,dialogStore:a}},components:{NewOrderDialog:_o}},ho=s("h2",{class:"mt-1"},"Nuova prenotazione",-1),vo={class:"formgrid grid px-0 align-items-center mt-4"},yo={key:0,class:"field flex flex-column w-full col-12"},go=s("label",{for:"typology"},"Scegli il percorso",-1),ko={key:1,class:"field flex flex-column w-full col-12"},bo=s("label",{for:"typology"},"Seleziona l'orario",-1),wo={class:"flex justify-content-between align-items-center mt-2"},xo={class:"flex align-items-center"},Co=s("label",{for:"open_ticket",class:"ml-2"}," Biglietto a data aperta ",-1),Vo={class:"flex align-items-center justify-content-between w-full"},Do=s("h2",null,"Nuova prenotazione",-1);function Oo(t,e,n,o,c,_){const a=p("Dropdown"),r=p("Checkbox"),u=p("Button"),f=p("NewOrderDialog"),i=p("Dialog"),d=p("Card");return w(),q(d,{class:"mt-4"},{content:g(()=>[ho,s("div",vo,[n.filters.location_permalink?(w(),V("div",yo,[go,l(a,{modelValue:o.form.course,"onUpdate:modelValue":e[0]||(e[0]=m=>o.form.course=m),options:o.courses,optionLabel:"name",disabled:o.disableForm},null,8,["modelValue","options","disabled"])])):N("",!0),n.filters.location_permalink?(w(),V("div",ko,[bo,l(a,{modelValue:o.form.hour,"onUpdate:modelValue":e[1]||(e[1]=m=>o.form.hour=m),options:o.hours,disabled:o.disableForm},null,8,["modelValue","options","disabled"])])):N("",!0)]),s("div",wo,[s("div",xo,[l(r,{modelValue:o.form.open_ticket,"onUpdate:modelValue":e[2]||(e[2]=m=>o.form.open_ticket=m),inputId:"open_ticket",binary:!0,onChange:e[3]||(e[3]=m=>o.onChecked())},null,8,["modelValue"]),Co]),l(u,{label:"Prenota",disabled:!o.form.course||!o.form.hour,onClick:e[4]||(e[4]=m=>o.updateDialog(!0))},null,8,["disabled"])]),l(i,{visible:o.dialogVisible,"onUpdate:visible":e[7]||(e[7]=m=>o.dialogVisible=m),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1},{header:g(()=>[s("div",Vo,[Do,l(u,{icon:"pi pi-times",text:"",rounded:"",onClick:e[5]||(e[5]=m=>o.updateDialog(!1))})])]),default:g(()=>[l(f,{form:o.form,onCloseDialog:e[6]||(e[6]=m=>o.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const To=P(po,[["render",Oo]]),Fo={setup(){$(()=>{_.value&&(t.value.location_permalink=_.value.location.permalink,r())});const t=k({}),e=k(),n=ve(),o=X(),c=j(),_=S(()=>n.currentUser),a=S(()=>o.allLocations),r=async function(){await o.fetchAllLocations().then(()=>{}).catch(f=>{B(c,f)})};return{filters:t,orderTable:e,user:_,locations:a,fetchAllLocations:r,formatDate:ne,onUpdateFilters:function(f){t.value.hour=f.start_at,t.value.course={name:f.course_name},f.course&&(t.value.course={id:f.course}),t.value.name=f.name,f.hour&&(f.hour.start_at?t.value.hour=f.hour.start_at:t.value.hour=f.hour)}}},components:{CalendarFilter:Ee,OrderTable:$e,OrderFilter:tt,NewOrderCard:To}};const So={class:"flex justify-content-between align-items-center"},No={class:"field flex flex-column mt-3"},Lo={key:0,style:{color:"#495057"}},Ao=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Uo={class:"capitalize text-xl"},Po={class:"flex gap-4"},Bo={key:0,class:"col-3 mt-3"},$o={class:"col-9 mt-3"};function Mo(t,e,n,o,c,_){const a=p("Dropdown"),r=p("CalendarFilter"),u=p("NewOrderCard"),f=p("OrderFilter"),i=p("OrderTable");return w(),V("div",null,[s("div",So,[s("div",No,[l(a,{modelValue:o.filters.location_permalink,"onUpdate:modelValue":e[0]||(e[0]=d=>o.filters.location_permalink=d),options:o.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),o.filters&&o.filters.date?(w(),V("div",Lo,[Ao,s("span",Uo,O(o.formatDate(o.filters.date)),1)])):N("",!0)]),s("div",Po,[o.filters.location_permalink?(w(),V("div",Bo,[l(r,{filters:o.filters},null,8,["filters"]),l(u,{filters:o.filters},null,8,["filters"])])):N("",!0),s("div",$o,[l(f,{filters:o.filters,onOnSubmit:e[1]||(e[1]=d=>o.onUpdateFilters(d))},null,8,["filters"]),o.filters.date?(w(),q(i,{key:0,filters:o.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:e[2]||(e[2]=d=>o.onUpdateFilters(d))},null,8,["filters"])):N("",!0)])])])}const Ro=P(Fo,[["render",Mo]]);export{Ro as default};
