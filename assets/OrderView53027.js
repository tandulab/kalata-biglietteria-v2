import{I as R,J as Y,K as fe,L as _e,M as I,o as B,c as S,N as pe,a as j,x as k,i as A,_ as U,r as f,O as he,b as w,e as V,f as l,w as y,h as L,n as Z,g as s,t as O,P as H,Q as E,R as q,S as F,T as te,u as ve}from"../index53027.js";import{D as N,f as ye,e as $,s as ge,p as oe,g as ke}from"./helpers53027.js";const be=function(t){return N.fromJSDate(new Date(t)).toFormat("yyyy-LL-dd")},ee=function(t){return N.fromFormat(t+"","dd/MM/yyyy").toFormat("yyyy-LL-dd")},we=function(t){return N.fromSeconds(t).toFormat("dd/MM/yyyy")},K=function(t){const e=N.fromJSDate(new Date(t)),n=e.setLocale("it").toFormat("cccc"),o=e.toFormat("d"),d=e.setLocale("it").toFormat("LLLL");return`${n} ${o} ${d}`},xe=function(t){const e=N.fromFormat(t,"dd/MM/yyyy"),n=e.setLocale("it").toFormat("cccc"),o=e.toFormat("d"),d=e.setLocale("it").toFormat("LLLL");return`${n} ${o} ${d}`},ne=function(t){return K(t).includes("Invalid DateTime")?xe(t):K(t)};class z{static async fetchAll(e){const n=new Map(e),o=n.get("location_permalink");return n.delete("location_permalink"),n.delete("name"),n.delete("course"),n.set("api_version","v2"),(await R(`/ticket_office/${o}/orders`,n)).data}static async calendar(e){const n=e.location_permalink;return delete e.location_peramlink,e.api_version="v2",(await Y(`/ticket_office/${n}/search/calendar`,e)).data}static async getOrderDetail(e){return(await R(`/orders/${e}`)).data.order}static async createOrder(e){const n=e.get("location_permalink");return e.delete("location_permalink"),(await fe(`/ticket_office/${n}/orders`,e)).data.order}static async deleteOrder(e){return(await _e(`/orders/${e}`)).data}static async updateOrder(e){return(await Y(`/orders/${e.id}/update`,e.formData)).data.order}}const J=I({id:"order",state:()=>({order:{},orders:[],response_orders:{},total_orders:Number,calendar:{}}),getters:{allOrders:t=>t.response_orders.orders,responseOrders:t=>t.response_orders,getTotalOrders:t=>t.response_orders?t.response_orders.total:0,getCurrentOrder:t=>t.order,status:()=>[{name:"Attivo",value:"true"},{name:"Disattivo",value:"false"}],getCalendar:t=>t.calendar},actions:{async fetchAllOrders(t){await z.fetchAll(t).then(e=>this.response_orders=this.filterOrder(e,t))},filterOrder(t,e){if(e.get("course")&&e.get("course")!="Tutti i percorsi"&&(t.time_slots=t.time_slots.filter(n=>n.course_name==e.get("course"))),e.get("hour")&&(t.time_slots=ye(e.get("hour"),t.time_slots)),e.get("name")&&e.get("name")!=null){const n={time_slots:[]};return t.time_slots&&t.time_slots.forEach(o=>{let d=!1;o.orders.forEach(m=>{(m.user_name.trim().toLowerCase()===e.get("name").trim().toLowerCase()||m.user_surname.trim().toLowerCase()===e.get("name").trim().toLowerCase())&&(d=!0)}),d&&n.time_slots.push(o)}),n}return t},async fetchOrderDetail(t){await z.getOrderDetail(t).then(e=>this.order=e)},async fetchCalendar(t){await z.calendar(t).then(e=>this.calendar=e)},async createOrder(t){await z.createOrder(t).then(e=>this.order=e)},async updateOrder(t){await z.updateOrder(t).then(e=>this.order=e)},async deleteOrder(t){await z.deleteOrder(t).then(e=>this.order=e)}}}),se=I({id:"newOrderDialog",state:()=>({_showNewOrderDialog:!1}),getters:{showNewOrderDialog:t=>t._showNewOrderDialog},actions:{setNewOrderDialogVisibility(t){this.updateNewOrderDialog(t)},updateNewOrderDialog(t){this._showNewOrderDialog=t}}}),Ce={props:["filters"],setup(t,e){B(()=>{g.value=!0,b.value={first:0,rows:r.value.rows,sortField:null,sortOrder:null},b.value.page=0,t.filters.location_permalink&&M()});const n=J(),o=se(),d=S(()=>n.responseOrders),m=S(()=>n.status),a=pe(),i=S(()=>a.submitDialog),_=S(()=>a.cancelDialog),u=j(),r=k(),c=k(),p=k(),T=k([{code:"2023795703",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!0},{code:"2023795704",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795705",type:"Biglietto ridotto",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795706",type:"Biglietto gratuito",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1}]),P=k(["Da pagare","Pagato","Gratuito"]),g=k(!0),b=k(),C=k(0),v=k([]),x=k([]);function M(){g.value=!0;let h=new Map;for(const D in t.filters)D=="date"?ee(t.filters.date)=="Invalid DateTime"?h.set("date",be(t.filters.date)):h.set("date",ee(t.filters.date)):t.filters.location_permalink&&h.set("location_permalink",t.filters.location_permalink),D=="course"&&t.filters.course.id!="-1"&&h.set("course",t.filters.course.id),D=="hour"&&t.filters.hour!="Tutti gli orari"&&h.set("hour",t.filters.hour),D=="name"&&h.set("name",t.filters.name);setTimeout(()=>{G(h)},Math.random()*1e3+250)}const G=async function(h){await n.fetchAllOrders(h).then(()=>{g.value=!1}).catch(D=>{g.value=!1,$(u,D)})},Q=function(h){},le=function(h,D){h.stopPropagation(),h.stopImmediatePropagation(),c.value=D;let W="Sei sicuro di voler disattivare l'utente <b>"+(D==null?void 0:D.email)+"</b> ?";a.setDialog("Cambia stato","Conferma","Annulla",W),a.setDynamicDialogVisibility(!0)},ae=async function(){var D;g.value=!0;const h={order_id:c.value.id,order:{enabled:(D=c.value)==null?void 0:D.enabled}};await n.updateOrder(h).then(()=>{g.value=!1,ge(u,{message:"Stato aggiornato correttamente",error:!1}),M()}).catch(W=>{g.value=!1,$(u,W)})},ie=function(h){return h!=null&&h.cluster?h.cluster:""},re=h=>{p.value.toggle(h)},ce=(h,D)=>{if(h>=(h+D)/2)return"green";if(h<=(h+D)/3)return"red"},de=function(h,D){D&&(p.value.note=D,p.value.toggle(h))},ue=function(h){},me=function(h){const D={course_name:h.course_name,start_at:h.start_at};e.emit("updateFilters",D),o.setNewOrderDialogVisibility(!0)};return A(i,()=>{ae()}),A(_,()=>{c.value.enabled?c.value.enabled=!1:c.value.enabled=!0}),A(t.filters,()=>{t.filters.location_permalink&&M()}),{dt:r,responseOrders:d,loading:g,totalRecords:C,lazyParams:b,currentOrder:c,status:m,expandedRows:v,expandedRows1:x,op:p,tmp_tickets:T,payments:P,dialogStore:o,showSidebar:Q,loadLazyData:M,onChangeStatus:le,getRowClass:ie,toggle:re,getProgressClass:ce,showNotes:de,checkAll:ue,openDialog:me,formatDataFromUnixTimestamps:we}},components:{}};const De={class:"order-table"},Ve={style:{width:"15rem"}},Oe={class:"m-0 text-right",style:{"font-size":"12px"}},Te={style:{width:"15rem"}},Se={class:"m-0 text-right",style:{"font-size":"12px"}},Fe=["href"],Ne=s("i",{class:"pi pi-file-pdf"},null,-1),Le=[Ne],Ae=["href"],Ue=s("i",{class:"pi pi-file-pdf"},null,-1),Pe=[Ue];function $e(t,e,n,o,d,m){const a=f("Column"),i=f("ProgressBar"),_=f("Button"),u=f("Dropdown"),r=f("Checkbox"),c=f("OverlayPanel"),p=f("Badge"),T=f("DataTable"),P=he("tooltip");return w(),V("div",De,[l(T,{value:o.responseOrders.time_slots,totalRecords:o.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:"",rowClass:o.getRowClass,expandedRows:o.expandedRows,"onUpdate:expandedRows":e[1]||(e[1]=g=>o.expandedRows=g)},{empty:y(()=>[L(" Nessuna prenotazione trovata. ")]),expansion:y(g=>[l(T,{value:g.data.orders,class:"m-4 mx-4",expandedRows:o.expandedRows1,"onUpdate:expandedRows":e[0]||(e[0]=b=>o.expandedRows1=b)},{empty:y(()=>[L(" Nessuna prenotazione trovata. ")]),expansion:y(b=>[l(T,{value:o.tmp_tickets,class:"m-4 mx-5"},{default:y(()=>[l(a,{header:"Codice biglietto",field:"code"}),l(a,{header:"Tipo biglietto",field:"type"},{body:y(({data:C})=>[l(p,{value:C.type,class:Z([C.type,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(a,{header:"PDF",field:"tickets_url"},{body:y(({data:C})=>[s("a",{href:C.tickets_url,target:"_blank"},Pe,8,Ae)]),_:1}),l(a,{header:"Check-in"},{body:y(({data:C})=>[s("div",null,[l(r,{modelValue:C.check_in,"onUpdate:modelValue":v=>C.check_in=v,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(a,{header:"No-show"},{body:y(({data:C})=>[s("div",null,[l(r,{modelValue:C.no_show_tickets,"onUpdate:modelValue":v=>C.no_show_tickets=v,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["value"])]),default:y(()=>[l(a,{header:"Codice",field:"code"}),l(a,{header:"Effettuato da",field:"created_by"}),l(a,{header:"Acquirente"},{body:y(({data:b})=>[L(O(b.user_name)+" "+O(b.user_surname),1)]),_:1}),l(a,{header:"Q.ta",field:"quantity"}),l(a,{header:"Pdf",field:"pdf"},{body:y(({data:b})=>[s("a",{href:b.tickets_url,target:"_blank"},Le,8,Fe)]),_:1}),l(a,{header:"Pagamento"},{body:y(({data:b})=>[l(u,{modelValue:b.payment,"onUpdate:modelValue":C=>b.payment=C,options:o.payments,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),l(a,{header:"Check-in"},{body:y(({data:b})=>[s("div",null,[l(r,{modelValue:b.check_in,"onUpdate:modelValue":C=>b.check_in=C,binary:!0,onClick:C=>o.checkAll(b.time_slot)},null,8,["modelValue","onUpdate:modelValue","onClick"])])]),_:1}),l(a,{header:"No-show"},{body:y(({data:b})=>[s("div",null,[l(r,{modelValue:b.no_show_tickets,"onUpdate:modelValue":C=>b.no_show_tickets=C,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(a,{header:"",style:{"padding-right":"0"}},{body:y(({data:b})=>[H(l(_,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-comment",text:"",rounded:"",onClick:C=>o.showNotes(C,b.notes),disabled:!b.notes},null,8,["onClick","disabled"]),[[P,"Note",void 0,{top:!0}]]),l(c,{ref:"op"},{default:y(()=>[L(O(o.op.note),1)]),_:1},512),H(l(_,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-trash",text:"",rounded:"",disabled:!b.can_cancel},null,8,["disabled"]),[[P,"Elimina",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:2},1032,["value","expandedRows"])]),default:y(()=>[l(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),l(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:y(({data:g})=>[s("div",Ve,[s("p",Oe,O(g.confirmed_seats)+"/"+O(g.remaing_seats+g.confirmed_seats),1),l(i,{value:g.confirmed_seats*100/(g.remaing_seats+g.confirmed_seats),showValue:!1,style:{height:"10px"},class:Z(["available-progress",o.getProgressClass(g.confirmed_seats,g.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:y(({data:g})=>[s("div",Te,[s("p",Se," 0 /"+O(g.confirmed_seats),1),l(i,{value:g.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(a,null,{body:y(({data:g})=>[H(l(_,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:b=>o.openDialog(g)},null,8,["onClick"]),[[P,"Prenota",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","rowClass","expandedRows"])])}const Be=U(Ce,[["render",$e]]);class Me{static async fetchAll(){return(await R("/locations/select?online=true")).data}}const X=I({id:"location",state:()=>({location:{},locations:[],response_locations:{}}),getters:{allLocations:t=>t.response_locations.locations,responseLocations:t=>t.response_locations,getTotalLocations:t=>t.response_locations?t.response_locations.total:0,getCurrentLocation:t=>t.location},actions:{async fetchAllLocations(){await Me.fetchAll().then(t=>this.response_locations=t)}}}),ze={props:["filters"],setup(t,e){B(()=>{p();let v=N.now();n.value=t.filters,n.value.date=v.toFormat("dd/MM/yyyy"),g()});const n=k({}),o=X(),d=J(),m=j(),a=k([]),i=k(),_=S(()=>o.allLocations),u=S(()=>d.getCalendar),r=function(){},c=async function(v){await d.fetchCalendar(v).then(()=>{}).catch(x=>{$(m,x)})},p=async function(){await o.fetchAllLocations().then(()=>{T()}).catch(v=>{$(m,v)})},T=function(){if(t.filters.location_permalink){const v=_.value.find(x=>x.permalink===t.filters.location_permalink);a.value=v.courses}},P=function(v){let x={};x.month=N.fromJSDate(new Date(v)).month,x.year=N.fromJSDate(new Date(v)).year,x.location_permalink=t.filters.location_permalink,i.value={month:x.month,year:x.year},c(x)},g=function(){let v=N.now(),x={location_permalink:"",month:"",year:""};x.location_permalink=t.filters.location_permalink,x.month=v.month+"",x.year=v.year+"",c(x)},b=function(v){if(u.value.web_dates&&u.value.web_dates.length!=0){let x=v.month+1;x=v.month<10?"0"+x:x;let M=v.day<10?"0"+v.day:v.day,G=v.year+"-"+x+"-"+M;return u.value.web_dates.find(Q=>Q==G)}},C=function(v){let x={location_permalink:t.filters.location_permalink,month:v.month,year:v.year};c(x)};return A(t.filters,()=>{if(i.value){let v={location_permalink:t.filters.location_permalink,month:i.value.month,year:i.value.year};c(v)}else g()}),{form:n,courses:a,locations:_,calendar:u,resetField:r,getCourses:T,onDateChange:P,getDayFromDate:b,onMonthChange:C}}};const Re={class:"flex calendar-filter"},Ie={key:0,class:"special-day"};function je(t,e,n,o,d,m){const a=f("Calendar");return w(),V("div",Re,[l(a,{modelValue:o.form.date,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.date=i),inline:"",onDateSelect:e[1]||(e[1]=i=>o.onDateChange(i)),onMonthChange:e[2]||(e[2]=i=>o.onMonthChange(i))},{date:y(i=>[o.getDayFromDate(i.date)?(w(),V("div",Ie,[s("span",null,O(i.date.day),1)])):(w(),V(E,{key:1},[L(O(i.date.day),1)],64))]),_:1},8,["modelValue"])])}const Ee=U(ze,[["render",je]]),qe={props:["filters"],setup(t,e){B(()=>{n.value=Object.assign({},t.filters),n.value.date=N.now().toFormat("dd/MM/yyyy"),m.value=oe(8,20),m.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=k({}),o=k([]),d=X();j();const m=k([]),a=J(),i=S(()=>d.allLocations),_=S(()=>a.responseOrders),u=function(){n.value.name=null,n.value.course=o.value[0].name,n.value.hour=m.value[0],e.emit("onSubmit",n.value)},r=function(){if(o.value=[],n.value.location_permalink){const c=i.value.find(p=>p.permalink===n.value.location_permalink);o.value=c.courses,o.value[0].id!="-1"&&o.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=o.value[0].name}};return A(i,()=>{t.filters.location_permalink&&i.value&&(n.value=Object.assign({},t.filters),n.value.hour||(n.value.hour="Tutti gli orari"),r())}),A(t.filters,()=>{t.filters.location_permalink&&i.value&&n.value.location_permalink&&n.value.location_permalink!=t.filters.location_permalink&&(n.value=Object.assign({},t.filters),n.value.hour||(n.value.hour="Tutti gli orari"),r())}),A(_,()=>{}),{form:n,courses:o,hours:m,locations:i,responseOrders:_,resetField:u,getCourses:r}}},Je={class:"formgrid grid px-0 align-items-center"},Ge={key:0,class:"field col-4 flex flex-column"},Qe=s("label",{for:"typology"},"Filtra per percorso",-1),We={key:1,class:"field col-3 flex flex-column"},He=s("label",{for:"typology"},"Filtra per orario (dalle)",-1),Ke=s("div",{class:"col-12"},null,-1),Xe={class:"field col-4 flex flex-column"},Ye=s("label",{for:"typology"},"Filtra per nome acquirente",-1),Ze={class:"flex col-12 justify-content-end pt-1"};function et(t,e,n,o,d,m){const a=f("Dropdown"),i=f("InputText"),_=f("Button"),u=f("AccordionTab"),r=f("Accordion");return w(),q(r,{activeIndex:0},{default:y(()=>[l(u,{header:"FILTRI"},{default:y(()=>[s("div",Je,[o.form.location_permalink?(w(),V("div",Ge,[Qe,l(a,{modelValue:o.form.course,"onUpdate:modelValue":e[0]||(e[0]=c=>o.form.course=c),options:o.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):F("",!0),o.responseOrders?(w(),V("div",We,[He,l(a,{modelValue:o.form.hour,"onUpdate:modelValue":e[1]||(e[1]=c=>o.form.hour=c),options:o.hours,placeholder:""},null,8,["modelValue","options"])])):F("",!0),Ke,s("div",Xe,[Ye,l(i,{modelValue:o.form.name,"onUpdate:modelValue":e[2]||(e[2]=c=>o.form.name=c),placeholder:""},null,8,["modelValue"])])]),s("div",Ze,[l(_,{label:"Ricerca",class:"mr-2",onClick:e[3]||(e[3]=c=>t.$emit("onSubmit",o.form))}),l(_,{label:"Annulla",class:"p-button-outlined",onClick:e[4]||(e[4]=c=>o.resetField())})])]),_:1})]),_:1})}const tt=U(qe,[["render",et]]);class ot{static async fetchAll(e){const n=e.get("location_permalink");return e.delete("location_permalink"),e.set("api_version","v2"),(await R(`/ticket_office/${n}/courses`,e)).data}}const nt=I({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.response_courses.tickets,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await ot.fetchAll(t).then(e=>this.response_courses=e)}}});class st{static async fetchAll(e){const n=e.get("location_permalink");return e.delete("location_permalink"),e.set("api_version","v2"),(await R(`/ticket_office/${n}/tickets`,e)).data}}const lt=I({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.response_tickets.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await st.fetchAll(t).then(e=>this.response_tickets=e)}}}),at={props:["form","price","index","ticket"],setup(t,e){const n=k(0),o=function(){n.value++,m()},d=function(){n.value>0&&n.value--,m()},m=function(){const a={counter:n.value,price:t.price,index:t.index,ticket:t.ticket};e.emit("changeCounter",a)};return{counter:n,decrement:d,increment:o}}};const it={class:"btn-plus-min flex align-items-center"},rt={class:"counter"};function ct(t,e,n,o,d,m){const a=f("Button");return w(),V("div",it,[l(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:o.decrement,disabled:o.counter===0},null,8,["onClick","disabled"]),s("div",rt,O(o.counter),1),l(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:o.increment},null,8,["onClick"])])}const dt=U(at,[["render",ct]]),ut={props:["tickets","form"],setup(t){const e=k(0),n=k([]);return{total:e,partialTotals:n,onChangeCounter:function(d){n.value[d.index]={partial_total:d.price*d.counter,ticket:d.ticket,quantity:d.counter},e.value=0,n.value.forEach(m=>{m.partial_total==0&&n.value.splice(n.value.indexOf(m)),e.value+=m.partial_total})}}},components:{PlusMinusButton:dt}},mt={key:0,class:"flex justify-content-between align-items-center"},ft={class:"flex align-items-center col-9"},_t={class:"col-4 pl-0"},pt={class:"text-right col-2"},ht={class:"col-3 flex justify-content-end"},vt=s("hr",{class:"mt-3"},null,-1),yt={class:"flex align-items-center justify-content-between"},gt={class:"col-9 flex"},kt=s("div",{class:"col-4 pl-0"},[s("b",null,"Totale")],-1),bt={class:"col-2 text-right"},wt={class:"col-3 flex justify-content-end"};function xt(t,e,n,o,d,m){const a=f("PlusMinusButton"),i=f("Button");return w(),V(E,null,[(w(!0),V(E,null,te(n.tickets,(_,u)=>{var r,c,p;return w(),V("div",{key:_.id},[((r=_.course)==null?void 0:r.id)==((c=n.form.course)==null?void 0:c.id)?(w(),V("div",mt,[s("div",ft,[s("b",_t,O(_.name),1),s("div",pt,"€ "+O((p=_.price)==null?void 0:p.toFixed(2)),1)]),s("div",ht,[l(a,{onChangeCounter:e[0]||(e[0]=T=>o.onChangeCounter(T)),price:_.price,index:u,ticket:_},null,8,["price","index","ticket"])])])):F("",!0)])}),128)),vt,s("div",yt,[s("div",gt,[kt,s("div",bt,"€ "+O(o.total.toFixed(2)),1)]),s("div",wt,[l(i,{label:"Prosegui",onClick:e[1]||(e[1]=_=>t.$emit("nextTab",o.partialTotals))})])])],64)}const Ct=U(ut,[["render",xt]]);class Dt{static async fetchAll(){return(await R("/countries")).data.countries}}const Vt=I({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:t=>t.countries},actions:{async fetchAllCountries(){await Dt.fetchAll().then(t=>this.countries=t)}}}),Ot={setup(){B(()=>{d()});const t=Vt(),e=k({}),n=k([{id:"to_pay",name:"Da pagare"},{id:"payed",name:"Pagato"},{id:"free",name:"Gratuito"}]),o=S(()=>t.allCountries),d=async function(){await t.fetchAllCountries().then(()=>{e.value.country_id="88"})};return{form:e,countries:o,paymentList:n}}},Tt={class:"formgrid grid"},St={class:"field col-6"},Ft=s("label",{for:"user_name"},"Nome",-1),Nt={class:"field col-6"},Lt=s("label",{for:"user_surname"},"Cognome",-1),At={class:"field col-6"},Ut=s("label",{for:"user_email"},"Email",-1),Pt={class:"field col-6"},$t=s("label",{for:"user_confirm_email"},"Conferma Email",-1),Bt={class:"field col-6"},Mt=s("label",{for:"user_phone"},"Telefono",-1),zt={class:"field col-6"},Rt=s("label",{for:"country_id"},"Nazione",-1),It={class:"field col-6"},jt=s("label",{for:"user_zip"},"Cap",-1),Et={class:"field col-6"},qt=s("label",{for:"status"},"Pagamento",-1),Jt={class:"field col-12"},Gt={class:"field flex flex-column"},Qt=s("label",{for:"notes"},"Note",-1),Wt={class:"col-12 flex justify-content-end"};function Ht(t,e,n,o,d,m){const a=f("InputText"),i=f("Dropdown"),_=f("Textarea"),u=f("Button");return w(),V("div",Tt,[s("div",St,[Ft,l(a,{type:"text",modelValue:o.form.user_name,"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.user_name=r),class:"w-full"},null,8,["modelValue"])]),s("div",Nt,[Lt,l(a,{type:"text",modelValue:o.form.user_surname,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.user_surname=r),class:"w-full"},null,8,["modelValue"])]),s("div",At,[Ut,l(a,{type:"text",modelValue:o.form.user_email,"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.user_email=r),class:"w-full"},null,8,["modelValue"])]),s("div",Pt,[$t,l(a,{type:"text",modelValue:o.form.user_confirm_email,"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.user_confirm_email=r),class:"w-full"},null,8,["modelValue"])]),s("div",Bt,[Mt,l(a,{type:"text",modelValue:o.form.user_phone,"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.user_phone=r),class:"w-full"},null,8,["modelValue"])]),s("div",zt,[Rt,l(i,{modelValue:o.form.country_id,"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.country_id=r),options:o.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",It,[jt,l(a,{type:"text",modelValue:o.form.user_zip,"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.user_zip=r),class:"w-full"},null,8,["modelValue"])]),s("div",Et,[qt,l(i,{modelValue:o.form.status,"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.status=r),options:o.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",Jt,[s("div",Gt,[Qt,l(_,{modelValue:o.form.notes,"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.notes=r),rows:"5",cols:"30"},null,8,["modelValue"])])]),s("div",Wt,[l(u,{label:"Prosegui",onClick:e[9]||(e[9]=r=>t.$emit("nextTab",o.form))})])])}const Kt=U(Ot,[["render",Ht]]),Xt={props:["form"],setup(t){B(()=>{i()});const e=k(0),n=k([]),o=k(!1),d=lt();J();const m=j(),a=S(()=>d.allTickets),i=async function(){const r=new Map;r.set("location_permalink",t.form.location_permalink),await d.fetchAllTickets(r).then(()=>{}).catch(c=>{$(m,c)})};return{tickets:a,active:e,partialTotals:n,showOrderDetail:o,formatExplicitDate:K,formatDate:ne,onNextTab:function(r){e.value+=1,n.value=Object.assign([],r)},onConfirmPayment:function(r){e.value+=1,o.value=!0}}},components:{NewOrderTicketTab:Ct,NewOrderFormTab:Kt}};const Yt={key:0,class:"info-box"},Zt={class:"font-medium"},eo=s("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),to={class:"font-medium"},oo=s("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),no={class:"capitalize"},so={key:0,class:"flex pb-4"},lo=s("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),ao={class:"flex flex-column"},io=s("div",{class:"m-0 text-center font-bold line-height-3"},[L(" Ordine #VIC_2023865090 registrato correttamente!"),s("br"),L(" Ti abbiamo inoltrato la conferma via mail. ")],-1),ro={class:"flex align-items-center justify-content-center mt-3"};function co(t,e,n,o,d,m){var c;const a=f("NewOrderTicketTab"),i=f("TabPanel"),_=f("NewOrderFormTab"),u=f("Button"),r=f("TabView");return w(),V(E,null,[n.form?(w(),V("div",Yt,[s("p",Zt,[eo,L(" "+O((c=n.form.course)==null?void 0:c.name),1)]),s("p",to,[oo,s("span",no,O(o.formatDate(n.form.date)),1),L(" - "+O(n.form.hour),1)]),o.partialTotals&&o.partialTotals.length>0?(w(),V("div",so,[lo,s("div",ao,[(w(!0),V(E,null,te(o.partialTotals,p=>{var T;return w(),V("p",{class:"p-0 m-0 pb-1 font-medium",key:p.id},O((T=p.ticket)==null?void 0:T.name)+" x "+O(p.quantity)+" "+O(p.price),1)}),128))])])):F("",!0)])):F("",!0),l(r,{activeIndex:o.active,"onUpdate:activeIndex":e[3]||(e[3]=p=>o.active=p)},{default:y(()=>[l(i,{header:"Seleziona i biglietti",disabled:o.showOrderDetail},{default:y(()=>[l(a,{tickets:o.tickets,form:n.form,onNextTab:e[0]||(e[0]=p=>o.onNextTab(p))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(i,{header:"Inserisci i dati",disabled:o.showOrderDetail},{default:y(()=>[l(_,{onNextTab:e[1]||(e[1]=p=>o.onConfirmPayment(p))})]),_:1},8,["disabled"]),o.showOrderDetail?(w(),q(i,{key:0,header:"Ordine completato"},{default:y(()=>[io,s("div",ro,[l(u,{label:"Stampa biglietti",outlined:"",onClick:e[2]||(e[2]=p=>t.$emit("closeDialog",p))})])]),_:1})):F("",!0)]),_:1},8,["activeIndex"])],64)}const uo=U(Xt,[["render",co]]),mo={props:["filters"],setup(t){B(()=>{u(),d.value=oe(8,20),e.value=Object.assign({},t.filters),e.value.hour=ke(d.value)});const e=k({}),n=nt(),o=j(),d=k(),m=k(!1),a=se(),i=S(()=>n.allCourses),_=S(()=>a.showNewOrderDialog),u=async function(){const p=new Map;p.set("location_permalink",t.filters.location_permalink),await n.fetchAllCourses(p).then(()=>{}).catch(T=>{$(o,T)})},r=function(){e.value={}},c=function(p){a.setNewOrderDialogVisibility(p)};return A(t.filters,()=>{if((t.filters.location_permalink!=e.value.location_permalink||!e.value.course)&&u(),e.value.date=t.filters.date,e.value.location_permalink=t.filters.location_permalink,t.filters.hour&&t.filters.hour!="Tutti gli orari"&&(e.value.hour=t.filters.hour),t.filters.course&&!t.filters.course.id){let p=i.value.find(T=>T.name===t.filters.course.name);p&&(e.value.course=p)}}),A(i,()=>{e.value.course=i.value[0]}),{courses:i,form:e,hours:d,visible:m,onCloseDialog:r,updateDialog:c,dialogVisible:_,dialogStore:a}},components:{NewOrderDialog:uo}},fo=s("h2",{class:"mt-1"},"Nuova prenotazione",-1),_o={class:"formgrid grid px-0 align-items-center mt-4"},po={key:0,class:"field flex flex-column w-full col-12"},ho=s("label",{for:"typology"},"Scegli il percorso",-1),vo={key:1,class:"field flex flex-column w-full col-12"},yo=s("label",{for:"typology"},"Seleziona l'orario",-1),go={class:"flex justify-content-end mt-2"},ko={class:"flex align-items-center justify-content-between w-full"},bo=s("h2",null,"Nuova prenotazione",-1);function wo(t,e,n,o,d,m){const a=f("Dropdown"),i=f("Button"),_=f("NewOrderDialog"),u=f("Dialog"),r=f("Card");return w(),q(r,{class:"mt-4"},{content:y(()=>[fo,s("div",_o,[n.filters.location_permalink?(w(),V("div",po,[ho,l(a,{modelValue:o.form.course,"onUpdate:modelValue":e[0]||(e[0]=c=>o.form.course=c),options:o.courses,optionLabel:"name"},null,8,["modelValue","options"])])):F("",!0),n.filters.location_permalink?(w(),V("div",vo,[yo,l(a,{modelValue:o.form.hour,"onUpdate:modelValue":e[1]||(e[1]=c=>o.form.hour=c),options:o.hours},null,8,["modelValue","options"])])):F("",!0)]),s("div",go,[l(i,{label:"Prenota",disabled:!o.form.course||!o.form.hour,onClick:e[2]||(e[2]=c=>o.updateDialog(!0))},null,8,["disabled"])]),l(u,{visible:o.dialogVisible,"onUpdate:visible":e[5]||(e[5]=c=>o.dialogVisible=c),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1},{header:y(()=>[s("div",ko,[bo,l(i,{icon:"pi pi-times",text:"",rounded:"",onClick:e[3]||(e[3]=c=>o.updateDialog(!1))})])]),default:y(()=>[l(_,{form:o.form,onCloseDialog:e[4]||(e[4]=c=>o.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const xo=U(mo,[["render",wo]]),Co={setup(){B(()=>{m.value&&(t.value.location_permalink=m.value.location.permalink,i())});const t=k({}),e=k(),n=ve(),o=X(),d=j(),m=S(()=>n.currentUser),a=S(()=>o.allLocations),i=async function(){await o.fetchAllLocations().then(()=>{}).catch(u=>{$(d,u)})};return{filters:t,orderTable:e,user:m,locations:a,fetchAllLocations:i,formatDate:ne,onUpdateFilters:function(u){t.value.hour=u.start_at,t.value.course={name:u.course_name},u.course&&(t.value.course={id:u.course}),t.value.name=u.name,u.hour&&(u.hour.start_at?t.value.hour=u.hour.start_at:t.value.hour=u.hour)}}},components:{CalendarFilter:Ee,OrderTable:Be,OrderFilter:tt,NewOrderCard:xo}};const Do={class:"flex justify-content-between align-items-center"},Vo={class:"field flex flex-column mt-3"},Oo={key:0,style:{color:"#495057"}},To=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),So={class:"capitalize text-xl"},Fo={class:"flex gap-4"},No={key:0,class:"col-3 mt-3"},Lo={class:"col-9 mt-3"};function Ao(t,e,n,o,d,m){const a=f("Dropdown"),i=f("CalendarFilter"),_=f("NewOrderCard"),u=f("OrderFilter"),r=f("OrderTable");return w(),V("div",null,[s("div",Do,[s("div",Vo,[l(a,{modelValue:o.filters.location_permalink,"onUpdate:modelValue":e[0]||(e[0]=c=>o.filters.location_permalink=c),options:o.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),o.filters&&o.filters.date?(w(),V("div",Oo,[To,s("span",So,O(o.formatDate(o.filters.date)),1)])):F("",!0)]),s("div",Fo,[o.filters.location_permalink?(w(),V("div",No,[l(i,{filters:o.filters},null,8,["filters"]),l(_,{filters:o.filters},null,8,["filters"])])):F("",!0),s("div",Lo,[l(u,{filters:o.filters,onOnSubmit:e[1]||(e[1]=c=>o.onUpdateFilters(c))},null,8,["filters"]),o.filters.date?(w(),q(r,{key:0,filters:o.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:e[2]||(e[2]=c=>o.onUpdateFilters(c))},null,8,["filters"])):F("",!0)])])])}const $o=U(Co,[["render",Ao]]);export{$o as default};
