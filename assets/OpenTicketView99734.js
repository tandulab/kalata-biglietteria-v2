import{o as L,c as y,a as $,p as h,i as M,_ as C,r as v,b as k,e as b,f as a,w as _,h as D,t as w,g as s,F as U,s as S,n as P,z as j,u as q,q as E}from"../index99734.js";import{u as W,e as G,i as H,a as J,b as K}from"./location99734.js";import{u as Q,e as V,s as X}from"./helpers99734.js";const Y={props:["filters"],setup(n,o){L(()=>{p.value=!0,F.value={first:0,rows:f.value.rows,sortField:null,sortOrder:null},F.value.page=0,n.filters.location_permalink&&T()});const r=W(),e=G(),x=y(()=>r.responseOrders),g=y(()=>r.status),{showLoader:l,hideLoader:d}=Q(),u=$(),f=h(),t=h(),i=h(),p=h(!0),F=h(),z=h(0);function T(){p.value=!0;let c=new Map;for(const m in n.filters)n.filters[m]&&c.set(m,n.filters[m].trim());setTimeout(()=>{A(c)},Math.random()*1e3+250)}const A=async function(c){await r.fetchOrderWithOpenTicket(c).then(()=>{p.value=!1}).catch(m=>{p.value=!1,V(u,m)})},B=async function(c){p.value=!0;const m={ticket_id:c.id,location:n.filters.location_permalink,used:c.used};await r.useOpenTicket(m).then(()=>{p.value=!1,X(u,{message:"Stato aggiornato correttamente",error:!1}),T()}).catch(O=>{p.value=!1,V(u,O)})},N=c=>{i.value.toggle(c)},R=function(c){const m={course_name:c.course_name,start_at:c.start_at};o.emit("updateFilters",m),e.setNewOrderDialogVisibility(!0)},I=function(c){const m=new Map;m.set("id",c.id),m.set("location_permalink",n.filters.location_permalink),l(),r.downloadTicket(m).then(()=>{d()}).catch(O=>{d(),V(u,O)})};return M(n.filters,()=>{T()}),{dt:f,responseOrders:x,loading:p,totalRecords:z,lazyParams:F,currentOrder:t,status:g,op:i,dialogStore:e,loadLazyData:T,onChangeUsedStatus:B,toggle:N,openDialog:R,downloadPDF:I,formatDataFromUnixTimestamps:H}}};const Z={class:"order-table"},ee=s("div",{class:"w-full text-center"},"Numero ticket",-1),te={class:"flex flex-column align-items-center"},oe=s("div",{class:"w-full text-center"},"Utilizzato",-1),ne=s("div",{class:"w-full text-center"},"PDF",-1),le={class:"flex flex-column align-items-center"};function ae(n,o,r,e,x,g){const l=v("Column"),d=v("Checkbox"),u=v("Button"),f=v("DataTable");return k(),b("div",Z,[a(f,{value:e.responseOrders.orders,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:_(()=>[D(" Nessuna prenotazione trovata. ")]),default:_(()=>[a(l,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),a(l,{header:"Email",field:"email",ref:"email"},null,512),a(l,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:_(({data:t})=>[D(w(e.formatDataFromUnixTimestamps(t.created_at)),1)]),_:1},512),a(l,null,{header:_(()=>[ee]),body:_(({data:t})=>[s("div",te,w(t.tickets_number),1)]),_:1}),a(l,{header:"Codice ticket"},{body:_(({data:t})=>[(k(!0),b(U,null,S(t.codes,i=>(k(),b("div",{key:i.code,class:P(["py-1",i.used?"used":""])},w(i.code),3))),128))]),_:1}),a(l,null,{header:_(()=>[oe]),body:_(({data:t})=>[(k(!0),b(U,null,S(t.codes,i=>(k(),b("div",{key:i.code,class:"py-1 flex flex-column align-items-center"},[a(d,{modelValue:i.used,"onUpdate:modelValue":p=>i.used=p,binary:!0,onChange:p=>e.onChangeUsedStatus(i),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])]))),128))]),_:1}),a(l,null,{header:_(()=>[ne]),body:_(({data:t})=>[s("div",le,[a(u,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-download",text:"",rounded:"",onClick:i=>e.downloadPDF(t)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","totalRecords","loading"])])}const se=C(Y,[["render",ae]]),re={setup(n,o){const r=h({});return{form:r,resetField:function(){r.value.reservation_number=null,r.value.ticket_code=null,r.value.email=null,o.emit("onSubmit",r.value)}}}},ie={class:"formgrid grid px-0 align-items-center"},ce={class:"field col-3 flex flex-column"},de=s("label",{for:"typology"},"Filtra per codice prenotazione",-1),ue={class:"field col-3 flex flex-column"},me=s("label",{for:"typology"},"Filtra per codice ticket",-1),_e={class:"field col-3 flex flex-column"},fe=s("label",{for:"typology"},"Filtra per email",-1),pe={class:"flex col-12 justify-content-end mt-1"};function ve(n,o,r,e,x,g){const l=v("InputText"),d=v("Button"),u=v("AccordionTab"),f=v("Accordion");return k(),j(f,{activeIndex:0},{default:_(()=>[a(u,{header:"FILTRI"},{default:_(()=>[s("div",ie,[s("div",ce,[de,a(l,{modelValue:e.form.reservation_number,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.reservation_number=t),placeholder:""},null,8,["modelValue"])]),s("div",ue,[me,a(l,{modelValue:e.form.ticket_code,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.ticket_code=t),placeholder:""},null,8,["modelValue"])]),s("div",_e,[fe,a(l,{modelValue:e.form.email,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.email=t),placeholder:""},null,8,["modelValue"])])]),s("div",pe,[a(d,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=t=>n.$emit("onSubmit",e.form))}),a(d,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=t=>e.resetField())})])]),_:1})]),_:1})}const he=C(re,[["render",ve]]),ke={setup(){L(()=>{d.value&&(n.value.location_permalink=d.value),u()});const n=h({}),o=h(),r=q(),e=J(),x=$(),g=y(()=>r.currentUser),l=y(()=>e.allLocations),d=y(()=>e.getCurrentLocation),u=async function(){await e.fetchAllLocations().then(()=>{d.value||(n.value.location_permalink=l.value[0].permalink,e.updateCurrenLocation(l.value[0].permalink))}).catch(t=>{V(x,t)})};return{filters:n,orderTable:o,user:g,locations:l,fetchAllLocations:u,formatDate:K,onUpdateFilters:function(t){let i=n.value.location_permalink;n.value.reservation_number=t.reservation_number,n.value.location_permalink=i,n.value.ticket_code=t.ticket_code,n.value.email=t.email}}},components:{OpenTicketTable:se,OpenTicketFilter:he}};const be={class:"flex justify-content-between align-items-center"},xe={class:"field flex flex-column mt-3"},ge={key:0,style:{color:"#495057"}},ye=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Te={class:"capitalize text-xl"},we={class:"flex gap-4"},Ve={class:"col-12 mt-3"};function Fe(n,o,r,e,x,g){const l=v("Dropdown"),d=v("OpenTicketFilter"),u=v("OpenTicketTable");return k(),b("div",null,[s("div",be,[s("div",xe,[a(l,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=f=>e.filters.location_permalink=f),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(k(),b("div",ge,[ye,s("span",Te,w(e.formatDate(e.filters.date)),1)])):E("",!0)]),s("div",we,[s("div",Ve,[a(d,{onOnSubmit:o[1]||(o[1]=f=>e.onUpdateFilters(f))}),a(u,{filters:e.filters,ref:"orderTable",class:"mt-4"},null,8,["filters"])])])])}const Ue=C(ke,[["render",Fe]]);export{Ue as default};
