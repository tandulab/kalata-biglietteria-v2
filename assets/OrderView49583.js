import{H as re,I as de,o as E,x,a as q,c as N,_ as I,r as b,b as m,e as v,g as n,f as l,J as V,K,t as k,h as P,n as Q,L as oe,M as Be,i as Y,N as ze,w,O as ae,P as se,Q as je,R as Ie,u as Ee}from"../index49583.js";import{u as H,a as le,f as pe,b as ue,c as Re,d as qe,e as me,g as ne,h as he,i as $e,D as te}from"./location49583.js";import{s as J,e as B,p as ve,a as He,b as ye,c as ce,d as ke}from"./helpers49583.js";import{u as _e}from"./loader49583.js";class fe{static async fetchAll(t){const o=t.location_permalink;return delete t.location_permalink,(await re(`/ticket_office/${o}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const o=t.location_permalink;return delete t.location_permalink,(await re(`/ticket_office/${o}/orders/search_codes`,t)).data}}const ie=de({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:s=>s.response_tickets.available_ticket_types,allOpenTickets:s=>s.open_tickets_codes.open_tickets,responseTickets:s=>s.response_tickets,getTotalTickets:s=>s.response_tickets?s.response_tickets.total:0,getCurrentTicket:s=>s.ticket},actions:{async fetchAllTickets(s){await fe.fetchAll(s).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(s){await fe.fetchAllOpenTickets(s).then(t=>this.open_tickets_codes=t)}}}),Je={props:["location_permalink","time_slot"],setup(s,t){E(()=>{o.value=Object.assign({},s.time_slot)});const o=x({}),e=ie(),h=H(),{showLoader:p,hideLoader:a}=_e(),c=q(),_=N(()=>e.allOpenTickets),d=N(()=>h.paymentStatus),C=N(()=>h.paymentModeList),i=N(()=>h.getCurrentOrder),T=async function(L){const M={code:L.query.toUpperCase(),location_permalink:s.location_permalink};await e.fetchAllOpenTickets(M)},D=async function(){var M;const L={id:s.location_permalink,order_id:o.value.id,status:(M=o.value)==null?void 0:M.status,payment_method:o.value.payment_method,open_ticket_codes:[],api_version:"v2"};if(o.value.open_tickets_used&&o.value.open_tickets_used.length>0){let r=[];o.value.open_tickets_used.forEach(u=>{r.push(u.code)}),L.open_ticket_codes=r}y(L)},y=async function(L){p(),await h.updateOrder(L).then(()=>{a(),J(c,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",i.value)}).catch(M=>{a(),B(c,M)})};return{form:o,open_tickets:_,paymentList:d,paymentModeList:C,changeStatus:D,fetchAllOpenTickets:T,onChangeStatus:function(){(o.value.status=="free"||o.value.status=="to_pay")&&(o.value.payment_method=null)}}}},Ke={key:0,class:"formgrid grid flex-column mt-3"},Ge={class:"field col-12"},Qe=n("label",{for:"status"},"Stato pagamento",-1),We={class:"field col-12"},Xe=n("label",{for:"payment_method"},"Modalità pagamento",-1),Ye={key:0,class:"field col-12 flex flex-column"},Ze=n("label",{for:"user_zip"},"Codice biglietto",-1),et={class:"flex align-items-center justify-content-end mt-3"};function tt(s,t,o,e,h,p){const a=b("Dropdown"),c=b("AutoComplete"),_=b("Button");return m(),v(K,null,[e.form?(m(),v("div",Ke,[n("div",Ge,[Qe,l(a,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.status=d),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=d=>e.onChangeStatus())},null,8,["modelValue","options"])]),n("div",We,[Xe,l(a,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=d=>e.form.payment_method=d),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full",disabled:e.form.status!="payed"},null,8,["modelValue","options","disabled"])]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(m(),v("div",Ye,[Ze,l(c,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[3]||(t[3]=d=>e.form.open_tickets_used=d),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[4]||(t[4]=d=>e.fetchAllOpenTickets(d)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):V("",!0)])):V("",!0),n("div",et,[l(_,{label:"Annulla",text:"",onClick:t[5]||(t[5]=d=>s.$emit("closeDialog",null))}),l(_,{label:"Conferma",onClick:t[6]||(t[6]=d=>e.changeStatus())})])],64)}const ot=I(Je,[["render",tt]]),nt={props:["order"],setup(s,t){E(()=>{D.value&&T.value&&D.value.forEach(y=>{y.permalink===T.value&&(a.value=y.name)})});const o=x(0),e=x([]),h=x(!1),p=x(!0),a=x(),c=ie(),_=H();q();const d=le(),C=N(()=>c.allTickets),i=N(()=>_.getCurrentOrder),T=N(()=>d.getCurrentLocation),D=N(()=>d.allLocations);return{tickets:C,active:o,partialTotals:e,showOrderDetail:h,currentOrder:i,showSecondTab:p,currentLocation:T,selectedLocation:a,formatExplicitDate:pe,formatDate:ue,prettyPaymentStatus:ve,formatPrettyDate:Re,formatDataAndHourFromUnixTimestamps:qe,prettyPaymentMethod:He}},components:{}};const st={class:"mt-3 line-height-3"},lt={class:"flex gap-3"},it=n("i",{class:"pi pi-user mt-1"},null,-1),at={class:"m-0 mb-1"},rt={class:"m-0 mb-1"},ct={class:"m-0 mb-1"},dt={class:"m-0 mb-1"},ut={key:0},mt={class:"flex gap-3 mt-4"},_t=n("i",{class:"pi pi-map-marker mt-1"},null,-1),ft={class:"m-0 mb-1"},pt={class:"m-0 mb-1"},ht={key:0,class:"m-0 mb-1"},vt={class:"flex gap-3 mt-4"},yt=n("i",{class:"pi pi-shopping-cart mt-1"},null,-1),kt={class:"m-0 mb-1"},gt={class:"m-0 mb-1"},bt={class:"m-0 mb-1"},xt={key:0,class:"m-0 mb-1"},Ct={key:1,class:"m-0 mb-1"},wt={key:2,class:"m-0 mb-1"},Dt={class:"m-0 mb-1"},Ot={class:"m-0 mb-1"},Tt={key:0},St={key:1},Vt={key:0,class:"flex gap-3 mt-4"},At=n("i",{class:"pi pi-comment mt-1"},null,-1);function Nt(s,t,o,e,h,p){const a=b("Badge");return m(),v("div",st,[n("div",lt,[it,n("div",null,[n("p",at,k(o.order.user_name)+" "+k(o.order.user_surname||"-"),1),n("p",rt,k(o.order.user_email),1),n("p",ct,k(o.order.user_phone),1),n("p",dt,[P(k(o.order.country)+" ",1),o.order.user_zip?(m(),v("span",ut," - "+k(o.order.user_zip),1)):V("",!0)])])]),n("div",mt,[_t,n("div",null,[n("p",ft,k(e.selectedLocation),1),n("p",pt,k(o.order.course_name),1),o.order.date?(m(),v("p",ht,k(e.formatPrettyDate(o.order.date))+" "+k(o.order.start_at),1)):V("",!0)])]),n("div",vt,[yt,n("div",null,[n("p",kt,k(o.order.reservation_number),1),n("p",gt,k(e.formatDataAndHourFromUnixTimestamps(o.order.created_at)),1),n("p",bt,k(o.order.created_by),1),o.order.status?(m(),v("p",xt,[l(a,{value:e.prettyPaymentStatus(o.order.status),class:Q([o.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):V("",!0),o.order.status=="payed"?(m(),v("p",Ct,k(e.prettyPaymentMethod(o.order.payment_method)),1)):V("",!0),o.order.open_tickets_used&&o.order.status=="payed"?(m(),v("p",wt,[(m(!0),v(K,null,oe(o.order.open_tickets_used,c=>(m(),v("span",{key:c},[l(a,{value:c.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):V("",!0),n("p",Dt,"Codice sconto utilizzato: "+k(o.order.discount_code||"-"),1),n("p",Ot,[P(" Totale ordine: "),o.order.amount?(m(),v("span",Tt,"€ "+k(o.order.amount),1)):(m(),v("span",St,"-"))])])]),o.order.notes?(m(),v("div",Vt,[At,n("div",null,k(o.order.notes),1)])):V("",!0)])}const Lt=I(nt,[["render",Nt]]),Ft={props:["order","location_permalink"],setup(s,t){E(()=>{s.order&&s.order.notes&&(o.value=s.order.notes)});const o=x(),{showLoader:e,hideLoader:h}=_e(),p=q(),a=H(),c=N(()=>a.getCurrentOrder);return{notes:o,updateOrder:async function(){const d={id:s.location_permalink,order_id:s.order.id,notes:o.value,api_version:"v2"};e(),await a.updateOrder(d).then(()=>{h(),J(p,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",c.value)}).catch(C=>{h(),B(p,C)})}}}},Mt={class:"pt-5 px-2"},Ut={class:"flex align-items-center justify-content-end mt-3"};function Pt(s,t,o,e,h,p){const a=b("Textarea"),c=b("Button");return m(),v("div",Mt,[l(a,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=_=>e.notes=_),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),n("div",Ut,[l(c,{label:"Annulla",text:"",onClick:t[1]||(t[1]=_=>s.$emit("closeDialog",null))}),l(c,{label:"Conferma",onClick:t[2]||(t[2]=_=>e.updateOrder())})])])}const Bt=I(Ft,[["render",Pt]]),zt={props:["filters"],setup(s,t){E(()=>{r.value=!0,u.value={first:0,rows:D.value.rows,sortField:null,sortOrder:null},u.value.page=0,s.filters.location_permalink&&X()});const o=H(),e=me(),h=N(()=>o.responseOrders),p=N(()=>o.status),a=Be(),c=N(()=>a.submitDialog),_=N(()=>o.paymentStatus),d=N(()=>o.getDeleteResponse),{showLoader:C,hideLoader:i}=_e(),T=q(),D=x(),y=x(),g=x(),L=x(),M=x(),r=x(!0),u=x(),O=x(0),S=x([]),z=x([]),R=x(!1),Z=x(!1),G=x(),W=x(!1);function X(){r.value=!0;let f=new Map;for(const A in s.filters)A=="date"?ne(s.filters.date)=="Invalid DateTime"?f.set("date",he(s.filters.date)):f.set("date",ne(s.filters.date)):s.filters.location_permalink&&f.set("location_permalink",s.filters.location_permalink),A=="course"&&s.filters.course.id!="-1"&&f.set("course",s.filters.course.id),A=="hour"&&s.filters.hour!="Tutti gli orari"&&f.set("hour",s.filters.hour),A=="name"&&f.set("name",s.filters.name);setTimeout(()=>{$(f)},Math.random()*1e3+250)}const $=async function(f){await o.fetchAllOrders(f).then(()=>{r.value=!1}).catch(A=>{r.value=!1,B(T,A)})},ge=f=>{g.value.toggle(f),G.value.toggle(f)},be=(f,A)=>f>f+A?"red":"green",xe=function(f,A){A&&(g.value.note=A,g.value.toggle(f))},ee=function(f){f.order&&h.value.time_slots&&h.value.time_slots.forEach((A,F)=>{A.orders.forEach((j,U)=>{j.id==f.order.id&&(h.value.time_slots[F].orders[U]=f.order,f.check_in_done!=null&&(h.value.time_slots[F].check_in_done+=f.check_in_done))})})},Ce=async function(f,A){let F=[];for(let U of f.tickets)F.push(U.order_item_id);const j={check_in:A,order_item_ids:F,location_permalink:s.filters.location_permalink};await o.checkInOrder(j).then(()=>{ee(d.value),z.value.push(d.value.order),J(T,{message:"Check-in registrato correttamente",error:!1})}).catch(U=>{B(T,U)})},we=async function(f,A){let F=[];for(let U of f.tickets)F.push(U.order_item_id);const j={order_item_ids:F,no_show:A,location_permalink:s.filters.location_permalink};await o.noShowOrder(j).then(()=>{ee(d.value),z.value.push(d.value.order),J(T,{message:"No-show registrato correttamente",error:!1})}).catch(U=>{B(T,U)})},De=async function(f,A,F){const j={id:f,check_in:A,location_permalink:s.filters.location_permalink};await o.checkInTicket(j).then(()=>{J(T,{message:"Check-in registrato correttamente",error:!1}),ee(d.value),z.value.push(d.value.order)}).catch(U=>{B(T,U)})},Oe=async function(f,A,F){const j={id:f,no_show:A,location_permalink:s.filters.location_permalink};await o.noShowTicket(j).then(()=>{J(T,{message:"No-show registrato correttamente",error:!1}),ee(d.value),z.value.push(d.value.order)}).catch(U=>{B(T,U)})},Te=function(f){const A={course_name:f.course_name,start_at:f.start_at,date:s.filters.date,hour:f.start_at};t.emit("updateFilters",A)},Se=function(f){R.value=!0,L.value=f},Ve=function(f){ee({order:f}),R.value=!1,W.value=!1},Ae=function(f){return f!=null&&f.created_by?f.created_by:""},Ne=function(f,A){let F=0;if(f&&f.tickets){f.tickets.forEach(U=>{A?U.no_show&&(F+=1):U.check_in&&(F+=1)});let j=f.tickets.length;if(F!=j&&F!=0)return F+"/"+j}},Le=function(f,A){G.value.data=A,G.value.toggle(f)},Fe=function(f,A){M.value=A.id;let F="Sei sicuro di voler eliminare questa prenotazione?";a.setDialog("Elimina prenotazione","Elimina","Annulla",F),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},Me=function(){if(C(),M.value){const f={id:M.value,location_permalink:s.filters.location_permalink};o.deleteOrder(f).then(()=>{i(),J(T,{message:"La prenotazione è stata eliminata correttamente",error:!1}),h.value.time_slots&&h.value.time_slots.forEach((A,F)=>{A.orders.forEach((j,U)=>{j.id==M.value&&(h.value.time_slots[F].orders.splice(U,1),d.value,h.value.time_slots[F].check_in_done+=d.value.check_in_done,h.value.time_slots[F].confirmed_seats+=d.value.confirmed_seats)})})}).catch(A=>{i(),B(T,A)})}},Ue=function(f){Z.value=!0,y.value=f},Pe=function(f){W.value=!0,y.value=f};return Y(c,f=>{f&&Me()}),Y(s.filters,()=>{s.filters.location_permalink&&X()}),{dt:D,responseOrders:h,loading:r,totalRecords:O,lazyParams:u,currentOrder:y,status:p,expandedRows:S,expandedRows1:z,op:g,dialogStore:e,paymentList:_,visibleDialog:R,currentTimeSlot:L,visibleMenu:G,visibleDetailDialog:Z,visibleNotesDialog:W,loadLazyData:X,toggle:ge,getProgressClass:be,showNotes:xe,checkAll:Ce,noShowAll:we,openDialog:Te,checkInSingleTicket:De,noShowSingleTicket:Oe,prettyPaymentStatus:ve,openPaymentStatusDialog:Se,onClosePaymentStatusDialog:Ve,getRowClass:Ae,printPDF:ye,showLabelCheckbox:Ne,confirmDeleteOrder:Fe,showMenu:Le,openOrderDetailDialog:Ue,openNotesDialog:Pe,formatDataFromUnixTimestamps:$e,printOrderPDF:ce}},components:{PaymentStatusDialog:ot,OrderDetailDialog:Lt,NotesDialog:Bt}};const jt={class:"order-table"},It={class:""},Et={style:{width:"15rem"}},Rt={class:"m-0 text-right",style:{"font-size":"12px"}},qt={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},$t={style:{width:"15rem"}},Ht={class:"m-0 text-right",style:{"font-size":"12px"}},Jt={key:0},Kt={key:0},Gt=n("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Qt={class:"flex justify-content-center"},Wt={class:"flex flex-column",style:{"margin-top":"8px"}},Xt={class:"text-sm",style:{"min-height":"15px"}},Yt=n("div",{class:"flex justify-content-center w-full"},"No-show",-1),Zt={class:"flex justify-content-center"},eo={class:"flex flex-column",style:{"margin-top":"8px"}},to={class:"text-sm",style:{"min-height":"15px"}},oo=["onClick"],no={style:{"max-width":"50rem"},class:"p-3"},so={class:"overlay-menu"},lo=["onClick"],io=n("i",{class:"pi pi-eye mr-3"},null,-1),ao=["onClick"],ro=n("i",{class:"pi pi-print mr-3"},null,-1),co=["disabled","onClick"],uo=n("i",{class:"pi pi-comment mr-3"},null,-1),mo=["disabled","onClick"],_o=n("i",{class:"pi pi-pencil mr-3"},null,-1),fo=["disabled","onClick"],po=n("i",{class:"pi pi-trash mr-3"},null,-1),ho={key:0},vo={key:1},yo=n("div",{class:"flex justify-content-center w-full"},"Check-in",-1),ko={class:"flex justify-content-center"},go=n("div",{class:"flex justify-content-center w-full"},"No-show",-1),bo={class:"flex justify-content-center"},xo=n("div",{class:"flex justify-content-center w-full"},null,-1),Co={class:"flex justify-content-center"},wo={key:0,class:"flex mx-4"},Do=n("div",null,[n("div",{class:"p-0 m-0 flex align-items-center"},[n("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),n("span",{class:"text-sm"},"WEB")]),n("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[n("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),n("span",{class:"text-sm"},"KALATA")])],-1),Oo=[Do];function To(s,t,o,e,h,p){const a=b("Column"),c=b("ProgressBar"),_=b("Button"),d=b("Badge"),C=b("Checkbox"),i=b("OverlayPanel"),T=b("DataTable"),D=b("PaymentStatusDialog"),y=b("Dialog"),g=b("OrderDetailDialog"),L=b("NotesDialog"),M=ze("tooltip");return m(),v("div",jt,[l(T,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=r=>e.expandedRows=r)},{empty:w(()=>[P(" Nessuna prenotazione trovata. ")]),expansion:w(r=>[l(T,{value:r.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=u=>e.expandedRows1=u),rowClass:e.getRowClass},{empty:w(()=>[P(" Nessuna prenotazione trovata. ")]),expansion:w(u=>[l(T,{value:u.data.tickets,class:"m-4 mx-5"},{default:w(()=>[l(a,{header:"Codice biglietto",field:"code"}),l(a,{header:"Tipo biglietto",field:"type"},{body:w(({data:O})=>[l(d,{value:O.ticket_name,class:Q([O.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(a,{header:"Prezzo"},{body:w(({data:O})=>[O.ticket_price?(m(),v("span",ho," € "+k((+O.ticket_price).toFixed(2)),1)):(m(),v("span",vo,"-"))]),_:1}),l(a,null,{header:w(()=>[yo]),body:w(({data:O})=>[n("div",ko,[l(C,{modelValue:O.check_in,"onUpdate:modelValue":S=>O.check_in=S,binary:!0,onChange:S=>e.checkInSingleTicket(O.id,O.check_in,u.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(a,null,{header:w(()=>[go]),body:w(({data:O})=>[n("div",bo,[l(C,{modelValue:O.no_show,"onUpdate:modelValue":S=>O.no_show=S,binary:!0,onChange:S=>e.noShowSingleTicket(O.id,O.no_show,u.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(a,{field:"tickets_url"},{header:w(()=>[xo]),body:w(({data:O})=>[n("div",Co,[ae(l(_,{link:"",icon:"pi pi-print",href:O.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:S=>e.printPDF(O.id,o.filters.location_permalink)},null,8,["href","onClick"]),[[M,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:w(()=>[l(a,{header:"Codice",field:"reservation_number"}),l(a,{header:"Acquirente"},{body:w(({data:u})=>[P(k(u.user_name)+" "+k(u.user_surname)+" ",1),!u.user_name&&!u.user_surname?(m(),v("span",Jt,"-")):V("",!0)]),_:1}),l(a,{header:"Pagamento"},{body:w(({data:u})=>[u.status?(m(),v("span",Kt,[l(d,{value:e.prettyPaymentStatus(u.status),class:Q([u.status,"px-3 border-round-lg"])},null,8,["value","class"])])):V("",!0)]),_:1}),l(a,null,{header:w(()=>[Gt]),body:w(({data:u})=>[n("div",Qt,[n("div",Wt,[l(C,{modelValue:u.check_in,"onUpdate:modelValue":O=>u.check_in=O,binary:!0,onChange:O=>e.checkAll(u,u.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),n("span",Xt,k(e.showLabelCheckbox(u,!1)),1)])])]),_:1}),l(a,null,{header:w(()=>[Yt]),body:w(({data:u})=>[n("div",Zt,[n("div",eo,[l(C,{modelValue:u.no_show,"onUpdate:modelValue":O=>u.no_show=O,binary:!0,onChange:O=>e.noShowAll(u,u.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),n("span",to,k(e.showLabelCheckbox(u,!0)),1)])])]),_:1}),l(a,{header:"Note"},{body:w(({data:u})=>[n("div",{class:"notes cursor-pointer",onClick:O=>e.showNotes(O,u.notes)},k(u.notes||"-"),9,oo),l(i,{ref:"op"},{default:w(()=>[n("div",no,k(e.op.note),1)]),_:1},512)]),_:1}),l(a,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:w(({data:u})=>[l(_,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:O=>e.showMenu(O,u)},null,8,["onClick"]),l(i,{ref:"visibleMenu"},{default:w(()=>[n("ul",so,[n("li",{onClick:O=>e.openOrderDetailDialog(e.visibleMenu.data)},[io,P("Dettaglio ordine ")],8,lo),n("li",{onClick:O=>e.printOrderPDF(e.visibleMenu.data,o.filters.location_permalink)},[ro,P("Stampa ")],8,ao),n("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:O=>e.openNotesDialog(e.visibleMenu.data)},[uo,P("Modifica nota ")],8,co),n("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:O=>e.openPaymentStatusDialog(e.visibleMenu.data)},[_o,P("Cambia stato ")],8,mo),n("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:O=>e.confirmDeleteOrder(O,e.visibleMenu.data)},[po,P("Elimina ")],8,fo)])]),_:2},1536)]),_:1}),l(a,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass"]),r.data.orders&&r.data.orders.length>0?(m(),v("div",wo,Oo)):V("",!0)]),default:w(()=>[l(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:w(({data:r})=>[n("div",It,[n("span",{class:Q(r.is_free_slot?"free":"")},k(r.start_at),3)])]),_:1},512),l(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:w(({data:r})=>[n("div",Et,[n("p",Rt,[P(k(r.confirmed_seats)+"/"+k(r.remaing_seats+r.confirmed_seats)+" ",1),r.confirmed_seats>r.remaing_seats+r.confirmed_seats?ae((m(),v("i",qt,null,512)),[[M,r.confirmed_seats-(r.remaing_seats+r.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):V("",!0)]),l(c,{value:r.confirmed_seats*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:Q(["available-progress",e.getProgressClass(r.confirmed_seats,r.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:w(({data:r})=>[n("div",$t,[n("p",Ht,k(r.check_in_done)+"/"+k(r.confirmed_seats),1),l(c,{value:r.check_in_done*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(a,null,{body:w(({data:r})=>[ae(l(_,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:u=>e.openDialog(r)},null,8,["onClick"]),[[M,"Prenota",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"]),l(y,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=r=>e.visibleDialog=r),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:w(()=>[l(D,{location_permalink:o.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=r=>e.onClosePaymentStatusDialog(r))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),l(y,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=r=>e.visibleDetailDialog=r),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:w(()=>[l(g,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),l(y,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=r=>e.visibleNotesDialog=r),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:w(()=>[l(L,{order:e.currentOrder,location_permalink:o.filters.location_permalink,onCloseDialog:t[5]||(t[5]=r=>e.onClosePaymentStatusDialog(r))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const So=I(zt,[["render",To]]),Vo={props:["filters"],setup(s,t){E(()=>{T();let r=te.now();o.value=s.filters,o.value.date=r.toFormat("dd/MM/yyyy"),g()});const o=x({}),e=le(),h=H(),p=q(),a=x([]),c=x(),_=N(()=>e.allLocations),d=N(()=>h.getCalendar),C=function(){},i=async function(r){await h.fetchCalendar(r).then(()=>{}).catch(u=>{B(p,u)})},T=async function(){await e.fetchAllLocations().then(()=>{D()}).catch(r=>{B(p,r)})},D=function(){if(s.filters.location_permalink){const r=_.value.find(u=>u.permalink===s.filters.location_permalink);a.value=r.courses}},y=function(r){let u={};u.month=te.fromJSDate(new Date(r)).month,u.year=te.fromJSDate(new Date(r)).year,u.location_permalink=s.filters.location_permalink,c.value={month:u.month,year:u.year},i(u)},g=function(){let r=te.now(),u={location_permalink:"",month:"",year:""};u.location_permalink=s.filters.location_permalink,u.month=r.month+"",u.year=r.year+"",i(u)},L=function(r){if(d.value.web_dates&&d.value.web_dates.length!=0){let u=r.month+1;u=r.month<10?"0"+u:u;let O=r.day<10?"0"+r.day:r.day,S=r.year+"-"+u+"-"+O;return d.value.web_dates.find(z=>z==S)}},M=function(r){let u={location_permalink:s.filters.location_permalink,month:r.month,year:r.year};i(u)};return Y(s.filters,()=>{if(c.value){let r={location_permalink:s.filters.location_permalink,month:c.value.month,year:c.value.year};i(r)}else g()}),{form:o,courses:a,locations:_,calendar:d,resetField:C,getCourses:D,onDateChange:y,getDayFromDate:L,onMonthChange:M}}};const Ao={class:"flex calendar-filter"},No={key:0,class:"special-day"};function Lo(s,t,o,e,h,p){const a=b("Calendar");return m(),v("div",Ao,[l(a,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.date=c),inline:"",onDateSelect:t[1]||(t[1]=c=>e.onDateChange(c)),onMonthChange:t[2]||(t[2]=c=>e.onMonthChange(c))},{date:w(c=>[e.getDayFromDate(c.date)?(m(),v("div",No,[n("span",null,k(c.date.day),1)])):(m(),v(K,{key:1},[P(k(c.date.day),1)],64))]),_:1},8,["modelValue"])])}const Fo=I(Vo,[["render",Lo]]),Mo={props:["filters"],setup(s,t){E(()=>{o.value=Object.assign({},s.filters),o.value.date=te.now().toFormat("dd/MM/yyyy"),p.value=ke(8,20),p.value.unshift("Tutti gli orari"),o.value.hour="Tutti gli orari"});const o=x({}),e=x([]),h=le();q();const p=x([]),a=H(),c=N(()=>h.allLocations),_=N(()=>a.responseOrders),d=function(){o.value.name=null,o.value.course=e.value[0].name,o.value.hour=p.value[0],t.emit("onSubmit",o.value)},C=function(){if(e.value=[],o.value.location_permalink){const i=c.value.find(T=>T.permalink===o.value.location_permalink);e.value=i.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),o.value.course=e.value[0].name}};return Y(c,()=>{s.filters.location_permalink&&c.value&&(o.value=Object.assign({},s.filters),o.value.hour||(o.value.hour="Tutti gli orari"),C())}),Y(s.filters,()=>{s.filters.location_permalink&&c.value&&o.value.location_permalink&&o.value.location_permalink!=s.filters.location_permalink&&(o.value=Object.assign({},s.filters),o.value.hour||(o.value.hour="Tutti gli orari"),C())}),{form:o,courses:e,hours:p,locations:c,responseOrders:_,resetField:d,getCourses:C}}},Uo={class:"formgrid grid px-0 align-items-center"},Po={key:0,class:"field col-4 flex flex-column"},Bo=n("label",{for:"typology"},"Filtra per percorso",-1),zo={key:1,class:"field col-3 flex flex-column"},jo=n("label",{for:"typology"},"Filtra per orario (dalle)",-1),Io=n("div",{class:"col-12"},null,-1),Eo={class:"field col-4 flex flex-column"},Ro=n("label",{for:"typology"},"Filtra per nome acquirente",-1),qo={class:"flex col-12 justify-content-end pt-1"};function $o(s,t,o,e,h,p){const a=b("Dropdown"),c=b("InputText"),_=b("Button"),d=b("AccordionTab"),C=b("Accordion");return m(),se(C,{activeIndex:0},{default:w(()=>[l(d,{header:"FILTRI"},{default:w(()=>[n("div",Uo,[e.form.location_permalink?(m(),v("div",Po,[Bo,l(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.course=i),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):V("",!0),e.responseOrders?(m(),v("div",zo,[jo,l(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.hour=i),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):V("",!0),Io,n("div",Eo,[Ro,l(c,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.name=i),placeholder:""},null,8,["modelValue"])])]),n("div",qo,[l(_,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=i=>s.$emit("onSubmit",e.form))}),l(_,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=i=>e.resetField())})])]),_:1})]),_:1})}const Ho=I(Mo,[["render",$o]]);class Jo{static async fetchAll(t){const o=t.location_permalink;return delete t.location_permalink,(await re(`/ticket_office/${o}/search/courses`,t)).data}}const Ko=de({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:s=>s.response_courses.tickets,responseCourses:s=>s.response_courses,getTotalCourses:s=>s.response_courses?s.response_courses.total:0,getCurrentCourse:s=>s.course},actions:{async fetchAllCourses(s){await Jo.fetchAll(s).then(t=>this.response_courses=t)}}}),Go={props:["form","price","index","ticket"],setup(s,t){const o=x(0),e=function(){o.value++,p()},h=function(){o.value>0&&o.value--,p()},p=function(){const a={counter:o.value,price:s.price,index:s.index,ticket:s.ticket};t.emit("changeCounter",a)};return{counter:o,decrement:h,increment:e,emitEvent:p}}};const Qo={class:"btn-plus-min flex align-items-center"},Wo={class:"counter"};function Xo(s,t,o,e,h,p){const a=b("Button"),c=b("InputNumber");return m(),v("div",Qo,[l(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),n("div",Wo,[l(c,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=_=>e.counter=_),t[1]||(t[1]=_=>e.emitEvent())],min:0},null,8,["modelValue"])]),l(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const Yo=I(Go,[["render",Xo]]),Zo={props:["tickets","form"],setup(s,t){E(()=>{h.value=!1,a.discount={},p.value=null});const o=x(0),e=x([]),h=x(!1),p=x(),a=H(),c=q(),_=N(()=>a.getDiscount),d=function(y){e.value[y.index]={partial_total:y.price*y.counter,ticket:y.ticket,quantity:y.counter},o.value=0,e.value.forEach(g=>{o.value+=g.partial_total}),p.value&&i()},C=function(){i()},i=async function(){let y=[];e.value.forEach(L=>{y.push({id:L.ticket.id,quantity:L.quantity})});const g={discount_code:p.value,location_permalink:s.form.location_permalink,tickets:y};await a.cost(g).then(()=>{}).catch(L=>{B(c,L)})};return{total:o,partialTotals:e,showDiscount:h,discountCode:p,discount:_,onChangeCounter:d,applyDiscount:C,checkDisabled:function(){let y=!1;(!e.value||e.value.length==0)&&(y=!0);let g=0;return e.value.forEach(L=>{g+=L.quantity}),g==0&&(y=!0),t.emit("disableSecondoTab",y),y},nextTab:function(){const y={discount_code:p.value,partial_total:e.value};t.emit("nextTab",y)}}},components:{PlusMinusButton:Yo}};const en={key:0,class:"flex justify-content-between align-items-center"},tn={class:"flex align-items-center col-9"},on={class:"col-4 pl-0"},nn={class:"text-right col-3"},sn={class:"col-3 flex justify-content-end"},ln={key:0,class:"mt-3 mb-5"},an=n("i",null,"Nessuna tipologia di biglietto trovata.",-1),rn=[an],cn=n("hr",{class:"mt-3"},null,-1),dn={class:"flex align-items-center justify-content-between py-0"},un={class:"col-9 flex"},mn=n("b",null,"Totale",-1),_n=[mn],fn={key:0,class:"text-right col-4"},pn={class:"line-through text-sm mr-2"},hn={class:"font-bold"},vn={key:1,class:"col-3 text-right font-bold"},yn={class:"col-3 flex justify-content-end"};function kn(s,t,o,e,h,p){const a=b("PlusMinusButton"),c=b("Button");return m(),v(K,null,[(m(!0),v(K,null,oe(o.tickets,(_,d)=>{var C,i,T;return m(),v("div",{key:_.id},[((C=_.course)==null?void 0:C.id)==((i=o.form.course)==null?void 0:i.id)?(m(),v("div",en,[n("div",tn,[n("b",on,k(_.name),1),n("div",nn,"€ "+k((T=_.price)==null?void 0:T.toFixed(2)),1)]),n("div",sn,[l(a,{onChangeCounter:t[0]||(t[0]=D=>e.onChangeCounter(D)),price:_.price,index:d,ticket:_},null,8,["price","index","ticket"])])])):V("",!0)])}),128)),o.tickets&&o.tickets.length==0?(m(),v("div",ln,rn)):V("",!0),cn,n("div",dn,[n("div",un,[n("div",{class:Q(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},_n,2),e.discount&&e.discount.total_amount?(m(),v("div",fn,[n("span",pn,"€ "+k(e.total.toFixed(2)),1),n("span",hn,"€ "+k(e.discount.total_amount.toFixed(2)),1)])):(m(),v("div",vn,"€ "+k(e.total.toFixed(2)),1))]),n("div",yn,[l(c,{label:"Prosegui",onClick:t[1]||(t[1]=_=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const gn=I(Zo,[["render",kn]]);class bn{static async fetchAll(){return(await je("/countries")).data.countries}}const xn=de({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:s=>s.countries},actions:{async fetchAllCountries(){await bn.fetchAll().then(s=>this.countries=s)}}}),Cn={props:["location_permalink"],setup(s,t){E(()=>{i()});const o=ie(),e=xn(),h=H(),p=x({}),a=x(),c=N(()=>e.allCountries),_=N(()=>o.allOpenTickets),d=N(()=>h.paymentStatus),C=N(()=>h.paymentModeList),i=async function(){await e.fetchAllCountries().then(()=>{p.value.country_id=88,p.value.status={id:"payed",name:"Pagato"}})};return{form:p,countries:c,paymentList:d,paymentModeList:C,errorMessage:a,open_tickets:_,fetchAllOpenTickets:async function(g){const L={code:g.query.toUpperCase(),location_permalink:s.location_permalink};await o.fetchAllOpenTickets(L)},onChangeStatus:function(){p.value.status.id&&(p.value.status.id=="free"||p.value.status.id=="to_pay")&&(p.value.payment_method=null)},onConfirm:function(){if(p.value.status&&p.value.status.id=="payed"&&!p.value.payment_method){a.value="Seleziona un metodo di pagamento";return}t.emit("nextTab",p.value)}}}},wn={key:0,class:"formgrid grid"},Dn={class:"field col-6"},On=n("label",{for:"user_name"},"Nome",-1),Tn={class:"field col-6"},Sn=n("label",{for:"user_surname"},"Cognome",-1),Vn={class:"field col-6"},An=n("label",{for:"user_email"},"Email",-1),Nn={class:"field col-6"},Ln=n("label",{for:"user_phone"},"Telefono",-1),Fn={class:"field col-6"},Mn=n("label",{for:"country_id"},"Nazione",-1),Un={class:"field col-6"},Pn=n("label",{for:"user_zip"},"Cap",-1),Bn={class:"field col-6"},zn=n("label",{for:"status"},"Stato pagamento",-1),jn={class:"field col-6"},In={for:"payment_method"},En={key:0},Rn={class:"p-float-label"},qn={class:"p-error",id:"dd-error"},$n={key:0,class:"field col-6 flex flex-column"},Hn=n("label",{for:"user_zip"},"Codice biglietto",-1),Jn={class:"field col-12"},Kn={class:"field flex flex-column"},Gn=n("label",{for:"notes"},"Note",-1),Qn={class:"col-12 flex justify-content-end"};function Wn(s,t,o,e,h,p){const a=b("InputText"),c=b("Dropdown"),_=b("AutoComplete"),d=b("Textarea"),C=b("Button");return e.form?(m(),v("div",wn,[n("div",Dn,[On,l(a,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.user_name=i),class:"w-full"},null,8,["modelValue"])]),n("div",Tn,[Sn,l(a,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.user_surname=i),class:"w-full"},null,8,["modelValue"])]),n("div",Vn,[An,l(a,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.user_email=i),class:"w-full"},null,8,["modelValue"])]),n("div",Nn,[Ln,l(a,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=i=>e.form.user_phone=i),class:"w-full"},null,8,["modelValue"])]),n("div",Fn,[Mn,l(c,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=i=>e.form.country_id=i),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),n("div",Un,[Pn,l(a,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=i=>e.form.user_zip=i),class:"w-full"},null,8,["modelValue"])]),n("div",Bn,[zn,l(c,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=i=>e.form.status=i),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=i=>e.onChangeStatus())},null,8,["modelValue","options"])]),n("div",jn,[n("label",In,[P("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(m(),v("span",En,"*")):V("",!0)]),n("span",Rn,[l(c,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=i=>e.form.payment_method=i),options:e.paymentModeList,optionLabel:"label",class:Q(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=i=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),n("small",qn,k(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.label=="Biglietto a data aperta (voucher)"?(m(),v("div",$n,[Hn,l(_,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=i=>e.form.open_ticket_codes=i),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[11]||(t[11]=i=>e.fetchAllOpenTickets(i)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):V("",!0),n("div",Jn,[n("div",Kn,[Gn,l(d,{modelValue:e.form.notes,"onUpdate:modelValue":t[12]||(t[12]=i=>e.form.notes=i),rows:"5",cols:"30"},null,8,["modelValue"])])]),n("div",Qn,[l(C,{label:"Conferma",onClick:t[13]||(t[13]=i=>e.onConfirm())})])])):V("",!0)}const Xn=I(Cn,[["render",Wn]]);var Yn=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,Zn={root:function(t){var o=t.instance;return["p-contextmenu p-component",{"p-input-filled":o.$primevue.config.inputStyle==="filled","p-ripple-disabled":o.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var o=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":o.isItemActive(e),"p-focus":o.isItemFocused(e),"p-disabled":o.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var o=t.props,e=t.isActive,h=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":o.exact&&h}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Ie.extend({name:"contextmenu",css:Yn,classes:Zn});const es={props:["form"],setup(s,t){E(()=>{T()});const o=x(0),e=x([]),h=x(!1),p=x(!0),a=x(),c=ie(),_=H(),d=q(),C=N(()=>c.allTickets),i=N(()=>_.getCurrentOrder),T=async function(){const S={location_permalink:s.form.location_permalink,api_version:"v2",date:y(s.form.date),course_id:s.form.course.id};await c.fetchAllTickets(S).then(()=>{}).catch(z=>{B(d,z)})},D=function(S){o.value+=1,a.value=S.discount_code,e.value=Object.assign([],S.partial_total)},y=function(S){return ne(S).includes("Invalid")?he(S):ne(S)},g=function(S){L(S)},L=async function(S){var G,W,X;const z=[{start_at:s.form.hour,tickets:[]}];e.value.forEach($=>{$.quantity!=0&&z[0].tickets.push({id:$.ticket.id,quantity:$.quantity})});let R=[];S.open_ticket_codes&&S.open_ticket_codes.forEach($=>{R.push($.code)});const Z={location_permalink:s.form.location_permalink,country_id:S.country_id,status:S.status.id,user_email:S.user_email,user_name:S.user_name,user_phone:S.user_phone,user_surname:S.user_surname,user_zip:S.user_zip,api_version:"v2",date:s.form.date?y(s.form.date):"",notes:S.notes,time_slots:z,payment_method:(G=S.payment_method)==null?void 0:G.id,course_id:(X=(W=s.form)==null?void 0:W.course)==null?void 0:X.id,open_ticket_codes:R};a.value&&(Z.discount_code=a.value),await _.createOrder(Z).then(()=>{o.value+=1,p.value=!0,h.value=!0}).catch($=>{B(d,$)})},M=function(){ce(i==null?void 0:i.value,s.form.location_permalink),t.emit("closeDialog",!0)},r=function(S){p.value=S},u=function(){ce(i==null?void 0:i.value,s.form.location_permalink),O()},O=async function(){let S=[];if(!i.value&&!s.form.location_permalink)return;for(let R of i.value.order_items)S.push(R.id);const z={check_in:!0,order_item_ids:S,location_permalink:s.form.location_permalink};await _.checkInOrder(z).then(()=>{J(d,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(R=>{B(d,R)})};return{tickets:C,active:o,partialTotals:e,showOrderDetail:h,currentOrder:i,showSecondTab:p,formatExplicitDate:pe,formatDate:ue,onNextTab:D,onConfirmPayment:g,printPDF:ye,onPrintPDF:M,onDisableSecondoTab:r,printAndCheckIn:u}},components:{NewOrderTicketTab:gn,NewOrderFormTab:Xn}};const ts={key:0,class:"info-box"},os={class:"font-medium"},ns=n("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),ss={class:"font-medium"},ls=n("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),is={key:0,class:"capitalize"},as={key:0,class:"flex pb-4"},rs=n("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),cs={class:"flex flex-column"},ds={key:0,class:"pb-1 pr-1"},us={key:1,class:"pb-1"},ms={class:"py-5"},_s={class:"m-0 text-center line-height-3"},fs=n("br",null,null,-1),ps={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},hs=n("p",{class:"my-2"},[n("b",null,"Riepilogo ordine:")],-1),vs={class:"flex flex-column col-12"},ys={key:0,class:"pb-1",style:{"min-width":"8rem"}},ks={key:1,class:"pb-1"},gs={key:2},bs={class:"flex flex-column col-12"},xs={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Cs=n("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),ws={class:"pb-1"},Ds={class:"flex align-items-center justify-content-center mt-4"};function Os(s,t,o,e,h,p){var i,T;const a=b("NewOrderTicketTab"),c=b("TabPanel"),_=b("NewOrderFormTab"),d=b("Button"),C=b("TabView");return m(),v(K,null,[o.form?(m(),v("div",ts,[n("p",os,[ns,P(k((i=o.form.course)==null?void 0:i.name),1)]),n("p",ss,[ls,o.form.date?(m(),v("span",is,k(e.formatDate((T=o.form)==null?void 0:T.date)),1)):V("",!0),P(" - "+k(o.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(m(),v("div",as,[rs,n("div",cs,[(m(!0),v(K,null,oe(e.partialTotals,D=>{var y;return m(),v("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:D},[D&&D.quantity!=0?(m(),v("span",ds,k((y=D.ticket)==null?void 0:y.name),1)):V("",!0),D&&D.quantity!=0?(m(),v("span",us," x "+k(D.quantity)+" "+k(D.price),1)):V("",!0)])}),128))])])):V("",!0)])):V("",!0),l(C,{activeIndex:e.active,"onUpdate:activeIndex":t[5]||(t[5]=D=>e.active=D)},{default:w(()=>[l(c,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:w(()=>[l(a,{tickets:e.tickets,form:o.form,onNextTab:t[0]||(t[0]=D=>e.onNextTab(D)),onDisableSecondoTab:t[1]||(t[1]=D=>e.onDisableSecondoTab(D))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(c,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:w(()=>[l(_,{onNextTab:t[2]||(t[2]=D=>e.onConfirmPayment(D)),location_permalink:o.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(m(),se(c,{key:0,header:"Ordine completato"},{default:w(()=>{var D;return[n("div",ms,[n("div",_s,[P(" Ordine "),n("b",null,k(e.currentOrder.reservation_number),1),P(" registrato correttamente!"),fs]),e.currentOrder?(m(),v("div",ps,[hs,n("div",vs,[(m(!0),v(K,null,oe(e.currentOrder.order_items[0].tickets,y=>(m(),v("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:y},[y&&y.quantity!=0?(m(),v("span",ys,k(y.name),1)):V("",!0),y&&y.quantity!=0?(m(),v("span",ks," x "+k(y.quantity),1)):V("",!0),y.price?(m(),v("span",gs," € "+k((+y.price).toFixed(2)),1)):V("",!0)]))),128))]),n("div",bs,[e.currentOrder.total?(m(),v("p",xs,[Cs,n("span",ws,[n("b",null,"€ "+k((+((D=e.currentOrder)==null?void 0:D.total)).toFixed(2)),1)])])):V("",!0)])])):V("",!0),n("div",Ds,[l(d,{icon:"pi pi-print",onClick:t[3]||(t[3]=y=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),l(d,{icon:"pi print-check-icon",onClick:t[4]||(t[4]=y=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"}),l(d,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti"})])])]}),_:1})):V("",!0)]),_:1},8,["activeIndex"])],64)}const Ts=I(es,[["render",Os]]),Ss={props:["filters","date"],setup(s,t){E(()=>{i(),p.value=ke(8,20),o.value=Object.assign({},s.filters)});const o=x({}),e=Ko(),h=q(),p=x(),a=x(!1),c=me(),_=x(!1),d=N(()=>e.allCourses),C=N(()=>c.showNewOrderDialog),i=async function(){const g={location_permalink:s.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(g).then(()=>{}).catch(L=>{B(h,L)})},T=function(){c.setNewOrderDialogVisibility(!1),o.value.hour="",o.value.course=null,t.emit("onCloseDialog")},D=function(g){o.value.date=s.date,c.setNewOrderDialogVisibility(g)},y=function(){_.value=o.value.open_ticket};return Y(s.filters,()=>{if(i(),o.value=Object.assign({},s.filters),s.filters.course&&!s.filters.course.id){let g=d.value.find(L=>L.name===s.filters.course.name);g&&(o.value.course=g)}}),{courses:d,form:o,hours:p,disableForm:_,visible:a,onCloseDialog:T,updateDialog:D,onChecked:y,dialogVisible:C,dialogStore:c}},components:{NewOrderDialog:Ts}},Vs=n("h2",{class:"mt-1"},"Nuova prenotazione",-1),As={class:"formgrid grid px-0 align-items-center mt-4"},Ns={key:0,class:"field flex flex-column w-full col-12"},Ls=n("label",{for:"typology"},"Scegli il percorso",-1),Fs={key:1,class:"field flex flex-column w-full col-12"},Ms=n("label",{for:"typology"},"Seleziona l'orario",-1),Us={class:"flex justify-content-end align-items-center mt-2"},Ps={class:"flex align-items-center justify-content-between w-full"},Bs=n("h2",null,"Nuova prenotazione",-1);function zs(s,t,o,e,h,p){const a=b("Dropdown"),c=b("Button"),_=b("NewOrderDialog"),d=b("Dialog"),C=b("Card");return m(),se(C,{class:"mt-4"},{content:w(()=>[Vs,n("div",As,[o.filters.location_permalink?(m(),v("div",Ns,[Ls,l(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.course=i),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):V("",!0),o.filters.location_permalink?(m(),v("div",Fs,[Ms,l(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.hour=i),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):V("",!0)]),n("div",Us,[l(c,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=i=>e.updateDialog(!0))},null,8,["disabled"])]),l(d,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=i=>e.dialogVisible=i),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=i=>e.onCloseDialog())},{header:w(()=>[n("div",Ps,[Bs,l(c,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=i=>e.updateDialog(!1))})])]),default:w(()=>[l(_,{form:e.form,onCloseDialog:t[4]||(t[4]=i=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const js=I(Ss,[["render",zs]]),Is={setup(){E(()=>{d.value&&(s.value.location_permalink=d.value,t.value.location_permalink=d.value),C()});const s=x({}),t=x({}),o=x(),e=Ee(),h=le(),p=q(),a=me(),c=N(()=>e.currentUser),_=N(()=>h.allLocations),d=N(()=>h.getCurrentLocation),C=async function(){await h.fetchAllLocations().then(()=>{d.value||(s.value.location_permalink=_.value[0].permalink,t.value.location_permalink=_.value[0].permalink,h.updateCurrenLocation(_.value[0].permalink))}).catch(g=>{B(p,g)})};return{filters:s,orderTable:o,order_filters:t,user:c,locations:_,fetchAllLocations:C,formatDate:ue,onUpdateFilters:function(g){g.course?s.value.course={id:g.course}:s.value.course="",g.name?s.value.name=g.name:s.value.name="",g.hour&&(g.hour.start_at?s.value.hour=g.hour.start_at:s.value.hour=g.hour)},onUpdateNewOrderFilters:function(g){g.start_at&&(t.value.hour=g.start_at),g.course_name&&(t.value.course={name:g.course_name}),g.date&&(t.value.date=g.date),g.hour&&(t.value.hour=g.hour),a.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){o.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=s.value.location_permalink,h.updateCurrenLocation(s.value.location_permalink)}}},components:{CalendarFilter:Fo,OrderTable:So,OrderFilter:Ho,NewOrderCard:js}};const Es={class:"flex justify-content-between align-items-center"},Rs={class:"field flex flex-column mt-3"},qs={key:0,style:{color:"#495057"}},$s=n("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Hs={class:"capitalize text-xl"},Js={class:"flex gap-4"},Ks={key:0,class:"col-3 mt-3"},Gs={class:"col-9 mt-3"};function Qs(s,t,o,e,h,p){const a=b("Dropdown"),c=b("CalendarFilter"),_=b("NewOrderCard"),d=b("OrderFilter"),C=b("OrderTable");return m(),v("div",null,[n("div",Es,[n("div",Rs,[l(a,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":t[0]||(t[0]=i=>e.filters.location_permalink=i),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location",onChange:t[1]||(t[1]=i=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(m(),v("div",qs,[$s,n("span",Hs,k(e.formatDate(e.filters.date)),1)])):V("",!0)]),n("div",Js,[e.filters.location_permalink?(m(),v("div",Ks,[l(c,{filters:e.filters},null,8,["filters"]),l(_,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[2]||(t[2]=i=>e.onCloseDialog())},null,8,["date","filters"])])):V("",!0),n("div",Gs,[l(d,{filters:e.filters,onOnSubmit:t[3]||(t[3]=i=>e.onUpdateFilters(i))},null,8,["filters"]),e.filters.date?(m(),se(C,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[4]||(t[4]=i=>e.onUpdateNewOrderFilters(i))},null,8,["filters"])):V("",!0)])])])}const el=I(Is,[["render",Qs]]);export{el as default};
