import{o as D,c as g,a as S,x as v,i as R,_ as w,r as m,b as h,e as k,f as a,w as d,h as F,t as V,g as s,K as C,L as U,n as I,P as j,u as M,J as P}from"../index85207.js";import{u as q,e as E,i as J,a as K,b as W}from"./location85207.js";import{e as O,s as G}from"./helpers85207.js";const H={props:["filters"],setup(l,o){D(()=>{t.value=!0,r.value={first:0,rows:c.value.rows,sortField:null,sortOrder:null},r.value.page=0,l.filters.location_permalink&&T()});const i=q(),e=E(),b=g(()=>i.responseOrders),x=g(()=>i.status),n=S(),c=v(),f=v(),u=v(),t=v(!0),r=v(),y=v(0);function T(){t.value=!0;let _=new Map;for(const p in l.filters)l.filters[p]&&_.set(p,l.filters[p].trim());setTimeout(()=>{L(_)},Math.random()*1e3+250)}const L=async function(_){await i.fetchOrderWithOpenTicket(_).then(()=>{t.value=!1}).catch(p=>{t.value=!1,O(n,p)})},$=async function(_,p){t.value=!0;const B={order_id:_.id,id:l.filters.location_permalink,ticket_codes:[p]};await i.updateOrder(B).then(()=>{t.value=!1,G(n,{message:"Stato aggiornato correttamente",error:!1}),T()}).catch(N=>{t.value=!1,O(n,N)})},z=_=>{u.value.toggle(_)},A=function(_){const p={course_name:_.course_name,start_at:_.start_at};o.emit("updateFilters",p),e.setNewOrderDialogVisibility(!0)};return R(l.filters,()=>{T()}),{dt:c,responseOrders:b,loading:t,totalRecords:y,lazyParams:r,currentOrder:f,status:x,op:u,dialogStore:e,loadLazyData:T,onChangeUsedStatus:$,toggle:z,openDialog:A,formatDataFromUnixTimestamps:J}}};const Q={class:"order-table"},X=s("div",{class:"w-full text-center"},"Numero ticket",-1),Y={class:"flex flex-column align-items-center"},Z=s("div",{class:"w-full text-center"},"Utilizzato",-1),ee=s("div",{class:"w-full text-center"},"PDF",-1),te={class:"flex flex-column align-items-center"};function oe(l,o,i,e,b,x){const n=m("Column"),c=m("Checkbox"),f=m("Button"),u=m("DataTable");return h(),k("div",Q,[a(u,{value:e.responseOrders.orders,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:d(()=>[F(" Nessuna prenotazione trovata. ")]),default:d(()=>[a(n,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),a(n,{header:"Email",field:"user_email",ref:"user_email"},null,512),a(n,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:d(({data:t})=>[F(V(e.formatDataFromUnixTimestamps(t.created_at)),1)]),_:1},512),a(n,null,{header:d(()=>[X]),body:d(({data:t})=>{var r;return[s("div",Y,V((r=t.order_items[0])==null?void 0:r.tickets[0].quantity),1)]}),_:1}),a(n,{header:"Codice ticket"},{body:d(({data:t})=>[(h(!0),k(C,null,U(t.order_items[0].ticket_codes,r=>(h(),k("div",{key:r.code,class:I(["py-1",r.used?"used":""])},V(r.code),3))),128))]),_:1}),a(n,null,{header:d(()=>[Z]),body:d(({data:t})=>[(h(!0),k(C,null,U(t.order_items[0].ticket_codes,r=>(h(),k("div",{key:r.code,class:"py-1 flex flex-column align-items-center"},[a(c,{modelValue:r.used,"onUpdate:modelValue":y=>r.used=y,binary:!0,onChange:y=>e.onChangeUsedStatus(t.order_items[0],r),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])]))),128))]),_:1}),a(n,null,{header:d(()=>[ee]),body:d(()=>[s("div",te,[a(f,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-download",text:"",rounded:""})])]),_:1})]),_:1},8,["value","totalRecords","loading"])])}const ne=w(H,[["render",oe]]),le={setup(l,o){const i=v({});return{form:i,resetField:function(){i.value.reservation_number=null,i.value.ticket_code=null,i.value.email=null,o.emit("onSubmit",i.value)}}}},ae={class:"formgrid grid px-0 align-items-center"},se={class:"field col-3 flex flex-column"},re=s("label",{for:"typology"},"Filtra per codice prenotazione",-1),ie={class:"field col-3 flex flex-column"},ce=s("label",{for:"typology"},"Filtra per codice ticket",-1),de={class:"field col-3 flex flex-column"},ue=s("label",{for:"typology"},"Filtra per email",-1),_e={class:"flex col-12 justify-content-end mt-1"};function me(l,o,i,e,b,x){const n=m("InputText"),c=m("Button"),f=m("AccordionTab"),u=m("Accordion");return h(),j(u,{activeIndex:0},{default:d(()=>[a(f,{header:"FILTRI"},{default:d(()=>[s("div",ae,[s("div",se,[re,a(n,{modelValue:e.form.reservation_number,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.reservation_number=t),placeholder:""},null,8,["modelValue"])]),s("div",ie,[ce,a(n,{modelValue:e.form.ticket_code,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.ticket_code=t),placeholder:""},null,8,["modelValue"])]),s("div",de,[ue,a(n,{modelValue:e.form.email,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.email=t),placeholder:""},null,8,["modelValue"])])]),s("div",_e,[a(c,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=t=>l.$emit("onSubmit",e.form))}),a(c,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=t=>e.resetField())})])]),_:1})]),_:1})}const fe=w(le,[["render",me]]),pe={setup(){D(()=>{c.value&&(l.value.location_permalink=c.value),f()});const l=v({}),o=v(),i=M(),e=K(),b=S(),x=g(()=>i.currentUser),n=g(()=>e.allLocations),c=g(()=>e.getCurrentLocation),f=async function(){await e.fetchAllLocations().then(()=>{c.value||(l.value.location_permalink=n.value[0].permalink,e.updateCurrenLocation(n.value[0].permalink))}).catch(t=>{O(b,t)})};return{filters:l,orderTable:o,user:x,locations:n,fetchAllLocations:f,formatDate:W,onUpdateFilters:function(t){let r=l.value.location_permalink;l.value.reservation_number=t.reservation_number,l.value.location_permalink=r,l.value.ticket_code=t.ticket_code,l.value.email=t.email}}},components:{OpenTicketTable:ne,OpenTicketFilter:fe}};const ve={class:"flex justify-content-between align-items-center"},he={class:"field flex flex-column mt-3"},ke={key:0,style:{color:"#495057"}},be=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),xe={class:"capitalize text-xl"},ge={class:"flex gap-4"},ye={class:"col-12 mt-3"};function Te(l,o,i,e,b,x){const n=m("Dropdown"),c=m("OpenTicketFilter"),f=m("OpenTicketTable");return h(),k("div",null,[s("div",ve,[s("div",he,[a(n,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=u=>e.filters.location_permalink=u),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(h(),k("div",ke,[be,s("span",xe,V(e.formatDate(e.filters.date)),1)])):P("",!0)]),s("div",ge,[s("div",ye,[a(c,{onOnSubmit:o[1]||(o[1]=u=>e.onUpdateFilters(u))}),a(f,{filters:e.filters,ref:"orderTable",class:"mt-4"},null,8,["filters"])])])])}const Fe=w(pe,[["render",Te]]);export{Fe as default};
