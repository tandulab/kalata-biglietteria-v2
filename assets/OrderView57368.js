import{o as I,x as C,a as R,c as F,_ as z,r as h,b as y,e as D,g as t,f as a,H as N,I as H,J as Te,i as K,K as Oe,w as b,h as U,n as Z,t as S,L as ee,M as Y,N as se,u as Se}from"../index57368.js";import{u as te,a as E,b as ae,f as X,c as ie,d as Fe,D as W,e as ne,g as Ne,h as Le,i as re,j as Ae}from"./NewOrderDialog.vue_vue_type_style_index_0_lang57368.js";import{s as G,e as A,p as Ue,a as oe,b as ce}from"./helpers57368.js";import{u as de}from"./loader57368.js";const Me={props:["location_permalink","time_slot"],setup(l,o){I(()=>{n.value=Object.assign({},l.time_slot)});const n=C({}),e=te(),x=E(),{showLoader:k,hideLoader:i}=de(),c=R(),p=F(()=>e.allOpenTickets),f=F(()=>x.paymentStatus),_=F(()=>x.paymentModeList),s=async function(g){const T={code:g.query.toUpperCase(),location_permalink:l.location_permalink};await e.fetchAllOpenTickets(T)},O=async function(){var T;const g={id:l.location_permalink,order_id:n.value.id,status:(T=n.value)==null?void 0:T.status,payment_method:n.value.payment_mode,open_ticket_codes:[],api_version:"v2"};if(n.value.open_ticket_codes&&n.value.open_ticket_codes.length>0){let v=[];n.value.open_ticket_codes.forEach(d=>{v.push(d.code)}),g.open_ticket_codes=v}m(g)},m=async function(g){k(),await x.updateOrder(g).then(()=>{i(),G(c,{message:"Stato aggiornato correttamente",error:!1}),o.emit("closeDialog",!0)}).catch(T=>{i(),A(c,T)})};return{form:n,open_tickets:p,paymentList:f,paymentModeList:_,changeStatus:O,fetchAllOpenTickets:s}}},Pe={key:0,class:"formgrid grid flex-column mt-3"},je={class:"field col-12"},ze=t("label",{for:"status"},"Stato pagamento",-1),Be={class:"field col-12"},Ie=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Re={key:0,class:"field col-12 flex flex-column"},Ee=t("label",{for:"user_zip"},"Codice biglietto",-1),qe={class:"flex align-items-center justify-content-end mt-3"};function Je(l,o,n,e,x,k){const i=h("Dropdown"),c=h("AutoComplete"),p=h("Button");return y(),D(H,null,[e.form?(y(),D("div",Pe,[t("div",je,[ze,a(i,{modelValue:e.form.status,"onUpdate:modelValue":o[0]||(o[0]=f=>e.form.status=f),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Be,[Ie,a(i,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[1]||(o[1]=f=>e.form.payment_mode=f),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode=="voucher"?(y(),D("div",Re,[Ee,a(c,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":o[2]||(o[2]=f=>e.form.open_ticket_codes=f),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:o[3]||(o[3]=f=>e.fetchAllOpenTickets(f)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):N("",!0)])):N("",!0),t("div",qe,[a(p,{label:"Annulla",text:"",onClick:o[4]||(o[4]=f=>l.$emit("closeDialog",!1))}),a(p,{label:"Conferma",onClick:o[5]||(o[5]=f=>e.changeStatus())})])],64)}const Ge=z(Me,[["render",Je]]),He={props:["filters"],setup(l,o){I(()=>{d.value=!0,r.value={first:0,rows:O.value.rows,sortField:null,sortOrder:null},r.value.page=0,l.filters.location_permalink&&Q()});const n=E(),e=ae(),x=F(()=>n.responseOrders),k=F(()=>n.status),i=Te();F(()=>i.cancelDialog);const c=F(()=>i.submitDialog),p=F(()=>n.paymentStatus),{showLoader:f,hideLoader:_}=de(),s=R(),O=C(),m=C(),g=C(),T=C(),v=C(),d=C(!0),r=C(),V=C(0),q=C([]),J=C([]),B=C(!1),j=C();function Q(){d.value=!0;let u=new Map;for(const w in l.filters)w=="date"?X(l.filters.date)=="Invalid DateTime"?u.set("date",ie(l.filters.date)):u.set("date",X(l.filters.date)):l.filters.location_permalink&&u.set("location_permalink",l.filters.location_permalink),w=="course"&&l.filters.course.id!="-1"&&u.set("course",l.filters.course.id),w=="hour"&&l.filters.hour!="Tutti gli orari"&&u.set("hour",l.filters.hour),w=="name"&&u.set("name",l.filters.name);setTimeout(()=>{ue(u)},Math.random()*1e3+250)}const ue=async function(u){await n.fetchAllOrders(u).then(()=>{d.value=!1}).catch(w=>{d.value=!1,A(s,w)})},me=u=>{g.value.toggle(u),j.value.toggle(u)},_e=(u,w)=>{if(u>=(u+w)/2)return"green";if(u<=(u+w)/3)return"red"},fe=function(u,w){w&&(g.value.note=w,g.value.toggle(u))},he=async function(u,w){const L={id:u.id,check_in:w,location_permalink:l.filters.location_permalink};await n.checkInOrder(L).then(()=>{le(u,w,"check_in"),G(s,{message:"Check-in registrato correttamente",error:!1})}).catch(M=>{A(s,M)})},pe=async function(u,w){const L={id:u.id,no_show:w,location_permalink:l.filters.location_permalink};await n.noShowOrder(L).then(()=>{le(u,w,"no_show"),G(s,{message:"No-show registrato correttamente",error:!1})}).catch(M=>{A(s,M)})},le=function(u,w,L){u&&u.order_item_tickets.forEach(M=>{M[L]=w})},ve=async function(u,w,L){const M={id:u,check_in:w,location_permalink:l.filters.location_permalink};await n.checkInTicket(M).then(()=>{if(G(s,{message:"Check-in registrato correttamente",error:!1}),!w)L.check_in=!1;else{let P=!0;L.order_item_tickets.forEach($=>{$.check_in==!1&&(P=!1)}),P&&(L.check_in=!0)}}).catch(P=>{A(s,P)})},ye=async function(u,w,L){const M={id:u,no_show:w,location_permalink:l.filters.location_permalink};await n.noShowTicket(M).then(()=>{if(G(s,{message:"No-show registrato correttamente",error:!1}),!w)L.no_show=!1;else{let P=!0;L.order_item_tickets.forEach($=>{$.no_show==!1&&(P=!1)}),P&&(L.no_show=!0)}}).catch(P=>{A(s,P)})},ke=function(u){const w={course_name:u.course_name,start_at:u.start_at};o.emit("updateFilters",w),e.setNewOrderDialogVisibility(!0)},ge=function(u){B.value=!0,T.value=u},be=function(u){u&&Q(),B.value=!1},xe=function(u){return u!=null&&u.created_by?u.created_by:""},we=function(u,w){let L=0;if(u&&u.order_item_tickets){u.order_item_tickets.forEach(P=>{w?P.no_show&&(L+=1):P.check_in&&(L+=1)});let M=u.order_item_tickets.length;if(L!=M&&L!=0)return L+"/"+M}},Ce=function(u,w){j.value.data=w,j.value.toggle(u)},De=function(u,w){v.value=w.id;let L="Sei sicuro di voler eliminare questa prenotazione?";i.setDialog("Elimina prenotazione","Elimina","Annulla",L),i.setDynamicDialogVisibility(!0)},Ve=function(){if(f(),v.value){const u={id:v.value,location_permalink:l.filters.location_permalink};n.deleteOrder(u).then(()=>{_(),G(s,{message:"La prenotazione è stata eliminata correttamente",error:!1}),Q()}).catch(w=>{_(),A(s,w)})}};return K(c,u=>{Ve()}),K(l.filters,()=>{l.filters.location_permalink&&Q()}),{dt:O,responseOrders:x,loading:d,totalRecords:V,lazyParams:r,currentOrder:m,status:k,expandedRows:q,expandedRows1:J,op:g,dialogStore:e,paymentList:p,visibleDialog:B,currentTimeSlot:T,visibleMenu:j,loadLazyData:Q,toggle:me,getProgressClass:_e,showNotes:fe,checkAll:he,noShowAll:pe,openDialog:ke,checkInSingleTicket:ve,noShowSingleTicket:ye,prettyPaymentStatus:Ue,openPaymentStatusDialog:ge,onClosePaymentStatusDialog:be,getRowClass:xe,printPDF:oe,showLabelCheckbox:we,confirmDeleteOrder:De,showMenu:Ce,formatDataFromUnixTimestamps:Fe}},components:{PaymentStatusDialog:Ge}};const Ke={class:"order-table"},Qe={style:{width:"15rem"}},We={class:"m-0 text-right",style:{"font-size":"12px"}},Xe={style:{width:"15rem"}},Ye={class:"m-0 text-right",style:{"font-size":"12px"}},Ze={key:0},$e={key:0},eo=t("div",{class:"flex justify-content-center w-full"},"Check-in",-1),oo={class:"flex justify-content-center"},to={class:"flex flex-column",style:{"margin-top":"8px"}},no={class:"text-sm",style:{"min-height":"15px"}},lo=t("div",{class:"flex justify-content-center w-full"},"No-show",-1),so={class:"flex justify-content-center"},ao={class:"flex flex-column",style:{"margin-top":"8px"}},io={class:"text-sm",style:{"min-height":"15px"}},ro={class:"overlay-menu"},co=["onClick"],uo=t("i",{class:"pi pi-print mr-3"},null,-1),mo=["disabled","onClick"],_o=t("i",{class:"pi pi-pencil mr-3"},null,-1),fo=["disabled","onClick"],ho=t("i",{class:"pi pi-trash mr-3"},null,-1),po={key:0},vo={key:1},yo=t("div",{class:"flex justify-content-center w-full"},"Check-in",-1),ko={class:"flex justify-content-center"},go=t("div",{class:"flex justify-content-center w-full"},"No-show",-1),bo={class:"flex justify-content-center"},xo=t("div",{class:"flex justify-content-center w-full"},"PDF",-1),wo={class:"flex justify-content-center"},Co={key:0,class:"flex mx-4"},Do=t("div",null,[t("div",{class:"p-0 m-0 flex align-items-center"},[t("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),t("span",{class:"text-sm"},"WEB")]),t("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[t("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),t("span",{class:"text-sm"},"KALATA")])],-1),Vo=[Do];function To(l,o,n,e,x,k){const i=h("Column"),c=h("ProgressBar"),p=h("Button"),f=h("Badge"),_=h("Checkbox"),s=h("OverlayPanel"),O=h("DataTable"),m=h("PaymentStatusDialog"),g=h("Dialog"),T=Oe("tooltip");return y(),D("div",Ke,[a(O,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":o[1]||(o[1]=v=>e.expandedRows=v)},{empty:b(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:b(v=>[a(O,{value:v.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":o[0]||(o[0]=d=>e.expandedRows1=d),rowClass:e.getRowClass},{empty:b(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:b(d=>[a(O,{value:d.data.order_item_tickets,class:"m-4 mx-5"},{default:b(()=>[a(i,{header:"Codice biglietto",field:"code"}),a(i,{header:"Tipo biglietto",field:"type"},{body:b(({data:r})=>[a(f,{value:r.ticket_name,class:Z([r.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(i,{header:"Prezzo"},{body:b(({data:r})=>[r.ticket_price?(y(),D("span",po," € "+S((+r.ticket_price).toFixed(2)),1)):(y(),D("span",vo,"-"))]),_:1}),a(i,null,{header:b(()=>[yo]),body:b(({data:r})=>[t("div",ko,[a(_,{modelValue:r.check_in,"onUpdate:modelValue":V=>r.check_in=V,binary:!0,onChange:V=>e.checkInSingleTicket(r.id,r.check_in,d.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(i,null,{header:b(()=>[go]),body:b(({data:r})=>[t("div",bo,[a(_,{modelValue:r.no_show,"onUpdate:modelValue":V=>r.no_show=V,binary:!0,onChange:V=>e.noShowSingleTicket(r.id,r.no_show,d.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(i,{field:"tickets_url"},{header:b(()=>[xo]),body:b(({data:r})=>[t("div",wo,[ee(a(p,{link:"",icon:"pi pi-print",href:r.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:V=>e.printPDF(r.id,n.filters.location_permalink,!0)},null,8,["href","onClick"]),[[T,"Stampa PDF",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:b(()=>[a(i,{header:"Codice",field:"reservation_number"}),a(i,{header:"Acquirente"},{body:b(({data:d})=>[U(S(d.user_name)+" "+S(d.user_surname)+" ",1),!d.user_name&&!d.user_surname?(y(),D("span",Ze,"-")):N("",!0)]),_:1}),a(i,{header:"Q.ta",field:"quantity"}),a(i,{header:"Pagamento"},{body:b(({data:d})=>[d.status?(y(),D("span",$e,[a(f,{value:e.prettyPaymentStatus(d.status),class:Z([d.status,"px-3 border-round-lg"])},null,8,["value","class"])])):N("",!0)]),_:1}),a(i,null,{header:b(()=>[eo]),body:b(({data:d})=>[t("div",oo,[t("div",to,[a(_,{modelValue:d.check_in,"onUpdate:modelValue":r=>d.check_in=r,binary:!0,onChange:r=>e.checkAll(d,d.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),t("span",no,S(e.showLabelCheckbox(d,!1)),1)])])]),_:1}),a(i,null,{header:b(()=>[lo]),body:b(({data:d})=>[t("div",so,[t("div",ao,[a(_,{modelValue:d.no_show,"onUpdate:modelValue":r=>d.no_show=r,binary:!0,onChange:r=>e.noShowAll(d,d.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),t("span",io,S(e.showLabelCheckbox(d,!0)),1)])])]),_:1}),a(i,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:b(({data:d})=>[ee(a(p,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-comment",text:"",rounded:"",onClick:r=>e.showNotes(r,d.notes),disabled:!d.notes},null,8,["onClick","disabled"]),[[T,"Note",void 0,{top:!0}]]),a(s,{ref:"op"},{default:b(()=>[U(S(e.op.note),1)]),_:1},512),a(p,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:r=>e.showMenu(r,d)},null,8,["onClick"]),a(s,{ref:"visibleMenu"},{default:b(()=>[t("ul",ro,[t("li",{onClick:r=>e.printPDF(e.visibleMenu.data.id,n.filters.location_permalink,!1)},[uo,U("Stampa PDF ")],8,co),t("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:r=>e.openPaymentStatusDialog(e.visibleMenu.data)},[_o,U("Cambia stato ")],8,mo),t("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:r=>e.confirmDeleteOrder(r,e.visibleMenu.data)},[ho,U("Elimina ")],8,fo)])]),_:2},1536)]),_:1}),a(i,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass"]),v.data.orders&&v.data.orders.length>0?(y(),D("div",Co,Vo)):N("",!0)]),default:b(()=>[a(i,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(i,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),a(i,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:b(({data:v})=>[t("div",Qe,[t("p",We,S(v.confirmed_seats)+"/"+S(v.remaing_seats+v.confirmed_seats),1),a(c,{value:v.confirmed_seats*100/(v.remaing_seats+v.confirmed_seats),showValue:!1,style:{height:"10px"},class:Z(["available-progress",e.getProgressClass(v.confirmed_seats,v.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(i,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:b(({data:v})=>[t("div",Xe,[t("p",Ye," 0 /"+S(v.confirmed_seats),1),a(c,{value:v.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(i,null,{body:b(({data:v})=>[ee(a(p,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:d=>e.openDialog(v)},null,8,["onClick"]),[[T,"Prenota",void 0,{top:!0}]])]),_:1}),a(i,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"]),a(g,{visible:e.visibleDialog,"onUpdate:visible":o[3]||(o[3]=v=>e.visibleDialog=v),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:b(()=>[a(m,{location_permalink:n.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:o[2]||(o[2]=v=>e.onClosePaymentStatusDialog(v))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"])])}const Oo=z(He,[["render",To]]),So={props:["filters"],setup(l,o){I(()=>{O();let r=W.now();n.value=l.filters,n.value.date=r.toFormat("dd/MM/yyyy"),T()});const n=C({}),e=ne(),x=E(),k=R(),i=C([]),c=C(),p=F(()=>e.allLocations),f=F(()=>x.getCalendar),_=function(){},s=async function(r){await x.fetchCalendar(r).then(()=>{}).catch(V=>{A(k,V)})},O=async function(){await e.fetchAllLocations().then(()=>{m()}).catch(r=>{A(k,r)})},m=function(){if(l.filters.location_permalink){const r=p.value.find(V=>V.permalink===l.filters.location_permalink);i.value=r.courses}},g=function(r){let V={};V.month=W.fromJSDate(new Date(r)).month,V.year=W.fromJSDate(new Date(r)).year,V.location_permalink=l.filters.location_permalink,c.value={month:V.month,year:V.year},s(V)},T=function(){let r=W.now(),V={location_permalink:"",month:"",year:""};V.location_permalink=l.filters.location_permalink,V.month=r.month+"",V.year=r.year+"",s(V)},v=function(r){if(f.value.web_dates&&f.value.web_dates.length!=0){let V=r.month+1;V=r.month<10?"0"+V:V;let q=r.day<10?"0"+r.day:r.day,J=r.year+"-"+V+"-"+q;return f.value.web_dates.find(B=>B==J)}},d=function(r){let V={location_permalink:l.filters.location_permalink,month:r.month,year:r.year};s(V)};return K(l.filters,()=>{if(c.value){let r={location_permalink:l.filters.location_permalink,month:c.value.month,year:c.value.year};s(r)}else T()}),{form:n,courses:i,locations:p,calendar:f,resetField:_,getCourses:m,onDateChange:g,getDayFromDate:v,onMonthChange:d}}},Fo={class:"flex calendar-filter"},No={key:0,class:"special-day"};function Lo(l,o,n,e,x,k){const i=h("Calendar");return y(),D("div",Fo,[a(i,{modelValue:e.form.date,"onUpdate:modelValue":o[0]||(o[0]=c=>e.form.date=c),inline:"",onDateSelect:o[1]||(o[1]=c=>e.onDateChange(c)),onMonthChange:o[2]||(o[2]=c=>e.onMonthChange(c))},{date:b(c=>[e.getDayFromDate(c.date)?(y(),D("div",No,[t("span",null,S(c.date.day),1)])):(y(),D(H,{key:1},[U(S(c.date.day),1)],64))]),_:1},8,["modelValue"])])}const Ao=z(So,[["render",Lo]]),Uo={props:["filters"],setup(l,o){I(()=>{n.value=Object.assign({},l.filters),n.value.date=W.now().toFormat("dd/MM/yyyy"),k.value=ce(8,20),k.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=C({}),e=C([]),x=ne();R();const k=C([]),i=E(),c=F(()=>x.allLocations),p=F(()=>i.responseOrders),f=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=k.value[0],o.emit("onSubmit",n.value)},_=function(){if(e.value=[],n.value.location_permalink){const s=c.value.find(O=>O.permalink===n.value.location_permalink);e.value=s.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}};return K(c,()=>{l.filters.location_permalink&&c.value&&(n.value=Object.assign({},l.filters),n.value.hour||(n.value.hour="Tutti gli orari"),_())}),K(l.filters,()=>{l.filters.location_permalink&&c.value&&n.value.location_permalink&&n.value.location_permalink!=l.filters.location_permalink&&(n.value=Object.assign({},l.filters),n.value.hour||(n.value.hour="Tutti gli orari"),_())}),{form:n,courses:e,hours:k,locations:c,responseOrders:p,resetField:f,getCourses:_}}},Mo={class:"formgrid grid px-0 align-items-center"},Po={key:0,class:"field col-4 flex flex-column"},jo=t("label",{for:"typology"},"Filtra per percorso",-1),zo={key:1,class:"field col-3 flex flex-column"},Bo=t("label",{for:"typology"},"Filtra per orario (dalle)",-1),Io=t("div",{class:"col-12"},null,-1),Ro={class:"field col-4 flex flex-column"},Eo=t("label",{for:"typology"},"Filtra per nome acquirente",-1),qo={class:"flex col-12 justify-content-end pt-1"};function Jo(l,o,n,e,x,k){const i=h("Dropdown"),c=h("InputText"),p=h("Button"),f=h("AccordionTab"),_=h("Accordion");return y(),Y(_,{activeIndex:0},{default:b(()=>[a(f,{header:"FILTRI"},{default:b(()=>[t("div",Mo,[e.form.location_permalink?(y(),D("div",Po,[jo,a(i,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.course=s),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):N("",!0),e.responseOrders?(y(),D("div",zo,[Bo,a(i,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.hour=s),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):N("",!0),Io,t("div",Ro,[Eo,a(c,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.name=s),placeholder:""},null,8,["modelValue"])])]),t("div",qo,[a(p,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=s=>l.$emit("onSubmit",e.form))}),a(p,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=s=>e.resetField())})])]),_:1})]),_:1})}const Go=z(Uo,[["render",Jo]]),Ho={props:["form","price","index","ticket"],setup(l,o){const n=C(0),e=function(){n.value++,k()},x=function(){n.value>0&&n.value--,k()},k=function(){const i={counter:n.value,price:l.price,index:l.index,ticket:l.ticket};o.emit("changeCounter",i)};return{counter:n,decrement:x,increment:e}}},Ko={class:"btn-plus-min flex align-items-center"},Qo={class:"counter"};function Wo(l,o,n,e,x,k){const i=h("Button");return y(),D("div",Ko,[a(i,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),t("div",Qo,S(e.counter),1),a(i,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const Xo=z(Ho,[["render",Wo]]),Yo={props:["tickets","form"],setup(l,o){const n=C(0),e=C([]),x=C(!1),k=C(),i=E(),c=R(),p=F(()=>i.getDiscount),f=function(g){e.value[g.index]={partial_total:g.price*g.counter,ticket:g.ticket,quantity:g.counter},n.value=0,e.value.forEach(T=>{n.value+=T.partial_total}),k.value&&s()},_=function(){s()},s=async function(){let g=[];e.value.forEach(v=>{g.push({id:v.ticket.id,quantity:v.quantity})});const T={discount_code:k.value,location_permalink:l.form.location_permalink,tickets:g};await i.cost(T).then(()=>{}).catch(v=>{A(c,v)})};return{total:n,partialTotals:e,showDiscount:x,discountCode:k,discount:p,onChangeCounter:f,applyDiscount:_,checkDisabled:function(){if(!e.value||e.value.length==0)return!0;let g=0;return e.value.forEach(T=>{g+=T.quantity}),g==0},nextTab:function(){const g={discount_code:k.value,partial_total:e.value};o.emit("nextTab",g)}}},components:{PlusMinusButton:Xo}},Zo={key:0,class:"flex justify-content-between align-items-center"},$o={class:"flex align-items-center col-9"},et={class:"col-4 pl-0"},ot={class:"text-right col-2"},tt={class:"col-3 flex justify-content-end"},nt=t("hr",{class:"mt-3"},null,-1),lt={class:"col-12 m-0 py-0 flex flex-column align-items-start"},st={class:"flex align-items-center justify-content-between py-0"},at={class:"col-9 flex"},it=t("b",null,"Totale",-1),rt=[it],ct={key:0,class:"text-right col-4"},dt={class:"line-through text-sm mr-2"},ut={class:"font-bold"},mt={key:1,class:"col-2 text-right font-bold"},_t={class:"col-3 flex justify-content-end"};function ft(l,o,n,e,x,k){const i=h("PlusMinusButton"),c=h("Button"),p=h("InputText"),f=h("InputGroup");return y(),D(H,null,[(y(!0),D(H,null,se(n.tickets,(_,s)=>{var O,m,g;return y(),D("div",{key:_.id},[((O=_.course)==null?void 0:O.id)==((m=n.form.course)==null?void 0:m.id)?(y(),D("div",Zo,[t("div",$o,[t("b",et,S(_.name),1),t("div",ot,"€ "+S((g=_.price)==null?void 0:g.toFixed(2)),1)]),t("div",tt,[a(i,{onChangeCounter:o[0]||(o[0]=T=>e.onChangeCounter(T)),price:_.price,index:s,ticket:_},null,8,["price","index","ticket"])])])):N("",!0)])}),128)),nt,t("div",lt,[a(c,{label:"Codice sconto",link:"",onClick:o[1]||(o[1]=_=>e.showDiscount?e.showDiscount=!1:e.showDiscount=!0),class:"p-0"}),e.showDiscount?(y(),Y(f,{key:0,class:"discount"},{default:b(()=>[a(p,{placeholder:"Inserisci codice",modelValue:e.discountCode,"onUpdate:modelValue":o[2]||(o[2]=_=>e.discountCode=_)},null,8,["modelValue"]),a(c,{label:"Applica",onClick:e.applyDiscount},null,8,["onClick"])]),_:1})):N("",!0)]),t("div",st,[t("div",at,[t("div",{class:Z(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},rt,2),e.discount&&e.discount.total_amount?(y(),D("div",ct,[t("span",dt,"€ "+S(e.total.toFixed(2)),1),t("span",ut,"€ "+S(e.discount.total_amount.toFixed(2)),1)])):(y(),D("div",mt,"€ "+S(e.total.toFixed(2)),1))]),t("div",_t,[a(c,{label:"Prosegui",onClick:o[3]||(o[3]=_=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const ht=z(Yo,[["render",ft]]),pt={props:["location_permalink"],setup(l){I(()=>{f()});const o=te(),n=Ne(),e=E(),x=C({}),k=F(()=>n.allCountries),i=F(()=>o.allOpenTickets),c=F(()=>e.paymentStatus),p=F(()=>e.paymentModeList),f=async function(){await n.fetchAllCountries().then(()=>{x.value.country_id=88,x.value.status={id:"to_pay",name:"Da pagare"}})};return{form:x,countries:k,paymentList:c,paymentModeList:p,open_tickets:i,fetchAllOpenTickets:async function(s){const O={code:s.query.toUpperCase(),location_permalink:l.location_permalink};await o.fetchAllOpenTickets(O)}}}},vt={key:0,class:"formgrid grid"},yt={class:"field col-6"},kt=t("label",{for:"user_name"},"Nome",-1),gt={class:"field col-6"},bt=t("label",{for:"user_surname"},"Cognome",-1),xt={class:"field col-6"},wt=t("label",{for:"user_email"},"Email",-1),Ct={class:"field col-6"},Dt=t("label",{for:"user_phone"},"Telefono",-1),Vt={class:"field col-6"},Tt=t("label",{for:"country_id"},"Nazione",-1),Ot={class:"field col-6"},St=t("label",{for:"user_zip"},"Cap",-1),Ft={class:"field col-6"},Nt=t("label",{for:"status"},"Stato pagamento",-1),Lt={class:"field col-6"},At=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Ut={key:0,class:"field col-6 flex flex-column"},Mt=t("label",{for:"user_zip"},"Codice biglietto",-1),Pt={class:"field col-12"},jt={class:"field flex flex-column"},zt=t("label",{for:"notes"},"Note",-1),Bt={class:"col-12 flex justify-content-end"};function It(l,o,n,e,x,k){const i=h("InputText"),c=h("Dropdown"),p=h("AutoComplete"),f=h("Textarea"),_=h("Button");return e.form?(y(),D("div",vt,[t("div",yt,[kt,a(i,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.user_name=s),class:"w-full"},null,8,["modelValue"])]),t("div",gt,[bt,a(i,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.user_surname=s),class:"w-full"},null,8,["modelValue"])]),t("div",xt,[wt,a(i,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.user_email=s),class:"w-full"},null,8,["modelValue"])]),t("div",Ct,[Dt,a(i,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":o[3]||(o[3]=s=>e.form.user_phone=s),class:"w-full"},null,8,["modelValue"])]),t("div",Vt,[Tt,a(c,{modelValue:e.form.country_id,"onUpdate:modelValue":o[4]||(o[4]=s=>e.form.country_id=s),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Ot,[St,a(i,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":o[5]||(o[5]=s=>e.form.user_zip=s),class:"w-full"},null,8,["modelValue"])]),t("div",Ft,[Nt,a(c,{modelValue:e.form.status,"onUpdate:modelValue":o[6]||(o[6]=s=>e.form.status=s),options:e.paymentList,optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])]),t("div",Lt,[At,a(c,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[7]||(o[7]=s=>e.form.payment_mode=s),options:e.paymentModeList,optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode&&e.form.payment_mode.label=="Biglietto a data aperta (voucher)"?(y(),D("div",Ut,[Mt,a(p,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":o[8]||(o[8]=s=>e.form.open_ticket_codes=s),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:o[9]||(o[9]=s=>e.fetchAllOpenTickets(s)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"id",multiple:""},null,8,["modelValue","suggestions"])])):N("",!0),t("div",Pt,[t("div",jt,[zt,a(f,{modelValue:e.form.notes,"onUpdate:modelValue":o[10]||(o[10]=s=>e.form.notes=s),rows:"5",cols:"30"},null,8,["modelValue"])])]),t("div",Bt,[a(_,{label:"Prosegui",onClick:o[11]||(o[11]=s=>l.$emit("nextTab",e.form))})])])):N("",!0)}const Rt=z(pt,[["render",It]]),Et={props:["form"],setup(l,o){I(()=>{s()});const n=C(0),e=C([]),x=C(!1),k=C(),i=te(),c=E(),p=R(),f=F(()=>i.allTickets),_=F(()=>c.getCurrentOrder),s=async function(){debugger;const d={location_permalink:l.form.location_permalink,api_version:"v2",date:X(l.form.date),course_id:l.form.course.id};await i.fetchAllTickets(d).then(()=>{}).catch(r=>{A(p,r)})},O=function(d){n.value+=1,k.value=d.discount_code,e.value=Object.assign([],d.partial_total)},m=function(d){return X(d).includes("Invalid")?ie(d):X(d)},g=function(d){T(d)},T=async function(d){var q,J,B;const r=[{start_at:l.form.hour,tickets:[]}];e.value.forEach(j=>{j.quantity!=0&&r[0].tickets.push({id:j.ticket.id,quantity:j.quantity})});const V={location_permalink:l.form.location_permalink,country_id:d.country_id,status:d.status.id,user_email:d.user_email,user_name:d.user_name,user_phone:d.user_phone,user_surname:d.user_surname,user_zip:d.user_zip,api_version:"v2",date:l.form.date?m(l.form.date):"",note:d.notes,time_slots:r,payment_method:(q=d.payment_mode)==null?void 0:q.id,course_id:(B=(J=l.form)==null?void 0:J.course)==null?void 0:B.id};k.value&&(V.discount_code=k.value),await c.createOrder(V).then(()=>{n.value+=1,x.value=!0}).catch(j=>{A(p,j)})};return{tickets:f,active:n,partialTotals:e,showOrderDetail:x,currentOrder:_,formatExplicitDate:Le,formatDate:re,onNextTab:O,onConfirmPayment:g,printPDF:oe,onPrintPDF:function(){oe(_==null?void 0:_.value.order_items[0].id,l.form.location_permalink,!1),o.emit("closeDialog",!0)}}},components:{NewOrderTicketTab:ht,NewOrderFormTab:Rt}},qt={key:0,class:"info-box"},Jt={class:"font-medium"},Gt=t("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),Ht={class:"font-medium"},Kt=t("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Qt={key:0,class:"capitalize"},Wt={key:0,class:"flex pb-4"},Xt=t("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),Yt={class:"flex flex-column"},Zt={key:0,class:"pb-1 pr-1"},$t={key:1,class:"pb-1"},en={class:"py-5"},on={class:"m-0 text-center font-bold line-height-3"},tn=t("br",null,null,-1),nn=t("br",null,null,-1),ln={class:"flex align-items-center justify-content-center mt-3"};function sn(l,o,n,e,x,k){var s,O;const i=h("NewOrderTicketTab"),c=h("TabPanel"),p=h("NewOrderFormTab"),f=h("Button"),_=h("TabView");return y(),D(H,null,[n.form?(y(),D("div",qt,[t("p",Jt,[Gt,U(S((s=n.form.course)==null?void 0:s.name),1)]),t("p",Ht,[Kt,n.form.date?(y(),D("span",Qt,S(e.formatDate((O=n.form)==null?void 0:O.date)),1)):N("",!0),U(" - "+S(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(y(),D("div",Wt,[Xt,t("div",Yt,[(y(!0),D(H,null,se(e.partialTotals,m=>{var g;return y(),D("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:m},[m&&m.quantity!=0?(y(),D("span",Zt,S((g=m.ticket)==null?void 0:g.name),1)):N("",!0),m&&m.quantity!=0?(y(),D("span",$t," x "+S(m.quantity)+" "+S(m.price),1)):N("",!0)])}),128))])])):N("",!0)])):N("",!0),a(_,{activeIndex:e.active,"onUpdate:activeIndex":o[3]||(o[3]=m=>e.active=m)},{default:b(()=>[a(c,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:b(()=>[a(i,{tickets:e.tickets,form:n.form,onNextTab:o[0]||(o[0]=m=>e.onNextTab(m))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(c,{header:"Inserisci i dati",disabled:e.showOrderDetail},{default:b(()=>[a(p,{onNextTab:o[1]||(o[1]=m=>e.onConfirmPayment(m)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(y(),Y(c,{key:0,header:"Ordine completato"},{default:b(()=>{var m;return[t("div",en,[t("div",on,[U(" Ordine "+S(e.currentOrder.reservation_number)+" registrato correttamente!",1),tn,U(" Ti abbiamo inoltrato la conferma via mail."),nn,U(" Totale ordine: € "+S((+((m=e.currentOrder)==null?void 0:m.total)).toFixed(2)),1)]),t("div",ln,[a(f,{label:"Stampa biglietti",outlined:"",onClick:o[2]||(o[2]=g=>e.onPrintPDF())})])])]}),_:1})):N("",!0)]),_:1},8,["activeIndex"])],64)}const an=z(Et,[["render",sn]]),rn={props:["filters","date"],setup(l,o){I(()=>{s(),k.value=ce(8,20),n.value=Object.assign({},l.filters)});const n=C({}),e=Ae(),x=R(),k=C(),i=C(!1),c=ae(),p=C(!1),f=F(()=>e.allCourses),_=F(()=>c.showNewOrderDialog),s=async function(){const T={location_permalink:l.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(T).then(()=>{}).catch(v=>{A(x,v)})},O=function(){c.setNewOrderDialogVisibility(!1),n.value={},o.emit("onCloseDialog")},m=function(T){n.value.date=l.date,c.setNewOrderDialogVisibility(T)},g=function(){p.value=n.value.open_ticket};return K(l.filters,()=>{if(s(),n.value=Object.assign({},l.filters),l.filters.course&&!l.filters.course.id){let T=f.value.find(v=>v.name===l.filters.course.name);T&&(n.value.course=T)}}),{courses:f,form:n,hours:k,disableForm:p,visible:i,onCloseDialog:O,updateDialog:m,onChecked:g,dialogVisible:_,dialogStore:c}},components:{NewOrderDialog:an}},cn=t("h2",{class:"mt-1"},"Nuova prenotazione",-1),dn={class:"formgrid grid px-0 align-items-center mt-4"},un={key:0,class:"field flex flex-column w-full col-12"},mn=t("label",{for:"typology"},"Scegli il percorso",-1),_n={key:1,class:"field flex flex-column w-full col-12"},fn=t("label",{for:"typology"},"Seleziona l'orario",-1),hn={class:"flex justify-content-end align-items-center mt-2"},pn={class:"flex align-items-center justify-content-between w-full"},vn=t("h2",null,"Nuova prenotazione",-1);function yn(l,o,n,e,x,k){const i=h("Dropdown"),c=h("Button"),p=h("NewOrderDialog"),f=h("Dialog"),_=h("Card");return y(),Y(_,{class:"mt-4"},{content:b(()=>[cn,t("div",dn,[n.filters.location_permalink?(y(),D("div",un,[mn,a(i,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.course=s),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):N("",!0),n.filters.location_permalink?(y(),D("div",_n,[fn,a(i,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.hour=s),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):N("",!0)]),t("div",hn,[a(c,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:o[2]||(o[2]=s=>e.updateDialog(!0))},null,8,["disabled"])]),a(f,{visible:e.dialogVisible,"onUpdate:visible":o[5]||(o[5]=s=>e.dialogVisible=s),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:o[6]||(o[6]=s=>e.onCloseDialog())},{header:b(()=>[t("div",pn,[vn,a(c,{icon:"pi pi-times",text:"",rounded:"",onClick:o[3]||(o[3]=s=>e.updateDialog(!1))})])]),default:b(()=>[a(p,{form:e.form,onCloseDialog:o[4]||(o[4]=s=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const kn=z(rn,[["render",yn]]),gn={setup(){I(()=>{i.value&&(l.value.location_permalink=i.value.location.permalink,o.value.location_permalink=i.value.location.permalink,p())});const l=C({}),o=C({}),n=C(),e=Se(),x=ne(),k=R(),i=F(()=>e.currentUser),c=F(()=>x.allLocations),p=async function(){await x.fetchAllLocations().then(()=>{}).catch(m=>{A(k,m)})};return{filters:l,orderTable:n,order_filters:o,user:i,locations:c,fetchAllLocations:p,formatDate:re,onUpdateFilters:function(m){m.course&&(l.value.course={id:m.course}),m.name&&(l.value.name=m.name),m.hour&&(m.hour.start_at?l.value.hour=m.hour.start_at:l.value.hour=m.hour)},onUpdateNewOrderFilters:function(m){m.start_at&&(o.value.hour=m.start_at),m.course_name&&(o.value.course={name:m.course_name}),o.value.date=l.value.date},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){o.value.location_permalink=l.value.location_permalink}}},components:{CalendarFilter:Ao,OrderTable:Oo,OrderFilter:Go,NewOrderCard:kn}};const bn={class:"flex justify-content-between align-items-center"},xn={class:"field flex flex-column mt-3"},wn={key:0,style:{color:"#495057"}},Cn=t("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Dn={class:"capitalize text-xl"},Vn={class:"flex gap-4"},Tn={key:0,class:"col-3 mt-3"},On={class:"col-9 mt-3"};function Sn(l,o,n,e,x,k){const i=h("Dropdown"),c=h("CalendarFilter"),p=h("NewOrderCard"),f=h("OrderFilter"),_=h("OrderTable");return y(),D("div",null,[t("div",bn,[t("div",xn,[a(i,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=s=>e.filters.location_permalink=s),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location",onChange:o[1]||(o[1]=s=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(y(),D("div",wn,[Cn,t("span",Dn,S(e.formatDate(e.filters.date)),1)])):N("",!0)]),t("div",Vn,[e.filters.location_permalink?(y(),D("div",Tn,[a(c,{filters:e.filters},null,8,["filters"]),a(p,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:o[2]||(o[2]=s=>e.onCloseDialog())},null,8,["date","filters"])])):N("",!0),t("div",On,[a(f,{filters:e.filters,onOnSubmit:o[3]||(o[3]=s=>e.onUpdateFilters(s))},null,8,["filters"]),e.filters.date?(y(),Y(_,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:o[4]||(o[4]=s=>e.onUpdateNewOrderFilters(s))},null,8,["filters"])):N("",!0)])])])}const Un=z(gn,[["render",Sn]]);export{Un as default};
