import{o as F,c as b,J as $,a as S,x as m,i as q,_ as D,r as f,b as h,e as x,f as s,w as p,h as O,t as T,I as U,N as C,n as E,g as r,M as H,u as J,H as P}from"../index57368.js";import{a as W,b as G,d as K,e as Q,i as X}from"./NewOrderDialog.vue_vue_type_style_index_0_lang57368.js";import{e as V,s as Y}from"./helpers57368.js";const Z={props:["filters"],setup(n,t){F(()=>{d.value=!0,w.value={first:0,rows:_.value.rows,sortField:null,sortOrder:null},w.value.page=0,n.filters.location_permalink&&y()});const i=W(),e=G(),g=b(()=>i.responseOrders),v=b(()=>i.status),l=$();b(()=>l.submitDialog),b(()=>l.cancelDialog);const c=S(),_=m(),o=m(),a=m(),d=m(!0),w=m(),R=m(0),A=m([]),N=m([]);function y(){d.value=!0;let u=new Map;for(const k in n.filters)n.filters.location_permalink&&u.set("location_permalink",n.filters.location_permalink);setTimeout(()=>{z(u)},Math.random()*1e3+250)}const z=async function(u){await i.fetchOrderWithOpenTicket(u).then(()=>{d.value=!1}).catch(k=>{d.value=!1,V(c,k)})},L=async function(u,k){d.value=!0;const j={order_id:u.id,id:n.filters.location_permalink,ticket_codes:[k]};await i.updateOrder(j).then(()=>{d.value=!1,Y(c,{message:"Stato aggiornato correttamente",error:!1}),y()}).catch(M=>{d.value=!1,V(c,M)})},B=u=>{a.value.toggle(u)},I=function(u){const k={course_name:u.course_name,start_at:u.start_at};t.emit("updateFilters",k),e.setNewOrderDialogVisibility(!0)};return q(n.filters,()=>{n.filters.location_permalink&&y()}),{dt:_,responseOrders:g,loading:d,totalRecords:R,lazyParams:w,currentOrder:o,status:v,expandedRows:A,expandedRows1:N,op:a,dialogStore:e,loadLazyData:y,onChangeUsedStatus:L,toggle:B,openDialog:I,formatDataFromUnixTimestamps:K}},components:{}};const ee={class:"order-table"},oe=r("div",{class:"w-full text-center"},"Utilizzato",-1);function te(n,t,i,e,g,v){const l=f("Column"),c=f("Checkbox"),_=f("DataTable");return h(),x("div",ee,[s(_,{value:e.responseOrders.orders,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[0]||(t[0]=o=>e.expandedRows=o)},{empty:p(()=>[O(" Nessuna prenotazione trovata. ")]),default:p(()=>[s(l,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),s(l,{header:"Email",field:"user_email",ref:"user_email"},null,512),s(l,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:p(({data:o})=>[O(T(e.formatDataFromUnixTimestamps(o.created_at)),1)]),_:1},512),s(l,{header:"Numero ticket"},{body:p(({data:o})=>{var a;return[O(T((a=o.order_items[0])==null?void 0:a.tickets[0].quantity),1)]}),_:1}),s(l,{header:"Codice ticket"},{body:p(({data:o})=>[(h(!0),x(U,null,C(o.order_items[0].ticket_codes,a=>(h(),x("div",{key:a.code,class:E(["py-1",a.used?"used":""])},T(a.code),3))),128))]),_:1}),s(l,null,{header:p(()=>[oe]),body:p(({data:o})=>[(h(!0),x(U,null,C(o.order_items[0].ticket_codes,a=>(h(),x("div",{key:a.code,class:"py-1 flex flex-column align-items-center"},[s(c,{modelValue:a.used,"onUpdate:modelValue":d=>a.used=d,binary:!0,onChange:d=>e.onChangeUsedStatus(o.order_items[0],a),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])]))),128))]),_:1})]),_:1},8,["value","totalRecords","loading","expandedRows"])])}const ne=D(Z,[["render",te]]),ae={props:["filters"],setup(n,t){F(()=>{i.value=Object.assign({},n.filters)});const i=m({});return{form:i,resetField:function(){i.value.name=null,t.emit("onSubmit",i.value)}}}},le={class:"formgrid grid px-0 align-items-center"},se={class:"field col-4 flex flex-column"},re=r("label",{for:"typology"},"Filtra per codice ordine",-1),ie={class:"field col-4 flex flex-column"},ce=r("label",{for:"typology"},"Filtra per codice ticket",-1),de={class:"field col-4 flex flex-column"},ue=r("label",{for:"typology"},"Filtra per email",-1),me={class:"flex col-12 justify-content-end mt-1"};function fe(n,t,i,e,g,v){const l=f("InputText"),c=f("Button"),_=f("AccordionTab"),o=f("Accordion");return h(),H(o,{activeIndex:0},{default:p(()=>[s(_,{header:"FILTRI"},{default:p(()=>[r("div",le,[r("div",se,[re,s(l,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])]),r("div",ie,[ce,s(l,{modelValue:e.form.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])]),r("div",de,[ue,s(l,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])])]),r("div",me,[s(c,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=a=>n.$emit("onSubmit",e.form))}),s(c,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=a=>e.resetField())})])]),_:1})]),_:1})}const _e=D(ae,[["render",fe]]),pe={setup(){F(()=>{v.value&&(n.value.location_permalink=v.value.location.permalink,c())});const n=m({}),t=m(),i=J(),e=Q(),g=S(),v=b(()=>i.currentUser),l=b(()=>e.allLocations),c=async function(){await e.fetchAllLocations().then(()=>{}).catch(o=>{V(g,o)})};return{filters:n,orderTable:t,user:v,locations:l,fetchAllLocations:c,formatDate:X,onUpdateFilters:function(o){n.value.hour=o.start_at,n.value.course={name:o.course_name},o.course&&(n.value.course={id:o.course}),n.value.name=o.name,o.hour&&(o.hour.start_at?n.value.hour=o.hour.start_at:n.value.hour=o.hour)}}},components:{OpenTicketTable:ne,OpenTicketFilter:_e}};const ve={class:"flex justify-content-between align-items-center"},he={class:"field flex flex-column mt-3"},xe={key:0,style:{color:"#495057"}},ge=r("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),ke={class:"capitalize text-xl"},be={class:"flex gap-4"},ye={class:"col-12 mt-3"};function Te(n,t,i,e,g,v){const l=f("Dropdown"),c=f("OpenTicketFilter"),_=f("OpenTicketTable");return h(),x("div",null,[r("div",ve,[r("div",he,[s(l,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":t[0]||(t[0]=o=>e.filters.location_permalink=o),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(h(),x("div",xe,[ge,r("span",ke,T(e.formatDate(e.filters.date)),1)])):P("",!0)]),r("div",be,[r("div",ye,[s(c,{filters:e.filters,onOnSubmit:t[1]||(t[1]=o=>e.onUpdateFilters(o))},null,8,["filters"]),s(_,{filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[2]||(t[2]=o=>e.onUpdateFilters(o))},null,8,["filters"])])])])}const Fe=D(pe,[["render",Te]]);export{Fe as default};
