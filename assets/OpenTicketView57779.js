import{o as S,c as x,a as U,x as p,i as R,_ as w,r as m,b as k,e as b,f as r,w as f,h as O,t as T,K as F,P as C,n as I,g as s,O as j,u as M,J as q}from"../index57779.js";import{u as E,b as P,e as J,g as K,a as W}from"./location57779.js";import{e as V,s as G}from"./helpers57779.js";const H={props:["filters"],setup(n,o){S(()=>{e.value=!0,v.value={first:0,rows:c.value.rows,sortField:null,sortOrder:null},v.value.page=0,n.filters.location_permalink&&y()});const i=E(),t=P(),h=x(()=>i.responseOrders),g=x(()=>i.status),a=U(),c=p(),u=p(),l=p(),e=p(!0),v=p(),D=p(0);function y(){e.value=!0;let d=new Map;for(const _ in n.filters)n.filters[_]&&d.set(_,n.filters[_].trim());setTimeout(()=>{L(d)},Math.random()*1e3+250)}const L=async function(d){await i.fetchOrderWithOpenTicket(d).then(()=>{e.value=!1}).catch(_=>{e.value=!1,V(a,_)})},z=async function(d,_){e.value=!0;const $={order_id:d.id,id:n.filters.location_permalink,ticket_codes:[_]};await i.updateOrder($).then(()=>{e.value=!1,G(a,{message:"Stato aggiornato correttamente",error:!1}),y()}).catch(B=>{e.value=!1,V(a,B)})},A=d=>{l.value.toggle(d)},N=function(d){const _={course_name:d.course_name,start_at:d.start_at};o.emit("updateFilters",_),t.setNewOrderDialogVisibility(!0)};return R(n.filters,()=>{y()}),{dt:c,responseOrders:h,loading:e,totalRecords:D,lazyParams:v,currentOrder:u,status:g,op:l,dialogStore:t,loadLazyData:y,onChangeUsedStatus:z,toggle:A,openDialog:N,formatDataFromUnixTimestamps:J}}};const Q={class:"order-table"},X=s("div",{class:"w-full text-center"},"Utilizzato",-1);function Y(n,o,i,t,h,g){const a=m("Column"),c=m("Checkbox"),u=m("DataTable");return k(),b("div",Q,[r(u,{value:t.responseOrders.orders,totalRecords:t.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:t.loading,stripedRows:""},{empty:f(()=>[O(" Nessuna prenotazione trovata. ")]),default:f(()=>[r(a,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),r(a,{header:"Email",field:"user_email",ref:"user_email"},null,512),r(a,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:f(({data:l})=>[O(T(t.formatDataFromUnixTimestamps(l.created_at)),1)]),_:1},512),r(a,{header:"Numero ticket"},{body:f(({data:l})=>{var e;return[O(T((e=l.order_items[0])==null?void 0:e.tickets[0].quantity),1)]}),_:1}),r(a,{header:"Codice ticket"},{body:f(({data:l})=>[(k(!0),b(F,null,C(l.order_items[0].ticket_codes,e=>(k(),b("div",{key:e.code,class:I(["py-1",e.used?"used":""])},T(e.code),3))),128))]),_:1}),r(a,null,{header:f(()=>[X]),body:f(({data:l})=>[(k(!0),b(F,null,C(l.order_items[0].ticket_codes,e=>(k(),b("div",{key:e.code,class:"py-1 flex flex-column align-items-center"},[r(c,{modelValue:e.used,"onUpdate:modelValue":v=>e.used=v,binary:!0,onChange:v=>t.onChangeUsedStatus(l.order_items[0],e),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])]))),128))]),_:1})]),_:1},8,["value","totalRecords","loading"])])}const Z=w(H,[["render",Y]]),ee={setup(n,o){const i=p({});return{form:i,resetField:function(){i.value.reservation_number=null,i.value.ticket_code=null,i.value.email=null,o.emit("onSubmit",i.value)}}}},te={class:"formgrid grid px-0 align-items-center"},oe={class:"field col-3 flex flex-column"},ne=s("label",{for:"typology"},"Filtra per codice prenotazione",-1),ae={class:"field col-3 flex flex-column"},le=s("label",{for:"typology"},"Filtra per codice ticket",-1),re={class:"field col-3 flex flex-column"},se=s("label",{for:"typology"},"Filtra per email",-1),ie={class:"flex col-12 justify-content-end mt-1"};function ce(n,o,i,t,h,g){const a=m("InputText"),c=m("Button"),u=m("AccordionTab"),l=m("Accordion");return k(),j(l,{activeIndex:0},{default:f(()=>[r(u,{header:"FILTRI"},{default:f(()=>[s("form",{onSubmit:o[4]||(o[4]=e=>n.$emit("onSubmit",t.form))},[s("div",te,[s("div",oe,[ne,r(a,{modelValue:t.form.reservation_number,"onUpdate:modelValue":o[0]||(o[0]=e=>t.form.reservation_number=e),placeholder:""},null,8,["modelValue"])]),s("div",ae,[le,r(a,{modelValue:t.form.ticket_code,"onUpdate:modelValue":o[1]||(o[1]=e=>t.form.ticket_code=e),placeholder:""},null,8,["modelValue"])]),s("div",re,[se,r(a,{modelValue:t.form.email,"onUpdate:modelValue":o[2]||(o[2]=e=>t.form.email=e),placeholder:""},null,8,["modelValue"])])]),s("div",ie,[r(c,{label:"Ricerca",class:"mr-2",type:"submit"}),r(c,{label:"Annulla",class:"p-button-outlined",onClick:o[3]||(o[3]=e=>t.resetField())})])],32)]),_:1})]),_:1})}const de=w(ee,[["render",ce]]),ue={setup(){S(()=>{c.value&&(n.value.location_permalink=c.value),u()});const n=p({}),o=p(),i=M(),t=K(),h=U(),g=x(()=>i.currentUser),a=x(()=>t.allLocations),c=x(()=>t.getCurrentLocation),u=async function(){await t.fetchAllLocations().then(()=>{c.value||(n.value.location_permalink=a.value[0].permalink,t.updateCurrenLocation(a.value[0].permalink))}).catch(e=>{V(h,e)})};return{filters:n,orderTable:o,user:g,locations:a,fetchAllLocations:u,formatDate:W,onUpdateFilters:function(e){let v=n.value.location_permalink;n.value.reservation_number=e.reservation_number,n.value.location_permalink=v,n.value.ticket_code=e.ticket_code,n.value.email=e.email}}},components:{OpenTicketTable:Z,OpenTicketFilter:de}};const me={class:"flex justify-content-between align-items-center"},_e={class:"field flex flex-column mt-3"},fe={key:0,style:{color:"#495057"}},pe=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),ve={class:"capitalize text-xl"},ke={class:"flex gap-4"},be={class:"col-12 mt-3"};function he(n,o,i,t,h,g){const a=m("Dropdown"),c=m("OpenTicketFilter"),u=m("OpenTicketTable");return k(),b("div",null,[s("div",me,[s("div",_e,[r(a,{modelValue:t.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=l=>t.filters.location_permalink=l),options:t.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),t.filters&&t.filters.date?(k(),b("div",fe,[pe,s("span",ve,T(t.formatDate(t.filters.date)),1)])):q("",!0)]),s("div",ke,[s("div",be,[r(c,{onOnSubmit:o[1]||(o[1]=l=>t.onUpdateFilters(l))}),r(u,{filters:t.filters,ref:"orderTable",class:"mt-4"},null,8,["filters"])])])])}const Te=w(ue,[["render",he]]);export{Te as default};
