import{l as me,m as fe,o as $,p as g,a as J,c as L,_ as R,r as y,b as m,e as p,g as s,f as l,q as F,F as W,t as b,h as M,n as X,s as ae,v as je,i as Q,x as Ee,w as D,y as ue,z as Y,A as Ie,B as Re,u as qe}from"../index58380.js";import{u as K,a as re,f as ye,b as pe,c as $e,d as Je,e as ve,g as ie,h as ke,i as He,D as Z}from"./location58380.js";import{u as ce,s as G,e as P,p as ge,a as Ge,b as be,c as _e,d as xe}from"./helpers58380.js";import{F as Ke}from"./vee-validate.esm58380.js";class he{static async fetchAll(t){const o=t.location_permalink;return delete t.location_permalink,(await me(`/ticket_office/${o}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const o=t.location_permalink;return delete t.location_permalink,(await me(`/ticket_office/${o}/orders/search_codes`,t)).data}}const de=fe({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:n=>n.response_tickets.available_ticket_types,allOpenTickets:n=>n.open_tickets_codes.open_tickets,responseTickets:n=>n.response_tickets,getTotalTickets:n=>n.response_tickets?n.response_tickets.total:0,getCurrentTicket:n=>n.ticket},actions:{async fetchAllTickets(n){await he.fetchAll(n).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(n){await he.fetchAllOpenTickets(n).then(t=>this.open_tickets_codes=t)}}}),We={props:["location_permalink","time_slot"],setup(n,t){$(()=>{o.value=Object.assign({},n.time_slot)});const o=g({}),e=de(),h=K(),{showLoader:f,hideLoader:a}=ce(),d=J(),k=L(()=>e.allOpenTickets),c=L(()=>h.paymentStatus),w=L(()=>h.paymentModeList),i=L(()=>h.getCurrentOrder),x=async function(S){const N={code:S.query.toUpperCase(),location_permalink:n.location_permalink};await e.fetchAllOpenTickets(N)},C=async function(){var N;const S={id:n.location_permalink,order_id:o.value.id,status:(N=o.value)==null?void 0:N.status,payment_method:o.value.payment_method,open_ticket_codes:[],api_version:"v2"};if(o.value.open_tickets_used&&o.value.open_tickets_used.length>0){let r=[];o.value.open_tickets_used.forEach(u=>{r.push(u.code)}),S.open_ticket_codes=r}v(S)},v=async function(S){f(),await h.updateOrder(S).then(()=>{a(),G(d,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",i.value)}).catch(N=>{a(),P(d,N)})};return{form:o,open_tickets:k,paymentList:c,paymentModeList:w,changeStatus:C,fetchAllOpenTickets:x,onChangeStatus:function(){(o.value.status=="free"||o.value.status=="to_pay")&&(o.value.payment_method=null)}}}},Qe={key:0,class:"formgrid grid flex-column mt-3"},Xe={class:"field col-12"},Ye=s("label",{for:"status"},"Stato pagamento",-1),Ze={class:"field col-12"},et=s("label",{for:"payment_method"},"Modalità pagamento",-1),tt={key:0,class:"field col-12 flex flex-column"},ot=s("label",{for:"user_zip"},"Codice biglietto",-1),nt={class:"flex align-items-center justify-content-end mt-3"};function st(n,t,o,e,h,f){const a=y("Dropdown"),d=y("AutoComplete"),k=y("Button");return m(),p(W,null,[e.form?(m(),p("div",Qe,[s("div",Xe,[Ye,l(a,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.status=c),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=c=>e.onChangeStatus())},null,8,["modelValue","options"])]),s("div",Ze,[et,l(a,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=c=>e.form.payment_method=c),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full",disabled:e.form.status!="payed"},null,8,["modelValue","options","disabled"])]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(m(),p("div",tt,[ot,l(d,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[3]||(t[3]=c=>e.form.open_tickets_used=c),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[4]||(t[4]=c=>e.fetchAllOpenTickets(c)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):F("",!0)])):F("",!0),s("div",nt,[l(k,{label:"Annulla",text:"",onClick:t[5]||(t[5]=c=>n.$emit("closeDialog",null))}),l(k,{label:"Conferma",onClick:t[6]||(t[6]=c=>e.changeStatus())})])],64)}const lt=R(We,[["render",st]]),at={props:["order"],setup(n,t){$(()=>{C.value&&x.value&&C.value.forEach(v=>{v.permalink===x.value&&(a.value=v.name)})});const o=g(0),e=g([]),h=g(!1),f=g(!0),a=g(),d=de(),k=K();J();const c=re(),w=L(()=>d.allTickets),i=L(()=>k.getCurrentOrder),x=L(()=>c.getCurrentLocation),C=L(()=>c.allLocations);return{tickets:w,active:o,partialTotals:e,showOrderDetail:h,currentOrder:i,showSecondTab:f,currentLocation:x,selectedLocation:a,formatExplicitDate:ye,formatDate:pe,prettyPaymentStatus:ge,formatPrettyDate:$e,formatDataAndHourFromUnixTimestamps:Je,prettyPaymentMethod:Ge}},components:{}};const it={class:"mt-3 line-height-3"},rt={class:"flex gap-3"},ct=s("i",{class:"pi pi-user mt-1"},null,-1),dt={class:"m-0 mb-1"},ut={class:"m-0 mb-1"},mt={class:"m-0 mb-1"},_t={class:"m-0 mb-1"},ft={key:0},pt={class:"flex gap-3 mt-4"},vt=s("i",{class:"pi pi-map-marker mt-1"},null,-1),ht={class:"m-0 mb-1"},yt={class:"m-0 mb-1"},kt={key:0,class:"m-0 mb-1"},gt={class:"flex gap-3 mt-4"},bt=s("i",{class:"pi pi-shopping-cart mt-1"},null,-1),xt={class:"m-0 mb-1"},wt={class:"m-0 mb-1"},Ct={class:"m-0 mb-1"},Dt={key:0,class:"m-0 mb-1"},St={key:1,class:"m-0 mb-1"},Ot={key:2,class:"m-0 mb-1"},Tt={class:"m-0 mb-1"},Vt={class:"m-0 mb-1"},At={key:0},Ft={key:1},Nt={key:0,class:"flex gap-3 mt-4"},Lt=s("i",{class:"pi pi-comment mt-1"},null,-1);function Ut(n,t,o,e,h,f){const a=y("Badge");return m(),p("div",it,[s("div",rt,[ct,s("div",null,[s("p",dt,b(o.order.user_name)+" "+b(o.order.user_surname||"-"),1),s("p",ut,b(o.order.user_email),1),s("p",mt,b(o.order.user_phone),1),s("p",_t,[M(b(o.order.country)+" ",1),o.order.user_zip?(m(),p("span",ft," - "+b(o.order.user_zip),1)):F("",!0)])])]),s("div",pt,[vt,s("div",null,[s("p",ht,b(e.selectedLocation),1),s("p",yt,b(o.order.course_name),1),o.order.date?(m(),p("p",kt,b(e.formatPrettyDate(o.order.date))+" "+b(o.order.start_at),1)):F("",!0)])]),s("div",gt,[bt,s("div",null,[s("p",xt,b(o.order.reservation_number),1),s("p",wt,b(e.formatDataAndHourFromUnixTimestamps(o.order.created_at)),1),s("p",Ct,b(o.order.created_by),1),o.order.status?(m(),p("p",Dt,[l(a,{value:e.prettyPaymentStatus(o.order.status),class:X([o.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):F("",!0),o.order.status=="payed"?(m(),p("p",St,b(e.prettyPaymentMethod(o.order.payment_method)),1)):F("",!0),o.order.open_tickets_used&&o.order.status=="payed"?(m(),p("p",Ot,[(m(!0),p(W,null,ae(o.order.open_tickets_used,d=>(m(),p("span",{key:d},[l(a,{value:d.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):F("",!0),s("p",Tt,"Codice sconto utilizzato: "+b(o.order.discount_code||"-"),1),s("p",Vt,[M(" Totale ordine: "),o.order.total?(m(),p("span",At,"€ "+b((+o.order.total).toFixed(2)),1)):(m(),p("span",Ft,"-"))])])]),o.order.notes?(m(),p("div",Nt,[Lt,s("div",null,b(o.order.notes),1)])):F("",!0)])}const Mt=R(at,[["render",Ut]]),Pt={props:["order","location_permalink"],setup(n,t){$(()=>{n.order&&n.order.notes&&(o.value=n.order.notes)});const o=g(),{showLoader:e,hideLoader:h}=ce(),f=J(),a=K(),d=L(()=>a.getCurrentOrder);return{notes:o,updateOrder:async function(){const c={id:n.location_permalink,order_id:n.order.id,notes:o.value,api_version:"v2"};e(),await a.updateOrder(c).then(()=>{h(),G(f,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",d.value)}).catch(w=>{h(),P(f,w)})}}}},Bt={class:"pt-5 px-2"},zt={class:"flex align-items-center justify-content-end mt-3"};function jt(n,t,o,e,h,f){const a=y("Textarea"),d=y("Button");return m(),p("div",Bt,[l(a,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=k=>e.notes=k),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),s("div",zt,[l(d,{label:"Annulla",text:"",onClick:t[1]||(t[1]=k=>n.$emit("closeDialog",null))}),l(d,{label:"Conferma",onClick:t[2]||(t[2]=k=>e.updateOrder())})])])}const Et=R(Pt,[["render",jt]]),It={props:["filters"],setup(n,t){$(()=>{r.value=!0,u.value={first:0,rows:C.value.rows,sortField:null,sortOrder:null},u.value.page=0,n.filters.location_permalink&&j()});const o=K(),e=ve(),h=L(()=>o.responseOrders),f=L(()=>o.status),a=je(),d=L(()=>a.submitDialog),k=L(()=>o.paymentStatus),c=L(()=>o.getDeleteResponse),{showLoader:w,hideLoader:i}=ce(),x=J(),C=g(),v=g(),T=g(),S=g(),N=g(),r=g(!0),u=g(),O=g(0),q=g([]),H=g([]),ee=g(!1),te=g(!1),V=g(),z=g(!1);function j(){r.value=!0;let _=new Map;for(const A in n.filters)A=="date"?ie(n.filters.date)=="Invalid DateTime"?_.set("date",ke(n.filters.date)):_.set("date",ie(n.filters.date)):n.filters.location_permalink&&_.set("location_permalink",n.filters.location_permalink),A=="course"&&n.filters.course.id!="-1"&&_.set("course",n.filters.course.id),A=="hour"&&n.filters.hour!="Tutti gli orari"&&_.set("hour",n.filters.hour),A=="name"&&_.set("name",n.filters.name);setTimeout(()=>{oe(_)},Math.random()*1e3+250)}const oe=async function(_){await o.fetchAllOrders(_).then(()=>{r.value=!1}).catch(A=>{r.value=!1,P(x,A)})},ne=_=>{T.value.toggle(_),V.value.toggle(_)},se=(_,A)=>_>_+A?"red":"green",le=function(_,A){A&&(T.value.note=A,T.value.toggle(_))},I=function(_){_.order&&h.value.time_slots&&h.value.time_slots.forEach((A,U)=>{A.orders.forEach((E,B)=>{E.id==_.order.id&&(h.value.time_slots[U].orders[B]=_.order,_.check_in_done!=null&&(h.value.time_slots[U].check_in_done+=_.check_in_done))})})},Ce=async function(_,A){let U=[];for(let B of _.tickets)U.push(B.order_item_id);const E={check_in:A,order_item_ids:U,location_permalink:n.filters.location_permalink};await o.checkInOrder(E).then(()=>{I(c.value),H.value.push(c.value.order),G(x,{message:"Check-in registrato correttamente",error:!1})}).catch(B=>{P(x,B)})},De=async function(_,A){let U=[];for(let B of _.tickets)U.push(B.order_item_id);const E={order_item_ids:U,no_show:A,location_permalink:n.filters.location_permalink};await o.noShowOrder(E).then(()=>{I(c.value),H.value.push(c.value.order),G(x,{message:"No-show registrato correttamente",error:!1})}).catch(B=>{P(x,B)})},Se=async function(_,A,U){const E={id:_,check_in:A,location_permalink:n.filters.location_permalink};await o.checkInTicket(E).then(()=>{G(x,{message:"Check-in registrato correttamente",error:!1}),I(c.value),H.value.push(c.value.order)}).catch(B=>{P(x,B)})},Oe=async function(_,A,U){const E={id:_,no_show:A,location_permalink:n.filters.location_permalink};await o.noShowTicket(E).then(()=>{G(x,{message:"No-show registrato correttamente",error:!1}),I(c.value),H.value.push(c.value.order)}).catch(B=>{P(x,B)})},Te=function(_){const A={course_name:_.course_name,start_at:_.start_at,date:n.filters.date,hour:_.start_at,max_seats:_.is_free_slot?null:_.remaing_seats};t.emit("updateFilters",A)},Ve=function(_){ee.value=!0,S.value=_},Ae=function(_){I({order:_}),ee.value=!1,z.value=!1},Fe=function(_){return _!=null&&_.created_by?_.created_by:""},Ne=function(_,A){let U=0;if(_&&_.tickets){_.tickets.forEach(B=>{A?B.no_show&&(U+=1):B.check_in&&(U+=1)});let E=_.tickets.length;if(U!=E&&U!=0)return U+"/"+E}},Le=function(_,A){V.value.data=A,V.value.toggle(_)},Ue=function(_,A){N.value=A.id;let U="Sei sicuro di voler eliminare questa prenotazione?";U+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',a.setDialog("Elimina prenotazione","Elimina","Annulla",U),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},Me=function(){if(w(),N.value){const _={id:N.value,location_permalink:n.filters.location_permalink};o.deleteOrder(_).then(()=>{i(),G(x,{message:"La prenotazione è stata eliminata correttamente",error:!1}),h.value.time_slots&&h.value.time_slots.forEach((A,U)=>{A.orders.forEach((E,B)=>{E.id==N.value&&(h.value.time_slots[U].orders.splice(B,1),c.value,h.value.time_slots[U].check_in_done+=c.value.check_in_done,h.value.time_slots[U].confirmed_seats+=c.value.confirmed_seats,h.value.time_slots[U].remaing_seats-=c.value.confirmed_seats)})})}).catch(A=>{i(),P(x,A)})}},Pe=function(_){te.value=!0,v.value=_},Be=function(_){z.value=!0,v.value=_},ze=function(_){const A=new Map;A.set("id",_.id),A.set("location_permalink",n.filters.location_permalink),w(),o.downloadTicket(A).then(()=>{i()}).catch(U=>{i(),P(x,U)})};return Q(d,_=>{_&&Me()}),Q(n.filters,()=>{n.filters.location_permalink&&j()}),{dt:C,responseOrders:h,loading:r,totalRecords:O,lazyParams:u,currentOrder:v,status:f,expandedRows:q,expandedRows1:H,op:T,dialogStore:e,paymentList:k,visibleDialog:ee,currentTimeSlot:S,visibleMenu:V,visibleDetailDialog:te,visibleNotesDialog:z,toast:x,loadLazyData:j,toggle:ne,getProgressClass:se,showNotes:le,checkAll:Ce,noShowAll:De,openDialog:Te,checkInSingleTicket:Se,noShowSingleTicket:Oe,prettyPaymentStatus:ge,openPaymentStatusDialog:Ve,onClosePaymentStatusDialog:Ae,getRowClass:Fe,printPDF:be,showLabelCheckbox:Ne,confirmDeleteOrder:Ue,showMenu:Le,openOrderDetailDialog:Pe,openNotesDialog:Be,downloadPDF:ze,formatDataFromUnixTimestamps:He,printOrderPDF:_e}},components:{PaymentStatusDialog:lt,OrderDetailDialog:Mt,NotesDialog:Et}};const Rt={class:"order-table"},qt={class:""},$t={style:{width:"15rem"}},Jt={class:"m-0 text-right",style:{"font-size":"12px"}},Ht={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Gt={style:{width:"15rem"}},Kt={class:"m-0 text-right",style:{"font-size":"12px"}},Wt={key:0},Qt={key:0},Xt=s("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Yt={class:"flex justify-content-center"},Zt={class:"flex flex-column",style:{"margin-top":"8px"}},eo={class:"text-sm",style:{"min-height":"15px"}},to=s("div",{class:"flex justify-content-center w-full"},"No-show",-1),oo={class:"flex justify-content-center"},no={class:"flex flex-column",style:{"margin-top":"8px"}},so={class:"text-sm",style:{"min-height":"15px"}},lo=["onClick"],ao={style:{"max-width":"50rem"},class:"p-3"},io={class:"overlay-menu"},ro=["onClick"],co=s("i",{class:"pi pi-eye mr-3"},null,-1),uo=["onClick"],mo=s("i",{class:"pi pi-print mr-3"},null,-1),_o=["onClick"],fo=s("i",{class:"pi pi-download mr-3"},null,-1),po=["onClick"],vo=s("i",{class:"pi pi-comment mr-3"},null,-1),ho=["disabled","onClick"],yo=s("i",{class:"pi pi-pencil mr-3"},null,-1),ko=["disabled","onClick"],go=s("i",{class:"pi pi-trash mr-3"},null,-1),bo={key:0},xo={key:1},wo=s("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Co={class:"flex justify-content-center"},Do=s("div",{class:"flex justify-content-center w-full"},"No-show",-1),So={class:"flex justify-content-center"},Oo=s("div",{class:"flex justify-content-center w-full"},null,-1),To={class:"flex justify-content-center"},Vo={key:0,class:"flex mx-4"},Ao=s("div",null,[s("div",{class:"p-0 m-0 flex align-items-center"},[s("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),s("span",{class:"text-sm"},"WEB")]),s("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[s("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),s("span",{class:"text-sm"},"KALATA")])],-1),Fo=[Ao];function No(n,t,o,e,h,f){const a=y("Column"),d=y("ProgressBar"),k=y("Button"),c=y("Badge"),w=y("Checkbox"),i=y("OverlayPanel"),x=y("DataTable"),C=y("PaymentStatusDialog"),v=y("Dialog"),T=y("OrderDetailDialog"),S=y("NotesDialog"),N=Ee("tooltip");return m(),p("div",Rt,[l(x,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=r=>e.expandedRows=r)},{empty:D(()=>[M(" Nessuna prenotazione trovata. ")]),expansion:D(r=>[l(x,{value:r.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=u=>e.expandedRows1=u),rowClass:e.getRowClass},{empty:D(()=>[M(" Nessuna prenotazione trovata. ")]),expansion:D(u=>[l(x,{value:u.data.tickets,class:"m-4 mx-5"},{default:D(()=>[l(a,{header:"Codice biglietto",field:"code"}),l(a,{header:"Tipo biglietto",field:"type"},{body:D(({data:O})=>[l(c,{value:O.ticket_name,class:X([O.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(a,{header:"Prezzo"},{body:D(({data:O})=>[O.ticket_price?(m(),p("span",bo," € "+b((+O.ticket_price).toFixed(2)),1)):(m(),p("span",xo,"-"))]),_:1}),l(a,null,{header:D(()=>[wo]),body:D(({data:O})=>[s("div",Co,[l(w,{modelValue:O.check_in,"onUpdate:modelValue":q=>O.check_in=q,binary:!0,onChange:q=>e.checkInSingleTicket(O.id,O.check_in,u.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(a,null,{header:D(()=>[Do]),body:D(({data:O})=>[s("div",So,[l(w,{modelValue:O.no_show,"onUpdate:modelValue":q=>O.no_show=q,binary:!0,onChange:q=>e.noShowSingleTicket(O.id,O.no_show,u.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(a,{field:"tickets_url"},{header:D(()=>[Oo]),body:D(({data:O})=>[s("div",To,[ue(l(k,{link:"",icon:"pi pi-print",href:O.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:q=>e.printPDF(O.id,o.filters.location_permalink,e.toast)},null,8,["href","onClick"]),[[N,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:D(()=>[l(a,{header:"Codice",field:"reservation_number"}),l(a,{header:"Acquirente"},{body:D(({data:u})=>[M(b(u.user_name)+" "+b(u.user_surname)+" ",1),!u.user_name&&!u.user_surname?(m(),p("span",Wt,"-")):F("",!0)]),_:1}),l(a,{header:"Pagamento"},{body:D(({data:u})=>[u.status?(m(),p("span",Qt,[l(c,{value:e.prettyPaymentStatus(u.status),class:X([u.status,"px-3 border-round-lg"])},null,8,["value","class"])])):F("",!0)]),_:1}),l(a,null,{header:D(()=>[Xt]),body:D(({data:u})=>[s("div",Yt,[s("div",Zt,[l(w,{modelValue:u.check_in,"onUpdate:modelValue":O=>u.check_in=O,binary:!0,onChange:O=>e.checkAll(u,u.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",eo,b(e.showLabelCheckbox(u,!1)),1)])])]),_:1}),l(a,null,{header:D(()=>[to]),body:D(({data:u})=>[s("div",oo,[s("div",no,[l(w,{modelValue:u.no_show,"onUpdate:modelValue":O=>u.no_show=O,binary:!0,onChange:O=>e.noShowAll(u,u.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",so,b(e.showLabelCheckbox(u,!0)),1)])])]),_:1}),l(a,{header:"Note"},{body:D(({data:u})=>[s("div",{class:"notes cursor-pointer",onClick:O=>e.showNotes(O,u.notes)},b(u.notes||"-"),9,lo),l(i,{ref:"op"},{default:D(()=>[s("div",ao,b(e.op.note),1)]),_:1},512)]),_:1}),l(a,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:D(({data:u})=>[l(k,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:O=>e.showMenu(O,u)},null,8,["onClick"]),l(i,{ref:"visibleMenu"},{default:D(()=>[s("ul",io,[s("li",{onClick:O=>e.openOrderDetailDialog(e.visibleMenu.data)},[co,M("Dettaglio ordine ")],8,ro),s("li",{onClick:O=>e.printOrderPDF(e.visibleMenu.data,o.filters.location_permalink,e.toast)},[mo,M("Stampa ")],8,uo),s("li",{onClick:O=>e.downloadPDF(e.visibleMenu.data)},[fo,M("Scarica PDF ")],8,_o),s("li",{onClick:O=>e.openNotesDialog(e.visibleMenu.data)},[vo,M("Modifica nota ")],8,po),s("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:O=>e.openPaymentStatusDialog(e.visibleMenu.data)},[yo,M("Cambia stato ")],8,ho),s("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:O=>e.confirmDeleteOrder(O,e.visibleMenu.data)},[go,M("Elimina ")],8,ko)])]),_:2},1536)]),_:1}),l(a,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass"]),r.data.orders&&r.data.orders.length>0?(m(),p("div",Vo,Fo)):F("",!0)]),default:D(()=>[l(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:D(({data:r})=>[s("div",qt,[s("span",{class:X(r.is_free_slot?"free":"")},b(r.start_at),3)])]),_:1},512),l(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:D(({data:r})=>[s("div",$t,[s("p",Jt,[M(b(r.confirmed_seats)+"/"+b(r.remaing_seats+r.confirmed_seats)+" ",1),r.confirmed_seats>r.remaing_seats+r.confirmed_seats?ue((m(),p("i",Ht,null,512)),[[N,r.confirmed_seats-(r.remaing_seats+r.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):F("",!0)]),l(d,{value:r.confirmed_seats*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:X(["available-progress",e.getProgressClass(r.confirmed_seats,r.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:D(({data:r})=>[s("div",Gt,[s("p",Kt,b(r.check_in_done)+"/"+b(r.confirmed_seats),1),l(d,{value:r.check_in_done*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(a,null,{body:D(({data:r})=>[ue(l(k,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:u=>e.openDialog(r)},null,8,["onClick"]),[[N,"Prenota",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"]),l(v,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=r=>e.visibleDialog=r),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:D(()=>[l(C,{location_permalink:o.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=r=>e.onClosePaymentStatusDialog(r))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),l(v,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=r=>e.visibleDetailDialog=r),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:D(()=>[l(T,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),l(v,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=r=>e.visibleNotesDialog=r),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:D(()=>[l(S,{order:e.currentOrder,location_permalink:o.filters.location_permalink,onCloseDialog:t[5]||(t[5]=r=>e.onClosePaymentStatusDialog(r))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const Lo=R(It,[["render",No]]),Uo={props:["filters"],setup(n,t){$(()=>{x(),o.value=n.filters,o.value.date=new Date,T()});const o=g({}),e=re(),h=K(),f=J(),a=g([]),d=g(),k=Z.now().plus({months:5}).endOf("month"),c=L(()=>e.allLocations),w=L(()=>h.getCalendar),i=async function(r){await h.fetchCalendar(r).then(()=>{}).catch(u=>{P(f,u)})},x=async function(){await e.fetchAllLocations().then(()=>{}).catch(r=>{P(f,r)})},C=function(){if(n.filters.location_permalink){const r=c.value.find(u=>u.permalink===n.filters.location_permalink);a.value=r.courses}},v=function(r){let u={};u.month=Z.fromJSDate(new Date(r)).month,u.year=Z.fromJSDate(new Date(r)).year,u.location_permalink=n.filters.location_permalink,d.value={month:u.month,year:u.year},i(u)},T=function(){let r=Z.now(),u={location_permalink:"",month:"",year:""};u.location_permalink=n.filters.location_permalink,u.month=r.month+"",u.year=r.year+"",i(u)},S=function(r){if(w.value.web_dates&&w.value.web_dates.length!=0){let u=r.month+1;u=u<10?"0"+u:u;let O=r.day<10?"0"+r.day:r.day,q=r.year+"-"+u+"-"+O;return w.value.web_dates.find(H=>H==q)}},N=function(r){let u={location_permalink:n.filters.location_permalink,month:r.month,year:r.year};i(u)};return Q(n.filters,()=>{if(d.value){let r={location_permalink:n.filters.location_permalink,month:d.value.month,year:d.value.year};i(r)}else T()}),{form:o,courses:a,maxAllowedDate:k,locations:c,calendar:w,getCourses:C,onDateChange:v,getDayFromDate:S,onMonthChange:N}}};const Mo={class:"flex calendar-filter"},Po={key:0,class:"special-day"};function Bo(n,t,o,e,h,f){const a=y("Calendar");return m(),p("div",Mo,[l(a,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.date=d),inline:"",onDateSelect:t[1]||(t[1]=d=>e.onDateChange(d)),onMonthChange:t[2]||(t[2]=d=>e.onMonthChange(d)),maxDate:e.maxAllowedDate.toJSDate()},{date:D(d=>[e.getDayFromDate(d.date)?(m(),p("div",Po,[s("span",null,b(d.date.day),1)])):(m(),p(W,{key:1},[M(b(d.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const zo=R(Uo,[["render",Bo]]);class jo{static async fetchAll(t){const o=t.location_permalink;return delete t.location_permalink,(await me(`/ticket_office/${o}/search/courses`,t)).data}}const we=fe({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:n=>n.response_courses.tickets,responseCourses:n=>n.response_courses,getTotalCourses:n=>n.response_courses?n.response_courses.total:0,getCurrentCourse:n=>n.course},actions:{async fetchAllCourses(n){await jo.fetchAll(n).then(t=>this.response_courses=t)}}}),Eo={props:["filters"],setup(n,t){$(()=>{o.value=Object.assign({},n.filters),o.value.date=Z.now().toFormat("dd/MM/yyyy"),a.value=xe(8,20),a.value.unshift("Tutti gli orari"),o.value.hour="Tutti gli orari"});const o=g({}),e=g([]),h=re(),f=J(),a=g([]),d=K(),k=we(),c=L(()=>h.allLocations),w=L(()=>d.responseOrders),i=L(()=>k.allCourses),x=function(){o.value.name=null,o.value.course=e.value[0].name,o.value.hour=a.value[0],t.emit("onSubmit",o.value)},C=async function(){const v={location_permalink:o.value.location_permalink,api_version:"v2"};await k.fetchAllCourses(v).then(()=>{}).catch(T=>{P(f,T)})};return Q(c,()=>{n.filters.location_permalink&&c.value&&(o.value=Object.assign({},n.filters),o.value.hour||(o.value.hour="Tutti gli orari"),C())}),Q(n.filters,()=>{n.filters.location_permalink&&c.value&&o.value.location_permalink&&o.value.location_permalink!=n.filters.location_permalink&&(o.value=Object.assign({},n.filters),o.value.hour||(o.value.hour="Tutti gli orari"))}),Q(i,()=>{var v;e.value=Object.assign([],i.value),e.value&&((v=e.value[0])==null?void 0:v.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),o.value.course=e.value[0].name}),{form:o,courses:e,hours:a,locations:c,responseOrders:w,resetField:x}}},Io={class:"formgrid grid px-0 align-items-center"},Ro={key:0,class:"field col-4 flex flex-column"},qo=s("label",{for:"typology"},"Filtra per percorso",-1),$o={key:1,class:"field col-3 flex flex-column"},Jo=s("label",{for:"typology"},"Filtra per orario (dalle)",-1),Ho=s("div",{class:"col-12"},null,-1),Go={class:"field col-4 flex flex-column"},Ko=s("label",{for:"typology"},"Filtra per nome acquirente",-1),Wo={class:"flex col-12 justify-content-end pt-1"};function Qo(n,t,o,e,h,f){const a=y("Dropdown"),d=y("InputText"),k=y("Button"),c=y("AccordionTab"),w=y("Accordion");return m(),Y(w,{activeIndex:0},{default:D(()=>[l(c,{header:"FILTRI"},{default:D(()=>[s("div",Io,[e.form.location_permalink?(m(),p("div",Ro,[qo,l(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.course=i),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):F("",!0),e.responseOrders?(m(),p("div",$o,[Jo,l(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.hour=i),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):F("",!0),Ho,s("div",Go,[Ko,l(d,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.name=i),placeholder:""},null,8,["modelValue"])])]),s("div",Wo,[l(k,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=i=>n.$emit("onSubmit",e.form))}),l(k,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=i=>e.resetField())})])]),_:1})]),_:1})}const Xo=R(Eo,[["render",Qo]]),Yo={props:["form","price","index","ticket"],setup(n,t){const o=g(0),e=function(){o.value++,f()},h=function(){o.value>0&&o.value--,f()},f=function(){o.value==null&&(o.value=0);const a={counter:o.value,price:n.price,index:n.index,ticket:n.ticket};t.emit("changeCounter",a)};return{counter:o,decrement:h,increment:e,emitEvent:f}}};const Zo={class:"btn-plus-min flex align-items-center"},en={class:"counter"};function tn(n,t,o,e,h,f){const a=y("Button"),d=y("InputNumber");return m(),p("div",Zo,[l(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),s("div",en,[l(d,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=k=>e.counter=k),t[1]||(t[1]=k=>e.emitEvent())],min:0},null,8,["modelValue"])]),l(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const on=R(Yo,[["render",tn]]),nn={props:["tickets","form"],setup(n,t){$(()=>{h.value=!1,a.discount={},f.value=null,n.form.max_seats&&n.form.max_seats<0?(c.value=!0,w.value=-n.form.max_seats):c.value=!1});const o=g(0),e=g([]),h=g(!1),f=g(),a=K(),d=J(),k=g(!1),c=g(!1),w=g(),i=L(()=>a.getDiscount),x=function(N){e.value[N.index]={partial_total:N.price*N.counter,ticket:N.ticket,quantity:N.counter},o.value=0;let r=0;e.value.forEach(u=>{o.value+=u.partial_total,r+=u.quantity}),c.value||(n.form.max_seats&&r>n.form.max_seats?(w.value=r-n.form.max_seats,k.value=!0):(w.value=null,k.value=!1)),f.value&&v()},C=function(){v()},v=async function(){let N=[];e.value.forEach(u=>{N.push({id:u.ticket.id,quantity:u.quantity})});const r={discount_code:f.value,location_permalink:n.form.location_permalink,tickets:N};await a.cost(r).then(()=>{}).catch(u=>{P(d,u)})};return{total:o,partialTotals:e,showDiscount:h,discountCode:f,discount:i,showAlert:k,showAlert2:c,numOverbooking:w,onChangeCounter:x,applyDiscount:C,checkDisabled:function(){let N=!1;(!e.value||e.value.length==0)&&(N=!0);let r=0;return e.value.forEach(u=>{r+=u.quantity}),r==0&&(N=!0),t.emit("disableSecondoTab",!0),N},nextTab:function(){const N={discount_code:f.value,partial_total:e.value};t.emit("nextTab",N)}}},components:{PlusMinusButton:on}};const sn={key:0},ln={key:1},an={key:0},rn={key:1},cn={key:0,class:"flex justify-content-between align-items-center"},dn={class:"flex align-items-center col-9"},un={class:"col-4 pl-0"},mn={class:"text-right col-3"},_n={class:"col-3 flex justify-content-end"},fn={key:2,class:"mt-3 mb-5"},pn=s("i",null,"Nessuna tipologia di biglietto trovata.",-1),vn=[pn],hn=s("hr",{class:"mt-3"},null,-1),yn={class:"flex align-items-center justify-content-between py-0"},kn={class:"col-9 flex"},gn=s("b",null,"Totale",-1),bn=[gn],xn={key:0,class:"text-right col-4"},wn={class:"line-through text-sm mr-2"},Cn={class:"font-bold"},Dn={key:1,class:"col-3 text-right font-bold"},Sn={class:"col-3 flex justify-content-end"};function On(n,t,o,e,h,f){const a=y("Message"),d=y("PlusMinusButton"),k=y("Button");return m(),p(W,null,[e.showAlert?(m(),Y(a,{key:0,severity:"warn"},{default:D(()=>[M("Attenzione! Si sta andando in overbooking di "+b(e.numOverbooking)+" ",1),e.numOverbooking==1?(m(),p("span",sn,"posto")):(m(),p("span",ln,"posti"))]),_:1})):F("",!0),e.showAlert2?(m(),Y(a,{key:1,severity:"warn"},{default:D(()=>[M("Attenzione! Lo slot orario è già in overbooking di "+b(e.numOverbooking)+" ",1),e.numOverbooking==1?(m(),p("span",an,"posto")):(m(),p("span",rn,"posti"))]),_:1})):F("",!0),(m(!0),p(W,null,ae(o.tickets,(c,w)=>{var i,x,C;return m(),p("div",{key:c.id},[((i=c.course)==null?void 0:i.id)==((x=o.form.course)==null?void 0:x.id)?(m(),p("div",cn,[s("div",dn,[s("b",un,b(c.name),1),s("div",mn,"€ "+b((C=c.price)==null?void 0:C.toFixed(2)),1)]),s("div",_n,[l(d,{onChangeCounter:t[0]||(t[0]=v=>e.onChangeCounter(v)),price:c.price,index:w,ticket:c},null,8,["price","index","ticket"])])])):F("",!0)])}),128)),o.tickets&&o.tickets.length==0?(m(),p("div",fn,vn)):F("",!0),hn,s("div",yn,[s("div",kn,[s("div",{class:X(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},bn,2),e.discount&&e.discount.total_amount?(m(),p("div",xn,[s("span",wn,"€ "+b(e.total.toFixed(2)),1),s("span",Cn,"€ "+b(e.discount.total_amount.toFixed(2)),1)])):(m(),p("div",Dn,"€ "+b(e.total.toFixed(2)),1))]),s("div",Sn,[l(k,{label:"Prosegui",onClick:t[1]||(t[1]=c=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Tn=R(nn,[["render",On]]);class Vn{static async fetchAll(){return(await Ie("/countries")).data.countries}}const An=fe({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:n=>n.countries},actions:{async fetchAllCountries(){await Vn.fetchAll().then(n=>this.countries=n)}}}),Fn={props:["location_permalink"],setup(n,t){$(()=>{i()});const o=de(),e=An(),h=K(),f=g({}),a=g(),d=L(()=>e.allCountries),k=L(()=>o.allOpenTickets),c=L(()=>h.paymentStatus),w=L(()=>h.paymentModeList),i=async function(){await e.fetchAllCountries().then(()=>{f.value.country_id=88,f.value.status={id:"payed",name:"Pagato"}})};return{form:f,countries:d,paymentList:c,paymentModeList:w,errorMessage:a,open_tickets:k,fetchAllOpenTickets:async function(T){const S={code:T.query.toUpperCase(),location_permalink:n.location_permalink};await o.fetchAllOpenTickets(S)},onChangeStatus:function(){f.value.status.id&&(f.value.status.id=="free"||f.value.status.id=="to_pay")&&(f.value.payment_method=null)},onConfirm:function(){if(f.value.status&&f.value.status.id=="payed"&&!f.value.payment_method){a.value="Seleziona un metodo di pagamento";return}t.emit("nextTab",f.value)}}}},Nn={key:0,class:"formgrid grid"},Ln={class:"field col-6"},Un=s("label",{for:"user_name"},"Nome",-1),Mn={class:"field col-6"},Pn=s("label",{for:"user_surname"},"Cognome",-1),Bn={class:"field col-6"},zn=s("label",{for:"user_email"},"Email",-1),jn={class:"field col-6"},En=s("label",{for:"user_phone"},"Telefono",-1),In={class:"field col-6"},Rn=s("label",{for:"country_id"},"Nazione",-1),qn={class:"field col-6"},$n=s("label",{for:"user_zip"},"Cap",-1),Jn={class:"field col-6"},Hn=s("label",{for:"status"},"Stato pagamento",-1),Gn={class:"field col-6"},Kn={for:"payment_method"},Wn={key:0},Qn={class:"p-float-label"},Xn={class:"p-error",id:"dd-error"},Yn={key:0,class:"field col-6 flex flex-column"},Zn=s("label",{for:"user_zip"},"Codice biglietto",-1),es={class:"field col-12"},ts={class:"field flex flex-column"},os=s("label",{for:"notes"},"Note",-1),ns={class:"col-12 flex justify-content-end"};function ss(n,t,o,e,h,f){const a=y("InputText"),d=y("Dropdown"),k=y("AutoComplete"),c=y("Textarea"),w=y("Button");return e.form?(m(),p("div",Nn,[s("div",Ln,[Un,l(a,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.user_name=i),class:"w-full"},null,8,["modelValue"])]),s("div",Mn,[Pn,l(a,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.user_surname=i),class:"w-full"},null,8,["modelValue"])]),s("div",Bn,[zn,l(a,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.user_email=i),class:"w-full"},null,8,["modelValue"])]),s("div",jn,[En,l(a,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=i=>e.form.user_phone=i),class:"w-full"},null,8,["modelValue"])]),s("div",In,[Rn,l(d,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=i=>e.form.country_id=i),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",qn,[$n,l(a,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=i=>e.form.user_zip=i),class:"w-full"},null,8,["modelValue"])]),s("div",Jn,[Hn,l(d,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=i=>e.form.status=i),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=i=>e.onChangeStatus())},null,8,["modelValue","options"])]),s("div",Gn,[s("label",Kn,[M("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(m(),p("span",Wn,"*")):F("",!0)]),s("span",Qn,[l(d,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=i=>e.form.payment_method=i),options:e.paymentModeList,optionLabel:"label",class:X(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=i=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),s("small",Xn,b(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.label=="Biglietto a data aperta (voucher)"?(m(),p("div",Yn,[Zn,l(k,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=i=>e.form.open_ticket_codes=i),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[11]||(t[11]=i=>e.fetchAllOpenTickets(i)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):F("",!0),s("div",es,[s("div",ts,[os,l(c,{modelValue:e.form.notes,"onUpdate:modelValue":t[12]||(t[12]=i=>e.form.notes=i),rows:"5",cols:"30"},null,8,["modelValue"])])]),s("div",ns,[l(w,{label:"Conferma",onClick:t[13]||(t[13]=i=>e.onConfirm())})])])):F("",!0)}const ls=R(Fn,[["render",ss]]);var as=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,is={root:function(t){var o=t.instance;return["p-contextmenu p-component",{"p-input-filled":o.$primevue.config.inputStyle==="filled","p-ripple-disabled":o.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var o=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":o.isItemActive(e),"p-focus":o.isItemFocused(e),"p-disabled":o.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var o=t.props,e=t.isActive,h=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":o.exact&&h}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Re.extend({name:"contextmenu",css:as,classes:is});const rs={props:["form"],setup(n,t){$(()=>{T()});const o=g(0),e=g([]),h=g(!1),f=g(!0),a=g(),d=g([]),{showLoader:k,hideLoader:c}=ce(),w=de(),i=K(),x=J(),C=L(()=>w.allTickets),v=L(()=>i.getCurrentOrder),T=async function(){const V={location_permalink:n.form.location_permalink,api_version:"v2",date:N(n.form.date),course_id:n.form.course.id};await w.fetchAllTickets(V).then(()=>{}).catch(z=>{P(x,z)})},S=function(V){o.value+=1,a.value=V.discount_code,e.value=Object.assign([],V.partial_total),f.value=!1},N=function(V){return ie(V).includes("Invalid")?ke(V):ie(V)},r=function(V){u(V)},u=async function(V){var ne,se,le;const z=[{start_at:n.form.hour,tickets:[]}];e.value.forEach(I=>{I.quantity!=0&&z[0].tickets.push({id:I.ticket.id,quantity:I.quantity})});let j=[];V.open_ticket_codes&&V.open_ticket_codes.forEach(I=>{j.push(I.code)});const oe={location_permalink:n.form.location_permalink,country_id:V.country_id,status:V.status.id,user_email:V.user_email,user_name:V.user_name,user_phone:V.user_phone,user_surname:V.user_surname,user_zip:V.user_zip,api_version:"v2",date:n.form.date?N(n.form.date):"",notes:V.notes,time_slots:z,payment_method:(ne=V.payment_method)==null?void 0:ne.id,course_id:(le=(se=n.form)==null?void 0:se.course)==null?void 0:le.id,open_ticket_codes:j};a.value&&(oe.discount_code=a.value),await i.createOrder(oe).then(()=>{o.value+=1,f.value=!0,h.value=!0}).catch(I=>{P(x,I)})},O=function(){_e(v==null?void 0:v.value,n.form.location_permalink,x),t.emit("closeDialog",!0)},q=function(V){f.value=V},H=function(){_e(v==null?void 0:v.value,n.form.location_permalink,x),ee()},ee=async function(){let V=[];if(!v.value&&!n.form.location_permalink)return;for(let j of v.value.tickets)V.push(j.order_item_id);const z={check_in:!0,order_item_ids:V,location_permalink:n.form.location_permalink};await i.checkInOrder(z).then(()=>{G(x,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(j=>{P(x,j)})},te=function(){k();const V={location_permalink:n.form.location_permalink,order_id:v.value.id};i.sendEmail(V).then(()=>{G(x,{message:"Email inviata correttamente al cliente",error:!1}),c(),t.emit("closeDialog",!0)}).catch(z=>{c(),P(x,z)})};return Q(v,()=>{d.value=[],v.value.tickets.forEach(V=>{const z=d.value.find(j=>j.ticket_name===V.ticket_name);if(!z)V.quantity=1,d.value.push(V);else{let j=d.value.indexOf(z);d.value[j].quantity+=1}})}),{tickets:C,active:o,partialTotals:e,showOrderDetail:h,currentOrder:v,tmp_tickets:d,showSecondTab:f,formatExplicitDate:ye,formatDate:pe,onNextTab:S,onConfirmPayment:r,printPDF:be,onPrintPDF:O,onDisableSecondoTab:q,printAndCheckIn:H,sendEmail:te}},components:{NewOrderTicketTab:Tn,NewOrderFormTab:ls}};const cs={key:0,class:"info-box"},ds={class:"font-medium"},us=s("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),ms={class:"font-medium"},_s=s("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),fs={key:0,class:"capitalize"},ps={key:0,class:"flex pb-4"},vs=s("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),hs={class:"flex flex-column"},ys={key:0,class:"pb-1 pr-1"},ks={key:1,class:"pb-1"},gs={class:"py-5"},bs={class:"m-0 text-center line-height-3"},xs=s("br",null,null,-1),ws={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Cs=s("p",{class:"my-2"},[s("b",null,"Riepilogo ordine:")],-1),Ds={class:"flex flex-column col-12"},Ss={key:0,class:"pb-1",style:{"min-width":"8rem"}},Os={key:1,class:"pb-1"},Ts={key:2},Vs={class:"flex flex-column col-12"},As={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Fs=s("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),Ns={class:"pb-1"},Ls={class:"flex align-items-center justify-content-center mt-4"};function Us(n,t,o,e,h,f){var i,x;const a=y("NewOrderTicketTab"),d=y("TabPanel"),k=y("NewOrderFormTab"),c=y("Button"),w=y("TabView");return m(),p(W,null,[o.form?(m(),p("div",cs,[s("p",ds,[us,M(b((i=o.form.course)==null?void 0:i.name),1)]),s("p",ms,[_s,o.form.date?(m(),p("span",fs,b(e.formatDate((x=o.form)==null?void 0:x.date)),1)):F("",!0),M(" - "+b(o.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(m(),p("div",ps,[vs,s("div",hs,[(m(!0),p(W,null,ae(e.partialTotals,C=>{var v;return m(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:C},[C&&C.quantity!=0?(m(),p("span",ys,b((v=C.ticket)==null?void 0:v.name),1)):F("",!0),C&&C.quantity!=0?(m(),p("span",ks," x "+b(C.quantity)+" "+b(C.price),1)):F("",!0)])}),128))])])):F("",!0)])):F("",!0),l(w,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=C=>e.active=C)},{default:D(()=>[l(d,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:D(()=>[l(a,{tickets:e.tickets,form:o.form,onNextTab:t[0]||(t[0]=C=>e.onNextTab(C)),onDisableSecondoTab:t[1]||(t[1]=C=>e.onDisableSecondoTab(C))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(d,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:D(()=>[l(k,{onNextTab:t[2]||(t[2]=C=>e.onConfirmPayment(C)),location_permalink:o.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(m(),Y(d,{key:0,header:"Ordine completato"},{default:D(()=>{var C,v;return[s("div",gs,[s("div",bs,[M(" Ordine "),s("b",null,b(e.currentOrder.reservation_number),1),M(" registrato correttamente!"),xs]),e.currentOrder?(m(),p("div",ws,[Cs,s("div",Ds,[(m(!0),p(W,null,ae(e.tmp_tickets,T=>(m(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:T},[T&&T.quantity!=0?(m(),p("span",Ss,b(T.ticket_name),1)):F("",!0),T&&T.quantity!=0?(m(),p("span",Os," x "+b(T.quantity),1)):F("",!0),T.ticket_price?(m(),p("span",Ts," € "+b((+T.ticket_price).toFixed(2)),1)):F("",!0)]))),128))]),s("div",Vs,[e.currentOrder.total?(m(),p("p",As,[Fs,s("span",Ns,[s("b",null,"€ "+b((+((C=e.currentOrder)==null?void 0:C.total)).toFixed(2)),1)])])):F("",!0)])])):F("",!0),s("div",Ls,[l(c,{icon:"pi pi-print",onClick:t[3]||(t[3]=T=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),l(c,{icon:"pi print-check-icon",onClick:t[4]||(t[4]=T=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"}),l(c,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[5]||(t[5]=T=>e.sendEmail()),disable:!((v=e.currentOrder)!=null&&v.user_email)},null,8,["disable"])])])]}),_:1})):F("",!0)]),_:1},8,["activeIndex"])],64)}const Ms=R(rs,[["render",Us]]),Ps={props:["filters","date"],setup(n,t){$(()=>{f.value=xe(8,20),o.value=Object.assign({},n.filters)});const o=g({}),e=we(),h=J(),f=g(),a=g(!1),d=ve(),k=g(!1),c=L(()=>e.allCourses),w=L(()=>d.showNewOrderDialog),i=async function(){const T={location_permalink:n.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(T).then(()=>{}).catch(S=>{P(h,S)})},x=function(){d.setNewOrderDialogVisibility(!1),o.value.hour="",o.value.course=null,t.emit("onCloseDialog")},C=function(T){o.value.date=n.date,d.setNewOrderDialogVisibility(T)},v=function(){k.value=o.value.open_ticket};return Q(n.filters,()=>{if(i(),o.value=Object.assign({},n.filters),n.filters.course&&!n.filters.course.id){let T=c.value.find(S=>S.name===n.filters.course.name);T&&(o.value.course=T)}}),{courses:c,form:o,hours:f,disableForm:k,visible:a,onCloseDialog:x,updateDialog:C,onChecked:v,dialogVisible:w,dialogStore:d}},components:{NewOrderDialog:Ms}},Bs=s("h2",{class:"mt-1"},"Nuova prenotazione",-1),zs={class:"formgrid grid px-0 align-items-center mt-4"},js={key:0,class:"field flex flex-column w-full col-12"},Es=s("label",{for:"typology"},"Scegli il percorso",-1),Is={key:1,class:"field flex flex-column w-full col-12"},Rs=s("label",{for:"typology"},"Seleziona l'orario",-1),qs={class:"flex justify-content-end align-items-center mt-2"},$s={class:"flex align-items-center justify-content-between w-full"},Js=s("h2",null,"Nuova prenotazione",-1);function Hs(n,t,o,e,h,f){const a=y("Dropdown"),d=y("Button"),k=y("NewOrderDialog"),c=y("Dialog"),w=y("Card");return m(),Y(w,{class:"mt-4"},{content:D(()=>[Bs,s("div",zs,[o.filters.location_permalink?(m(),p("div",js,[Es,l(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.course=i),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):F("",!0),o.filters.location_permalink?(m(),p("div",Is,[Rs,l(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.hour=i),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):F("",!0)]),s("div",qs,[l(d,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=i=>e.updateDialog(!0))},null,8,["disabled"])]),l(c,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=i=>e.dialogVisible=i),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=i=>e.onCloseDialog())},{header:D(()=>[s("div",$s,[Js,l(d,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=i=>e.updateDialog(!1))})])]),default:D(()=>[l(k,{form:e.form,onCloseDialog:t[4]||(t[4]=i=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const Gs=R(Ps,[["render",Hs]]),Ks={setup(){$(()=>{let o=Z.now().toFormat("dd/MM/yyyy");n.value.start_date=o,n.value.end_date=o});const n=g({});return{form:n,onSubmit:function(){}}},components:{Form:Ke}},Ws={class:"formgrid grid mt-3"},Qs={class:"field col-6 flex flex-column"},Xs=s("label",{from:"start_date"},"Dal",-1),Ys={class:"field col-6 flex flex-column"},Zs=s("label",{from:"end_date"},"Al",-1),el={class:"flex align-items-center justify-content-end mt-6"};function tl(n,t,o,e,h,f){const a=y("Calendar"),d=y("Button"),k=y("Form");return m(),Y(k,{onSubmit:e.onSubmit},{default:D(()=>[s("div",Ws,[s("div",Qs,[Xs,l(a,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.start_date=c),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),s("div",Ys,[Zs,l(a,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[1]||(t[1]=c=>e.form.end_date=c),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),s("div",el,[l(d,{label:"Annulla",text:""}),l(d,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const ol=R(Ks,[["render",tl]]),nl={setup(){$(()=>{w.value&&(n.value.location_permalink=w.value,t.value.location_permalink=w.value),i()});const n=g({}),t=g({}),o=g(),e=g(!1),h=qe(),f=re(),a=J(),d=ve(),k=L(()=>h.currentUser),c=L(()=>f.allLocations),w=L(()=>f.getCurrentLocation),i=async function(){await f.fetchAllLocations().then(()=>{w.value||(n.value.location_permalink=c.value[0].permalink,t.value.location_permalink=c.value[0].permalink,f.updateCurrenLocation(c.value[0].permalink))}).catch(S=>{P(a,S)})};return{filters:n,orderTable:o,order_filters:t,visibleDialog:e,user:k,locations:c,fetchAllLocations:i,formatDate:pe,onUpdateFilters:function(S){S.course?n.value.course={id:S.course}:n.value.course="",S.name?n.value.name=S.name:n.value.name="",S.hour&&(S.hour.start_at?n.value.hour=S.hour.start_at:n.value.hour=S.hour)},onUpdateNewOrderFilters:function(S){S.start_at&&(t.value.hour=S.start_at),S.course_name&&(t.value.course={name:S.course_name}),S.date&&(t.value.date=S.date),S.hour&&(t.value.hour=S.hour),S.max_seats?t.value.max_seats=S.max_seats:t.value.max_seats=null,d.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){o.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=n.value.location_permalink,f.updateCurrenLocation(n.value.location_permalink)}}},components:{CalendarFilter:zo,OrderTable:Lo,OrderFilter:Xo,NewOrderCard:Gs,SalesReportsDialog:ol}};const sl={class:"flex justify-content-between align-items-center"},ll={class:"field flex flex-column mt-3"},al={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},il=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),rl={class:"capitalize text-xl"},cl={class:"flex gap-4"},dl={key:0,class:"col-3 mt-3"},ul={class:"col-9 mt-3"};function ml(n,t,o,e,h,f){const a=y("Dropdown"),d=y("Button"),k=y("SalesReportsDialog"),c=y("Dialog"),w=y("CalendarFilter"),i=y("NewOrderCard"),x=y("OrderFilter"),C=y("OrderTable");return m(),p("div",null,[s("div",sl,[s("div",ll,[l(a,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":t[0]||(t[0]=v=>e.filters.location_permalink=v),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location",onChange:t[1]||(t[1]=v=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(m(),p("div",al,[s("div",null,[il,s("span",rl,b(e.formatDate(e.filters.date)),1)]),l(d,{label:"Report vendite",link:"",class:"m-0 p-0 underline",onClick:t[2]||(t[2]=v=>e.visibleDialog=!0)}),l(c,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=v=>e.visibleDialog=v),modal:"",header:"Report vendite",style:{width:"35rem"}},{default:D(()=>[l(k)]),_:1},8,["visible"])])):F("",!0)]),s("div",cl,[e.filters.location_permalink?(m(),p("div",dl,[l(w,{filters:e.filters},null,8,["filters"]),l(i,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[4]||(t[4]=v=>e.onCloseDialog())},null,8,["date","filters"])])):F("",!0),s("div",ul,[l(x,{filters:e.filters,onOnSubmit:t[5]||(t[5]=v=>e.onUpdateFilters(v))},null,8,["filters"]),e.filters.date?(m(),Y(C,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[6]||(t[6]=v=>e.onUpdateNewOrderFilters(v))},null,8,["filters"])):F("",!0)])])])}const hl=R(nl,[["render",ml]]);export{hl as default};
