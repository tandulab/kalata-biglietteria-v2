import{H as re,I as de,o as E,x as k,a as q,c as L,_ as I,r as g,b as m,e as f,g as s,f as l,J as V,K as $,t as y,h as U,n as Q,L as ne,M as ze,i as Y,N as Be,w,O as ie,P as Z,Q as je,R as Ie,u as Ee}from"../index46197.js";import{u as J,a as le,f as pe,b as ue,c as Re,d as qe,e as me,g as se,h as he,i as He,D as oe}from"./location46197.js";import{s as K,e as z,p as ve,a as Je,b as ye,c as ce,d as ke}from"./helpers46197.js";import{u as _e}from"./loader46197.js";class fe{static async fetchAll(t){const o=t.location_permalink;return delete t.location_permalink,(await re(`/ticket_office/${o}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const o=t.location_permalink;return delete t.location_permalink,(await re(`/ticket_office/${o}/orders/search_codes`,t)).data}}const ae=de({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:n=>n.response_tickets.available_ticket_types,allOpenTickets:n=>n.open_tickets_codes.open_tickets,responseTickets:n=>n.response_tickets,getTotalTickets:n=>n.response_tickets?n.response_tickets.total:0,getCurrentTicket:n=>n.ticket},actions:{async fetchAllTickets(n){await fe.fetchAll(n).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(n){await fe.fetchAllOpenTickets(n).then(t=>this.open_tickets_codes=t)}}}),Ke={props:["location_permalink","time_slot"],setup(n,t){E(()=>{o.value=Object.assign({},n.time_slot)});const o=k({}),e=ae(),h=J(),{showLoader:p,hideLoader:i}=_e(),d=q(),v=L(()=>e.allOpenTickets),c=L(()=>h.paymentStatus),b=L(()=>h.paymentModeList),a=L(()=>h.getCurrentOrder),O=async function(M){const A={code:M.query.toUpperCase(),location_permalink:n.location_permalink};await e.fetchAllOpenTickets(A)},C=async function(){var A;const M={id:n.location_permalink,order_id:o.value.id,status:(A=o.value)==null?void 0:A.status,payment_method:o.value.payment_method,open_ticket_codes:[],api_version:"v2"};if(o.value.open_tickets_used&&o.value.open_tickets_used.length>0){let r=[];o.value.open_tickets_used.forEach(u=>{r.push(u.code)}),M.open_ticket_codes=r}D(M)},D=async function(M){p(),await h.updateOrder(M).then(()=>{i(),K(d,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",a.value)}).catch(A=>{i(),z(d,A)})};return{form:o,open_tickets:v,paymentList:c,paymentModeList:b,changeStatus:C,fetchAllOpenTickets:O,onChangeStatus:function(){(o.value.status=="free"||o.value.status=="to_pay")&&(o.value.payment_method=null)}}}},$e={key:0,class:"formgrid grid flex-column mt-3"},Ge={class:"field col-12"},Qe=s("label",{for:"status"},"Stato pagamento",-1),We={class:"field col-12"},Xe=s("label",{for:"payment_method"},"Modalità pagamento",-1),Ye={key:0,class:"field col-12 flex flex-column"},Ze=s("label",{for:"user_zip"},"Codice biglietto",-1),et={class:"flex align-items-center justify-content-end mt-3"};function tt(n,t,o,e,h,p){const i=g("Dropdown"),d=g("AutoComplete"),v=g("Button");return m(),f($,null,[e.form?(m(),f("div",$e,[s("div",Ge,[Qe,l(i,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.status=c),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=c=>e.onChangeStatus())},null,8,["modelValue","options"])]),s("div",We,[Xe,l(i,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=c=>e.form.payment_method=c),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full",disabled:e.form.status!="payed"},null,8,["modelValue","options","disabled"])]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(m(),f("div",Ye,[Ze,l(d,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[3]||(t[3]=c=>e.form.open_tickets_used=c),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[4]||(t[4]=c=>e.fetchAllOpenTickets(c)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):V("",!0)])):V("",!0),s("div",et,[l(v,{label:"Annulla",text:"",onClick:t[5]||(t[5]=c=>n.$emit("closeDialog",null))}),l(v,{label:"Conferma",onClick:t[6]||(t[6]=c=>e.changeStatus())})])],64)}const ot=I(Ke,[["render",tt]]),nt={props:["order"],setup(n,t){E(()=>{C.value&&O.value&&C.value.forEach(D=>{D.permalink===O.value&&(i.value=D.name)})});const o=k(0),e=k([]),h=k(!1),p=k(!0),i=k(),d=ae(),v=J();q();const c=le(),b=L(()=>d.allTickets),a=L(()=>v.getCurrentOrder),O=L(()=>c.getCurrentLocation),C=L(()=>c.allLocations);return{tickets:b,active:o,partialTotals:e,showOrderDetail:h,currentOrder:a,showSecondTab:p,currentLocation:O,selectedLocation:i,formatExplicitDate:pe,formatDate:ue,prettyPaymentStatus:ve,formatPrettyDate:Re,formatDataAndHourFromUnixTimestamps:qe,prettyPaymentMethod:Je}},components:{}};const st={class:"mt-3 line-height-3"},lt={class:"flex gap-3"},at=s("i",{class:"pi pi-user mt-1"},null,-1),it={class:"m-0 mb-1"},rt={class:"m-0 mb-1"},ct={class:"m-0 mb-1"},dt={class:"m-0 mb-1"},ut={key:0},mt={class:"flex gap-3 mt-4"},_t=s("i",{class:"pi pi-map-marker mt-1"},null,-1),ft={class:"m-0 mb-1"},pt={class:"m-0 mb-1"},ht={key:0,class:"m-0 mb-1"},vt={class:"flex gap-3 mt-4"},yt=s("i",{class:"pi pi-shopping-cart mt-1"},null,-1),kt={class:"m-0 mb-1"},gt={class:"m-0 mb-1"},bt={class:"m-0 mb-1"},xt={key:0,class:"m-0 mb-1"},wt={key:1,class:"m-0 mb-1"},Ct={key:2,class:"m-0 mb-1"},Dt={class:"m-0 mb-1"},Ot={class:"m-0 mb-1"},Tt={key:0},St={key:1},Vt={key:0,class:"flex gap-3 mt-4"},At=s("i",{class:"pi pi-comment mt-1"},null,-1);function Nt(n,t,o,e,h,p){const i=g("Badge");return m(),f("div",st,[s("div",lt,[at,s("div",null,[s("p",it,y(o.order.user_name)+" "+y(o.order.user_surname||"-"),1),s("p",rt,y(o.order.user_email),1),s("p",ct,y(o.order.user_phone),1),s("p",dt,[U(y(o.order.country)+" ",1),o.order.user_zip?(m(),f("span",ut," - "+y(o.order.user_zip),1)):V("",!0)])])]),s("div",mt,[_t,s("div",null,[s("p",ft,y(e.selectedLocation),1),s("p",pt,y(o.order.course_name),1),o.order.date?(m(),f("p",ht,y(e.formatPrettyDate(o.order.date))+" "+y(o.order.start_at),1)):V("",!0)])]),s("div",vt,[yt,s("div",null,[s("p",kt,y(o.order.reservation_number),1),s("p",gt,y(e.formatDataAndHourFromUnixTimestamps(o.order.created_at)),1),s("p",bt,y(o.order.created_by),1),o.order.status?(m(),f("p",xt,[l(i,{value:e.prettyPaymentStatus(o.order.status),class:Q([o.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):V("",!0),o.order.status=="payed"?(m(),f("p",wt,y(e.prettyPaymentMethod(o.order.payment_method)),1)):V("",!0),o.order.open_tickets_used&&o.order.status=="payed"?(m(),f("p",Ct,[(m(!0),f($,null,ne(o.order.open_tickets_used,d=>(m(),f("span",{key:d},[l(i,{value:d.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):V("",!0),s("p",Dt,"Codice sconto utilizzato: "+y(o.order.discount_code||"-"),1),s("p",Ot,[U(" Totale ordine: "),o.order.total?(m(),f("span",Tt,"€ "+y((+o.order.total).toFixed(2)),1)):(m(),f("span",St,"-"))])])]),o.order.notes?(m(),f("div",Vt,[At,s("div",null,y(o.order.notes),1)])):V("",!0)])}const Lt=I(nt,[["render",Nt]]),Ft={props:["order","location_permalink"],setup(n,t){E(()=>{n.order&&n.order.notes&&(o.value=n.order.notes)});const o=k(),{showLoader:e,hideLoader:h}=_e(),p=q(),i=J(),d=L(()=>i.getCurrentOrder);return{notes:o,updateOrder:async function(){const c={id:n.location_permalink,order_id:n.order.id,notes:o.value,api_version:"v2"};e(),await i.updateOrder(c).then(()=>{h(),K(p,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",d.value)}).catch(b=>{h(),z(p,b)})}}}},Mt={class:"pt-5 px-2"},Ut={class:"flex align-items-center justify-content-end mt-3"};function Pt(n,t,o,e,h,p){const i=g("Textarea"),d=g("Button");return m(),f("div",Mt,[l(i,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=v=>e.notes=v),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),s("div",Ut,[l(d,{label:"Annulla",text:"",onClick:t[1]||(t[1]=v=>n.$emit("closeDialog",null))}),l(d,{label:"Conferma",onClick:t[2]||(t[2]=v=>e.updateOrder())})])])}const zt=I(Ft,[["render",Pt]]),Bt={props:["filters"],setup(n,t){E(()=>{r.value=!0,u.value={first:0,rows:C.value.rows,sortField:null,sortOrder:null},u.value.page=0,n.filters.location_permalink&&X()});const o=J(),e=me(),h=L(()=>o.responseOrders),p=L(()=>o.status),i=ze(),d=L(()=>i.submitDialog),v=L(()=>o.paymentStatus),c=L(()=>o.getDeleteResponse),{showLoader:b,hideLoader:a}=_e(),O=q(),C=k(),D=k(),x=k(),M=k(),A=k(),r=k(!0),u=k(),T=k(0),S=k([]),B=k([]),R=k(!1),ee=k(!1),G=k(),W=k(!1);function X(){r.value=!0;let _=new Map;for(const N in n.filters)N=="date"?se(n.filters.date)=="Invalid DateTime"?_.set("date",he(n.filters.date)):_.set("date",se(n.filters.date)):n.filters.location_permalink&&_.set("location_permalink",n.filters.location_permalink),N=="course"&&n.filters.course.id!="-1"&&_.set("course",n.filters.course.id),N=="hour"&&n.filters.hour!="Tutti gli orari"&&_.set("hour",n.filters.hour),N=="name"&&_.set("name",n.filters.name);setTimeout(()=>{H(_)},Math.random()*1e3+250)}const H=async function(_){await o.fetchAllOrders(_).then(()=>{r.value=!1}).catch(N=>{r.value=!1,z(O,N)})},ge=_=>{x.value.toggle(_),G.value.toggle(_)},be=(_,N)=>_>_+N?"red":"green",xe=function(_,N){N&&(x.value.note=N,x.value.toggle(_))},te=function(_){_.order&&h.value.time_slots&&h.value.time_slots.forEach((N,F)=>{N.orders.forEach((j,P)=>{j.id==_.order.id&&(h.value.time_slots[F].orders[P]=_.order,_.check_in_done!=null&&(h.value.time_slots[F].check_in_done+=_.check_in_done))})})},we=async function(_,N){let F=[];for(let P of _.tickets)F.push(P.order_item_id);const j={check_in:N,order_item_ids:F,location_permalink:n.filters.location_permalink};await o.checkInOrder(j).then(()=>{te(c.value),B.value.push(c.value.order),K(O,{message:"Check-in registrato correttamente",error:!1})}).catch(P=>{z(O,P)})},Ce=async function(_,N){let F=[];for(let P of _.tickets)F.push(P.order_item_id);const j={order_item_ids:F,no_show:N,location_permalink:n.filters.location_permalink};await o.noShowOrder(j).then(()=>{te(c.value),B.value.push(c.value.order),K(O,{message:"No-show registrato correttamente",error:!1})}).catch(P=>{z(O,P)})},De=async function(_,N,F){const j={id:_,check_in:N,location_permalink:n.filters.location_permalink};await o.checkInTicket(j).then(()=>{K(O,{message:"Check-in registrato correttamente",error:!1}),te(c.value),B.value.push(c.value.order)}).catch(P=>{z(O,P)})},Oe=async function(_,N,F){const j={id:_,no_show:N,location_permalink:n.filters.location_permalink};await o.noShowTicket(j).then(()=>{K(O,{message:"No-show registrato correttamente",error:!1}),te(c.value),B.value.push(c.value.order)}).catch(P=>{z(O,P)})},Te=function(_){const N={course_name:_.course_name,start_at:_.start_at,date:n.filters.date,hour:_.start_at,max_seats:_.is_free_slot?null:_.remaing_seats};t.emit("updateFilters",N)},Se=function(_){R.value=!0,M.value=_},Ve=function(_){te({order:_}),R.value=!1,W.value=!1},Ae=function(_){return _!=null&&_.created_by?_.created_by:""},Ne=function(_,N){let F=0;if(_&&_.tickets){_.tickets.forEach(P=>{N?P.no_show&&(F+=1):P.check_in&&(F+=1)});let j=_.tickets.length;if(F!=j&&F!=0)return F+"/"+j}},Le=function(_,N){G.value.data=N,G.value.toggle(_)},Fe=function(_,N){A.value=N.id;let F="Sei sicuro di voler eliminare questa prenotazione?";F+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',i.setDialog("Elimina prenotazione","Elimina","Annulla",F),i.setBtnSubmit(!1),i.setDynamicDialogVisibility(!0)},Me=function(){if(b(),A.value){const _={id:A.value,location_permalink:n.filters.location_permalink};o.deleteOrder(_).then(()=>{a(),K(O,{message:"La prenotazione è stata eliminata correttamente",error:!1}),h.value.time_slots&&h.value.time_slots.forEach((N,F)=>{N.orders.forEach((j,P)=>{j.id==A.value&&(h.value.time_slots[F].orders.splice(P,1),c.value,h.value.time_slots[F].check_in_done+=c.value.check_in_done,h.value.time_slots[F].confirmed_seats+=c.value.confirmed_seats,h.value.time_slots[F].remaing_seats-=c.value.confirmed_seats)})})}).catch(N=>{a(),z(O,N)})}},Ue=function(_){ee.value=!0,D.value=_},Pe=function(_){W.value=!0,D.value=_};return Y(d,_=>{_&&Me()}),Y(n.filters,()=>{n.filters.location_permalink&&X()}),{dt:C,responseOrders:h,loading:r,totalRecords:T,lazyParams:u,currentOrder:D,status:p,expandedRows:S,expandedRows1:B,op:x,dialogStore:e,paymentList:v,visibleDialog:R,currentTimeSlot:M,visibleMenu:G,visibleDetailDialog:ee,visibleNotesDialog:W,toast:O,loadLazyData:X,toggle:ge,getProgressClass:be,showNotes:xe,checkAll:we,noShowAll:Ce,openDialog:Te,checkInSingleTicket:De,noShowSingleTicket:Oe,prettyPaymentStatus:ve,openPaymentStatusDialog:Se,onClosePaymentStatusDialog:Ve,getRowClass:Ae,printPDF:ye,showLabelCheckbox:Ne,confirmDeleteOrder:Fe,showMenu:Le,openOrderDetailDialog:Ue,openNotesDialog:Pe,formatDataFromUnixTimestamps:He,printOrderPDF:ce}},components:{PaymentStatusDialog:ot,OrderDetailDialog:Lt,NotesDialog:zt}};const jt={class:"order-table"},It={class:""},Et={style:{width:"15rem"}},Rt={class:"m-0 text-right",style:{"font-size":"12px"}},qt={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Ht={style:{width:"15rem"}},Jt={class:"m-0 text-right",style:{"font-size":"12px"}},Kt={key:0},$t={key:0},Gt=s("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Qt={class:"flex justify-content-center"},Wt={class:"flex flex-column",style:{"margin-top":"8px"}},Xt={class:"text-sm",style:{"min-height":"15px"}},Yt=s("div",{class:"flex justify-content-center w-full"},"No-show",-1),Zt={class:"flex justify-content-center"},eo={class:"flex flex-column",style:{"margin-top":"8px"}},to={class:"text-sm",style:{"min-height":"15px"}},oo=["onClick"],no={style:{"max-width":"50rem"},class:"p-3"},so={class:"overlay-menu"},lo=["onClick"],ao=s("i",{class:"pi pi-eye mr-3"},null,-1),io=["onClick"],ro=s("i",{class:"pi pi-print mr-3"},null,-1),co=s("li",null,[s("i",{class:"pi pi-download mr-3"}),U("Scarica PDF")],-1),uo=["disabled","onClick"],mo=s("i",{class:"pi pi-comment mr-3"},null,-1),_o=["disabled","onClick"],fo=s("i",{class:"pi pi-pencil mr-3"},null,-1),po=["disabled","onClick"],ho=s("i",{class:"pi pi-trash mr-3"},null,-1),vo={key:0},yo={key:1},ko=s("div",{class:"flex justify-content-center w-full"},"Check-in",-1),go={class:"flex justify-content-center"},bo=s("div",{class:"flex justify-content-center w-full"},"No-show",-1),xo={class:"flex justify-content-center"},wo=s("div",{class:"flex justify-content-center w-full"},null,-1),Co={class:"flex justify-content-center"},Do={key:0,class:"flex mx-4"},Oo=s("div",null,[s("div",{class:"p-0 m-0 flex align-items-center"},[s("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),s("span",{class:"text-sm"},"WEB")]),s("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[s("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),s("span",{class:"text-sm"},"KALATA")])],-1),To=[Oo];function So(n,t,o,e,h,p){const i=g("Column"),d=g("ProgressBar"),v=g("Button"),c=g("Badge"),b=g("Checkbox"),a=g("OverlayPanel"),O=g("DataTable"),C=g("PaymentStatusDialog"),D=g("Dialog"),x=g("OrderDetailDialog"),M=g("NotesDialog"),A=Be("tooltip");return m(),f("div",jt,[l(O,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=r=>e.expandedRows=r)},{empty:w(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:w(r=>[l(O,{value:r.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=u=>e.expandedRows1=u),rowClass:e.getRowClass},{empty:w(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:w(u=>[l(O,{value:u.data.tickets,class:"m-4 mx-5"},{default:w(()=>[l(i,{header:"Codice biglietto",field:"code"}),l(i,{header:"Tipo biglietto",field:"type"},{body:w(({data:T})=>[l(c,{value:T.ticket_name,class:Q([T.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(i,{header:"Prezzo"},{body:w(({data:T})=>[T.ticket_price?(m(),f("span",vo," € "+y((+T.ticket_price).toFixed(2)),1)):(m(),f("span",yo,"-"))]),_:1}),l(i,null,{header:w(()=>[ko]),body:w(({data:T})=>[s("div",go,[l(b,{modelValue:T.check_in,"onUpdate:modelValue":S=>T.check_in=S,binary:!0,onChange:S=>e.checkInSingleTicket(T.id,T.check_in,u.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(i,null,{header:w(()=>[bo]),body:w(({data:T})=>[s("div",xo,[l(b,{modelValue:T.no_show,"onUpdate:modelValue":S=>T.no_show=S,binary:!0,onChange:S=>e.noShowSingleTicket(T.id,T.no_show,u.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(i,{field:"tickets_url"},{header:w(()=>[wo]),body:w(({data:T})=>[s("div",Co,[ie(l(v,{link:"",icon:"pi pi-print",href:T.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:S=>e.printPDF(T.id,o.filters.location_permalink,e.toast)},null,8,["href","onClick"]),[[A,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:w(()=>[l(i,{header:"Codice",field:"reservation_number"}),l(i,{header:"Acquirente"},{body:w(({data:u})=>[U(y(u.user_name)+" "+y(u.user_surname)+" ",1),!u.user_name&&!u.user_surname?(m(),f("span",Kt,"-")):V("",!0)]),_:1}),l(i,{header:"Pagamento"},{body:w(({data:u})=>[u.status?(m(),f("span",$t,[l(c,{value:e.prettyPaymentStatus(u.status),class:Q([u.status,"px-3 border-round-lg"])},null,8,["value","class"])])):V("",!0)]),_:1}),l(i,null,{header:w(()=>[Gt]),body:w(({data:u})=>[s("div",Qt,[s("div",Wt,[l(b,{modelValue:u.check_in,"onUpdate:modelValue":T=>u.check_in=T,binary:!0,onChange:T=>e.checkAll(u,u.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",Xt,y(e.showLabelCheckbox(u,!1)),1)])])]),_:1}),l(i,null,{header:w(()=>[Yt]),body:w(({data:u})=>[s("div",Zt,[s("div",eo,[l(b,{modelValue:u.no_show,"onUpdate:modelValue":T=>u.no_show=T,binary:!0,onChange:T=>e.noShowAll(u,u.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",to,y(e.showLabelCheckbox(u,!0)),1)])])]),_:1}),l(i,{header:"Note"},{body:w(({data:u})=>[s("div",{class:"notes cursor-pointer",onClick:T=>e.showNotes(T,u.notes)},y(u.notes||"-"),9,oo),l(a,{ref:"op"},{default:w(()=>[s("div",no,y(e.op.note),1)]),_:1},512)]),_:1}),l(i,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:w(({data:u})=>[l(v,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:T=>e.showMenu(T,u)},null,8,["onClick"]),l(a,{ref:"visibleMenu"},{default:w(()=>[s("ul",so,[s("li",{onClick:T=>e.openOrderDetailDialog(e.visibleMenu.data)},[ao,U("Dettaglio ordine ")],8,lo),s("li",{onClick:T=>e.printOrderPDF(e.visibleMenu.data,o.filters.location_permalink,e.toast)},[ro,U("Stampa ")],8,io),co,s("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:T=>e.openNotesDialog(e.visibleMenu.data)},[mo,U("Modifica nota ")],8,uo),s("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:T=>e.openPaymentStatusDialog(e.visibleMenu.data)},[fo,U("Cambia stato ")],8,_o),s("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:T=>e.confirmDeleteOrder(T,e.visibleMenu.data)},[ho,U("Elimina ")],8,po)])]),_:2},1536)]),_:1}),l(i,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass"]),r.data.orders&&r.data.orders.length>0?(m(),f("div",Do,To)):V("",!0)]),default:w(()=>[l(i,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(i,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:w(({data:r})=>[s("div",It,[s("span",{class:Q(r.is_free_slot?"free":"")},y(r.start_at),3)])]),_:1},512),l(i,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:w(({data:r})=>[s("div",Et,[s("p",Rt,[U(y(r.confirmed_seats)+"/"+y(r.remaing_seats+r.confirmed_seats)+" ",1),r.confirmed_seats>r.remaing_seats+r.confirmed_seats?ie((m(),f("i",qt,null,512)),[[A,r.confirmed_seats-(r.remaing_seats+r.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):V("",!0)]),l(d,{value:r.confirmed_seats*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:Q(["available-progress",e.getProgressClass(r.confirmed_seats,r.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(i,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:w(({data:r})=>[s("div",Ht,[s("p",Jt,y(r.check_in_done)+"/"+y(r.confirmed_seats),1),l(d,{value:r.check_in_done*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(i,null,{body:w(({data:r})=>[ie(l(v,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:u=>e.openDialog(r)},null,8,["onClick"]),[[A,"Prenota",void 0,{top:!0}]])]),_:1}),l(i,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"]),l(D,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=r=>e.visibleDialog=r),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:w(()=>[l(C,{location_permalink:o.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=r=>e.onClosePaymentStatusDialog(r))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),l(D,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=r=>e.visibleDetailDialog=r),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:w(()=>[l(x,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),l(D,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=r=>e.visibleNotesDialog=r),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:w(()=>[l(M,{order:e.currentOrder,location_permalink:o.filters.location_permalink,onCloseDialog:t[5]||(t[5]=r=>e.onClosePaymentStatusDialog(r))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const Vo=I(Bt,[["render",So]]),Ao={props:["filters"],setup(n,t){E(()=>{O();let r=oe.now();o.value=n.filters,o.value.date=r.toFormat("dd/MM/yyyy"),x()});const o=k({}),e=le(),h=J(),p=q(),i=k([]),d=k(),v=L(()=>e.allLocations),c=L(()=>h.getCalendar),b=function(){},a=async function(r){await h.fetchCalendar(r).then(()=>{}).catch(u=>{z(p,u)})},O=async function(){await e.fetchAllLocations().then(()=>{C()}).catch(r=>{z(p,r)})},C=function(){if(n.filters.location_permalink){const r=v.value.find(u=>u.permalink===n.filters.location_permalink);i.value=r.courses}},D=function(r){let u={};u.month=oe.fromJSDate(new Date(r)).month,u.year=oe.fromJSDate(new Date(r)).year,u.location_permalink=n.filters.location_permalink,d.value={month:u.month,year:u.year},a(u)},x=function(){let r=oe.now(),u={location_permalink:"",month:"",year:""};u.location_permalink=n.filters.location_permalink,u.month=r.month+"",u.year=r.year+"",a(u)},M=function(r){if(c.value.web_dates&&c.value.web_dates.length!=0){let u=r.month+1;u=r.month<10?"0"+u:u;let T=r.day<10?"0"+r.day:r.day,S=r.year+"-"+u+"-"+T;return c.value.web_dates.find(B=>B==S)}},A=function(r){let u={location_permalink:n.filters.location_permalink,month:r.month,year:r.year};a(u)};return Y(n.filters,()=>{if(d.value){let r={location_permalink:n.filters.location_permalink,month:d.value.month,year:d.value.year};a(r)}else x()}),{form:o,courses:i,locations:v,calendar:c,resetField:b,getCourses:C,onDateChange:D,getDayFromDate:M,onMonthChange:A}}};const No={class:"flex calendar-filter"},Lo={key:0,class:"special-day"};function Fo(n,t,o,e,h,p){const i=g("Calendar");return m(),f("div",No,[l(i,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.date=d),inline:"",onDateSelect:t[1]||(t[1]=d=>e.onDateChange(d)),onMonthChange:t[2]||(t[2]=d=>e.onMonthChange(d))},{date:w(d=>[e.getDayFromDate(d.date)?(m(),f("div",Lo,[s("span",null,y(d.date.day),1)])):(m(),f($,{key:1},[U(y(d.date.day),1)],64))]),_:1},8,["modelValue"])])}const Mo=I(Ao,[["render",Fo]]),Uo={props:["filters"],setup(n,t){E(()=>{o.value=Object.assign({},n.filters),o.value.date=oe.now().toFormat("dd/MM/yyyy"),p.value=ke(8,20),p.value.unshift("Tutti gli orari"),o.value.hour="Tutti gli orari"});const o=k({}),e=k([]),h=le();q();const p=k([]),i=J(),d=L(()=>h.allLocations),v=L(()=>i.responseOrders),c=function(){o.value.name=null,o.value.course=e.value[0].name,o.value.hour=p.value[0],t.emit("onSubmit",o.value)},b=function(){if(e.value=[],o.value.location_permalink){const a=d.value.find(O=>O.permalink===o.value.location_permalink.permalink);a&&(e.value=a.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),o.value.course=e.value[0].name)}};return Y(d,()=>{n.filters.location_permalink&&d.value&&(o.value=Object.assign({},n.filters),o.value.hour||(o.value.hour="Tutti gli orari"),b())}),Y(n.filters,()=>{n.filters.location_permalink&&d.value&&o.value.location_permalink&&o.value.location_permalink!=n.filters.location_permalink&&(o.value=Object.assign({},n.filters),o.value.hour||(o.value.hour="Tutti gli orari"),b())}),{form:o,courses:e,hours:p,locations:d,responseOrders:v,resetField:c,getCourses:b}}},Po={class:"formgrid grid px-0 align-items-center"},zo={key:0,class:"field col-4 flex flex-column"},Bo=s("label",{for:"typology"},"Filtra per percorso",-1),jo={key:1,class:"field col-3 flex flex-column"},Io=s("label",{for:"typology"},"Filtra per orario (dalle)",-1),Eo=s("div",{class:"col-12"},null,-1),Ro={class:"field col-4 flex flex-column"},qo=s("label",{for:"typology"},"Filtra per nome acquirente",-1),Ho={class:"flex col-12 justify-content-end pt-1"};function Jo(n,t,o,e,h,p){const i=g("Dropdown"),d=g("InputText"),v=g("Button"),c=g("AccordionTab"),b=g("Accordion");return m(),Z(b,{activeIndex:0},{default:w(()=>[l(c,{header:"FILTRI"},{default:w(()=>[s("div",Po,[e.form.location_permalink?(m(),f("div",zo,[Bo,l(i,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.course=a),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):V("",!0),e.responseOrders?(m(),f("div",jo,[Io,l(i,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.hour=a),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):V("",!0),Eo,s("div",Ro,[qo,l(d,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])])]),s("div",Ho,[l(v,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=a=>n.$emit("onSubmit",e.form))}),l(v,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=a=>e.resetField())})])]),_:1})]),_:1})}const Ko=I(Uo,[["render",Jo]]);class $o{static async fetchAll(t){const o=t.location_permalink;return delete t.location_permalink,(await re(`/ticket_office/${o}/search/courses`,t)).data}}const Go=de({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:n=>n.response_courses.tickets,responseCourses:n=>n.response_courses,getTotalCourses:n=>n.response_courses?n.response_courses.total:0,getCurrentCourse:n=>n.course},actions:{async fetchAllCourses(n){await $o.fetchAll(n).then(t=>this.response_courses=t)}}}),Qo={props:["form","price","index","ticket"],setup(n,t){const o=k(0),e=function(){o.value++,p()},h=function(){o.value>0&&o.value--,p()},p=function(){o.value==null&&(o.value=0);const i={counter:o.value,price:n.price,index:n.index,ticket:n.ticket};t.emit("changeCounter",i)};return{counter:o,decrement:h,increment:e,emitEvent:p}}};const Wo={class:"btn-plus-min flex align-items-center"},Xo={class:"counter"};function Yo(n,t,o,e,h,p){const i=g("Button"),d=g("InputNumber");return m(),f("div",Wo,[l(i,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),s("div",Xo,[l(d,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=v=>e.counter=v),t[1]||(t[1]=v=>e.emitEvent())],min:0},null,8,["modelValue"])]),l(i,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const Zo=I(Qo,[["render",Yo]]),en={props:["tickets","form"],setup(n,t){E(()=>{h.value=!1,i.discount={},p.value=null,n.form.max_seats&&n.form.max_seats<0?(c.value=!0,b.value=-n.form.max_seats):c.value=!1});const o=k(0),e=k([]),h=k(!1),p=k(),i=J(),d=q(),v=k(!1),c=k(!1),b=k(),a=L(()=>i.getDiscount),O=function(A){e.value[A.index]={partial_total:A.price*A.counter,ticket:A.ticket,quantity:A.counter},o.value=0;let r=0;e.value.forEach(u=>{o.value+=u.partial_total,r+=u.quantity}),c.value||(n.form.max_seats&&r>n.form.max_seats?(b.value=r-n.form.max_seats,v.value=!0):(b.value=null,v.value=!1)),p.value&&D()},C=function(){D()},D=async function(){let A=[];e.value.forEach(u=>{A.push({id:u.ticket.id,quantity:u.quantity})});const r={discount_code:p.value,location_permalink:n.form.location_permalink,tickets:A};await i.cost(r).then(()=>{}).catch(u=>{z(d,u)})};return{total:o,partialTotals:e,showDiscount:h,discountCode:p,discount:a,showAlert:v,showAlert2:c,numOverbooking:b,onChangeCounter:O,applyDiscount:C,checkDisabled:function(){let A=!1;(!e.value||e.value.length==0)&&(A=!0);let r=0;return e.value.forEach(u=>{r+=u.quantity}),r==0&&(A=!0),t.emit("disableSecondoTab",!0),A},nextTab:function(){const A={discount_code:p.value,partial_total:e.value};t.emit("nextTab",A)}}},components:{PlusMinusButton:Zo}};const tn={key:0},on={key:1},nn={key:0},sn={key:1},ln={key:0,class:"flex justify-content-between align-items-center"},an={class:"flex align-items-center col-9"},rn={class:"col-4 pl-0"},cn={class:"text-right col-3"},dn={class:"col-3 flex justify-content-end"},un={key:2,class:"mt-3 mb-5"},mn=s("i",null,"Nessuna tipologia di biglietto trovata.",-1),_n=[mn],fn=s("hr",{class:"mt-3"},null,-1),pn={class:"flex align-items-center justify-content-between py-0"},hn={class:"col-9 flex"},vn=s("b",null,"Totale",-1),yn=[vn],kn={key:0,class:"text-right col-4"},gn={class:"line-through text-sm mr-2"},bn={class:"font-bold"},xn={key:1,class:"col-3 text-right font-bold"},wn={class:"col-3 flex justify-content-end"};function Cn(n,t,o,e,h,p){const i=g("Message"),d=g("PlusMinusButton"),v=g("Button");return m(),f($,null,[e.showAlert?(m(),Z(i,{key:0,severity:"warn"},{default:w(()=>[U("Attenzione! Si sta andando in overbooking di "+y(e.numOverbooking)+" ",1),e.numOverbooking==1?(m(),f("span",tn,"posto")):(m(),f("span",on,"posti"))]),_:1})):V("",!0),e.showAlert2?(m(),Z(i,{key:1,severity:"warn"},{default:w(()=>[U("Attenzione! Lo slot orario è già in overbooking di "+y(e.numOverbooking)+" ",1),e.numOverbooking==1?(m(),f("span",nn,"posto")):(m(),f("span",sn,"posti"))]),_:1})):V("",!0),(m(!0),f($,null,ne(o.tickets,(c,b)=>{var a,O,C;return m(),f("div",{key:c.id},[((a=c.course)==null?void 0:a.id)==((O=o.form.course)==null?void 0:O.id)?(m(),f("div",ln,[s("div",an,[s("b",rn,y(c.name),1),s("div",cn,"€ "+y((C=c.price)==null?void 0:C.toFixed(2)),1)]),s("div",dn,[l(d,{onChangeCounter:t[0]||(t[0]=D=>e.onChangeCounter(D)),price:c.price,index:b,ticket:c},null,8,["price","index","ticket"])])])):V("",!0)])}),128)),o.tickets&&o.tickets.length==0?(m(),f("div",un,_n)):V("",!0),fn,s("div",pn,[s("div",hn,[s("div",{class:Q(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},yn,2),e.discount&&e.discount.total_amount?(m(),f("div",kn,[s("span",gn,"€ "+y(e.total.toFixed(2)),1),s("span",bn,"€ "+y(e.discount.total_amount.toFixed(2)),1)])):(m(),f("div",xn,"€ "+y(e.total.toFixed(2)),1))]),s("div",wn,[l(v,{label:"Prosegui",onClick:t[1]||(t[1]=c=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Dn=I(en,[["render",Cn]]);class On{static async fetchAll(){return(await je("/countries")).data.countries}}const Tn=de({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:n=>n.countries},actions:{async fetchAllCountries(){await On.fetchAll().then(n=>this.countries=n)}}}),Sn={props:["location_permalink"],setup(n,t){E(()=>{a()});const o=ae(),e=Tn(),h=J(),p=k({}),i=k(),d=L(()=>e.allCountries),v=L(()=>o.allOpenTickets),c=L(()=>h.paymentStatus),b=L(()=>h.paymentModeList),a=async function(){await e.fetchAllCountries().then(()=>{p.value.country_id=88,p.value.status={id:"payed",name:"Pagato"}})};return{form:p,countries:d,paymentList:c,paymentModeList:b,errorMessage:i,open_tickets:v,fetchAllOpenTickets:async function(x){const M={code:x.query.toUpperCase(),location_permalink:n.location_permalink};await o.fetchAllOpenTickets(M)},onChangeStatus:function(){p.value.status.id&&(p.value.status.id=="free"||p.value.status.id=="to_pay")&&(p.value.payment_method=null)},onConfirm:function(){if(p.value.status&&p.value.status.id=="payed"&&!p.value.payment_method){i.value="Seleziona un metodo di pagamento";return}t.emit("nextTab",p.value)}}}},Vn={key:0,class:"formgrid grid"},An={class:"field col-6"},Nn=s("label",{for:"user_name"},"Nome",-1),Ln={class:"field col-6"},Fn=s("label",{for:"user_surname"},"Cognome",-1),Mn={class:"field col-6"},Un=s("label",{for:"user_email"},"Email",-1),Pn={class:"field col-6"},zn=s("label",{for:"user_phone"},"Telefono",-1),Bn={class:"field col-6"},jn=s("label",{for:"country_id"},"Nazione",-1),In={class:"field col-6"},En=s("label",{for:"user_zip"},"Cap",-1),Rn={class:"field col-6"},qn=s("label",{for:"status"},"Stato pagamento",-1),Hn={class:"field col-6"},Jn={for:"payment_method"},Kn={key:0},$n={class:"p-float-label"},Gn={class:"p-error",id:"dd-error"},Qn={key:0,class:"field col-6 flex flex-column"},Wn=s("label",{for:"user_zip"},"Codice biglietto",-1),Xn={class:"field col-12"},Yn={class:"field flex flex-column"},Zn=s("label",{for:"notes"},"Note",-1),es={class:"col-12 flex justify-content-end"};function ts(n,t,o,e,h,p){const i=g("InputText"),d=g("Dropdown"),v=g("AutoComplete"),c=g("Textarea"),b=g("Button");return e.form?(m(),f("div",Vn,[s("div",An,[Nn,l(i,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.user_name=a),class:"w-full"},null,8,["modelValue"])]),s("div",Ln,[Fn,l(i,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.user_surname=a),class:"w-full"},null,8,["modelValue"])]),s("div",Mn,[Un,l(i,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.user_email=a),class:"w-full"},null,8,["modelValue"])]),s("div",Pn,[zn,l(i,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=a=>e.form.user_phone=a),class:"w-full"},null,8,["modelValue"])]),s("div",Bn,[jn,l(d,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=a=>e.form.country_id=a),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",In,[En,l(i,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=a=>e.form.user_zip=a),class:"w-full"},null,8,["modelValue"])]),s("div",Rn,[qn,l(d,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=a=>e.form.status=a),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=a=>e.onChangeStatus())},null,8,["modelValue","options"])]),s("div",Hn,[s("label",Jn,[U("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(m(),f("span",Kn,"*")):V("",!0)]),s("span",$n,[l(d,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=a=>e.form.payment_method=a),options:e.paymentModeList,optionLabel:"label",class:Q(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=a=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),s("small",Gn,y(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.label=="Biglietto a data aperta (voucher)"?(m(),f("div",Qn,[Wn,l(v,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=a=>e.form.open_ticket_codes=a),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[11]||(t[11]=a=>e.fetchAllOpenTickets(a)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):V("",!0),s("div",Xn,[s("div",Yn,[Zn,l(c,{modelValue:e.form.notes,"onUpdate:modelValue":t[12]||(t[12]=a=>e.form.notes=a),rows:"5",cols:"30"},null,8,["modelValue"])])]),s("div",es,[l(b,{label:"Conferma",onClick:t[13]||(t[13]=a=>e.onConfirm())})])])):V("",!0)}const os=I(Sn,[["render",ts]]);var ns=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,ss={root:function(t){var o=t.instance;return["p-contextmenu p-component",{"p-input-filled":o.$primevue.config.inputStyle==="filled","p-ripple-disabled":o.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var o=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":o.isItemActive(e),"p-focus":o.isItemFocused(e),"p-disabled":o.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var o=t.props,e=t.isActive,h=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":o.exact&&h}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Ie.extend({name:"contextmenu",css:ns,classes:ss});const ls={props:["form"],setup(n,t){E(()=>{O()});const o=k(0),e=k([]),h=k(!1),p=k(!0),i=k(),d=ae(),v=J(),c=q(),b=L(()=>d.allTickets),a=L(()=>v.getCurrentOrder),O=async function(){const S={location_permalink:n.form.location_permalink,api_version:"v2",date:D(n.form.date),course_id:n.form.course.id};await d.fetchAllTickets(S).then(()=>{}).catch(B=>{z(c,B)})},C=function(S){o.value+=1,i.value=S.discount_code,e.value=Object.assign([],S.partial_total),p.value=!1},D=function(S){return se(S).includes("Invalid")?he(S):se(S)},x=function(S){M(S)},M=async function(S){var G,W,X;const B=[{start_at:n.form.hour,tickets:[]}];e.value.forEach(H=>{H.quantity!=0&&B[0].tickets.push({id:H.ticket.id,quantity:H.quantity})});let R=[];S.open_ticket_codes&&S.open_ticket_codes.forEach(H=>{R.push(H.code)});const ee={location_permalink:n.form.location_permalink,country_id:S.country_id,status:S.status.id,user_email:S.user_email,user_name:S.user_name,user_phone:S.user_phone,user_surname:S.user_surname,user_zip:S.user_zip,api_version:"v2",date:n.form.date?D(n.form.date):"",notes:S.notes,time_slots:B,payment_method:(G=S.payment_method)==null?void 0:G.id,course_id:(X=(W=n.form)==null?void 0:W.course)==null?void 0:X.id,open_ticket_codes:R};i.value&&(ee.discount_code=i.value),await v.createOrder(ee).then(()=>{o.value+=1,p.value=!0,h.value=!0}).catch(H=>{z(c,H)})},A=function(){ce(a==null?void 0:a.value,n.form.location_permalink,c),t.emit("closeDialog",!0)},r=function(S){p.value=S},u=function(){ce(a==null?void 0:a.value,n.form.location_permalink,c),T()},T=async function(){let S=[];if(!a.value&&!n.form.location_permalink)return;for(let R of a.value.order_items)S.push(R.id);const B={check_in:!0,order_item_ids:S,location_permalink:n.form.location_permalink};await v.checkInOrder(B).then(()=>{K(c,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(R=>{z(c,R)})};return{tickets:b,active:o,partialTotals:e,showOrderDetail:h,currentOrder:a,showSecondTab:p,formatExplicitDate:pe,formatDate:ue,onNextTab:C,onConfirmPayment:x,printPDF:ye,onPrintPDF:A,onDisableSecondoTab:r,printAndCheckIn:u}},components:{NewOrderTicketTab:Dn,NewOrderFormTab:os}};const as={key:0,class:"info-box"},is={class:"font-medium"},rs=s("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),cs={class:"font-medium"},ds=s("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),us={key:0,class:"capitalize"},ms={key:0,class:"flex pb-4"},_s=s("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),fs={class:"flex flex-column"},ps={key:0,class:"pb-1 pr-1"},hs={key:1,class:"pb-1"},vs={class:"py-5"},ys={class:"m-0 text-center line-height-3"},ks=s("br",null,null,-1),gs={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},bs=s("p",{class:"my-2"},[s("b",null,"Riepilogo ordine:")],-1),xs={class:"flex flex-column col-12"},ws={key:0,class:"pb-1",style:{"min-width":"8rem"}},Cs={key:1,class:"pb-1"},Ds={key:2},Os={class:"flex flex-column col-12"},Ts={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Ss=s("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),Vs={class:"pb-1"},As={class:"flex align-items-center justify-content-center mt-4"};function Ns(n,t,o,e,h,p){var a,O;const i=g("NewOrderTicketTab"),d=g("TabPanel"),v=g("NewOrderFormTab"),c=g("Button"),b=g("TabView");return m(),f($,null,[o.form?(m(),f("div",as,[s("p",is,[rs,U(y((a=o.form.course)==null?void 0:a.name),1)]),s("p",cs,[ds,o.form.date?(m(),f("span",us,y(e.formatDate((O=o.form)==null?void 0:O.date)),1)):V("",!0),U(" - "+y(o.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(m(),f("div",ms,[_s,s("div",fs,[(m(!0),f($,null,ne(e.partialTotals,C=>{var D;return m(),f("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:C},[C&&C.quantity!=0?(m(),f("span",ps,y((D=C.ticket)==null?void 0:D.name),1)):V("",!0),C&&C.quantity!=0?(m(),f("span",hs," x "+y(C.quantity)+" "+y(C.price),1)):V("",!0)])}),128))])])):V("",!0)])):V("",!0),l(b,{activeIndex:e.active,"onUpdate:activeIndex":t[5]||(t[5]=C=>e.active=C)},{default:w(()=>[l(d,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:w(()=>[l(i,{tickets:e.tickets,form:o.form,onNextTab:t[0]||(t[0]=C=>e.onNextTab(C)),onDisableSecondoTab:t[1]||(t[1]=C=>e.onDisableSecondoTab(C))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(d,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:w(()=>[l(v,{onNextTab:t[2]||(t[2]=C=>e.onConfirmPayment(C)),location_permalink:o.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(m(),Z(d,{key:0,header:"Ordine completato"},{default:w(()=>{var C;return[s("div",vs,[s("div",ys,[U(" Ordine "),s("b",null,y(e.currentOrder.reservation_number),1),U(" registrato correttamente!"),ks]),e.currentOrder?(m(),f("div",gs,[bs,s("div",xs,[(m(!0),f($,null,ne(e.currentOrder.order_items[0].tickets,D=>(m(),f("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:D},[D&&D.quantity!=0?(m(),f("span",ws,y(D.name),1)):V("",!0),D&&D.quantity!=0?(m(),f("span",Cs," x "+y(D.quantity),1)):V("",!0),D.price?(m(),f("span",Ds," € "+y((+D.price).toFixed(2)),1)):V("",!0)]))),128))]),s("div",Os,[e.currentOrder.total?(m(),f("p",Ts,[Ss,s("span",Vs,[s("b",null,"€ "+y((+((C=e.currentOrder)==null?void 0:C.total)).toFixed(2)),1)])])):V("",!0)])])):V("",!0),s("div",As,[l(c,{icon:"pi pi-print",onClick:t[3]||(t[3]=D=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),l(c,{icon:"pi print-check-icon",onClick:t[4]||(t[4]=D=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"}),l(c,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti"})])])]}),_:1})):V("",!0)]),_:1},8,["activeIndex"])],64)}const Ls=I(ls,[["render",Ns]]),Fs={props:["filters","date"],setup(n,t){E(()=>{a(),p.value=ke(8,20),o.value=Object.assign({},n.filters)});const o=k({}),e=Go(),h=q(),p=k(),i=k(!1),d=me(),v=k(!1),c=L(()=>e.allCourses),b=L(()=>d.showNewOrderDialog),a=async function(){const x={location_permalink:n.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(x).then(()=>{}).catch(M=>{z(h,M)})},O=function(){d.setNewOrderDialogVisibility(!1),o.value.hour="",o.value.course=null,t.emit("onCloseDialog")},C=function(x){o.value.date=n.date,d.setNewOrderDialogVisibility(x)},D=function(){v.value=o.value.open_ticket};return Y(n.filters,()=>{if(a(),o.value=Object.assign({},n.filters),n.filters.course&&!n.filters.course.id){let x=c.value.find(M=>M.name===n.filters.course.name);x&&(o.value.course=x)}}),{courses:c,form:o,hours:p,disableForm:v,visible:i,onCloseDialog:O,updateDialog:C,onChecked:D,dialogVisible:b,dialogStore:d}},components:{NewOrderDialog:Ls}},Ms=s("h2",{class:"mt-1"},"Nuova prenotazione",-1),Us={class:"formgrid grid px-0 align-items-center mt-4"},Ps={key:0,class:"field flex flex-column w-full col-12"},zs=s("label",{for:"typology"},"Scegli il percorso",-1),Bs={key:1,class:"field flex flex-column w-full col-12"},js=s("label",{for:"typology"},"Seleziona l'orario",-1),Is={class:"flex justify-content-end align-items-center mt-2"},Es={class:"flex align-items-center justify-content-between w-full"},Rs=s("h2",null,"Nuova prenotazione",-1);function qs(n,t,o,e,h,p){const i=g("Dropdown"),d=g("Button"),v=g("NewOrderDialog"),c=g("Dialog"),b=g("Card");return m(),Z(b,{class:"mt-4"},{content:w(()=>[Ms,s("div",Us,[o.filters.location_permalink?(m(),f("div",Ps,[zs,l(i,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.course=a),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):V("",!0),o.filters.location_permalink?(m(),f("div",Bs,[js,l(i,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.hour=a),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):V("",!0)]),s("div",Is,[l(d,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=a=>e.updateDialog(!0))},null,8,["disabled"])]),l(c,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=a=>e.dialogVisible=a),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=a=>e.onCloseDialog())},{header:w(()=>[s("div",Es,[Rs,l(d,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=a=>e.updateDialog(!1))})])]),default:w(()=>[l(v,{form:e.form,onCloseDialog:t[4]||(t[4]=a=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const Hs=I(Fs,[["render",qs]]),Js={setup(){E(()=>{c.value&&(n.value.location_permalink=c.value,t.value.location_permalink=c.value),b()});const n=k({}),t=k({}),o=k(),e=Ee(),h=le(),p=q(),i=me(),d=L(()=>e.currentUser),v=L(()=>h.allLocations),c=L(()=>h.getCurrentLocation),b=async function(){await h.fetchAllLocations().then(()=>{c.value||(n.value.location_permalink=v.value[0].permalink,t.value.location_permalink=v.value[0].permalink,h.updateCurrenLocation(v.value[0].permalink))}).catch(x=>{z(p,x)})};return{filters:n,orderTable:o,order_filters:t,user:d,locations:v,fetchAllLocations:b,formatDate:ue,onUpdateFilters:function(x){x.course?n.value.course={id:x.course}:n.value.course="",x.name?n.value.name=x.name:n.value.name="",x.hour&&(x.hour.start_at?n.value.hour=x.hour.start_at:n.value.hour=x.hour)},onUpdateNewOrderFilters:function(x){x.start_at&&(t.value.hour=x.start_at),x.course_name&&(t.value.course={name:x.course_name}),x.date&&(t.value.date=x.date),x.hour&&(t.value.hour=x.hour),x.max_seats?t.value.max_seats=x.max_seats:t.value.max_seats=null,i.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){o.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=n.value.location_permalink,h.updateCurrenLocation(n.value.location_permalink)}}},components:{CalendarFilter:Mo,OrderTable:Vo,OrderFilter:Ko,NewOrderCard:Hs}};const Ks={class:"flex justify-content-between align-items-center"},$s={class:"field flex flex-column mt-3"},Gs={key:0,style:{color:"#495057"}},Qs=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Ws={class:"capitalize text-xl"},Xs={class:"flex gap-4"},Ys={key:0,class:"col-3 mt-3"},Zs={class:"col-9 mt-3"};function el(n,t,o,e,h,p){const i=g("Dropdown"),d=g("CalendarFilter"),v=g("NewOrderCard"),c=g("OrderFilter"),b=g("OrderTable");return m(),f("div",null,[s("div",Ks,[s("div",$s,[l(i,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":t[0]||(t[0]=a=>e.filters.location_permalink=a),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location",onChange:t[1]||(t[1]=a=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(m(),f("div",Gs,[Qs,s("span",Ws,y(e.formatDate(e.filters.date)),1)])):V("",!0)]),s("div",Xs,[e.filters.location_permalink?(m(),f("div",Ys,[l(d,{filters:e.filters},null,8,["filters"]),l(v,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[2]||(t[2]=a=>e.onCloseDialog())},null,8,["date","filters"])])):V("",!0),s("div",Zs,[l(c,{filters:e.filters,onOnSubmit:t[3]||(t[3]=a=>e.onUpdateFilters(a))},null,8,["filters"]),e.filters.date?(m(),Z(b,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[4]||(t[4]=a=>e.onUpdateNewOrderFilters(a))},null,8,["filters"])):V("",!0)])])])}const ll=I(Js,[["render",el]]);export{ll as default};
