import{o as F,c as b,J as q,a as C,x as m,i as E,_ as D,r as f,b as h,e as g,f as s,w as v,h as O,t as T,I as U,N as S,M as $,g as i,u as H,H as J}from"../index59263.js";import{a as P,b as W,d as G,e as K,i as Q}from"./NewOrderDialog.vue_vue_type_style_index_0_lang59263.js";import{e as V,s as X}from"./helpers59263.js";const Y={props:["filters"],setup(n,t){F(()=>{d.value=!0,w.value={first:0,rows:_.value.rows,sortField:null,sortOrder:null},w.value.page=0,n.filters.location_permalink&&y()});const r=P(),e=W(),k=b(()=>r.responseOrders),p=b(()=>r.status),l=q();b(()=>l.submitDialog),b(()=>l.cancelDialog);const c=C(),_=m(),o=m(),a=m(),d=m(!0),w=m(),R=m(0),A=m([]),N=m([]);function y(){d.value=!0;let u=new Map;for(const x in n.filters)n.filters.location_permalink&&u.set("location_permalink",n.filters.location_permalink);setTimeout(()=>{L(u)},Math.random()*1e3+250)}const L=async function(u){await r.fetchOrderWithOpenTicket(u).then(()=>{d.value=!1}).catch(x=>{d.value=!1,V(c,x)})},z=async function(u,x){d.value=!0;const j={order_id:u.id,id:n.filters.location_permalink,ticket_codes:[x]};await r.updateOrder(j).then(()=>{d.value=!1,X(c,{message:"Stato aggiornato correttamente",error:!1}),y()}).catch(M=>{d.value=!1,V(c,M)})},B=u=>{a.value.toggle(u)},I=function(u){const x={course_name:u.course_name,start_at:u.start_at};t.emit("updateFilters",x),e.setNewOrderDialogVisibility(!0)};return E(n.filters,()=>{n.filters.location_permalink&&y()}),{dt:_,responseOrders:k,loading:d,totalRecords:R,lazyParams:w,currentOrder:o,status:p,expandedRows:A,expandedRows1:N,op:a,dialogStore:e,loadLazyData:y,onChangeUsedStatus:z,toggle:B,openDialog:I,formatDataFromUnixTimestamps:G}},components:{}};const Z={class:"order-table"};function ee(n,t,r,e,k,p){const l=f("Column"),c=f("Checkbox"),_=f("DataTable");return h(),g("div",Z,[s(_,{value:e.responseOrders.orders,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[0]||(t[0]=o=>e.expandedRows=o)},{empty:v(()=>[O(" Nessuna prenotazione trovata. ")]),default:v(()=>[s(l,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),s(l,{header:"Email",field:"user_email",ref:"user_email"},null,512),s(l,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:v(({data:o})=>[O(T(e.formatDataFromUnixTimestamps(o.created_at)),1)]),_:1},512),s(l,{header:"Numero ticket"},{body:v(({data:o})=>{var a;return[O(T((a=o.order_items[0])==null?void 0:a.tickets[0].quantity),1)]}),_:1}),s(l,{header:"Codice ticket"},{body:v(({data:o})=>[(h(!0),g(U,null,S(o.order_items[0].ticket_codes,a=>(h(),g("div",{key:a.code,class:"py-1"},T(a.code),1))),128))]),_:1}),s(l,{header:"Utilizzato"},{body:v(({data:o})=>[(h(!0),g(U,null,S(o.order_items[0].ticket_codes,a=>(h(),g("div",{key:a.code,class:"py-1"},[s(c,{modelValue:a.used,"onUpdate:modelValue":d=>a.used=d,binary:!0,onChange:d=>e.onChangeUsedStatus(o.order_items[0],a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]))),128))]),_:1})]),_:1},8,["value","totalRecords","loading","expandedRows"])])}const oe=D(Y,[["render",ee]]),te={props:["filters"],setup(n,t){F(()=>{r.value=Object.assign({},n.filters)});const r=m({});return{form:r,resetField:function(){r.value.name=null,t.emit("onSubmit",r.value)}}}},ne={class:"formgrid grid px-0 align-items-center"},ae={class:"field col-4 flex flex-column"},le=i("label",{for:"typology"},"Filtra per codice ordine",-1),se={class:"field col-4 flex flex-column"},re=i("label",{for:"typology"},"Filtra per codice ticket",-1),ie={class:"field col-4 flex flex-column"},ce=i("label",{for:"typology"},"Filtra per email",-1),de={class:"flex col-12 justify-content-end mt-1"};function ue(n,t,r,e,k,p){const l=f("InputText"),c=f("Button"),_=f("AccordionTab"),o=f("Accordion");return h(),$(o,{activeIndex:0},{default:v(()=>[s(_,{header:"FILTRI"},{default:v(()=>[i("div",ne,[i("div",ae,[le,s(l,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])]),i("div",se,[re,s(l,{modelValue:e.form.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])]),i("div",ie,[ce,s(l,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])])]),i("div",de,[s(c,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=a=>n.$emit("onSubmit",e.form))}),s(c,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=a=>e.resetField())})])]),_:1})]),_:1})}const me=D(te,[["render",ue]]),fe={setup(){F(()=>{p.value&&(n.value.location_permalink=p.value.location.permalink,c())});const n=m({}),t=m(),r=H(),e=K(),k=C(),p=b(()=>r.currentUser),l=b(()=>e.allLocations),c=async function(){await e.fetchAllLocations().then(()=>{}).catch(o=>{V(k,o)})};return{filters:n,orderTable:t,user:p,locations:l,fetchAllLocations:c,formatDate:Q,onUpdateFilters:function(o){n.value.hour=o.start_at,n.value.course={name:o.course_name},o.course&&(n.value.course={id:o.course}),n.value.name=o.name,o.hour&&(o.hour.start_at?n.value.hour=o.hour.start_at:n.value.hour=o.hour)}}},components:{OpenTicketTable:oe,OpenTicketFilter:me}};const _e={class:"flex justify-content-between align-items-center"},pe={class:"field flex flex-column mt-3"},ve={key:0,style:{color:"#495057"}},he=i("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),ge={class:"capitalize text-xl"},ke={class:"flex gap-4"},xe={class:"col-12 mt-3"};function be(n,t,r,e,k,p){const l=f("Dropdown"),c=f("OpenTicketFilter"),_=f("OpenTicketTable");return h(),g("div",null,[i("div",_e,[i("div",pe,[s(l,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":t[0]||(t[0]=o=>e.filters.location_permalink=o),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(h(),g("div",ve,[he,i("span",ge,T(e.formatDate(e.filters.date)),1)])):J("",!0)]),i("div",ke,[i("div",xe,[s(c,{filters:e.filters,onOnSubmit:t[1]||(t[1]=o=>e.onUpdateFilters(o))},null,8,["filters"]),s(_,{filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[2]||(t[2]=o=>e.onUpdateFilters(o))},null,8,["filters"])])])])}const Oe=D(fe,[["render",be]]);export{Oe as default};
