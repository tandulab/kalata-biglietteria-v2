import{o as R,c as b,I as K,a as A,x as u,i as F,_ as U,r as p,b as y,e as x,f as r,w as g,h as D,t as O,L as Q,O as X,M as Y,g as d,u as Z,N as ee}from"../index74506.js";import{u as te,a as oe,c as ae,d as ne,i as le}from"./NewOrderDialog.vue_vue_type_style_index_0_lang74506.js";import{e as S,s as se}from"./helpers74506.js";const re={props:["filters"],setup(n,a){R(()=>{v.value=!0,V.value={first:0,rows:f.value.rows,sortField:null,sortOrder:null},V.value.page=0,n.filters.location_permalink&&T()});const c=te(),e=oe(),h=b(()=>c.responseOrders),_=b(()=>c.status),l=K(),m=b(()=>l.submitDialog),i=b(()=>l.cancelDialog),t=A(),f=u(),k=u(),w=u(),I=u([{code:"2023795703",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!0},{code:"2023795704",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795705",type:"Biglietto ridotto",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795706",type:"Biglietto gratuito",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1}]),B=u(["Da pagare","Pagato","Gratuito"]),v=u(!0),V=u(),N=u(0),z=u([]),L=u([]);function T(){v.value=!0;let o=new Map;for(const s in n.filters)n.filters.location_permalink&&o.set("location_permalink",n.filters.location_permalink);setTimeout(()=>{q(o)},Math.random()*1e3+250)}const q=async function(o){await c.fetchOrderWithOpenTicket(o).then(()=>{v.value=!1}).catch(s=>{v.value=!1,S(t,s)})},P=function(o){},j=function(o,s){o.stopPropagation(),o.stopImmediatePropagation(),k.value=s;let C="Sei sicuro di voler disattivare l'utente <b>"+(s==null?void 0:s.email)+"</b> ?";l.setDialog("Cambia stato","Conferma","Annulla",C),l.setDynamicDialogVisibility(!0)},M=async function(){var s;v.value=!0;const o={order_id:k.value.id,order:{enabled:(s=k.value)==null?void 0:s.enabled}};await c.updateOrder(o).then(()=>{v.value=!1,se(t,{message:"Stato aggiornato correttamente",error:!1}),T()}).catch(C=>{v.value=!1,S(t,C)})},E=function(o){return o!=null&&o.cluster?o.cluster:""},G=o=>{w.value.toggle(o)},W=(o,s)=>{if(o>=(o+s)/2)return"green";if(o<=(o+s)/3)return"red"},$=function(o,s){s&&(w.value.note=s,w.value.toggle(o))},H=function(o){},J=function(o){const s={course_name:o.course_name,start_at:o.start_at};a.emit("updateFilters",s),e.setNewOrderDialogVisibility(!0)};return F(m,()=>{M()}),F(i,()=>{k.value.enabled?k.value.enabled=!1:k.value.enabled=!0}),F(n.filters,()=>{n.filters.location_permalink&&T()}),{dt:f,responseOrders:h,loading:v,totalRecords:N,lazyParams:V,currentOrder:k,status:_,expandedRows:z,expandedRows1:L,op:w,tmp_tickets:I,payments:B,dialogStore:e,showSidebar:P,loadLazyData:T,onChangeStatus:j,getRowClass:E,toggle:G,getProgressClass:W,showNotes:$,checkAll:H,openDialog:J,formatDataFromUnixTimestamps:ae}},components:{}};const ie={class:"order-table"};function ce(n,a,c,e,h,_){const l=p("Column"),m=p("DataTable");return y(),x("div",ie,[r(m,{value:e.responseOrders.orders,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",rowClass:e.getRowClass,expandedRows:e.expandedRows,"onUpdate:expandedRows":a[0]||(a[0]=i=>e.expandedRows=i)},{empty:g(()=>[D(" Nessuna prenotazione trovata. ")]),default:g(()=>[r(l,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),r(l,{header:"Email",field:"user_email",ref:"user_email"},null,512),r(l,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:g(({data:i})=>[D(O(e.formatDataFromUnixTimestamps(i.created_at)),1)]),_:1},512),r(l,{header:"Numero ticket"},{body:g(({data:i})=>{var t;return[D(O((t=i.order_items[0])==null?void 0:t.tickets[0].quantity),1)]}),_:1}),r(l,{header:"Codice ticket"},{body:g(({data:i})=>[(y(!0),x(Q,null,X(i.order_items[0].ticket_codes,t=>(y(),x("div",{key:t.code,class:"py-1"},O(t.code),1))),128))]),_:1}),r(l,null,{body:g(({data:i})=>[]),_:1})]),_:1},8,["value","totalRecords","loading","rowClass","expandedRows"])])}const de=U(re,[["render",ce]]),ue={props:["filters"],setup(n,a){R(()=>{c.value=Object.assign({},n.filters)});const c=u({});return{form:c,resetField:function(){c.value.name=null,a.emit("onSubmit",c.value)}}}},me={class:"formgrid grid px-0 align-items-center"},fe={class:"field col-4 flex flex-column"},pe=d("label",{for:"typology"},"Filtra per codice ordine",-1),_e={class:"field col-4 flex flex-column"},ve=d("label",{for:"typology"},"Filtra per codice ticket",-1),ge={class:"field col-4 flex flex-column"},ke=d("label",{for:"typology"},"Filtra per email",-1),he={class:"flex col-12 justify-content-end mt-1"};function be(n,a,c,e,h,_){const l=p("InputText"),m=p("Button"),i=p("AccordionTab"),t=p("Accordion");return y(),Y(t,{activeIndex:0},{default:g(()=>[r(i,{header:"FILTRI"},{default:g(()=>[d("div",me,[d("div",fe,[pe,r(l,{modelValue:e.form.name,"onUpdate:modelValue":a[0]||(a[0]=f=>e.form.name=f),placeholder:""},null,8,["modelValue"])]),d("div",_e,[ve,r(l,{modelValue:e.form.name,"onUpdate:modelValue":a[1]||(a[1]=f=>e.form.name=f),placeholder:""},null,8,["modelValue"])]),d("div",ge,[ke,r(l,{modelValue:e.form.name,"onUpdate:modelValue":a[2]||(a[2]=f=>e.form.name=f),placeholder:""},null,8,["modelValue"])])]),d("div",he,[r(m,{label:"Ricerca",class:"mr-2",onClick:a[3]||(a[3]=f=>n.$emit("onSubmit",e.form))}),r(m,{label:"Annulla",class:"p-button-outlined",onClick:a[4]||(a[4]=f=>e.resetField())})])]),_:1})]),_:1})}const ye=U(ue,[["render",be]]),xe={setup(){R(()=>{_.value&&(n.value.location_permalink=_.value.location.permalink,m())});const n=u({}),a=u(),c=Z(),e=ne(),h=A(),_=b(()=>c.currentUser),l=b(()=>e.allLocations),m=async function(){await e.fetchAllLocations().then(()=>{}).catch(t=>{S(h,t)})};return{filters:n,orderTable:a,user:_,locations:l,fetchAllLocations:m,formatDate:le,onUpdateFilters:function(t){n.value.hour=t.start_at,n.value.course={name:t.course_name},t.course&&(n.value.course={id:t.course}),n.value.name=t.name,t.hour&&(t.hour.start_at?n.value.hour=t.hour.start_at:n.value.hour=t.hour)}}},components:{OpenTicketTable:de,OpenTicketFilter:ye}};const we={class:"flex justify-content-between align-items-center"},Te={class:"field flex flex-column mt-3"},Oe={key:0,style:{color:"#495057"}},Ve=d("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Ce={class:"capitalize text-xl"},Fe={class:"flex gap-4"},De={class:"col-12 mt-3"};function Se(n,a,c,e,h,_){const l=p("Dropdown"),m=p("OpenTicketFilter"),i=p("OpenTicketTable");return y(),x("div",null,[d("div",we,[d("div",Te,[r(l,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":a[0]||(a[0]=t=>e.filters.location_permalink=t),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(y(),x("div",Oe,[Ve,d("span",Ce,O(e.formatDate(e.filters.date)),1)])):ee("",!0)]),d("div",Fe,[d("div",De,[r(m,{filters:e.filters,onOnSubmit:a[1]||(a[1]=t=>e.onUpdateFilters(t))},null,8,["filters"]),r(i,{filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:a[2]||(a[2]=t=>e.onUpdateFilters(t))},null,8,["filters"])])])])}const Ie=U(xe,[["render",Se]]);export{Ie as default};
