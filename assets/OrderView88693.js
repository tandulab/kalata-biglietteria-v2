import{l as ve,m as me,o as $,p as x,a as G,c as N,_ as H,r as b,b as _,e as p,g as n,f as a,q as F,F as W,t as C,h as M,n as Y,s as de,v as Je,i as X,x as Ge,w as S,y as fe,z as ee,A as be,B as Ke,u as Qe}from"../index88693.js";import{u as Q,a as oe,f as xe,b as he,c as We,d as Xe,e as ge,g as ue,h as we,i as Ye,D as Z,j as ye}from"./location88693.js";import{u as ne,s as K,e as P,p as Ce,a as Ze,b as De,c as pe,d as Se}from"./helpers88693.js";import{F as et}from"./vee-validate.esm88693.js";class ke{static async fetchAll(t){const l=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${l}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const l=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${l}/orders/search_codes`,t)).data}}const _e=me({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await ke.fetchAll(o).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(o){await ke.fetchAllOpenTickets(o).then(t=>this.open_tickets_codes=t)}}}),tt={props:["location_permalink","time_slot"],setup(o,t){$(()=>{l.value=Object.assign({},o.time_slot)});const l=x({}),e=_e(),h=Q(),{showLoader:k,hideLoader:s}=ne(),d=G(),y=N(()=>e.allOpenTickets),i=N(()=>h.paymentStatus),f=N(()=>h.paymentModeList),c=N(()=>h.getCurrentOrder),w=async function(U){const g={code:U.query.toUpperCase(),location_permalink:o.location_permalink};await e.fetchAllOpenTickets(g)},D=async function(){var g;const U={id:o.location_permalink,order_id:l.value.id,status:(g=l.value)==null?void 0:g.status,payment_method:l.value.payment_method,open_ticket_codes:[],api_version:"v2"};if(l.value.open_tickets_used&&l.value.open_tickets_used.length>0){let r=[];l.value.open_tickets_used.forEach(u=>{r.push(u.code)}),U.open_ticket_codes=r}v(U)},v=async function(U){k(),await h.updateOrder(U).then(()=>{s(),K(d,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",c.value)}).catch(g=>{s(),P(d,g)})};return{form:l,open_tickets:y,paymentList:i,paymentModeList:f,changeStatus:D,fetchAllOpenTickets:w,onChangeStatus:function(){(l.value.status=="free"||l.value.status=="to_pay")&&(l.value.payment_method=null)}}}},ot={key:0,class:"formgrid grid flex-column mt-3"},nt={class:"field col-12"},lt=n("label",{for:"status"},"Stato pagamento",-1),st={class:"field col-12"},at=n("label",{for:"payment_method"},"Modalità pagamento",-1),it={key:0,class:"field col-12 flex flex-column"},rt=n("label",{for:"user_zip"},"Codice biglietto",-1),ct={class:"flex align-items-center justify-content-end mt-3"};function dt(o,t,l,e,h,k){const s=b("Dropdown"),d=b("AutoComplete"),y=b("Button");return _(),p(W,null,[e.form?(_(),p("div",ot,[n("div",nt,[lt,a(s,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.status=i),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=i=>e.onChangeStatus())},null,8,["modelValue","options"])]),n("div",st,[at,a(s,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.payment_method=i),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full",disabled:e.form.status!="payed"},null,8,["modelValue","options","disabled"])]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(_(),p("div",it,[rt,a(d,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[3]||(t[3]=i=>e.form.open_tickets_used=i),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[4]||(t[4]=i=>e.fetchAllOpenTickets(i)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):F("",!0)])):F("",!0),n("div",ct,[a(y,{label:"Annulla",text:"",onClick:t[5]||(t[5]=i=>o.$emit("closeDialog",null))}),a(y,{label:"Conferma",onClick:t[6]||(t[6]=i=>e.changeStatus())})])],64)}const ut=H(tt,[["render",dt]]),mt={props:["order"],setup(o,t){$(()=>{D.value&&w.value&&D.value.forEach(v=>{v.permalink===w.value&&(s.value=v.name)})});const l=x(0),e=x([]),h=x(!1),k=x(!0),s=x(),d=_e(),y=Q();G();const i=oe(),f=N(()=>d.allTickets),c=N(()=>y.getCurrentOrder),w=N(()=>i.getCurrentLocation),D=N(()=>i.allLocations);return{tickets:f,active:l,partialTotals:e,showOrderDetail:h,currentOrder:c,showSecondTab:k,currentLocation:w,selectedLocation:s,formatExplicitDate:xe,formatDate:he,prettyPaymentStatus:Ce,formatPrettyDate:We,formatDataAndHourFromUnixTimestamps:Xe,prettyPaymentMethod:Ze}},components:{}};const _t={class:"mt-3 line-height-3"},ft={class:"flex gap-3"},vt=n("i",{class:"pi pi-user mt-1"},null,-1),pt={class:"m-0 mb-1"},ht={class:"m-0 mb-1"},gt={class:"m-0 mb-1"},yt={class:"m-0 mb-1"},kt={key:0},bt={class:"flex gap-3 mt-4"},xt=n("i",{class:"pi pi-map-marker mt-1"},null,-1),wt={class:"m-0 mb-1"},Ct={class:"m-0 mb-1"},Dt={key:0,class:"m-0 mb-1"},St={class:"flex gap-3 mt-4"},Ot=n("i",{class:"pi pi-shopping-cart mt-1"},null,-1),Tt={class:"m-0 mb-1"},Vt={class:"m-0 mb-1"},At={class:"m-0 mb-1"},Ft={key:0,class:"m-0 mb-1"},Lt={key:1,class:"m-0 mb-1"},Nt={key:2,class:"m-0 mb-1"},Ut={class:"m-0 mb-1"},Mt={class:"m-0 mb-1"},Pt={key:0},Rt={key:1},Bt={key:0,class:"flex gap-3 mt-4"},zt=n("i",{class:"pi pi-comment mt-1"},null,-1);function Et(o,t,l,e,h,k){const s=b("Badge");return _(),p("div",_t,[n("div",ft,[vt,n("div",null,[n("p",pt,C(l.order.user_name)+" "+C(l.order.user_surname||"-"),1),n("p",ht,C(l.order.user_email),1),n("p",gt,C(l.order.user_phone),1),n("p",yt,[M(C(l.order.country)+" ",1),l.order.user_zip?(_(),p("span",kt," - "+C(l.order.user_zip),1)):F("",!0)])])]),n("div",bt,[xt,n("div",null,[n("p",wt,C(e.selectedLocation),1),n("p",Ct,C(l.order.course_name),1),l.order.date?(_(),p("p",Dt,C(e.formatPrettyDate(l.order.date))+" "+C(l.order.start_at),1)):F("",!0)])]),n("div",St,[Ot,n("div",null,[n("p",Tt,C(l.order.reservation_number),1),n("p",Vt,C(e.formatDataAndHourFromUnixTimestamps(l.order.created_at)),1),n("p",At,C(l.order.created_by),1),l.order.status?(_(),p("p",Ft,[a(s,{value:e.prettyPaymentStatus(l.order.status),class:Y([l.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):F("",!0),l.order.status=="payed"?(_(),p("p",Lt,C(e.prettyPaymentMethod(l.order.payment_method)),1)):F("",!0),l.order.open_tickets_used&&l.order.status=="payed"?(_(),p("p",Nt,[(_(!0),p(W,null,de(l.order.open_tickets_used,d=>(_(),p("span",{key:d},[a(s,{value:d.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):F("",!0),n("p",Ut,"Codice sconto utilizzato: "+C(l.order.discount_code||"-"),1),n("p",Mt,[M(" Totale ordine: "),l.order.total?(_(),p("span",Pt,"€ "+C((+l.order.total).toFixed(2)),1)):(_(),p("span",Rt,"-"))])])]),l.order.notes?(_(),p("div",Bt,[zt,n("div",null,C(l.order.notes),1)])):F("",!0)])}const It=H(mt,[["render",Et]]),jt={props:["order","location_permalink"],setup(o,t){$(()=>{o.order&&o.order.notes&&(l.value=o.order.notes)});const l=x(),{showLoader:e,hideLoader:h}=ne(),k=G(),s=Q(),d=N(()=>s.getCurrentOrder);return{notes:l,updateOrder:async function(){const i={id:o.location_permalink,order_id:o.order.id,notes:l.value,api_version:"v2"};e(),await s.updateOrder(i).then(()=>{h(),K(k,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",d.value)}).catch(f=>{h(),P(k,f)})}}}},qt={class:"pt-5 px-2"},Ht={class:"flex align-items-center justify-content-end mt-3"};function $t(o,t,l,e,h,k){const s=b("Textarea"),d=b("Button");return _(),p("div",qt,[a(s,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=y=>e.notes=y),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),n("div",Ht,[a(d,{label:"Annulla",text:"",onClick:t[1]||(t[1]=y=>o.$emit("closeDialog",null))}),a(d,{label:"Conferma",onClick:t[2]||(t[2]=y=>e.updateOrder())})])])}const Jt=H(jt,[["render",$t]]),Gt={props:["filters"],setup(o,t){$(()=>{r.value=!0,u.value={first:0,rows:D.value.rows,sortField:null,sortOrder:null},u.value.page=0,o.filters.location_permalink&&E()});const l=Q(),e=ge(),h=N(()=>l.responseOrders),k=N(()=>l.status),s=Je(),d=N(()=>s.submitDialog),y=N(()=>l.paymentStatus),i=N(()=>l.getDeleteResponse),{showLoader:f,hideLoader:c}=ne(),w=G(),D=x(),v=x(),A=x(),U=x(),g=x(),r=x(!0),u=x(),O=x(0),j=x([]),B=x([]),te=x(!1),le=x(!1),V=x(),z=x(!1);function E(){r.value=!0;let m=new Map;for(const T in o.filters)T=="date"?ue(o.filters.date)=="Invalid DateTime"?m.set("date",we(o.filters.date)):m.set("date",ue(o.filters.date)):o.filters.location_permalink&&m.set("location_permalink",o.filters.location_permalink),T=="course"&&o.filters.course.id!="-1"&&m.set("course",o.filters.course.id),T=="hour"&&o.filters.hour!="Tutti gli orari"&&m.set("hour",o.filters.hour),T=="name"&&m.set("name",o.filters.name);setTimeout(()=>{se(m)},Math.random()*1e3+250)}const se=async function(m){await l.fetchAllOrders(m).then(()=>{r.value=!1}).catch(T=>{r.value=!1,P(w,T)})},ae=m=>{A.value.toggle(m),V.value.toggle(m)},ie=(m,T)=>m>m+T?"red":"green",re=function(m,T){T&&(A.value.note=T,A.value.toggle(m))},q=function(m){m.order&&h.value.time_slots&&h.value.time_slots.forEach((T,L)=>{T.orders.forEach((R,I)=>{R.id==m.order.id&&(h.value.time_slots[L].orders[I]=m.order,m.check_in_done!=null&&(h.value.time_slots[L].check_in_done+=m.check_in_done))})})},Te=async function(m,T){let L=[],R=!1;B.value.forEach(J=>{if(J.id==m.id){R=!0;return}});for(let J of m.tickets)L.push(J.order_item_id);const I={check_in:T,order_item_ids:L,location_permalink:o.filters.location_permalink};await l.checkInOrder(I).then(()=>{q(i.value),K(w,{message:"Check-in registrato correttamente",error:!1}),R&&ce(B.value,i.value.order)}).catch(J=>{P(w,J)})},Ve=async function(m,T){let L=[],R=!1;B.value.forEach(J=>{if(J.id==m.id){R=!0;return}});for(let J of m.tickets)L.push(J.order_item_id);const I={order_item_ids:L,no_show:T,location_permalink:o.filters.location_permalink};await l.noShowOrder(I).then(()=>{q(i.value),K(w,{message:"No-show registrato correttamente",error:!1}),R&&ce(B.value,i.value.order)}).catch(J=>{P(w,J)})},Ae=async function(m,T,L){const R={id:m,check_in:T,location_permalink:o.filters.location_permalink};await l.checkInTicket(R).then(()=>{K(w,{message:"Check-in registrato correttamente",error:!1}),q(i.value),ce(B.value,i.value.order)}).catch(I=>{P(w,I)})},Fe=async function(m,T,L){const R={id:m,no_show:T,location_permalink:o.filters.location_permalink};await l.noShowTicket(R).then(()=>{K(w,{message:"No-show registrato correttamente",error:!1}),q(i.value),ce(B.value,i.value.order)}).catch(I=>{P(w,I)})},ce=function(m,T){let L=Le(B.value,i.value.order.id);L!=-1&&B.value.splice(L,1),B.value.push(i.value.order)},Le=function(m,T){for(let L=0;L<m.length;L++)if(m[L].id===T)return L;return-1},Ne=function(m){const T={course_name:m.course_name,start_at:m.start_at,date:o.filters.date,hour:m.start_at,max_seats:m.is_free_slot?null:m.remaing_seats+""};t.emit("updateFilters",T)},Ue=function(m){te.value=!0,U.value=m},Me=function(m){q({order:m}),te.value=!1,z.value=!1},Pe=function(m){return m!=null&&m.created_by?m.created_by:""},Re=function(m,T){let L=0;if(m&&m.tickets){m.tickets.forEach(I=>{T?I.no_show&&(L+=1):I.check_in&&(L+=1)});let R=m.tickets.length;if(L!=R&&L!=0)return L+"/"+R}},Be=function(m,T){V.value.data=T,V.value.toggle(m)},ze=function(m,T){g.value=T.id;let L="Sei sicuro di voler eliminare questa prenotazione?";L+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',s.setDialog("Elimina prenotazione","Elimina","Annulla",L),s.setBtnSubmit(!1),s.setDynamicDialogVisibility(!0)},Ee=function(){if(f(),g.value){const m={id:g.value,location_permalink:o.filters.location_permalink};l.deleteOrder(m).then(()=>{c(),K(w,{message:"La prenotazione è stata eliminata correttamente",error:!1}),h.value.time_slots&&h.value.time_slots.forEach((T,L)=>{T.orders.forEach((R,I)=>{R.id==g.value&&(h.value.time_slots[L].orders.splice(I,1),i.value,h.value.time_slots[L].check_in_done+=i.value.check_in_done,h.value.time_slots[L].confirmed_seats+=i.value.confirmed_seats,h.value.time_slots[L].remaing_seats-=i.value.confirmed_seats)})})}).catch(T=>{c(),P(w,T)})}},Ie=function(m){j.value=m.data?[m.data]:[]},je=function(m){B.value=m.data?[m.data]:[]},qe=function(m){le.value=!0,v.value=m},He=function(m){z.value=!0,v.value=m},$e=function(m){const T=new Map;T.set("id",m.id),T.set("location_permalink",o.filters.location_permalink),f(),l.downloadTicket(T).then(()=>{c()}).catch(L=>{c(),P(w,L)})};return X(d,m=>{m&&Ee()}),X(o.filters,()=>{o.filters.location_permalink&&E()}),{dt:D,responseOrders:h,loading:r,totalRecords:O,lazyParams:u,currentOrder:v,status:k,expandedRows:j,expandedRows1:B,op:A,dialogStore:e,paymentList:y,visibleDialog:te,currentTimeSlot:U,visibleMenu:V,visibleDetailDialog:le,visibleNotesDialog:z,toast:w,loadLazyData:E,toggle:ae,getProgressClass:ie,showNotes:re,checkAll:Te,noShowAll:Ve,openDialog:Ne,checkInSingleTicket:Ae,noShowSingleTicket:Fe,prettyPaymentStatus:Ce,openPaymentStatusDialog:Ue,onClosePaymentStatusDialog:Me,getRowClass:Pe,printPDF:De,showLabelCheckbox:Re,confirmDeleteOrder:ze,showMenu:Be,openOrderDetailDialog:qe,openNotesDialog:He,downloadPDF:$e,handleRowToggle:Ie,handleRowToggle1:je,formatDataFromUnixTimestamps:Ye,printOrderPDF:pe}},components:{PaymentStatusDialog:ut,OrderDetailDialog:It,NotesDialog:Jt}};const Kt={class:"order-table"},Qt={class:""},Wt={style:{width:"15rem"}},Xt={class:"m-0 text-right",style:{"font-size":"12px"}},Yt={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Zt={style:{width:"15rem"}},eo={class:"m-0 text-right",style:{"font-size":"12px"}},to={key:0},oo={key:0},no=n("div",{class:"flex justify-content-center w-full"},"Check-in",-1),lo={class:"flex justify-content-center"},so={class:"flex flex-column",style:{"margin-top":"8px"}},ao={class:"text-sm",style:{"min-height":"15px"}},io=n("div",{class:"flex justify-content-center w-full"},"No-show",-1),ro={class:"flex justify-content-center"},co={class:"flex flex-column",style:{"margin-top":"8px"}},uo={class:"text-sm",style:{"min-height":"15px"}},mo=["onClick"],_o={style:{"max-width":"50rem"},class:"p-3"},fo={class:"overlay-menu"},vo=["onClick"],po=n("i",{class:"pi pi-eye mr-3"},null,-1),ho=["onClick"],go=n("i",{class:"pi pi-print mr-3"},null,-1),yo=["onClick"],ko=n("i",{class:"pi pi-download mr-3"},null,-1),bo=["onClick"],xo=n("i",{class:"pi pi-comment mr-3"},null,-1),wo=["disabled","onClick"],Co=n("i",{class:"pi pi-pencil mr-3"},null,-1),Do=["disabled","onClick"],So=n("i",{class:"pi pi-trash mr-3"},null,-1),Oo={key:0},To={key:1},Vo=n("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Ao={class:"flex justify-content-center"},Fo=n("div",{class:"flex justify-content-center w-full"},"No-show",-1),Lo={class:"flex justify-content-center"},No=n("div",{class:"flex justify-content-center w-full"},null,-1),Uo={class:"flex justify-content-center"},Mo={key:0,class:"flex mx-4"},Po=n("div",null,[n("div",{class:"p-0 m-0 flex align-items-center"},[n("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),n("span",{class:"text-sm"},"WEB")]),n("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[n("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),n("span",{class:"text-sm"},"KALATA")])],-1),Ro=[Po];function Bo(o,t,l,e,h,k){const s=b("Column"),d=b("ProgressBar"),y=b("Button"),i=b("Badge"),f=b("Checkbox"),c=b("OverlayPanel"),w=b("DataTable"),D=b("PaymentStatusDialog"),v=b("Dialog"),A=b("OrderDetailDialog"),U=b("NotesDialog"),g=Ge("tooltip");return _(),p("div",Kt,[a(w,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=r=>e.expandedRows=r),onRowExpand:e.handleRowToggle},{empty:S(()=>[M(" Nessuna prenotazione trovata. ")]),expansion:S(r=>[a(w,{value:r.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=u=>e.expandedRows1=u),rowClass:e.getRowClass,onRowExpand:e.handleRowToggle1},{empty:S(()=>[M(" Nessuna prenotazione trovata. ")]),expansion:S(u=>[a(w,{value:u.data.tickets,class:"m-4 mx-5"},{default:S(()=>[a(s,{header:"Codice biglietto",field:"code"}),a(s,{header:"Tipo biglietto",field:"type"},{body:S(({data:O})=>[a(i,{value:O.ticket_name,class:Y([O.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(s,{header:"Prezzo"},{body:S(({data:O})=>[O.ticket_price?(_(),p("span",Oo," € "+C((+O.ticket_price).toFixed(2)),1)):(_(),p("span",To,"-"))]),_:1}),a(s,null,{header:S(()=>[Vo]),body:S(({data:O})=>[n("div",Ao,[a(f,{modelValue:O.check_in,"onUpdate:modelValue":j=>O.check_in=j,binary:!0,onChange:j=>e.checkInSingleTicket(O.id,O.check_in,u.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(s,null,{header:S(()=>[Fo]),body:S(({data:O})=>[n("div",Lo,[a(f,{modelValue:O.no_show,"onUpdate:modelValue":j=>O.no_show=j,binary:!0,onChange:j=>e.noShowSingleTicket(O.id,O.no_show,u.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(s,{field:"tickets_url"},{header:S(()=>[No]),body:S(({data:O})=>[n("div",Uo,[fe(a(y,{link:"",icon:"pi pi-print",href:O.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:j=>e.printPDF(O.id,l.filters.location_permalink,e.toast)},null,8,["href","onClick"]),[[g,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:S(()=>[a(s,{header:"Codice",field:"reservation_number"}),a(s,{header:"Acquirente"},{body:S(({data:u})=>[M(C(u.user_name)+" "+C(u.user_surname)+" ",1),!u.user_name&&!u.user_surname?(_(),p("span",to,"-")):F("",!0)]),_:1}),a(s,{header:"Pagamento"},{body:S(({data:u})=>[u.status?(_(),p("span",oo,[a(i,{value:e.prettyPaymentStatus(u.status),class:Y([u.status,"px-3 border-round-lg"])},null,8,["value","class"])])):F("",!0)]),_:1}),a(s,{header:"Q.ta",field:"tickets_number"}),a(s,null,{header:S(()=>[no]),body:S(({data:u})=>[n("div",lo,[n("div",so,[a(f,{modelValue:u.check_in,"onUpdate:modelValue":O=>u.check_in=O,binary:!0,onChange:O=>e.checkAll(u,u.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),n("span",ao,C(e.showLabelCheckbox(u,!1)),1)])])]),_:1}),a(s,null,{header:S(()=>[io]),body:S(({data:u})=>[n("div",ro,[n("div",co,[a(f,{modelValue:u.no_show,"onUpdate:modelValue":O=>u.no_show=O,binary:!0,onChange:O=>e.noShowAll(u,u.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),n("span",uo,C(e.showLabelCheckbox(u,!0)),1)])])]),_:1}),a(s,{header:"Note"},{body:S(({data:u})=>[n("div",{class:"notes cursor-pointer",onClick:O=>e.showNotes(O,u.notes)},C(u.notes||"-"),9,mo),a(c,{ref:"op"},{default:S(()=>[n("div",_o,C(e.op.note),1)]),_:1},512)]),_:1}),a(s,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:S(({data:u})=>[a(y,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:O=>e.showMenu(O,u)},null,8,["onClick"]),a(c,{ref:"visibleMenu"},{default:S(()=>[n("ul",fo,[n("li",{onClick:O=>e.openOrderDetailDialog(e.visibleMenu.data)},[po,M("Dettaglio ordine ")],8,vo),n("li",{onClick:O=>e.printOrderPDF(e.visibleMenu.data,l.filters.location_permalink,e.toast)},[go,M("Stampa ")],8,ho),n("li",{onClick:O=>e.downloadPDF(e.visibleMenu.data)},[ko,M("Scarica PDF ")],8,yo),n("li",{onClick:O=>e.openNotesDialog(e.visibleMenu.data)},[xo,M("Modifica nota ")],8,bo),n("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:O=>e.openPaymentStatusDialog(e.visibleMenu.data)},[Co,M("Cambia stato ")],8,wo),n("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:O=>e.confirmDeleteOrder(O,e.visibleMenu.data)},[So,M("Elimina ")],8,Do)])]),_:2},1536)]),_:1}),a(s,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),r.data.orders&&r.data.orders.length>0?(_(),p("div",Mo,Ro)):F("",!0)]),default:S(()=>[a(s,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(s,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:S(({data:r})=>[n("div",Qt,[n("span",{class:Y(r.is_free_slot?"free":"")},C(r.start_at),3)])]),_:1},512),a(s,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:S(({data:r})=>[n("div",Wt,[n("p",Xt,[M(C(r.confirmed_seats)+"/"+C(r.remaing_seats+r.confirmed_seats)+" ",1),r.confirmed_seats>r.remaing_seats+r.confirmed_seats?fe((_(),p("i",Yt,null,512)),[[g,r.confirmed_seats-(r.remaing_seats+r.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):F("",!0)]),a(d,{value:r.confirmed_seats*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:Y(["available-progress",e.getProgressClass(r.confirmed_seats,r.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(s,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:S(({data:r})=>[n("div",Zt,[n("p",eo,C(r.check_in_done)+"/"+C(r.confirmed_seats),1),a(d,{value:r.check_in_done*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(s,null,{body:S(({data:r})=>[fe(a(y,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:u=>e.openDialog(r)},null,8,["onClick"]),[[g,"Prenota",void 0,{top:!0}]])]),_:1}),a(s,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),a(v,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=r=>e.visibleDialog=r),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:S(()=>[a(D,{location_permalink:l.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=r=>e.onClosePaymentStatusDialog(r))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),a(v,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=r=>e.visibleDetailDialog=r),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:S(()=>[a(A,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),a(v,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=r=>e.visibleNotesDialog=r),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:S(()=>[a(U,{order:e.currentOrder,location_permalink:l.filters.location_permalink,onCloseDialog:t[5]||(t[5]=r=>e.onClosePaymentStatusDialog(r))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const zo=H(Gt,[["render",Bo]]),Eo={props:["filters"],setup(o,t){$(()=>{w(),l.value=o.filters,l.value.date=new Date,A()});const l=x({}),e=oe(),h=Q(),k=G(),s=x([]),d=x(),y=Z.now().plus({months:5}).endOf("month"),i=N(()=>e.allLocations),f=N(()=>h.getCalendar),c=async function(r){await h.fetchCalendar(r).then(()=>{}).catch(u=>{P(k,u)})},w=async function(){await e.fetchAllLocations().then(()=>{}).catch(r=>{P(k,r)})},D=function(){if(o.filters.location_permalink){const r=i.value.find(u=>u.permalink===o.filters.location_permalink);s.value=r.courses}},v=function(r){let u={};u.month=Z.fromJSDate(new Date(r)).month,u.year=Z.fromJSDate(new Date(r)).year,u.location_permalink=o.filters.location_permalink,d.value={month:u.month,year:u.year},c(u)},A=function(){let r=Z.now(),u={location_permalink:"",month:"",year:""};u.location_permalink=o.filters.location_permalink,u.month=r.month+"",u.year=r.year+"",c(u)},U=function(r){if(f.value.web_dates&&f.value.web_dates.length!=0){let u=r.month+1;u=u<10?"0"+u:u;let O=r.day<10?"0"+r.day:r.day,j=r.year+"-"+u+"-"+O;return f.value.web_dates.find(B=>B==j)}},g=function(r){let u={location_permalink:o.filters.location_permalink,month:r.month,year:r.year};c(u)};return X(o.filters,()=>{if(d.value){let r={location_permalink:o.filters.location_permalink,month:d.value.month,year:d.value.year};c(r)}else A()}),{form:l,courses:s,maxAllowedDate:y,locations:i,calendar:f,getCourses:D,onDateChange:v,getDayFromDate:U,onMonthChange:g}}};const Io={class:"flex calendar-filter"},jo={key:0,class:"special-day"};function qo(o,t,l,e,h,k){const s=b("Calendar");return _(),p("div",Io,[a(s,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.date=d),inline:"",onDateSelect:t[1]||(t[1]=d=>e.onDateChange(d)),onMonthChange:t[2]||(t[2]=d=>e.onMonthChange(d)),maxDate:e.maxAllowedDate.toJSDate()},{date:S(d=>[e.getDayFromDate(d.date)?(_(),p("div",jo,[n("span",null,C(d.date.day),1)])):(_(),p(W,{key:1},[M(C(d.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const Ho=H(Eo,[["render",qo]]);class $o{static async fetchAll(t){const l=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${l}/search/courses`,t)).data}}const Oe=me({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await $o.fetchAll(o).then(t=>this.response_courses=t)}}}),Jo={props:["filters"],setup(o,t){$(()=>{l.value=Object.assign({},o.filters),l.value.date=Z.now().toFormat("dd/MM/yyyy"),s.value=Se(8,20),s.value.unshift("Tutti gli orari"),l.value.hour="Tutti gli orari"});const l=x({}),e=x([]),h=oe(),k=G(),s=x([]),d=Q(),y=Oe(),i=N(()=>h.allLocations),f=N(()=>d.responseOrders),c=N(()=>y.allCourses),w=function(){l.value.name=null,l.value.course=e.value[0].name,l.value.hour=s.value[0],t.emit("onSubmit",l.value)},D=async function(){const v={location_permalink:l.value.location_permalink,api_version:"v2"};await y.fetchAllCourses(v).then(()=>{}).catch(A=>{P(k,A)})};return X(i,()=>{o.filters.location_permalink&&i.value&&(l.value=Object.assign({},o.filters),l.value.hour||(l.value.hour="Tutti gli orari"),D())}),X(o.filters,()=>{o.filters.location_permalink&&i.value&&l.value.location_permalink&&l.value.location_permalink!=o.filters.location_permalink&&(l.value=Object.assign({},o.filters),l.value.hour||(l.value.hour="Tutti gli orari"))}),X(c,()=>{var v;e.value=Object.assign([],c.value),e.value&&((v=e.value[0])==null?void 0:v.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),l.value.course=e.value[0].name}),{form:l,courses:e,hours:s,locations:i,responseOrders:f,resetField:w}}},Go={class:"formgrid grid px-0 align-items-center"},Ko={key:0,class:"field col-4 flex flex-column"},Qo=n("label",{for:"typology"},"Filtra per percorso",-1),Wo={key:1,class:"field col-3 flex flex-column"},Xo=n("label",{for:"typology"},"Filtra per orario (dalle)",-1),Yo=n("div",{class:"col-12"},null,-1),Zo={class:"field col-4 flex flex-column"},en=n("label",{for:"typology"},"Filtra per nome acquirente",-1),tn={class:"flex col-12 justify-content-end pt-1"};function on(o,t,l,e,h,k){const s=b("Dropdown"),d=b("InputText"),y=b("Button"),i=b("AccordionTab"),f=b("Accordion");return _(),ee(f,{activeIndex:0},{default:S(()=>[a(i,{header:"FILTRI"},{default:S(()=>[n("div",Go,[e.form.location_permalink?(_(),p("div",Ko,[Qo,a(s,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.course=c),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):F("",!0),e.responseOrders?(_(),p("div",Wo,[Xo,a(s,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=c=>e.form.hour=c),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):F("",!0),Yo,n("div",Zo,[en,a(d,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=c=>e.form.name=c),placeholder:""},null,8,["modelValue"])])]),n("div",tn,[a(y,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=c=>o.$emit("onSubmit",e.form))}),a(y,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=c=>e.resetField())})])]),_:1})]),_:1})}const nn=H(Jo,[["render",on]]),ln={props:["form","price","index","ticket"],setup(o,t){const l=x(0),e=function(){l.value++,k()},h=function(){l.value>0&&l.value--,k()},k=function(){l.value==null&&(l.value=0);const s={counter:l.value,price:o.price,index:o.index,ticket:o.ticket};t.emit("changeCounter",s)};return{counter:l,decrement:h,increment:e,emitEvent:k}}};const sn={class:"btn-plus-min flex align-items-center"},an={class:"counter"};function rn(o,t,l,e,h,k){const s=b("Button"),d=b("InputNumber");return _(),p("div",sn,[a(s,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),n("div",an,[a(d,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=y=>e.counter=y),t[1]||(t[1]=y=>e.emitEvent())],min:0},null,8,["modelValue"])]),a(s,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const cn=H(ln,[["render",rn]]),dn={props:["tickets","form"],setup(o,t){$(()=>{h.value=!1,s.discount={},k.value=null,o.form.max_seats&&o.form.max_seats<0?(i.value=!0,f.value=-o.form.max_seats):i.value=!1});const l=x(0),e=x([]),h=x(!1),k=x(),s=Q(),d=G(),y=x(!1),i=x(!1),f=x(),c=N(()=>s.getDiscount),w=function(g){e.value[g.index]={partial_total:g.price*g.counter,ticket:g.ticket,quantity:g.counter},l.value=0;let r=0;e.value.forEach(u=>{l.value+=u.partial_total,r+=u.quantity}),i.value||(o.form.max_seats&&r>+o.form.max_seats?(f.value=r-+o.form.max_seats,y.value=!0):(f.value=null,y.value=!1)),k.value&&v()},D=function(){v()},v=async function(){let g=[];e.value.forEach(u=>{g.push({id:u.ticket.id,quantity:u.quantity})});const r={discount_code:k.value,location_permalink:o.form.location_permalink,tickets:g};await s.cost(r).then(()=>{}).catch(u=>{P(d,u)})};return{total:l,partialTotals:e,showDiscount:h,discountCode:k,discount:c,showAlert:y,showAlert2:i,numOverbooking:f,onChangeCounter:w,applyDiscount:D,checkDisabled:function(){let g=!1;(!e.value||e.value.length==0)&&(g=!0);let r=0;return e.value.forEach(u=>{r+=u.quantity}),r==0&&(g=!0),t.emit("disableSecondoTab",!0),g},nextTab:function(){const g={discount_code:k.value,partial_total:e.value};t.emit("nextTab",g)}}},components:{PlusMinusButton:cn}};const un={key:0},mn={key:1},_n={key:0},fn={key:1},vn={key:0,class:"flex justify-content-between align-items-center"},pn={class:"flex align-items-center col-9"},hn={class:"col-7 pl-0"},gn={class:"text-right col-2"},yn={class:"col-3 flex justify-content-end"},kn={key:2,class:"mt-3 mb-5"},bn=n("i",null,"Nessuna tipologia di biglietto trovata.",-1),xn=[bn],wn=n("hr",{class:"mt-3"},null,-1),Cn={class:"flex align-items-center justify-content-between py-0"},Dn={class:"col-9 flex"},Sn=n("b",null,"Totale",-1),On=[Sn],Tn={class:"col-2 text-right font-bold"},Vn={class:"col-3 flex justify-content-end"};function An(o,t,l,e,h,k){const s=b("Message"),d=b("PlusMinusButton"),y=b("Button");return _(),p(W,null,[e.showAlert?(_(),ee(s,{key:0,severity:"warn",closable:!1},{default:S(()=>[M("Attenzione! Si sta andando in overbooking di "+C(e.numOverbooking)+" ",1),e.numOverbooking==1?(_(),p("span",un,"posto")):(_(),p("span",mn,"posti"))]),_:1})):F("",!0),e.showAlert2?(_(),ee(s,{key:1,severity:"warn",closable:!1},{default:S(()=>[M("Attenzione! Lo slot orario è già in overbooking di "+C(e.numOverbooking)+" ",1),e.numOverbooking==1?(_(),p("span",_n,"posto")):(_(),p("span",fn,"posti"))]),_:1})):F("",!0),(_(!0),p(W,null,de(l.tickets,(i,f)=>{var c,w,D;return _(),p("div",{key:i.id},[((c=i.course)==null?void 0:c.id)==((w=l.form.course)==null?void 0:w.id)?(_(),p("div",vn,[n("div",pn,[n("b",hn,C(i.name),1),n("div",gn,"€ "+C((D=i.price)==null?void 0:D.toFixed(2)),1)]),n("div",yn,[a(d,{onChangeCounter:t[0]||(t[0]=v=>e.onChangeCounter(v)),price:i.price,index:f,ticket:i},null,8,["price","index","ticket"])])])):F("",!0)])}),128)),l.tickets&&l.tickets.length==0?(_(),p("div",kn,xn)):F("",!0),wn,n("div",Cn,[n("div",Dn,[n("div",{class:Y(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-7"])},On,2),n("div",Tn,"€ "+C(e.total.toFixed(2)),1)]),n("div",Vn,[a(y,{label:"Prosegui",onClick:t[1]||(t[1]=i=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Fn=H(dn,[["render",An]]);class Ln{static async fetchAll(){return(await be("/countries")).data.countries}}const Nn=me({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Ln.fetchAll().then(o=>this.countries=o)}}});class Un{static async fetchAll(){return(await be("/provinces")).data.provinces}}const Mn=me({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await Un.fetchAll().then(o=>this.provinces=o)}}}),Pn={props:["location_permalink"],setup(o,t){$(()=>{D(),v()});const l=_e(),e=Nn(),h=Q(),k=Mn(),s=x({}),d=x(),y=N(()=>e.allCountries),i=N(()=>l.allOpenTickets),f=N(()=>h.paymentStatus),c=N(()=>h.paymentModeList),w=N(()=>k.allProvinces),D=async function(){await e.fetchAllCountries().then(()=>{s.value.country_id=88,s.value.status={id:"payed",name:"Pagato"}})},v=async function(){await k.fetchAllProvinces()};return{form:s,countries:y,paymentList:f,paymentModeList:c,errorMessage:d,open_tickets:i,provinces:w,fetchAllOpenTickets:async function(r){const u={code:r.query.toUpperCase(),location_permalink:o.location_permalink};await l.fetchAllOpenTickets(u)},onChangeStatus:function(){s.value.status.id&&(s.value.status.id=="free"||s.value.status.id=="to_pay")&&(s.value.payment_method=null)},onConfirm:function(){if(s.value.status&&s.value.status.id=="payed"&&!s.value.payment_method){d.value="Seleziona un metodo di pagamento";return}t.emit("nextTab",s.value)}}}},Rn={key:0,class:"formgrid grid"},Bn={class:"field col-6"},zn=n("label",{for:"user_name"},"Nome",-1),En={class:"field col-6"},In=n("label",{for:"user_surname"},"Cognome",-1),jn={class:"field col-6"},qn=n("label",{for:"user_email"},"Email",-1),Hn={class:"field col-6"},$n=n("label",{for:"user_phone"},"Telefono",-1),Jn={class:"field col-6"},Gn=n("label",{for:"country_id"},"Nazione",-1),Kn={class:"field col-6"},Qn=n("label",{for:"province"},"Provincia",-1),Wn={class:"field col-6"},Xn=n("label",{for:"status"},"Stato pagamento",-1),Yn={class:"field col-6"},Zn={for:"payment_method"},el={key:0},tl={class:"p-float-label"},ol={class:"p-error",id:"dd-error"},nl={key:0,class:"field col-6 flex flex-column"},ll=n("label",{for:"user_zip"},"Codice biglietto",-1),sl={class:"field col-12"},al={class:"field flex flex-column"},il=n("label",{for:"notes"},"Note",-1),rl={class:"col-12 flex justify-content-end"};function cl(o,t,l,e,h,k){const s=b("InputText"),d=b("Dropdown"),y=b("AutoComplete"),i=b("Textarea"),f=b("Button");return e.form?(_(),p("div",Rn,[n("div",Bn,[zn,a(s,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.user_name=c),class:"w-full"},null,8,["modelValue"])]),n("div",En,[In,a(s,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=c=>e.form.user_surname=c),class:"w-full"},null,8,["modelValue"])]),n("div",jn,[qn,a(s,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=c=>e.form.user_email=c),class:"w-full"},null,8,["modelValue"])]),n("div",Hn,[$n,a(s,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=c=>e.form.user_phone=c),class:"w-full"},null,8,["modelValue"])]),n("div",Jn,[Gn,a(d,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=c=>e.form.country_id=c),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),n("div",Kn,[Qn,a(d,{modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=c=>e.form.user_zip=c),options:e.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),n("div",Wn,[Xn,a(d,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=c=>e.form.status=c),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=c=>e.onChangeStatus())},null,8,["modelValue","options"])]),n("div",Yn,[n("label",Zn,[M("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(_(),p("span",el,"*")):F("",!0)]),n("span",tl,[a(d,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=c=>e.form.payment_method=c),options:e.paymentModeList,optionLabel:"label",class:Y(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=c=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),n("small",ol,C(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.label=="Biglietto a data aperta (voucher)"?(_(),p("div",nl,[ll,a(y,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=c=>e.form.open_ticket_codes=c),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[11]||(t[11]=c=>e.fetchAllOpenTickets(c)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):F("",!0),n("div",sl,[n("div",al,[il,a(i,{modelValue:e.form.notes,"onUpdate:modelValue":t[12]||(t[12]=c=>e.form.notes=c),rows:"5",cols:"30"},null,8,["modelValue"])])]),n("div",rl,[a(f,{label:"Conferma",onClick:t[13]||(t[13]=c=>e.onConfirm())})])])):F("",!0)}const dl=H(Pn,[["render",cl]]);var ul=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,ml={root:function(t){var l=t.instance;return["p-contextmenu p-component",{"p-input-filled":l.$primevue.config.inputStyle==="filled","p-ripple-disabled":l.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var l=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":l.isItemActive(e),"p-focus":l.isItemFocused(e),"p-disabled":l.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var l=t.props,e=t.isActive,h=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":l.exact&&h}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Ke.extend({name:"contextmenu",css:ul,classes:ml});const _l={props:["form"],setup(o,t){$(()=>{A()});const l=x(0),e=x([]),h=x(!1),k=x(!0),s=x(),d=x([]),{showLoader:y,hideLoader:i}=ne(),f=_e(),c=Q(),w=G(),D=N(()=>f.allTickets),v=N(()=>c.getCurrentOrder),A=async function(){const V={location_permalink:o.form.location_permalink,api_version:"v2",date:g(o.form.date),course_id:o.form.course.id};await f.fetchAllTickets(V).then(()=>{}).catch(z=>{P(w,z)})},U=function(V){l.value+=1,s.value=V.discount_code,e.value=Object.assign([],V.partial_total),k.value=!1},g=function(V){return ue(V).includes("Invalid")?we(V):ue(V)},r=function(V){u(V)},u=async function(V){var ae,ie,re;const z=[{start_at:o.form.hour,tickets:[]}];e.value.forEach(q=>{q.quantity!=0&&z[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let E=[];V.open_ticket_codes&&V.open_ticket_codes.forEach(q=>{E.push(q.code)});const se={location_permalink:o.form.location_permalink,country_id:V.country_id,status:V.status.id,user_email:V.user_email,user_name:V.user_name,user_phone:V.user_phone,user_surname:V.user_surname,user_zip:V.user_zip,api_version:"v2",date:o.form.date?g(o.form.date):"",notes:V.notes,time_slots:z,payment_method:(ae=V.payment_method)==null?void 0:ae.id,course_id:(re=(ie=o.form)==null?void 0:ie.course)==null?void 0:re.id,open_ticket_codes:E};s.value&&(se.discount_code=s.value),await c.createOrder(se).then(()=>{l.value+=1,k.value=!0,h.value=!0}).catch(q=>{P(w,q)})},O=function(){pe(v==null?void 0:v.value,o.form.location_permalink,w),t.emit("closeDialog",!0)},j=function(V){k.value=V},B=function(){pe(v==null?void 0:v.value,o.form.location_permalink,w),te()},te=async function(){let V=[];if(!v.value&&!o.form.location_permalink)return;for(let E of v.value.tickets)V.push(E.order_item_id);const z={check_in:!0,order_item_ids:V,location_permalink:o.form.location_permalink};await c.checkInOrder(z).then(()=>{K(w,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(E=>{P(w,E)})},le=function(){y();const V={location_permalink:o.form.location_permalink,order_id:v.value.id};c.sendEmail(V).then(()=>{K(w,{message:"Email inviata correttamente al cliente",error:!1}),i(),t.emit("closeDialog",!0)}).catch(z=>{i(),P(w,z)})};return X(v,()=>{d.value=[],v.value.tickets.forEach(V=>{const z=d.value.find(E=>E.ticket_name===V.ticket_name);if(!z)V.quantity=1,d.value.push(V);else{let E=d.value.indexOf(z);d.value[E].quantity+=1}})}),{tickets:D,active:l,partialTotals:e,showOrderDetail:h,currentOrder:v,tmp_tickets:d,showSecondTab:k,formatExplicitDate:xe,formatDate:he,onNextTab:U,onConfirmPayment:r,printPDF:De,onPrintPDF:O,onDisableSecondoTab:j,printAndCheckIn:B,sendEmail:le}},components:{NewOrderTicketTab:Fn,NewOrderFormTab:dl}};const fl={key:0,class:"info-box"},vl={class:"font-medium"},pl=n("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),hl={class:"font-medium"},gl=n("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),yl={key:0,class:"capitalize"},kl={key:0,class:"flex pb-4"},bl=n("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),xl={class:"flex flex-column"},wl={key:0,class:"pb-1 pr-1"},Cl={key:1,class:"pb-1"},Dl={class:"py-5"},Sl={class:"m-0 text-center line-height-3"},Ol=n("br",null,null,-1),Tl={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Vl=n("p",{class:"my-2"},[n("b",null,"Riepilogo ordine:")],-1),Al={class:"flex flex-column col-12"},Fl={key:0,class:"pb-1",style:{"min-width":"8rem"}},Ll={key:1,class:"pb-1"},Nl={key:2},Ul={class:"flex flex-column col-12"},Ml={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Pl=n("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),Rl={class:"pb-1"},Bl={class:"flex align-items-center justify-content-center mt-4"};function zl(o,t,l,e,h,k){var c,w;const s=b("NewOrderTicketTab"),d=b("TabPanel"),y=b("NewOrderFormTab"),i=b("Button"),f=b("TabView");return _(),p(W,null,[l.form?(_(),p("div",fl,[n("p",vl,[pl,M(C((c=l.form.course)==null?void 0:c.name),1)]),n("p",hl,[gl,l.form.date?(_(),p("span",yl,C(e.formatDate((w=l.form)==null?void 0:w.date)),1)):F("",!0),M(" - "+C(l.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(_(),p("div",kl,[bl,n("div",xl,[(_(!0),p(W,null,de(e.partialTotals,D=>{var v;return _(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:D},[D&&D.quantity!=0?(_(),p("span",wl,C((v=D.ticket)==null?void 0:v.name),1)):F("",!0),D&&D.quantity!=0?(_(),p("span",Cl," x "+C(D.quantity)+" "+C(D.price),1)):F("",!0)])}),128))])])):F("",!0)])):F("",!0),a(f,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=D=>e.active=D)},{default:S(()=>[a(d,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:S(()=>[a(s,{tickets:e.tickets,form:l.form,onNextTab:t[0]||(t[0]=D=>e.onNextTab(D)),onDisableSecondoTab:t[1]||(t[1]=D=>e.onDisableSecondoTab(D))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(d,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:S(()=>[a(y,{onNextTab:t[2]||(t[2]=D=>e.onConfirmPayment(D)),location_permalink:l.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(_(),ee(d,{key:0,header:"Ordine completato"},{default:S(()=>{var D,v;return[n("div",Dl,[n("div",Sl,[M(" Ordine "),n("b",null,C(e.currentOrder.reservation_number),1),M(" registrato correttamente!"),Ol]),e.currentOrder?(_(),p("div",Tl,[Vl,n("div",Al,[(_(!0),p(W,null,de(e.tmp_tickets,A=>(_(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:A},[A&&A.quantity!=0?(_(),p("span",Fl,C(A.ticket_name),1)):F("",!0),A&&A.quantity!=0?(_(),p("span",Ll," x "+C(A.quantity),1)):F("",!0),A.ticket_price?(_(),p("span",Nl," € "+C((+A.ticket_price).toFixed(2)),1)):F("",!0)]))),128))]),n("div",Ul,[e.currentOrder.total?(_(),p("p",Ml,[Pl,n("span",Rl,[n("b",null,"€ "+C((+((D=e.currentOrder)==null?void 0:D.total)).toFixed(2)),1)])])):F("",!0)])])):F("",!0),n("div",Bl,[a(i,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[3]||(t[3]=A=>e.sendEmail()),disable:!((v=e.currentOrder)!=null&&v.user_email)},null,8,["disable"]),a(i,{icon:"pi pi-print",onClick:t[4]||(t[4]=A=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),a(i,{icon:"pi print-check-icon",onClick:t[5]||(t[5]=A=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):F("",!0)]),_:1},8,["activeIndex"])],64)}const El=H(_l,[["render",zl]]),Il={props:["filters","date"],setup(o,t){$(()=>{k.value=Se(8,20),l.value=Object.assign({},o.filters)});const l=x({}),e=Oe(),h=G(),k=x(),s=x(!1),d=ge(),y=x(!1),i=N(()=>e.allCourses),f=N(()=>d.showNewOrderDialog),c=async function(){const A={location_permalink:o.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(A).then(()=>{}).catch(U=>{P(h,U)})},w=function(){d.setNewOrderDialogVisibility(!1),l.value.hour="",l.value.course=null,t.emit("onCloseDialog")},D=function(A){l.value.date=o.date,d.setNewOrderDialogVisibility(A)},v=function(){y.value=l.value.open_ticket};return X(o.filters,()=>{if(c(),l.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let A=i.value.find(U=>U.name===o.filters.course.name);A&&(l.value.course=A)}}),{courses:i,form:l,hours:k,disableForm:y,visible:s,onCloseDialog:w,updateDialog:D,onChecked:v,dialogVisible:f,dialogStore:d}},components:{NewOrderDialog:El}},jl=n("h2",{class:"mt-1"},"Nuova prenotazione",-1),ql={class:"formgrid grid px-0 align-items-center mt-4"},Hl={key:0,class:"field flex flex-column w-full col-12"},$l=n("label",{for:"typology"},"Scegli il percorso",-1),Jl={key:1,class:"field flex flex-column w-full col-12"},Gl=n("label",{for:"typology"},"Seleziona l'orario",-1),Kl={class:"flex justify-content-end align-items-center mt-2"},Ql={class:"flex align-items-center justify-content-between w-full"},Wl=n("h2",null,"Nuova prenotazione",-1);function Xl(o,t,l,e,h,k){const s=b("Dropdown"),d=b("Button"),y=b("NewOrderDialog"),i=b("Dialog"),f=b("Card");return _(),ee(f,{class:"mt-4"},{content:S(()=>[jl,n("div",ql,[l.filters.location_permalink?(_(),p("div",Hl,[$l,a(s,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.course=c),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):F("",!0),l.filters.location_permalink?(_(),p("div",Jl,[Gl,a(s,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=c=>e.form.hour=c),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):F("",!0)]),n("div",Kl,[a(d,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=c=>e.updateDialog(!0))},null,8,["disabled"])]),a(i,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=c=>e.dialogVisible=c),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=c=>e.onCloseDialog())},{header:S(()=>[n("div",Ql,[Wl,a(d,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=c=>e.updateDialog(!1))})])]),default:S(()=>[a(y,{form:e.form,onCloseDialog:t[4]||(t[4]=c=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const Yl=H(Il,[["render",Xl]]),Zl={props:["location_permalink"],setup(o,t){$(()=>{e.value.start_date=Z.local().startOf("day").toFormat("dd/MM/yyyy HH:mm"),e.value.end_date=Z.local().endOf("day").toFormat("dd/MM/yyyy HH:mm"),e.value.created_at="true"});const l=G(),e=x({}),h=oe(),{showLoader:k,hideLoader:s}=ne(),d=function(){const i={from:ye(e.value.start_date),to:ye(e.value.end_date),location_permalink:o.location_permalink,created_at:e.value.created_at};y(i)},y=async function(i){k(),await h.downloadReport(i).then(()=>{s(),t.emit("onSubmit")}).catch(f=>{s(),P(l,f)})};return{form:e,onSubmit:d}},components:{Form:et}},es={class:"formgrid grid mt-3"},ts={class:"field col-6 flex flex-column"},os=n("label",{from:"start_date"},"Dal",-1),ns={class:"field col-6 flex flex-column"},ls=n("label",{from:"end_date"},"Al",-1),ss={class:"flex flex-wrap gap-3 mt-3"},as={class:"flex align-items-center"},is=n("label",{for:"vendite",class:"ml-2"},"Report vendite",-1),rs={class:"flex align-items-center"},cs=n("label",{for:"prenotazioni",class:"ml-2"},"Report prenotazioni",-1),ds={class:"flex align-items-center justify-content-end mt-6"};function us(o,t,l,e,h,k){const s=b("Calendar"),d=b("RadioButton"),y=b("Button"),i=b("Form");return _(),ee(i,{onSubmit:e.onSubmit},{default:S(()=>[n("div",es,[n("div",ts,[os,a(s,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=f=>e.form.start_date=f),dateFormat:"dd/mm/yy",manualInput:!0,showTime:"",hourFormat:"24"},null,8,["modelValue"])]),n("div",ns,[ls,a(s,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[1]||(t[1]=f=>e.form.end_date=f),dateFormat:"dd/mm/yy",manualInput:!0,showTime:"",hourFormat:"24"},null,8,["modelValue"])])]),n("div",ss,[n("div",as,[a(d,{modelValue:e.form.created_at,"onUpdate:modelValue":t[2]||(t[2]=f=>e.form.created_at=f),inputId:"vendite",name:"vendite",value:"true"},null,8,["modelValue"]),is]),n("div",rs,[a(d,{modelValue:e.form.created_at,"onUpdate:modelValue":t[3]||(t[3]=f=>e.form.created_at=f),inputId:"prenotazioni",name:"prenotazioni",value:"false"},null,8,["modelValue"]),cs])]),n("div",ds,[a(y,{label:"Annulla",text:"",onClick:t[4]||(t[4]=f=>o.$emit("onSubmit"))}),a(y,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const ms=H(Zl,[["render",us]]),_s={setup(){$(()=>{f.value&&(o.value.location_permalink=f.value,t.value.location_permalink=f.value),c()});const o=x({}),t=x({}),l=x(),e=x(!1),h=Qe(),k=oe(),s=G(),d=ge(),y=N(()=>h.currentUser),i=N(()=>k.allLocations),f=N(()=>k.getCurrentLocation),c=async function(){await k.fetchAllLocations().then(()=>{f.value||(o.value.location_permalink=i.value[0].permalink,t.value.location_permalink=i.value[0].permalink,k.updateCurrenLocation(i.value[0].permalink))}).catch(g=>{P(s,g)})};return{filters:o,orderTable:l,order_filters:t,visibleDialog:e,user:y,locations:i,fetchAllLocations:c,formatDate:he,onUpdateFilters:function(g){g.course?o.value.course={id:g.course}:o.value.course="",g.name?o.value.name=g.name:o.value.name="",g.hour&&(g.hour.start_at?o.value.hour=g.hour.start_at:o.value.hour=g.hour)},onUpdateNewOrderFilters:function(g){g.start_at&&(t.value.hour=g.start_at),g.course_name&&(t.value.course={name:g.course_name}),g.date&&(t.value.date=g.date),g.hour&&(t.value.hour=g.hour),g.max_seats?t.value.max_seats=g.max_seats:t.value.max_seats=null,d.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){l.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=o.value.location_permalink,k.updateCurrenLocation(o.value.location_permalink)},onCloseReportDialog:function(){e.value=!1}}},components:{CalendarFilter:Ho,OrderTable:zo,OrderFilter:nn,NewOrderCard:Yl,SalesReportsDialog:ms}};const fs={class:"flex justify-content-between align-items-center"},vs={class:"field flex flex-column mt-3"},ps={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},hs=n("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),gs={class:"capitalize text-xl"},ys={class:"flex gap-4"},ks={key:0,class:"col-3 mt-3"},bs={class:"col-9 mt-3"};function xs(o,t,l,e,h,k){const s=b("Dropdown"),d=b("Button"),y=b("SalesReportsDialog"),i=b("Dialog"),f=b("CalendarFilter"),c=b("NewOrderCard"),w=b("OrderFilter"),D=b("OrderTable");return _(),p("div",null,[n("div",fs,[n("div",vs,[a(s,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":t[0]||(t[0]=v=>e.filters.location_permalink=v),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location",onChange:t[1]||(t[1]=v=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(_(),p("div",ps,[n("div",null,[hs,n("span",gs,C(e.formatDate(e.filters.date)),1)]),a(d,{label:"Report vendite",link:"",class:"m-0 p-0 underline",onClick:t[2]||(t[2]=v=>e.visibleDialog=!0)}),a(i,{visible:e.visibleDialog,"onUpdate:visible":t[4]||(t[4]=v=>e.visibleDialog=v),modal:"",header:"Report vendite",style:{width:"35rem"}},{default:S(()=>[a(y,{onOnSubmit:t[3]||(t[3]=v=>e.onCloseReportDialog()),location_permalink:e.filters.location_permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):F("",!0)]),n("div",ys,[e.filters.location_permalink?(_(),p("div",ks,[a(f,{filters:e.filters},null,8,["filters"]),a(c,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[5]||(t[5]=v=>e.onCloseDialog())},null,8,["date","filters"])])):F("",!0),n("div",bs,[a(w,{filters:e.filters,onOnSubmit:t[6]||(t[6]=v=>e.onUpdateFilters(v))},null,8,["filters"]),e.filters.date?(_(),ee(D,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[7]||(t[7]=v=>e.onUpdateNewOrderFilters(v))},null,8,["filters"])):F("",!0)])])])}const Os=H(_s,[["render",xs]]);export{Os as default};
