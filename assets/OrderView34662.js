import{I as j,J as H,K as _e,L as fe,M as $,o as z,c as F,N as pe,a as I,x as y,i as U,_ as P,r as _,O as he,b,e as x,f as l,w as g,h as A,n as X,g as s,t as T,P as K,Q as E,R as q,S as N,T as te,u as ve}from"../index34662.js";import{D as L,f as ye,e as B,s as ge,p as oe,g as ke}from"./helpers34662.js";const be=function(t){return L.fromJSDate(new Date(t)).toFormat("yyyy-LL-dd")},ee=function(t){return L.fromFormat(t+"","dd/MM/yyyy").toFormat("yyyy-LL-dd")},we=function(t){return L.fromSeconds(t).toFormat("dd/MM/yyyy")},Y=function(t){const e=L.fromJSDate(new Date(t)),n=e.setLocale("it").toFormat("cccc"),o=e.toFormat("d"),u=e.setLocale("it").toFormat("LLLL");return`${n} ${o} ${u}`},xe=function(t){const e=L.fromFormat(t,"dd/MM/yyyy"),n=e.setLocale("it").toFormat("cccc"),o=e.toFormat("d"),u=e.setLocale("it").toFormat("LLLL");return`${n} ${o} ${u}`},ne=function(t){return Y(t).includes("Invalid DateTime")?xe(t):Y(t)};class M{static async fetchAll(e){const n=new Map(e),o=n.get("location_permalink");return n.delete("location_permalink"),n.delete("name"),n.delete("course"),n.set("api_version","v2"),(await j(`/ticket_office/${o}/orders`,n)).data}static async calendar(e){const n=e.location_permalink;return delete e.location_peramlink,e.api_version="v2",(await H(`/ticket_office/${n}/search/calendar`,e)).data}static async cost(e){return(await H("/cart/cost",e)).data}static async getOrderDetail(e){return(await j(`/orders/${e}`)).data.order}static async createOrder(e){const n=e.get("location_permalink");return e.delete("location_permalink"),(await _e(`/ticket_office/${n}/orders`,e)).data.order}static async deleteOrder(e){return(await fe(`/orders/${e}`)).data}static async updateOrder(e){return(await H(`/orders/${e.id}/update`,e.formData)).data.order}}const J=$({id:"order",state:()=>({order:{},orders:[],response_orders:{},total_orders:Number,calendar:{},discount:{}}),getters:{allOrders:t=>t.response_orders.orders,responseOrders:t=>t.response_orders,getTotalOrders:t=>t.response_orders?t.response_orders.total:0,getCurrentOrder:t=>t.order,status:()=>[{name:"Attivo",value:"true"},{name:"Disattivo",value:"false"}],getCalendar:t=>t.calendar,getDiscount:t=>t.discount},actions:{async fetchAllOrders(t){await M.fetchAll(t).then(e=>this.response_orders=this.filterOrder(e,t))},filterOrder(t,e){if(e.get("course")&&e.get("course")!="Tutti i percorsi"&&(t.time_slots=t.time_slots.filter(n=>n.course_name==e.get("course"))),e.get("hour")&&(t.time_slots=ye(e.get("hour"),t.time_slots)),e.get("name")&&e.get("name")!=null){const n={time_slots:[]};return t.time_slots&&t.time_slots.forEach(o=>{let u=!1;o.orders.forEach(m=>{(m.user_name.trim().toLowerCase()===e.get("name").trim().toLowerCase()||m.user_surname.trim().toLowerCase()===e.get("name").trim().toLowerCase())&&(u=!0)}),u&&n.time_slots.push(o)}),n}return t},async fetchOrderDetail(t){await M.getOrderDetail(t).then(e=>this.order=e)},async fetchCalendar(t){await M.calendar(t).then(e=>this.calendar=e)},async createOrder(t){await M.createOrder(t).then(e=>this.order=e)},async cost(t){await M.cost(t).then(e=>this.discount=e)},async updateOrder(t){await M.updateOrder(t).then(e=>this.order=e)},async deleteOrder(t){await M.deleteOrder(t).then(e=>this.order=e)}}}),se=$({id:"newOrderDialog",state:()=>({_showNewOrderDialog:!1}),getters:{showNewOrderDialog:t=>t._showNewOrderDialog},actions:{setNewOrderDialogVisibility(t){this.updateNewOrderDialog(t)},updateNewOrderDialog(t){this._showNewOrderDialog=t}}}),Ce={props:["filters"],setup(t,e){z(()=>{f.value=!0,w.value={first:0,rows:i.value.rows,sortField:null,sortOrder:null},w.value.page=0,t.filters.location_permalink&&R()});const n=J(),o=se(),u=F(()=>n.responseOrders),m=F(()=>n.status),a=pe(),c=F(()=>a.submitDialog),h=F(()=>a.cancelDialog),d=I(),i=y(),r=y(),p=y(),O=y([{code:"2023795703",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!0},{code:"2023795704",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795705",type:"Biglietto ridotto",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795706",type:"Biglietto gratuito",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1}]),S=y(["Da pagare","Pagato","Gratuito"]),f=y(!0),w=y(),D=y(0),k=y([]),C=y([]);function R(){f.value=!0;let v=new Map;for(const V in t.filters)V=="date"?ee(t.filters.date)=="Invalid DateTime"?v.set("date",be(t.filters.date)):v.set("date",ee(t.filters.date)):t.filters.location_permalink&&v.set("location_permalink",t.filters.location_permalink),V=="course"&&t.filters.course.id!="-1"&&v.set("course",t.filters.course.id),V=="hour"&&t.filters.hour!="Tutti gli orari"&&v.set("hour",t.filters.hour),V=="name"&&v.set("name",t.filters.name);setTimeout(()=>{G(v)},Math.random()*1e3+250)}const G=async function(v){await n.fetchAllOrders(v).then(()=>{f.value=!1}).catch(V=>{f.value=!1,B(d,V)})},Q=function(v){},le=function(v,V){v.stopPropagation(),v.stopImmediatePropagation(),r.value=V;let W="Sei sicuro di voler disattivare l'utente <b>"+(V==null?void 0:V.email)+"</b> ?";a.setDialog("Cambia stato","Conferma","Annulla",W),a.setDynamicDialogVisibility(!0)},ae=async function(){var V;f.value=!0;const v={order_id:r.value.id,order:{enabled:(V=r.value)==null?void 0:V.enabled}};await n.updateOrder(v).then(()=>{f.value=!1,ge(d,{message:"Stato aggiornato correttamente",error:!1}),R()}).catch(W=>{f.value=!1,B(d,W)})},ie=function(v){return v!=null&&v.cluster?v.cluster:""},re=v=>{p.value.toggle(v)},ce=(v,V)=>{if(v>=(v+V)/2)return"green";if(v<=(v+V)/3)return"red"},de=function(v,V){V&&(p.value.note=V,p.value.toggle(v))},ue=function(v){},me=function(v){const V={course_name:v.course_name,start_at:v.start_at};e.emit("updateFilters",V),o.setNewOrderDialogVisibility(!0)};return U(c,()=>{ae()}),U(h,()=>{r.value.enabled?r.value.enabled=!1:r.value.enabled=!0}),U(t.filters,()=>{t.filters.location_permalink&&R()}),{dt:i,responseOrders:u,loading:f,totalRecords:D,lazyParams:w,currentOrder:r,status:m,expandedRows:k,expandedRows1:C,op:p,tmp_tickets:O,payments:S,dialogStore:o,showSidebar:Q,loadLazyData:R,onChangeStatus:le,getRowClass:ie,toggle:re,getProgressClass:ce,showNotes:de,checkAll:ue,openDialog:me,formatDataFromUnixTimestamps:we}},components:{}};const De={class:"order-table"},Ve={style:{width:"15rem"}},Oe={class:"m-0 text-right",style:{"font-size":"12px"}},Te={style:{width:"15rem"}},Se={class:"m-0 text-right",style:{"font-size":"12px"}},Fe=["href"],Ne=s("i",{class:"pi pi-file-pdf"},null,-1),Le=[Ne],Ae=["href"],Ue=s("i",{class:"pi pi-file-pdf"},null,-1),Pe=[Ue];function Be(t,e,n,o,u,m){const a=_("Column"),c=_("ProgressBar"),h=_("Button"),d=_("Dropdown"),i=_("Checkbox"),r=_("OverlayPanel"),p=_("Badge"),O=_("DataTable"),S=he("tooltip");return b(),x("div",De,[l(O,{value:o.responseOrders.time_slots,totalRecords:o.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:"",rowClass:o.getRowClass,expandedRows:o.expandedRows,"onUpdate:expandedRows":e[1]||(e[1]=f=>o.expandedRows=f)},{empty:g(()=>[A(" Nessuna prenotazione trovata. ")]),expansion:g(f=>[l(O,{value:f.data.orders,class:"m-4 mx-4",expandedRows:o.expandedRows1,"onUpdate:expandedRows":e[0]||(e[0]=w=>o.expandedRows1=w)},{empty:g(()=>[A(" Nessuna prenotazione trovata. ")]),expansion:g(w=>[l(O,{value:o.tmp_tickets,class:"m-4 mx-5"},{default:g(()=>[l(a,{header:"Codice biglietto",field:"code"}),l(a,{header:"Tipo biglietto",field:"type"},{body:g(({data:D})=>[l(p,{value:D.type,class:X([D.type,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(a,{header:"PDF",field:"tickets_url"},{body:g(({data:D})=>[s("a",{href:D.tickets_url,target:"_blank"},Pe,8,Ae)]),_:1}),l(a,{header:"Check-in"},{body:g(({data:D})=>[s("div",null,[l(i,{modelValue:D.check_in,"onUpdate:modelValue":k=>D.check_in=k,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(a,{header:"No-show"},{body:g(({data:D})=>[s("div",null,[l(i,{modelValue:D.no_show_tickets,"onUpdate:modelValue":k=>D.no_show_tickets=k,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["value"])]),default:g(()=>[l(a,{header:"Codice",field:"code"}),l(a,{header:"Effettuato da",field:"created_by"}),l(a,{header:"Acquirente"},{body:g(({data:w})=>[A(T(w.user_name)+" "+T(w.user_surname),1)]),_:1}),l(a,{header:"Q.ta",field:"quantity"}),l(a,{header:"Pdf",field:"pdf"},{body:g(({data:w})=>[s("a",{href:w.tickets_url,target:"_blank"},Le,8,Fe)]),_:1}),l(a,{header:"Pagamento"},{body:g(({data:w})=>[l(d,{modelValue:w.payment,"onUpdate:modelValue":D=>w.payment=D,options:o.payments,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),l(a,{header:"Check-in"},{body:g(({data:w})=>[s("div",null,[l(i,{modelValue:w.check_in,"onUpdate:modelValue":D=>w.check_in=D,binary:!0,onClick:D=>o.checkAll(w.time_slot)},null,8,["modelValue","onUpdate:modelValue","onClick"])])]),_:1}),l(a,{header:"No-show"},{body:g(({data:w})=>[s("div",null,[l(i,{modelValue:w.no_show_tickets,"onUpdate:modelValue":D=>w.no_show_tickets=D,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(a,{header:"",style:{"padding-right":"0"}},{body:g(({data:w})=>[K(l(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-comment",text:"",rounded:"",onClick:D=>o.showNotes(D,w.notes),disabled:!w.notes},null,8,["onClick","disabled"]),[[S,"Note",void 0,{top:!0}]]),l(r,{ref:"op"},{default:g(()=>[A(T(o.op.note),1)]),_:1},512),K(l(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-trash",text:"",rounded:"",disabled:!w.can_cancel},null,8,["disabled"]),[[S,"Elimina",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:2},1032,["value","expandedRows"])]),default:g(()=>[l(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),l(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:g(({data:f})=>[s("div",Ve,[s("p",Oe,T(f.confirmed_seats)+"/"+T(f.remaing_seats+f.confirmed_seats),1),l(c,{value:f.confirmed_seats*100/(f.remaing_seats+f.confirmed_seats),showValue:!1,style:{height:"10px"},class:X(["available-progress",o.getProgressClass(f.confirmed_seats,f.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:g(({data:f})=>[s("div",Te,[s("p",Se," 0 /"+T(f.confirmed_seats),1),l(c,{value:f.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(a,null,{body:g(({data:f})=>[K(l(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:w=>o.openDialog(f)},null,8,["onClick"]),[[S,"Prenota",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","rowClass","expandedRows"])])}const Me=P(Ce,[["render",Be]]);class ze{static async fetchAll(){return(await j("/locations/select?online=true")).data}}const Z=$({id:"location",state:()=>({location:{},locations:[],response_locations:{}}),getters:{allLocations:t=>t.response_locations.locations,responseLocations:t=>t.response_locations,getTotalLocations:t=>t.response_locations?t.response_locations.total:0,getCurrentLocation:t=>t.location},actions:{async fetchAllLocations(){await ze.fetchAll().then(t=>this.response_locations=t)}}}),Ie={props:["filters"],setup(t,e){z(()=>{p();let k=L.now();n.value=t.filters,n.value.date=k.toFormat("dd/MM/yyyy"),f()});const n=y({}),o=Z(),u=J(),m=I(),a=y([]),c=y(),h=F(()=>o.allLocations),d=F(()=>u.getCalendar),i=function(){},r=async function(k){await u.fetchCalendar(k).then(()=>{}).catch(C=>{B(m,C)})},p=async function(){await o.fetchAllLocations().then(()=>{O()}).catch(k=>{B(m,k)})},O=function(){if(t.filters.location_permalink){const k=h.value.find(C=>C.permalink===t.filters.location_permalink);a.value=k.courses}},S=function(k){let C={};C.month=L.fromJSDate(new Date(k)).month,C.year=L.fromJSDate(new Date(k)).year,C.location_permalink=t.filters.location_permalink,c.value={month:C.month,year:C.year},r(C)},f=function(){let k=L.now(),C={location_permalink:"",month:"",year:""};C.location_permalink=t.filters.location_permalink,C.month=k.month+"",C.year=k.year+"",r(C)},w=function(k){if(d.value.web_dates&&d.value.web_dates.length!=0){let C=k.month+1;C=k.month<10?"0"+C:C;let R=k.day<10?"0"+k.day:k.day,G=k.year+"-"+C+"-"+R;return d.value.web_dates.find(Q=>Q==G)}},D=function(k){let C={location_permalink:t.filters.location_permalink,month:k.month,year:k.year};r(C)};return U(t.filters,()=>{if(c.value){let k={location_permalink:t.filters.location_permalink,month:c.value.month,year:c.value.year};r(k)}else f()}),{form:n,courses:a,locations:h,calendar:d,resetField:i,getCourses:O,onDateChange:S,getDayFromDate:w,onMonthChange:D}}};const Re={class:"flex calendar-filter"},je={key:0,class:"special-day"};function $e(t,e,n,o,u,m){const a=_("Calendar");return b(),x("div",Re,[l(a,{modelValue:o.form.date,"onUpdate:modelValue":e[0]||(e[0]=c=>o.form.date=c),inline:"",onDateSelect:e[1]||(e[1]=c=>o.onDateChange(c)),onMonthChange:e[2]||(e[2]=c=>o.onMonthChange(c))},{date:g(c=>[o.getDayFromDate(c.date)?(b(),x("div",je,[s("span",null,T(c.date.day),1)])):(b(),x(E,{key:1},[A(T(c.date.day),1)],64))]),_:1},8,["modelValue"])])}const Ee=P(Ie,[["render",$e]]),qe={props:["filters"],setup(t,e){z(()=>{n.value=Object.assign({},t.filters),n.value.date=L.now().toFormat("dd/MM/yyyy"),m.value=oe(8,20),m.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=y({}),o=y([]),u=Z();I();const m=y([]),a=J(),c=F(()=>u.allLocations),h=F(()=>a.responseOrders),d=function(){n.value.name=null,n.value.course=o.value[0].name,n.value.hour=m.value[0],e.emit("onSubmit",n.value)},i=function(){if(o.value=[],n.value.location_permalink){const r=c.value.find(p=>p.permalink===n.value.location_permalink);o.value=r.courses,o.value[0].id!="-1"&&o.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=o.value[0].name}};return U(c,()=>{t.filters.location_permalink&&c.value&&(n.value=Object.assign({},t.filters),n.value.hour||(n.value.hour="Tutti gli orari"),i())}),U(t.filters,()=>{t.filters.location_permalink&&c.value&&n.value.location_permalink&&n.value.location_permalink!=t.filters.location_permalink&&(n.value=Object.assign({},t.filters),n.value.hour||(n.value.hour="Tutti gli orari"),i())}),U(h,()=>{}),{form:n,courses:o,hours:m,locations:c,responseOrders:h,resetField:d,getCourses:i}}},Je={class:"formgrid grid px-0 align-items-center"},Ge={key:0,class:"field col-4 flex flex-column"},Qe=s("label",{for:"typology"},"Filtra per percorso",-1),We={key:1,class:"field col-3 flex flex-column"},He=s("label",{for:"typology"},"Filtra per orario (dalle)",-1),Ke=s("div",{class:"col-12"},null,-1),Xe={class:"field col-4 flex flex-column"},Ye=s("label",{for:"typology"},"Filtra per nome acquirente",-1),Ze={class:"flex col-12 justify-content-end pt-1"};function et(t,e,n,o,u,m){const a=_("Dropdown"),c=_("InputText"),h=_("Button"),d=_("AccordionTab"),i=_("Accordion");return b(),q(i,{activeIndex:0},{default:g(()=>[l(d,{header:"FILTRI"},{default:g(()=>[s("div",Je,[o.form.location_permalink?(b(),x("div",Ge,[Qe,l(a,{modelValue:o.form.course,"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.course=r),options:o.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):N("",!0),o.responseOrders?(b(),x("div",We,[He,l(a,{modelValue:o.form.hour,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.hour=r),options:o.hours,placeholder:""},null,8,["modelValue","options"])])):N("",!0),Ke,s("div",Xe,[Ye,l(c,{modelValue:o.form.name,"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.name=r),placeholder:""},null,8,["modelValue"])])]),s("div",Ze,[l(h,{label:"Ricerca",class:"mr-2",onClick:e[3]||(e[3]=r=>t.$emit("onSubmit",o.form))}),l(h,{label:"Annulla",class:"p-button-outlined",onClick:e[4]||(e[4]=r=>o.resetField())})])]),_:1})]),_:1})}const tt=P(qe,[["render",et]]);class ot{static async fetchAll(e){const n=e.get("location_permalink");return e.delete("location_permalink"),e.set("api_version","v2"),(await j(`/ticket_office/${n}/courses`,e)).data}}const nt=$({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.response_courses.tickets,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await ot.fetchAll(t).then(e=>this.response_courses=e)}}});class st{static async fetchAll(e){const n=e.get("location_permalink");return e.delete("location_permalink"),e.set("api_version","v2"),(await j(`/ticket_office/${n}/tickets`,e)).data}}const lt=$({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.response_tickets.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await st.fetchAll(t).then(e=>this.response_tickets=e)}}}),at={props:["form","price","index","ticket"],setup(t,e){const n=y(0),o=function(){n.value++,m()},u=function(){n.value>0&&n.value--,m()},m=function(){const a={counter:n.value,price:t.price,index:t.index,ticket:t.ticket};e.emit("changeCounter",a)};return{counter:n,decrement:u,increment:o}}};const it={class:"btn-plus-min flex align-items-center"},rt={class:"counter"};function ct(t,e,n,o,u,m){const a=_("Button");return b(),x("div",it,[l(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:o.decrement,disabled:o.counter===0},null,8,["onClick","disabled"]),s("div",rt,T(o.counter),1),l(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:o.increment},null,8,["onClick"])])}const dt=P(at,[["render",ct]]),ut={props:["tickets","form"],setup(t){const e=y(0),n=y([]),o=y(!1),u=y(),m=J(),a=I(),c=F(()=>m.getDiscount),h=function(r){n.value[r.index]={partial_total:r.price*r.counter,ticket:r.ticket,quantity:r.counter},e.value=0,n.value.forEach(p=>{p.partial_total==0&&n.value.splice(n.value.indexOf(p)),e.value+=p.partial_total})},d=function(){i()},i=async function(){let r=[];n.value.forEach(O=>{r.push({id:O.ticket.id,quantity:O.quantity})});const p={discount_code:u.value,location_permalink:t.form.location_permalink,tickets:r};await m.cost(p).then(()=>{}).catch(O=>{B(a,O)})};return{total:e,partialTotals:n,showDiscount:o,discountCode:u,discount:c,onChangeCounter:h,applyDiscount:d}},components:{PlusMinusButton:dt}};const mt={key:0,class:"flex justify-content-between align-items-center"},_t={class:"flex align-items-center col-9"},ft={class:"col-4 pl-0"},pt={class:"text-right col-2"},ht={class:"col-3 flex justify-content-end"},vt=s("hr",{class:"mt-3"},null,-1),yt={class:"col-12 m-0 py-0 flex flex-column align-items-start"},gt={class:"flex align-items-center justify-content-between py-0"},kt={class:"col-9 flex"},bt=s("b",null,"Totale",-1),wt=[bt],xt={key:0,class:"text-right col-4"},Ct={class:"line-through text-sm mr-2"},Dt={class:"font-bold"},Vt={key:1,class:"col-2 text-right font-bold"},Ot={class:"col-3 flex justify-content-end"};function Tt(t,e,n,o,u,m){const a=_("PlusMinusButton"),c=_("Button"),h=_("InputText"),d=_("InputGroup");return b(),x(E,null,[(b(!0),x(E,null,te(n.tickets,(i,r)=>{var p,O,S;return b(),x("div",{key:i.id},[((p=i.course)==null?void 0:p.id)==((O=n.form.course)==null?void 0:O.id)?(b(),x("div",mt,[s("div",_t,[s("b",ft,T(i.name),1),s("div",pt,"€ "+T((S=i.price)==null?void 0:S.toFixed(2)),1)]),s("div",ht,[l(a,{onChangeCounter:e[0]||(e[0]=f=>o.onChangeCounter(f)),price:i.price,index:r,ticket:i},null,8,["price","index","ticket"])])])):N("",!0)])}),128)),vt,s("div",yt,[l(c,{label:"Codice sconto",link:"",onClick:e[1]||(e[1]=i=>o.showDiscount?o.showDiscount=!1:o.showDiscount=!0),class:"p-0"}),o.showDiscount?(b(),q(d,{key:0,class:"discount"},{default:g(()=>[l(h,{placeholder:"Inserisci codice",modelValue:o.discountCode,"onUpdate:modelValue":e[2]||(e[2]=i=>o.discountCode=i)},null,8,["modelValue"]),l(c,{label:"Applica",onClick:o.applyDiscount},null,8,["onClick"])]),_:1})):N("",!0)]),s("div",gt,[s("div",kt,[s("div",{class:X(["pl-0",o.discount&&o.discount.total_amount?"col-2":"col-4"])},wt,2),o.discount&&o.discount.total_amount?(b(),x("div",xt,[s("span",Ct,"€ "+T(o.total.toFixed(2)),1),s("span",Dt,"€ "+T(o.discount.total_amount.toFixed(2)),1)])):(b(),x("div",Vt,"€ "+T(o.total.toFixed(2)),1))]),s("div",Ot,[l(c,{label:"Prosegui",onClick:e[3]||(e[3]=i=>t.$emit("nextTab",o.partialTotals))})])])],64)}const St=P(ut,[["render",Tt]]);class Ft{static async fetchAll(){return(await j("/countries")).data.countries}}const Nt=$({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:t=>t.countries},actions:{async fetchAllCountries(){await Ft.fetchAll().then(t=>this.countries=t)}}}),Lt={setup(){z(()=>{m()});const t=Nt(),e=y({}),n=y([{id:"to_pay",name:"Da pagare"},{id:"payed",name:"Pagato"},{id:"free",name:"Gratuito"}]),o=y([{label:"Digitale (POS)"},{label:"Digitale (Satispay)"},{label:"Contanti"},{label:"Bonifico"},{label:"Biglietto a data aperta (voucher)"}]),u=F(()=>t.allCountries),m=async function(){await t.fetchAllCountries().then(()=>{e.value.country_id="88"})};return{form:e,countries:u,paymentList:n,paymentModeList:o}}},At={class:"formgrid grid"},Ut={class:"field col-6"},Pt=s("label",{for:"user_name"},"Nome",-1),Bt={class:"field col-6"},Mt=s("label",{for:"user_surname"},"Cognome",-1),zt={class:"field col-6"},It=s("label",{for:"user_email"},"Email",-1),Rt={class:"field col-6"},jt=s("label",{for:"user_phone"},"Telefono",-1),$t={class:"field col-6"},Et=s("label",{for:"country_id"},"Nazione",-1),qt={class:"field col-6"},Jt=s("label",{for:"user_zip"},"Cap",-1),Gt={class:"field col-6"},Qt=s("label",{for:"status"},"Stato pagamento",-1),Wt={class:"field col-6"},Ht=s("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Kt={key:0,class:"field col-6"},Xt=s("label",{for:"user_zip"},"Codice biglietto",-1),Yt={class:"field col-12"},Zt={class:"field flex flex-column"},eo=s("label",{for:"notes"},"Note",-1),to={class:"col-12 flex justify-content-end"};function oo(t,e,n,o,u,m){const a=_("InputText"),c=_("Dropdown"),h=_("Textarea"),d=_("Button");return b(),x("div",At,[s("div",Ut,[Pt,l(a,{type:"text",modelValue:o.form.user_name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.user_name=i),class:"w-full"},null,8,["modelValue"])]),s("div",Bt,[Mt,l(a,{type:"text",modelValue:o.form.user_surname,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.user_surname=i),class:"w-full"},null,8,["modelValue"])]),s("div",zt,[It,l(a,{type:"text",modelValue:o.form.user_email,"onUpdate:modelValue":e[2]||(e[2]=i=>o.form.user_email=i),class:"w-full"},null,8,["modelValue"])]),s("div",Rt,[jt,l(a,{type:"text",modelValue:o.form.user_phone,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.user_phone=i),class:"w-full"},null,8,["modelValue"])]),s("div",$t,[Et,l(c,{modelValue:o.form.country_id,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.country_id=i),options:o.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",qt,[Jt,l(a,{type:"text",modelValue:o.form.user_zip,"onUpdate:modelValue":e[5]||(e[5]=i=>o.form.user_zip=i),class:"w-full"},null,8,["modelValue"])]),s("div",Gt,[Qt,l(c,{modelValue:o.form.status,"onUpdate:modelValue":e[6]||(e[6]=i=>o.form.status=i),options:o.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",Wt,[Ht,l(c,{modelValue:o.form.payment_mode,"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.payment_mode=i),options:o.paymentModeList,optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),o.form.payment_mode&&o.form.payment_mode.label=="Biglietto a data aperta (voucher)"?(b(),x("div",Kt,[Xt,l(a,{type:"text",modelValue:o.form.user_zip,"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.user_zip=i),class:"w-full"},null,8,["modelValue"])])):N("",!0),s("div",Yt,[s("div",Zt,[eo,l(h,{modelValue:o.form.notes,"onUpdate:modelValue":e[9]||(e[9]=i=>o.form.notes=i),rows:"5",cols:"30"},null,8,["modelValue"])])]),s("div",to,[l(d,{label:"Prosegui",onClick:e[10]||(e[10]=i=>t.$emit("nextTab",o.form))})])])}const no=P(Lt,[["render",oo]]),so={props:["form"],setup(t){z(()=>{c()});const e=y(0),n=y([]),o=y(!1),u=lt();J();const m=I(),a=F(()=>u.allTickets),c=async function(){const i=new Map;i.set("location_permalink",t.form.location_permalink),await u.fetchAllTickets(i).then(()=>{}).catch(r=>{B(m,r)})};return{tickets:a,active:e,partialTotals:n,showOrderDetail:o,formatExplicitDate:Y,formatDate:ne,onNextTab:function(i){e.value+=1,n.value=Object.assign([],i)},onConfirmPayment:function(i){e.value+=1,o.value=!0}}},components:{NewOrderTicketTab:St,NewOrderFormTab:no}};const lo={key:0,class:"info-box"},ao={class:"font-medium"},io=s("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),ro={class:"font-medium"},co=s("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),uo={class:"capitalize"},mo={key:0,class:"flex pb-4"},_o=s("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),fo={class:"flex flex-column"},po=s("div",{class:"m-0 text-center font-bold line-height-3"},[A(" Ordine #VIC_2023865090 registrato correttamente!"),s("br"),A(" Ti abbiamo inoltrato la conferma via mail. ")],-1),ho={class:"flex align-items-center justify-content-center mt-3"};function vo(t,e,n,o,u,m){var r;const a=_("NewOrderTicketTab"),c=_("TabPanel"),h=_("NewOrderFormTab"),d=_("Button"),i=_("TabView");return b(),x(E,null,[n.form?(b(),x("div",lo,[s("p",ao,[io,A(" "+T((r=n.form.course)==null?void 0:r.name),1)]),s("p",ro,[co,s("span",uo,T(o.formatDate(n.form.date)),1),A(" - "+T(n.form.hour),1)]),o.partialTotals&&o.partialTotals.length>0?(b(),x("div",mo,[_o,s("div",fo,[(b(!0),x(E,null,te(o.partialTotals,p=>{var O;return b(),x("p",{class:"p-0 m-0 pb-1 font-medium",key:p.id},T((O=p.ticket)==null?void 0:O.name)+" x "+T(p.quantity)+" "+T(p.price),1)}),128))])])):N("",!0)])):N("",!0),l(i,{activeIndex:o.active,"onUpdate:activeIndex":e[3]||(e[3]=p=>o.active=p)},{default:g(()=>[l(c,{header:"Seleziona i biglietti",disabled:o.showOrderDetail},{default:g(()=>[l(a,{tickets:o.tickets,form:n.form,onNextTab:e[0]||(e[0]=p=>o.onNextTab(p))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(c,{header:"Inserisci i dati",disabled:o.showOrderDetail},{default:g(()=>[l(h,{onNextTab:e[1]||(e[1]=p=>o.onConfirmPayment(p))})]),_:1},8,["disabled"]),o.showOrderDetail?(b(),q(c,{key:0,header:"Ordine completato"},{default:g(()=>[po,s("div",ho,[l(d,{label:"Stampa biglietti",outlined:"",onClick:e[2]||(e[2]=p=>t.$emit("closeDialog",p))})])]),_:1})):N("",!0)]),_:1},8,["activeIndex"])],64)}const yo=P(so,[["render",vo]]),go={props:["filters"],setup(t){z(()=>{i(),u.value=oe(8,20),e.value=Object.assign({},t.filters),e.value.hour=ke(u.value)});const e=y({}),n=nt(),o=I(),u=y(),m=y(!1),a=se(),c=y(!1),h=F(()=>n.allCourses),d=F(()=>a.showNewOrderDialog),i=async function(){const S=new Map;S.set("location_permalink",t.filters.location_permalink),await n.fetchAllCourses(S).then(()=>{}).catch(f=>{B(o,f)})},r=function(){e.value={}},p=function(S){a.setNewOrderDialogVisibility(S)},O=function(){c.value=e.value.open_ticket};return U(t.filters,()=>{if((t.filters.location_permalink!=e.value.location_permalink||!e.value.course)&&i(),e.value.date=t.filters.date,e.value.location_permalink=t.filters.location_permalink,t.filters.hour&&t.filters.hour!="Tutti gli orari"&&(e.value.hour=t.filters.hour),t.filters.course&&!t.filters.course.id){let S=h.value.find(f=>f.name===t.filters.course.name);S&&(e.value.course=S)}}),U(h,()=>{e.value.course=h.value[0]}),{courses:h,form:e,hours:u,disableForm:c,visible:m,onCloseDialog:r,updateDialog:p,onChecked:O,dialogVisible:d,dialogStore:a}},components:{NewOrderDialog:yo}},ko=s("h2",{class:"mt-1"},"Nuova prenotazione",-1),bo={class:"formgrid grid px-0 align-items-center mt-4"},wo={key:0,class:"field flex flex-column w-full col-12"},xo=s("label",{for:"typology"},"Scegli il percorso",-1),Co={key:1,class:"field flex flex-column w-full col-12"},Do=s("label",{for:"typology"},"Seleziona l'orario",-1),Vo={class:"flex justify-content-end align-items-center mt-2"},Oo={class:"flex align-items-center justify-content-between w-full"},To=s("h2",null,"Nuova prenotazione",-1);function So(t,e,n,o,u,m){const a=_("Dropdown"),c=_("Button"),h=_("NewOrderDialog"),d=_("Dialog"),i=_("Card");return b(),q(i,{class:"mt-4"},{content:g(()=>[ko,s("div",bo,[n.filters.location_permalink?(b(),x("div",wo,[xo,l(a,{modelValue:o.form.course,"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.course=r),options:o.courses,optionLabel:"name",disabled:o.disableForm},null,8,["modelValue","options","disabled"])])):N("",!0),n.filters.location_permalink?(b(),x("div",Co,[Do,l(a,{modelValue:o.form.hour,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.hour=r),options:o.hours,disabled:o.disableForm},null,8,["modelValue","options","disabled"])])):N("",!0)]),s("div",Vo,[l(c,{label:"Prenota",disabled:!o.form.course||!o.form.hour,onClick:e[2]||(e[2]=r=>o.updateDialog(!0))},null,8,["disabled"])]),l(d,{visible:o.dialogVisible,"onUpdate:visible":e[5]||(e[5]=r=>o.dialogVisible=r),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1},{header:g(()=>[s("div",Oo,[To,l(c,{icon:"pi pi-times",text:"",rounded:"",onClick:e[3]||(e[3]=r=>o.updateDialog(!1))})])]),default:g(()=>[l(h,{form:o.form,onCloseDialog:e[4]||(e[4]=r=>o.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const Fo=P(go,[["render",So]]),No={setup(){z(()=>{m.value&&(t.value.location_permalink=m.value.location.permalink,c())});const t=y({}),e=y(),n=ve(),o=Z(),u=I(),m=F(()=>n.currentUser),a=F(()=>o.allLocations),c=async function(){await o.fetchAllLocations().then(()=>{}).catch(d=>{B(u,d)})};return{filters:t,orderTable:e,user:m,locations:a,fetchAllLocations:c,formatDate:ne,onUpdateFilters:function(d){t.value.hour=d.start_at,t.value.course={name:d.course_name},d.course&&(t.value.course={id:d.course}),t.value.name=d.name,d.hour&&(d.hour.start_at?t.value.hour=d.hour.start_at:t.value.hour=d.hour)}}},components:{CalendarFilter:Ee,OrderTable:Me,OrderFilter:tt,NewOrderCard:Fo}};const Lo={class:"flex justify-content-between align-items-center"},Ao={class:"field flex flex-column mt-3"},Uo={key:0,style:{color:"#495057"}},Po=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Bo={class:"capitalize text-xl"},Mo={class:"flex gap-4"},zo={key:0,class:"col-3 mt-3"},Io={class:"col-9 mt-3"};function Ro(t,e,n,o,u,m){const a=_("Dropdown"),c=_("CalendarFilter"),h=_("NewOrderCard"),d=_("OrderFilter"),i=_("OrderTable");return b(),x("div",null,[s("div",Lo,[s("div",Ao,[l(a,{modelValue:o.filters.location_permalink,"onUpdate:modelValue":e[0]||(e[0]=r=>o.filters.location_permalink=r),options:o.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),o.filters&&o.filters.date?(b(),x("div",Uo,[Po,s("span",Bo,T(o.formatDate(o.filters.date)),1)])):N("",!0)]),s("div",Mo,[o.filters.location_permalink?(b(),x("div",zo,[l(c,{filters:o.filters},null,8,["filters"]),l(h,{filters:o.filters},null,8,["filters"])])):N("",!0),s("div",Io,[l(d,{filters:o.filters,onOnSubmit:e[1]||(e[1]=r=>o.onUpdateFilters(r))},null,8,["filters"]),o.filters.date?(b(),q(i,{key:0,filters:o.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:e[2]||(e[2]=r=>o.onUpdateFilters(r))},null,8,["filters"])):N("",!0)])])])}const Eo=P(No,[["render",Ro]]);export{Eo as default};
