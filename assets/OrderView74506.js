import{o as z,c as F,I as re,a as I,x as v,i as B,_ as P,r as u,J as ce,b as k,e as w,f as l,w as y,h as U,n as K,g as t,t as O,K as $,L as R,M as j,N,O as W,u as de}from"../index74506.js";import{u as q,a as X,f as H,b as ue,c as me,d as Q,e as fe,g as _e,h as pe,i as Y,j as he}from"./NewOrderDialog.vue_vue_type_style_index_0_lang74506.js";import{e as A,s as ve,D as L,p as Z,g as ye}from"./helpers74506.js";const be={props:["filters"],setup(n,o){z(()=>{m.value=!0,x.value={first:0,rows:i.value.rows,sortField:null,sortOrder:null},x.value.page=0,n.filters.location_permalink&&M()});const a=q(),e=X(),b=F(()=>a.responseOrders),f=F(()=>a.status),s=re(),c=F(()=>s.submitDialog),p=F(()=>s.cancelDialog),d=I(),i=v(),r=v(),_=v(),T=v([{code:"2023795703",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!0},{code:"2023795704",type:"Biglietto intero",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795705",type:"Biglietto ridotto",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1},{code:"2023795706",type:"Biglietto gratuito",quantity:1,tickets_url:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023795703.pdf",no_show_tickets:!1,check_in:!1}]),S=v(["Da pagare","Pagato","Gratuito"]),m=v(!0),x=v(),V=v(0),g=v([]),C=v([]);function M(){m.value=!0;let h=new Map;for(const D in n.filters)D=="date"?H(n.filters.date)=="Invalid DateTime"?h.set("date",ue(n.filters.date)):h.set("date",H(n.filters.date)):n.filters.location_permalink&&h.set("location_permalink",n.filters.location_permalink),D=="course"&&n.filters.course.id!="-1"&&h.set("course",n.filters.course.id),D=="hour"&&n.filters.hour!="Tutti gli orari"&&h.set("hour",n.filters.hour),D=="name"&&h.set("name",n.filters.name);setTimeout(()=>{E(h)},Math.random()*1e3+250)}const E=async function(h){await a.fetchAllOrders(h).then(()=>{m.value=!1}).catch(D=>{m.value=!1,A(d,D)})},G=function(h){},ee=function(h,D){h.stopPropagation(),h.stopImmediatePropagation(),r.value=D;let J="Sei sicuro di voler disattivare l'utente <b>"+(D==null?void 0:D.email)+"</b> ?";s.setDialog("Cambia stato","Conferma","Annulla",J),s.setDynamicDialogVisibility(!0)},oe=async function(){var D;m.value=!0;const h={order_id:r.value.id,order:{enabled:(D=r.value)==null?void 0:D.enabled}};await a.updateOrder(h).then(()=>{m.value=!1,ve(d,{message:"Stato aggiornato correttamente",error:!1}),M()}).catch(J=>{m.value=!1,A(d,J)})},te=function(h){return h!=null&&h.cluster?h.cluster:""},ne=h=>{_.value.toggle(h)},le=(h,D)=>{if(h>=(h+D)/2)return"green";if(h<=(h+D)/3)return"red"},ae=function(h,D){D&&(_.value.note=D,_.value.toggle(h))},se=function(h){},ie=function(h){const D={course_name:h.course_name,start_at:h.start_at};o.emit("updateFilters",D),e.setNewOrderDialogVisibility(!0)};return B(c,()=>{oe()}),B(p,()=>{r.value.enabled?r.value.enabled=!1:r.value.enabled=!0}),B(n.filters,()=>{n.filters.location_permalink&&M()}),{dt:i,responseOrders:b,loading:m,totalRecords:V,lazyParams:x,currentOrder:r,status:f,expandedRows:g,expandedRows1:C,op:_,tmp_tickets:T,payments:S,dialogStore:e,showSidebar:G,loadLazyData:M,onChangeStatus:ee,getRowClass:te,toggle:ne,getProgressClass:le,showNotes:ae,checkAll:se,openDialog:ie,formatDataFromUnixTimestamps:me}},components:{}};const ge={class:"order-table"},ke={style:{width:"15rem"}},xe={class:"m-0 text-right",style:{"font-size":"12px"}},we={style:{width:"15rem"}},Ce={class:"m-0 text-right",style:{"font-size":"12px"}},Ve=["href"],De=t("i",{class:"pi pi-file-pdf"},null,-1),Te=[De],Oe=["href"],Se=t("i",{class:"pi pi-file-pdf"},null,-1),Fe=[Se];function Ne(n,o,a,e,b,f){const s=u("Column"),c=u("ProgressBar"),p=u("Button"),d=u("Dropdown"),i=u("Checkbox"),r=u("OverlayPanel"),_=u("Badge"),T=u("DataTable"),S=ce("tooltip");return k(),w("div",ge,[l(T,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",rowClass:e.getRowClass,expandedRows:e.expandedRows,"onUpdate:expandedRows":o[1]||(o[1]=m=>e.expandedRows=m)},{empty:y(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:y(m=>[l(T,{value:m.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":o[0]||(o[0]=x=>e.expandedRows1=x)},{empty:y(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:y(x=>[l(T,{value:e.tmp_tickets,class:"m-4 mx-5"},{default:y(()=>[l(s,{header:"Codice biglietto",field:"code"}),l(s,{header:"Tipo biglietto",field:"type"},{body:y(({data:V})=>[l(_,{value:V.type,class:K([V.type,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(s,{header:"PDF",field:"tickets_url"},{body:y(({data:V})=>[t("a",{href:V.tickets_url,target:"_blank"},Fe,8,Oe)]),_:1}),l(s,{header:"Check-in"},{body:y(({data:V})=>[t("div",null,[l(i,{modelValue:V.check_in,"onUpdate:modelValue":g=>V.check_in=g,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(s,{header:"No-show"},{body:y(({data:V})=>[t("div",null,[l(i,{modelValue:V.no_show_tickets,"onUpdate:modelValue":g=>V.no_show_tickets=g,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["value"])]),default:y(()=>[l(s,{header:"Codice",field:"code"}),l(s,{header:"Effettuato da",field:"created_by"}),l(s,{header:"Acquirente"},{body:y(({data:x})=>[U(O(x.user_name)+" "+O(x.user_surname),1)]),_:1}),l(s,{header:"Q.ta",field:"quantity"}),l(s,{header:"Pdf",field:"pdf"},{body:y(({data:x})=>[t("a",{href:x.tickets_url,target:"_blank"},Te,8,Ve)]),_:1}),l(s,{header:"Pagamento"},{body:y(({data:x})=>[l(d,{modelValue:x.payment,"onUpdate:modelValue":V=>x.payment=V,options:e.payments,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),l(s,{header:"Check-in"},{body:y(({data:x})=>[t("div",null,[l(i,{modelValue:x.check_in,"onUpdate:modelValue":V=>x.check_in=V,binary:!0,onClick:V=>e.checkAll(x.time_slot)},null,8,["modelValue","onUpdate:modelValue","onClick"])])]),_:1}),l(s,{header:"No-show"},{body:y(({data:x})=>[t("div",null,[l(i,{modelValue:x.no_show_tickets,"onUpdate:modelValue":V=>x.no_show_tickets=V,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(s,{header:"",style:{"padding-right":"0"}},{body:y(({data:x})=>[$(l(p,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-comment",text:"",rounded:"",onClick:V=>e.showNotes(V,x.notes),disabled:!x.notes},null,8,["onClick","disabled"]),[[S,"Note",void 0,{top:!0}]]),l(r,{ref:"op"},{default:y(()=>[U(O(e.op.note),1)]),_:1},512),$(l(p,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-trash",text:"",rounded:"",disabled:!x.can_cancel},null,8,["disabled"]),[[S,"Elimina",void 0,{top:!0}]])]),_:1}),l(s,{expander:"",style:{width:"5rem"}})]),_:2},1032,["value","expandedRows"])]),default:y(()=>[l(s,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(s,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),l(s,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:y(({data:m})=>[t("div",ke,[t("p",xe,O(m.confirmed_seats)+"/"+O(m.remaing_seats+m.confirmed_seats),1),l(c,{value:m.confirmed_seats*100/(m.remaing_seats+m.confirmed_seats),showValue:!1,style:{height:"10px"},class:K(["available-progress",e.getProgressClass(m.confirmed_seats,m.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(s,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:y(({data:m})=>[t("div",we,[t("p",Ce," 0 /"+O(m.confirmed_seats),1),l(c,{value:m.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(s,null,{body:y(({data:m})=>[$(l(p,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:x=>e.openDialog(m)},null,8,["onClick"]),[[S,"Prenota",void 0,{top:!0}]])]),_:1}),l(s,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","rowClass","expandedRows"])])}const Ue=P(be,[["render",Ne]]),Be={props:["filters"],setup(n,o){z(()=>{_();let g=L.now();a.value=n.filters,a.value.date=g.toFormat("dd/MM/yyyy"),m()});const a=v({}),e=Q(),b=q(),f=I(),s=v([]),c=v(),p=F(()=>e.allLocations),d=F(()=>b.getCalendar),i=function(){},r=async function(g){await b.fetchCalendar(g).then(()=>{}).catch(C=>{A(f,C)})},_=async function(){await e.fetchAllLocations().then(()=>{T()}).catch(g=>{A(f,g)})},T=function(){if(n.filters.location_permalink){const g=p.value.find(C=>C.permalink===n.filters.location_permalink);s.value=g.courses}},S=function(g){let C={};C.month=L.fromJSDate(new Date(g)).month,C.year=L.fromJSDate(new Date(g)).year,C.location_permalink=n.filters.location_permalink,c.value={month:C.month,year:C.year},r(C)},m=function(){let g=L.now(),C={location_permalink:"",month:"",year:""};C.location_permalink=n.filters.location_permalink,C.month=g.month+"",C.year=g.year+"",r(C)},x=function(g){if(d.value.web_dates&&d.value.web_dates.length!=0){let C=g.month+1;C=g.month<10?"0"+C:C;let M=g.day<10?"0"+g.day:g.day,E=g.year+"-"+C+"-"+M;return d.value.web_dates.find(G=>G==E)}},V=function(g){let C={location_permalink:n.filters.location_permalink,month:g.month,year:g.year};r(C)};return B(n.filters,()=>{if(c.value){let g={location_permalink:n.filters.location_permalink,month:c.value.month,year:c.value.year};r(g)}else m()}),{form:a,courses:s,locations:p,calendar:d,resetField:i,getCourses:T,onDateChange:S,getDayFromDate:x,onMonthChange:V}}},Pe={class:"flex calendar-filter"},Ae={key:0,class:"special-day"};function ze(n,o,a,e,b,f){const s=u("Calendar");return k(),w("div",Pe,[l(s,{modelValue:e.form.date,"onUpdate:modelValue":o[0]||(o[0]=c=>e.form.date=c),inline:"",onDateSelect:o[1]||(o[1]=c=>e.onDateChange(c)),onMonthChange:o[2]||(o[2]=c=>e.onMonthChange(c))},{date:y(c=>[e.getDayFromDate(c.date)?(k(),w("div",Ae,[t("span",null,O(c.date.day),1)])):(k(),w(R,{key:1},[U(O(c.date.day),1)],64))]),_:1},8,["modelValue"])])}const Ie=P(Be,[["render",ze]]),Me={props:["filters"],setup(n,o){z(()=>{a.value=Object.assign({},n.filters),a.value.date=L.now().toFormat("dd/MM/yyyy"),f.value=Z(8,20),f.value.unshift("Tutti gli orari"),a.value.hour="Tutti gli orari"});const a=v({}),e=v([]),b=Q();I();const f=v([]),s=q(),c=F(()=>b.allLocations),p=F(()=>s.responseOrders),d=function(){a.value.name=null,a.value.course=e.value[0].name,a.value.hour=f.value[0],o.emit("onSubmit",a.value)},i=function(){if(e.value=[],a.value.location_permalink){const r=c.value.find(_=>_.permalink===a.value.location_permalink);e.value=r.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),a.value.course=e.value[0].name}};return B(c,()=>{n.filters.location_permalink&&c.value&&(a.value=Object.assign({},n.filters),a.value.hour||(a.value.hour="Tutti gli orari"),i())}),B(n.filters,()=>{n.filters.location_permalink&&c.value&&a.value.location_permalink&&a.value.location_permalink!=n.filters.location_permalink&&(a.value=Object.assign({},n.filters),a.value.hour||(a.value.hour="Tutti gli orari"),i())}),B(p,()=>{}),{form:a,courses:e,hours:f,locations:c,responseOrders:p,resetField:d,getCourses:i}}},Le={class:"formgrid grid px-0 align-items-center"},Re={key:0,class:"field col-4 flex flex-column"},je=t("label",{for:"typology"},"Filtra per percorso",-1),qe={key:1,class:"field col-3 flex flex-column"},Ee=t("label",{for:"typology"},"Filtra per orario (dalle)",-1),Ge=t("div",{class:"col-12"},null,-1),Je={class:"field col-4 flex flex-column"},$e=t("label",{for:"typology"},"Filtra per nome acquirente",-1),Ke={class:"flex col-12 justify-content-end pt-1"};function Qe(n,o,a,e,b,f){const s=u("Dropdown"),c=u("InputText"),p=u("Button"),d=u("AccordionTab"),i=u("Accordion");return k(),j(i,{activeIndex:0},{default:y(()=>[l(d,{header:"FILTRI"},{default:y(()=>[t("div",Le,[e.form.location_permalink?(k(),w("div",Re,[je,l(s,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.course=r),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):N("",!0),e.responseOrders?(k(),w("div",qe,[Ee,l(s,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.hour=r),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):N("",!0),Ge,t("div",Je,[$e,l(c,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=r=>e.form.name=r),placeholder:""},null,8,["modelValue"])])]),t("div",Ke,[l(p,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=r=>n.$emit("onSubmit",e.form))}),l(p,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=r=>e.resetField())})])]),_:1})]),_:1})}const He=P(Me,[["render",Qe]]),We={props:["form","price","index","ticket"],setup(n,o){const a=v(0),e=function(){a.value++,f()},b=function(){a.value>0&&a.value--,f()},f=function(){const s={counter:a.value,price:n.price,index:n.index,ticket:n.ticket};o.emit("changeCounter",s)};return{counter:a,decrement:b,increment:e}}},Xe={class:"btn-plus-min flex align-items-center"},Ye={class:"counter"};function Ze(n,o,a,e,b,f){const s=u("Button");return k(),w("div",Xe,[l(s,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),t("div",Ye,O(e.counter),1),l(s,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const eo=P(We,[["render",Ze]]),oo={props:["tickets","form"],setup(n){const o=v(0),a=v([]),e=v(!1),b=v(),f=q(),s=I(),c=F(()=>f.getDiscount),p=function(r){a.value[r.index]={partial_total:r.price*r.counter,ticket:r.ticket,quantity:r.counter},o.value=0,a.value.forEach(_=>{_.partial_total==0&&a.value.splice(a.value.indexOf(_)),o.value+=_.partial_total})},d=function(){i()},i=async function(){let r=[];a.value.forEach(T=>{r.push({id:T.ticket.id,quantity:T.quantity})});const _={discount_code:b.value,location_permalink:n.form.location_permalink,tickets:r};await f.cost(_).then(()=>{}).catch(T=>{A(s,T)})};return{total:o,partialTotals:a,showDiscount:e,discountCode:b,discount:c,onChangeCounter:p,applyDiscount:d}},components:{PlusMinusButton:eo}},to={key:0,class:"flex justify-content-between align-items-center"},no={class:"flex align-items-center col-9"},lo={class:"col-4 pl-0"},ao={class:"text-right col-2"},so={class:"col-3 flex justify-content-end"},io=t("hr",{class:"mt-3"},null,-1),ro={class:"col-12 m-0 py-0 flex flex-column align-items-start"},co={class:"flex align-items-center justify-content-between py-0"},uo={class:"col-9 flex"},mo=t("b",null,"Totale",-1),fo=[mo],_o={key:0,class:"text-right col-4"},po={class:"line-through text-sm mr-2"},ho={class:"font-bold"},vo={key:1,class:"col-2 text-right font-bold"},yo={class:"col-3 flex justify-content-end"};function bo(n,o,a,e,b,f){const s=u("PlusMinusButton"),c=u("Button"),p=u("InputText"),d=u("InputGroup");return k(),w(R,null,[(k(!0),w(R,null,W(a.tickets,(i,r)=>{var _,T,S;return k(),w("div",{key:i.id},[((_=i.course)==null?void 0:_.id)==((T=a.form.course)==null?void 0:T.id)?(k(),w("div",to,[t("div",no,[t("b",lo,O(i.name),1),t("div",ao,"€ "+O((S=i.price)==null?void 0:S.toFixed(2)),1)]),t("div",so,[l(s,{onChangeCounter:o[0]||(o[0]=m=>e.onChangeCounter(m)),price:i.price,index:r,ticket:i},null,8,["price","index","ticket"])])])):N("",!0)])}),128)),io,t("div",ro,[l(c,{label:"Codice sconto",link:"",onClick:o[1]||(o[1]=i=>e.showDiscount?e.showDiscount=!1:e.showDiscount=!0),class:"p-0"}),e.showDiscount?(k(),j(d,{key:0,class:"discount"},{default:y(()=>[l(p,{placeholder:"Inserisci codice",modelValue:e.discountCode,"onUpdate:modelValue":o[2]||(o[2]=i=>e.discountCode=i)},null,8,["modelValue"]),l(c,{label:"Applica",onClick:e.applyDiscount},null,8,["onClick"])]),_:1})):N("",!0)]),t("div",co,[t("div",uo,[t("div",{class:K(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},fo,2),e.discount&&e.discount.total_amount?(k(),w("div",_o,[t("span",po,"€ "+O(e.total.toFixed(2)),1),t("span",ho,"€ "+O(e.discount.total_amount.toFixed(2)),1)])):(k(),w("div",vo,"€ "+O(e.total.toFixed(2)),1))]),t("div",yo,[l(c,{label:"Prosegui",onClick:o[3]||(o[3]=i=>n.$emit("nextTab",e.partialTotals))})])])],64)}const go=P(oo,[["render",bo]]),ko={setup(){z(()=>{f()});const n=fe(),o=v({}),a=v([{id:"to_pay",name:"Da pagare"},{id:"payed",name:"Pagato"},{id:"free",name:"Gratuito"}]),e=v([{label:"Digitale (POS)"},{label:"Digitale (Satispay)"},{label:"Contanti"},{label:"Bonifico"},{label:"Biglietto a data aperta (voucher)"}]),b=F(()=>n.allCountries),f=async function(){await n.fetchAllCountries().then(()=>{o.value.country_id="88"})};return{form:o,countries:b,paymentList:a,paymentModeList:e}}},xo={class:"formgrid grid"},wo={class:"field col-6"},Co=t("label",{for:"user_name"},"Nome",-1),Vo={class:"field col-6"},Do=t("label",{for:"user_surname"},"Cognome",-1),To={class:"field col-6"},Oo=t("label",{for:"user_email"},"Email",-1),So={class:"field col-6"},Fo=t("label",{for:"user_phone"},"Telefono",-1),No={class:"field col-6"},Uo=t("label",{for:"country_id"},"Nazione",-1),Bo={class:"field col-6"},Po=t("label",{for:"user_zip"},"Cap",-1),Ao={class:"field col-6"},zo=t("label",{for:"status"},"Stato pagamento",-1),Io={class:"field col-6"},Mo=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Lo={key:0,class:"field col-6"},Ro=t("label",{for:"user_zip"},"Codice biglietto",-1),jo={class:"field col-12"},qo={class:"field flex flex-column"},Eo=t("label",{for:"notes"},"Note",-1),Go={class:"col-12 flex justify-content-end"};function Jo(n,o,a,e,b,f){const s=u("InputText"),c=u("Dropdown"),p=u("Textarea"),d=u("Button");return k(),w("div",xo,[t("div",wo,[Co,l(s,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":o[0]||(o[0]=i=>e.form.user_name=i),class:"w-full"},null,8,["modelValue"])]),t("div",Vo,[Do,l(s,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":o[1]||(o[1]=i=>e.form.user_surname=i),class:"w-full"},null,8,["modelValue"])]),t("div",To,[Oo,l(s,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":o[2]||(o[2]=i=>e.form.user_email=i),class:"w-full"},null,8,["modelValue"])]),t("div",So,[Fo,l(s,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":o[3]||(o[3]=i=>e.form.user_phone=i),class:"w-full"},null,8,["modelValue"])]),t("div",No,[Uo,l(c,{modelValue:e.form.country_id,"onUpdate:modelValue":o[4]||(o[4]=i=>e.form.country_id=i),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Bo,[Po,l(s,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":o[5]||(o[5]=i=>e.form.user_zip=i),class:"w-full"},null,8,["modelValue"])]),t("div",Ao,[zo,l(c,{modelValue:e.form.status,"onUpdate:modelValue":o[6]||(o[6]=i=>e.form.status=i),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Io,[Mo,l(c,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[7]||(o[7]=i=>e.form.payment_mode=i),options:e.paymentModeList,optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode&&e.form.payment_mode.label=="Biglietto a data aperta (voucher)"?(k(),w("div",Lo,[Ro,l(s,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":o[8]||(o[8]=i=>e.form.user_zip=i),class:"w-full"},null,8,["modelValue"])])):N("",!0),t("div",jo,[t("div",qo,[Eo,l(p,{modelValue:e.form.notes,"onUpdate:modelValue":o[9]||(o[9]=i=>e.form.notes=i),rows:"5",cols:"30"},null,8,["modelValue"])])]),t("div",Go,[l(d,{label:"Prosegui",onClick:o[10]||(o[10]=i=>n.$emit("nextTab",e.form))})])])}const $o=P(ko,[["render",Jo]]),Ko={props:["form"],setup(n){z(()=>{c()});const o=v(0),a=v([]),e=v(!1),b=_e();q();const f=I(),s=F(()=>b.allTickets),c=async function(){const i=new Map;i.set("location_permalink",n.form.location_permalink),await b.fetchAllTickets(i).then(()=>{}).catch(r=>{A(f,r)})};return{tickets:s,active:o,partialTotals:a,showOrderDetail:e,formatExplicitDate:pe,formatDate:Y,onNextTab:function(i){o.value+=1,a.value=Object.assign([],i)},onConfirmPayment:function(i){o.value+=1,e.value=!0}}},components:{NewOrderTicketTab:go,NewOrderFormTab:$o}},Qo={key:0,class:"info-box"},Ho={class:"font-medium"},Wo=t("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),Xo={class:"font-medium"},Yo=t("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Zo={class:"capitalize"},et={key:0,class:"flex pb-4"},ot=t("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),tt={class:"flex flex-column"},nt=t("div",{class:"m-0 text-center font-bold line-height-3"},[U(" Ordine #VIC_2023865090 registrato correttamente!"),t("br"),U(" Ti abbiamo inoltrato la conferma via mail. ")],-1),lt={class:"flex align-items-center justify-content-center mt-3"};function at(n,o,a,e,b,f){var r;const s=u("NewOrderTicketTab"),c=u("TabPanel"),p=u("NewOrderFormTab"),d=u("Button"),i=u("TabView");return k(),w(R,null,[a.form?(k(),w("div",Qo,[t("p",Ho,[Wo,U(" "+O((r=a.form.course)==null?void 0:r.name),1)]),t("p",Xo,[Yo,t("span",Zo,O(e.formatDate(a.form.date)),1),U(" - "+O(a.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(k(),w("div",et,[ot,t("div",tt,[(k(!0),w(R,null,W(e.partialTotals,_=>{var T;return k(),w("p",{class:"p-0 m-0 pb-1 font-medium",key:_.id},O((T=_.ticket)==null?void 0:T.name)+" x "+O(_.quantity)+" "+O(_.price),1)}),128))])])):N("",!0)])):N("",!0),l(i,{activeIndex:e.active,"onUpdate:activeIndex":o[3]||(o[3]=_=>e.active=_)},{default:y(()=>[l(c,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:y(()=>[l(s,{tickets:e.tickets,form:a.form,onNextTab:o[0]||(o[0]=_=>e.onNextTab(_))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(c,{header:"Inserisci i dati",disabled:e.showOrderDetail},{default:y(()=>[l(p,{onNextTab:o[1]||(o[1]=_=>e.onConfirmPayment(_))})]),_:1},8,["disabled"]),e.showOrderDetail?(k(),j(c,{key:0,header:"Ordine completato"},{default:y(()=>[nt,t("div",lt,[l(d,{label:"Stampa biglietti",outlined:"",onClick:o[2]||(o[2]=_=>n.$emit("closeDialog",_))})])]),_:1})):N("",!0)]),_:1},8,["activeIndex"])],64)}const st=P(Ko,[["render",at]]),it={props:["filters"],setup(n){z(()=>{i(),b.value=Z(8,20),o.value=Object.assign({},n.filters),o.value.hour=ye(b.value)});const o=v({}),a=he(),e=I(),b=v(),f=v(!1),s=X(),c=v(!1),p=F(()=>a.allCourses),d=F(()=>s.showNewOrderDialog),i=async function(){const S=new Map;S.set("location_permalink",n.filters.location_permalink),await a.fetchAllCourses(S).then(()=>{}).catch(m=>{A(e,m)})},r=function(){o.value={}},_=function(S){s.setNewOrderDialogVisibility(S)},T=function(){c.value=o.value.open_ticket};return B(n.filters,()=>{if((n.filters.location_permalink!=o.value.location_permalink||!o.value.course)&&i(),o.value.date=n.filters.date,o.value.location_permalink=n.filters.location_permalink,n.filters.hour&&n.filters.hour!="Tutti gli orari"&&(o.value.hour=n.filters.hour),n.filters.course&&!n.filters.course.id){let S=p.value.find(m=>m.name===n.filters.course.name);S&&(o.value.course=S)}}),B(p,()=>{o.value.course=p.value[0]}),{courses:p,form:o,hours:b,disableForm:c,visible:f,onCloseDialog:r,updateDialog:_,onChecked:T,dialogVisible:d,dialogStore:s}},components:{NewOrderDialog:st}},rt=t("h2",{class:"mt-1"},"Nuova prenotazione",-1),ct={class:"formgrid grid px-0 align-items-center mt-4"},dt={key:0,class:"field flex flex-column w-full col-12"},ut=t("label",{for:"typology"},"Scegli il percorso",-1),mt={key:1,class:"field flex flex-column w-full col-12"},ft=t("label",{for:"typology"},"Seleziona l'orario",-1),_t={class:"flex justify-content-end align-items-center mt-2"},pt={class:"flex align-items-center justify-content-between w-full"},ht=t("h2",null,"Nuova prenotazione",-1);function vt(n,o,a,e,b,f){const s=u("Dropdown"),c=u("Button"),p=u("NewOrderDialog"),d=u("Dialog"),i=u("Card");return k(),j(i,{class:"mt-4"},{content:y(()=>[rt,t("div",ct,[a.filters.location_permalink?(k(),w("div",dt,[ut,l(s,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.course=r),options:e.courses,optionLabel:"name",disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):N("",!0),a.filters.location_permalink?(k(),w("div",mt,[ft,l(s,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.hour=r),options:e.hours,disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):N("",!0)]),t("div",_t,[l(c,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:o[2]||(o[2]=r=>e.updateDialog(!0))},null,8,["disabled"])]),l(d,{visible:e.dialogVisible,"onUpdate:visible":o[5]||(o[5]=r=>e.dialogVisible=r),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1},{header:y(()=>[t("div",pt,[ht,l(c,{icon:"pi pi-times",text:"",rounded:"",onClick:o[3]||(o[3]=r=>e.updateDialog(!1))})])]),default:y(()=>[l(p,{form:e.form,onCloseDialog:o[4]||(o[4]=r=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const yt=P(it,[["render",vt]]),bt={setup(){z(()=>{f.value&&(n.value.location_permalink=f.value.location.permalink,c())});const n=v({}),o=v(),a=de(),e=Q(),b=I(),f=F(()=>a.currentUser),s=F(()=>e.allLocations),c=async function(){await e.fetchAllLocations().then(()=>{}).catch(d=>{A(b,d)})};return{filters:n,orderTable:o,user:f,locations:s,fetchAllLocations:c,formatDate:Y,onUpdateFilters:function(d){n.value.hour=d.start_at,n.value.course={name:d.course_name},d.course&&(n.value.course={id:d.course}),n.value.name=d.name,d.hour&&(d.hour.start_at?n.value.hour=d.hour.start_at:n.value.hour=d.hour)}}},components:{CalendarFilter:Ie,OrderTable:Ue,OrderFilter:He,NewOrderCard:yt}};const gt={class:"flex justify-content-between align-items-center"},kt={class:"field flex flex-column mt-3"},xt={key:0,style:{color:"#495057"}},wt=t("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Ct={class:"capitalize text-xl"},Vt={class:"flex gap-4"},Dt={key:0,class:"col-3 mt-3"},Tt={class:"col-9 mt-3"};function Ot(n,o,a,e,b,f){const s=u("Dropdown"),c=u("CalendarFilter"),p=u("NewOrderCard"),d=u("OrderFilter"),i=u("OrderTable");return k(),w("div",null,[t("div",gt,[t("div",kt,[l(s,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=r=>e.filters.location_permalink=r),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(k(),w("div",xt,[wt,t("span",Ct,O(e.formatDate(e.filters.date)),1)])):N("",!0)]),t("div",Vt,[e.filters.location_permalink?(k(),w("div",Dt,[l(c,{filters:e.filters},null,8,["filters"]),l(p,{filters:e.filters},null,8,["filters"])])):N("",!0),t("div",Tt,[l(d,{filters:e.filters,onOnSubmit:o[1]||(o[1]=r=>e.onUpdateFilters(r))},null,8,["filters"]),e.filters.date?(k(),j(i,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:o[2]||(o[2]=r=>e.onUpdateFilters(r))},null,8,["filters"])):N("",!0)])])])}const Ut=P(bt,[["render",Ot]]);export{Ut as default};
