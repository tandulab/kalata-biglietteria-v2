import{l as _e,m as pe,o as $,p as b,a as G,c as N,_ as q,r as k,b as _,e as p,g as l,f as s,q as F,F as W,t as C,h as U,n as Y,s as re,v as qe,i as X,x as He,w as S,y as me,z as ee,A as $e,B as Je,u as Ge}from"../index83181.js";import{u as Q,a as oe,f as ke,b as ve,c as Ke,d as Qe,e as he,g as ce,h as be,i as We,D as Z,j as ye}from"./location83181.js";import{u as de,s as K,e as P,p as xe,a as Xe,b as we,c as fe,d as Ce}from"./helpers83181.js";import{F as Ye}from"./vee-validate.esm83181.js";class ge{static async fetchAll(t){const o=t.location_permalink;return delete t.location_permalink,(await _e(`/ticket_office/${o}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const o=t.location_permalink;return delete t.location_permalink,(await _e(`/ticket_office/${o}/orders/search_codes`,t)).data}}const ue=pe({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:n=>n.response_tickets.available_ticket_types,allOpenTickets:n=>n.open_tickets_codes.open_tickets,responseTickets:n=>n.response_tickets,getTotalTickets:n=>n.response_tickets?n.response_tickets.total:0,getCurrentTicket:n=>n.ticket},actions:{async fetchAllTickets(n){await ge.fetchAll(n).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(n){await ge.fetchAllOpenTickets(n).then(t=>this.open_tickets_codes=t)}}}),Ze={props:["location_permalink","time_slot"],setup(n,t){$(()=>{o.value=Object.assign({},n.time_slot)});const o=b({}),e=ue(),h=Q(),{showLoader:f,hideLoader:a}=de(),d=G(),g=N(()=>e.allOpenTickets),i=N(()=>h.paymentStatus),w=N(()=>h.paymentModeList),r=N(()=>h.getCurrentOrder),x=async function(M){const y={code:M.query.toUpperCase(),location_permalink:n.location_permalink};await e.fetchAllOpenTickets(y)},D=async function(){var y;const M={id:n.location_permalink,order_id:o.value.id,status:(y=o.value)==null?void 0:y.status,payment_method:o.value.payment_method,open_ticket_codes:[],api_version:"v2"};if(o.value.open_tickets_used&&o.value.open_tickets_used.length>0){let c=[];o.value.open_tickets_used.forEach(u=>{c.push(u.code)}),M.open_ticket_codes=c}v(M)},v=async function(M){f(),await h.updateOrder(M).then(()=>{a(),K(d,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",r.value)}).catch(y=>{a(),P(d,y)})};return{form:o,open_tickets:g,paymentList:i,paymentModeList:w,changeStatus:D,fetchAllOpenTickets:x,onChangeStatus:function(){(o.value.status=="free"||o.value.status=="to_pay")&&(o.value.payment_method=null)}}}},et={key:0,class:"formgrid grid flex-column mt-3"},tt={class:"field col-12"},ot=l("label",{for:"status"},"Stato pagamento",-1),nt={class:"field col-12"},lt=l("label",{for:"payment_method"},"Modalità pagamento",-1),st={key:0,class:"field col-12 flex flex-column"},at=l("label",{for:"user_zip"},"Codice biglietto",-1),it={class:"flex align-items-center justify-content-end mt-3"};function rt(n,t,o,e,h,f){const a=k("Dropdown"),d=k("AutoComplete"),g=k("Button");return _(),p(W,null,[e.form?(_(),p("div",et,[l("div",tt,[ot,s(a,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.status=i),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=i=>e.onChangeStatus())},null,8,["modelValue","options"])]),l("div",nt,[lt,s(a,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.payment_method=i),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full",disabled:e.form.status!="payed"},null,8,["modelValue","options","disabled"])]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(_(),p("div",st,[at,s(d,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[3]||(t[3]=i=>e.form.open_tickets_used=i),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[4]||(t[4]=i=>e.fetchAllOpenTickets(i)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):F("",!0)])):F("",!0),l("div",it,[s(g,{label:"Annulla",text:"",onClick:t[5]||(t[5]=i=>n.$emit("closeDialog",null))}),s(g,{label:"Conferma",onClick:t[6]||(t[6]=i=>e.changeStatus())})])],64)}const ct=q(Ze,[["render",rt]]),dt={props:["order"],setup(n,t){$(()=>{D.value&&x.value&&D.value.forEach(v=>{v.permalink===x.value&&(a.value=v.name)})});const o=b(0),e=b([]),h=b(!1),f=b(!0),a=b(),d=ue(),g=Q();G();const i=oe(),w=N(()=>d.allTickets),r=N(()=>g.getCurrentOrder),x=N(()=>i.getCurrentLocation),D=N(()=>i.allLocations);return{tickets:w,active:o,partialTotals:e,showOrderDetail:h,currentOrder:r,showSecondTab:f,currentLocation:x,selectedLocation:a,formatExplicitDate:ke,formatDate:ve,prettyPaymentStatus:xe,formatPrettyDate:Ke,formatDataAndHourFromUnixTimestamps:Qe,prettyPaymentMethod:Xe}},components:{}};const ut={class:"mt-3 line-height-3"},mt={class:"flex gap-3"},_t=l("i",{class:"pi pi-user mt-1"},null,-1),ft={class:"m-0 mb-1"},pt={class:"m-0 mb-1"},vt={class:"m-0 mb-1"},ht={class:"m-0 mb-1"},yt={key:0},gt={class:"flex gap-3 mt-4"},kt=l("i",{class:"pi pi-map-marker mt-1"},null,-1),bt={class:"m-0 mb-1"},xt={class:"m-0 mb-1"},wt={key:0,class:"m-0 mb-1"},Ct={class:"flex gap-3 mt-4"},Dt=l("i",{class:"pi pi-shopping-cart mt-1"},null,-1),St={class:"m-0 mb-1"},Ot={class:"m-0 mb-1"},Tt={class:"m-0 mb-1"},Vt={key:0,class:"m-0 mb-1"},At={key:1,class:"m-0 mb-1"},Ft={key:2,class:"m-0 mb-1"},Nt={class:"m-0 mb-1"},Lt={class:"m-0 mb-1"},Mt={key:0},Ut={key:1},Pt={key:0,class:"flex gap-3 mt-4"},Bt=l("i",{class:"pi pi-comment mt-1"},null,-1);function Rt(n,t,o,e,h,f){const a=k("Badge");return _(),p("div",ut,[l("div",mt,[_t,l("div",null,[l("p",ft,C(o.order.user_name)+" "+C(o.order.user_surname||"-"),1),l("p",pt,C(o.order.user_email),1),l("p",vt,C(o.order.user_phone),1),l("p",ht,[U(C(o.order.country)+" ",1),o.order.user_zip?(_(),p("span",yt," - "+C(o.order.user_zip),1)):F("",!0)])])]),l("div",gt,[kt,l("div",null,[l("p",bt,C(e.selectedLocation),1),l("p",xt,C(o.order.course_name),1),o.order.date?(_(),p("p",wt,C(e.formatPrettyDate(o.order.date))+" "+C(o.order.start_at),1)):F("",!0)])]),l("div",Ct,[Dt,l("div",null,[l("p",St,C(o.order.reservation_number),1),l("p",Ot,C(e.formatDataAndHourFromUnixTimestamps(o.order.created_at)),1),l("p",Tt,C(o.order.created_by),1),o.order.status?(_(),p("p",Vt,[s(a,{value:e.prettyPaymentStatus(o.order.status),class:Y([o.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):F("",!0),o.order.status=="payed"?(_(),p("p",At,C(e.prettyPaymentMethod(o.order.payment_method)),1)):F("",!0),o.order.open_tickets_used&&o.order.status=="payed"?(_(),p("p",Ft,[(_(!0),p(W,null,re(o.order.open_tickets_used,d=>(_(),p("span",{key:d},[s(a,{value:d.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):F("",!0),l("p",Nt,"Codice sconto utilizzato: "+C(o.order.discount_code||"-"),1),l("p",Lt,[U(" Totale ordine: "),o.order.total?(_(),p("span",Mt,"€ "+C((+o.order.total).toFixed(2)),1)):(_(),p("span",Ut,"-"))])])]),o.order.notes?(_(),p("div",Pt,[Bt,l("div",null,C(o.order.notes),1)])):F("",!0)])}const zt=q(dt,[["render",Rt]]),Et={props:["order","location_permalink"],setup(n,t){$(()=>{n.order&&n.order.notes&&(o.value=n.order.notes)});const o=b(),{showLoader:e,hideLoader:h}=de(),f=G(),a=Q(),d=N(()=>a.getCurrentOrder);return{notes:o,updateOrder:async function(){const i={id:n.location_permalink,order_id:n.order.id,notes:o.value,api_version:"v2"};e(),await a.updateOrder(i).then(()=>{h(),K(f,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",d.value)}).catch(w=>{h(),P(f,w)})}}}},jt={class:"pt-5 px-2"},It={class:"flex align-items-center justify-content-end mt-3"};function qt(n,t,o,e,h,f){const a=k("Textarea"),d=k("Button");return _(),p("div",jt,[s(a,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=g=>e.notes=g),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",It,[s(d,{label:"Annulla",text:"",onClick:t[1]||(t[1]=g=>n.$emit("closeDialog",null))}),s(d,{label:"Conferma",onClick:t[2]||(t[2]=g=>e.updateOrder())})])])}const Ht=q(Et,[["render",qt]]),$t={props:["filters"],setup(n,t){$(()=>{c.value=!0,u.value={first:0,rows:D.value.rows,sortField:null,sortOrder:null},u.value.page=0,n.filters.location_permalink&&z()});const o=Q(),e=he(),h=N(()=>o.responseOrders),f=N(()=>o.status),a=qe(),d=N(()=>a.submitDialog),g=N(()=>o.paymentStatus),i=N(()=>o.getDeleteResponse),{showLoader:w,hideLoader:r}=de(),x=G(),D=b(),v=b(),T=b(),M=b(),y=b(),c=b(!0),u=b(),O=b(0),j=b([]),H=b([]),te=b(!1),ne=b(!1),V=b(),R=b(!1);function z(){c.value=!0;let m=new Map;for(const A in n.filters)A=="date"?ce(n.filters.date)=="Invalid DateTime"?m.set("date",be(n.filters.date)):m.set("date",ce(n.filters.date)):n.filters.location_permalink&&m.set("location_permalink",n.filters.location_permalink),A=="course"&&n.filters.course.id!="-1"&&m.set("course",n.filters.course.id),A=="hour"&&n.filters.hour!="Tutti gli orari"&&m.set("hour",n.filters.hour),A=="name"&&m.set("name",n.filters.name);setTimeout(()=>{le(m)},Math.random()*1e3+250)}const le=async function(m){await o.fetchAllOrders(m).then(()=>{c.value=!1}).catch(A=>{c.value=!1,P(x,A)})},se=m=>{T.value.toggle(m),V.value.toggle(m)},ae=(m,A)=>m>m+A?"red":"green",ie=function(m,A){A&&(T.value.note=A,T.value.toggle(m))},I=function(m){m.order&&h.value.time_slots&&h.value.time_slots.forEach((A,L)=>{A.orders.forEach((B,E)=>{B.id==m.order.id&&(h.value.time_slots[L].orders[E]=m.order,m.check_in_done!=null&&(h.value.time_slots[L].check_in_done+=m.check_in_done))})})},Se=async function(m,A){let L=[],B=!1;H.value.forEach(J=>{if(J.id==m.id){B=!0;return}});for(let J of m.tickets)L.push(J.order_item_id);const E={check_in:A,order_item_ids:L,location_permalink:n.filters.location_permalink};await o.checkInOrder(E).then(()=>{I(i.value),K(x,{message:"Check-in registrato correttamente",error:!1}),B&&H.value.push(i.value.order)}).catch(J=>{P(x,J)})},Oe=async function(m,A){let L=[],B=!1;H.value.forEach(J=>{if(J.id==m.id){B=!0;return}});for(let J of m.tickets)L.push(J.order_item_id);const E={order_item_ids:L,no_show:A,location_permalink:n.filters.location_permalink};await o.noShowOrder(E).then(()=>{I(i.value),K(x,{message:"No-show registrato correttamente",error:!1}),B&&H.value.push(i.value.order)}).catch(J=>{P(x,J)})},Te=async function(m,A,L){const B={id:m,check_in:A,location_permalink:n.filters.location_permalink};await o.checkInTicket(B).then(()=>{K(x,{message:"Check-in registrato correttamente",error:!1}),I(i.value),H.value.push(i.value.order)}).catch(E=>{P(x,E)})},Ve=async function(m,A,L){const B={id:m,no_show:A,location_permalink:n.filters.location_permalink};await o.noShowTicket(B).then(()=>{K(x,{message:"No-show registrato correttamente",error:!1}),I(i.value),H.value.push(i.value.order)}).catch(E=>{P(x,E)})},Ae=function(m){const A={course_name:m.course_name,start_at:m.start_at,date:n.filters.date,hour:m.start_at,max_seats:m.is_free_slot?null:m.remaing_seats+""};t.emit("updateFilters",A)},Fe=function(m){te.value=!0,M.value=m},Ne=function(m){I({order:m}),te.value=!1,R.value=!1},Le=function(m){return m!=null&&m.created_by?m.created_by:""},Me=function(m,A){let L=0;if(m&&m.tickets){m.tickets.forEach(E=>{A?E.no_show&&(L+=1):E.check_in&&(L+=1)});let B=m.tickets.length;if(L!=B&&L!=0)return L+"/"+B}},Ue=function(m,A){V.value.data=A,V.value.toggle(m)},Pe=function(m,A){y.value=A.id;let L="Sei sicuro di voler eliminare questa prenotazione?";L+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',a.setDialog("Elimina prenotazione","Elimina","Annulla",L),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},Be=function(){if(w(),y.value){const m={id:y.value,location_permalink:n.filters.location_permalink};o.deleteOrder(m).then(()=>{r(),K(x,{message:"La prenotazione è stata eliminata correttamente",error:!1}),h.value.time_slots&&h.value.time_slots.forEach((A,L)=>{A.orders.forEach((B,E)=>{B.id==y.value&&(h.value.time_slots[L].orders.splice(E,1),i.value,h.value.time_slots[L].check_in_done+=i.value.check_in_done,h.value.time_slots[L].confirmed_seats+=i.value.confirmed_seats,h.value.time_slots[L].remaing_seats-=i.value.confirmed_seats)})})}).catch(A=>{r(),P(x,A)})}},Re=function(m){j.value=m.data?[m.data]:[]},ze=function(m){H.value=m.data?[m.data]:[]},Ee=function(m){ne.value=!0,v.value=m},je=function(m){R.value=!0,v.value=m},Ie=function(m){const A=new Map;A.set("id",m.id),A.set("location_permalink",n.filters.location_permalink),w(),o.downloadTicket(A).then(()=>{r()}).catch(L=>{r(),P(x,L)})};return X(d,m=>{m&&Be()}),X(n.filters,()=>{n.filters.location_permalink&&z()}),{dt:D,responseOrders:h,loading:c,totalRecords:O,lazyParams:u,currentOrder:v,status:f,expandedRows:j,expandedRows1:H,op:T,dialogStore:e,paymentList:g,visibleDialog:te,currentTimeSlot:M,visibleMenu:V,visibleDetailDialog:ne,visibleNotesDialog:R,toast:x,loadLazyData:z,toggle:se,getProgressClass:ae,showNotes:ie,checkAll:Se,noShowAll:Oe,openDialog:Ae,checkInSingleTicket:Te,noShowSingleTicket:Ve,prettyPaymentStatus:xe,openPaymentStatusDialog:Fe,onClosePaymentStatusDialog:Ne,getRowClass:Le,printPDF:we,showLabelCheckbox:Me,confirmDeleteOrder:Pe,showMenu:Ue,openOrderDetailDialog:Ee,openNotesDialog:je,downloadPDF:Ie,handleRowToggle:Re,handleRowToggle1:ze,formatDataFromUnixTimestamps:We,printOrderPDF:fe}},components:{PaymentStatusDialog:ct,OrderDetailDialog:zt,NotesDialog:Ht}};const Jt={class:"order-table"},Gt={class:""},Kt={style:{width:"15rem"}},Qt={class:"m-0 text-right",style:{"font-size":"12px"}},Wt={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Xt={style:{width:"15rem"}},Yt={class:"m-0 text-right",style:{"font-size":"12px"}},Zt={key:0},eo={key:0},to=l("div",{class:"flex justify-content-center w-full"},"Check-in",-1),oo={class:"flex justify-content-center"},no={class:"flex flex-column",style:{"margin-top":"8px"}},lo={class:"text-sm",style:{"min-height":"15px"}},so=l("div",{class:"flex justify-content-center w-full"},"No-show",-1),ao={class:"flex justify-content-center"},io={class:"flex flex-column",style:{"margin-top":"8px"}},ro={class:"text-sm",style:{"min-height":"15px"}},co=["onClick"],uo={style:{"max-width":"50rem"},class:"p-3"},mo={class:"overlay-menu"},_o=["onClick"],fo=l("i",{class:"pi pi-eye mr-3"},null,-1),po=["onClick"],vo=l("i",{class:"pi pi-print mr-3"},null,-1),ho=["onClick"],yo=l("i",{class:"pi pi-download mr-3"},null,-1),go=["onClick"],ko=l("i",{class:"pi pi-comment mr-3"},null,-1),bo=["disabled","onClick"],xo=l("i",{class:"pi pi-pencil mr-3"},null,-1),wo=["disabled","onClick"],Co=l("i",{class:"pi pi-trash mr-3"},null,-1),Do={key:0},So={key:1},Oo=l("div",{class:"flex justify-content-center w-full"},"Check-in",-1),To={class:"flex justify-content-center"},Vo=l("div",{class:"flex justify-content-center w-full"},"No-show",-1),Ao={class:"flex justify-content-center"},Fo=l("div",{class:"flex justify-content-center w-full"},null,-1),No={class:"flex justify-content-center"},Lo={key:0,class:"flex mx-4"},Mo=l("div",null,[l("div",{class:"p-0 m-0 flex align-items-center"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),l("span",{class:"text-sm"},"WEB")]),l("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),l("span",{class:"text-sm"},"KALATA")])],-1),Uo=[Mo];function Po(n,t,o,e,h,f){const a=k("Column"),d=k("ProgressBar"),g=k("Button"),i=k("Badge"),w=k("Checkbox"),r=k("OverlayPanel"),x=k("DataTable"),D=k("PaymentStatusDialog"),v=k("Dialog"),T=k("OrderDetailDialog"),M=k("NotesDialog"),y=He("tooltip");return _(),p("div",Jt,[s(x,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=c=>e.expandedRows=c),onRowExpand:e.handleRowToggle},{empty:S(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:S(c=>[s(x,{value:c.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=u=>e.expandedRows1=u),rowClass:e.getRowClass,onRowExpand:e.handleRowToggle1},{empty:S(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:S(u=>[s(x,{value:u.data.tickets,class:"m-4 mx-5"},{default:S(()=>[s(a,{header:"Codice biglietto",field:"code"}),s(a,{header:"Tipo biglietto",field:"type"},{body:S(({data:O})=>[s(i,{value:O.ticket_name,class:Y([O.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),s(a,{header:"Prezzo"},{body:S(({data:O})=>[O.ticket_price?(_(),p("span",Do," € "+C((+O.ticket_price).toFixed(2)),1)):(_(),p("span",So,"-"))]),_:1}),s(a,null,{header:S(()=>[Oo]),body:S(({data:O})=>[l("div",To,[s(w,{modelValue:O.check_in,"onUpdate:modelValue":j=>O.check_in=j,binary:!0,onChange:j=>e.checkInSingleTicket(O.id,O.check_in,u.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),s(a,null,{header:S(()=>[Vo]),body:S(({data:O})=>[l("div",Ao,[s(w,{modelValue:O.no_show,"onUpdate:modelValue":j=>O.no_show=j,binary:!0,onChange:j=>e.noShowSingleTicket(O.id,O.no_show,u.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),s(a,{field:"tickets_url"},{header:S(()=>[Fo]),body:S(({data:O})=>[l("div",No,[me(s(g,{link:"",icon:"pi pi-print",href:O.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:j=>e.printPDF(O.id,o.filters.location_permalink,e.toast)},null,8,["href","onClick"]),[[y,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:S(()=>[s(a,{header:"Codice",field:"reservation_number"}),s(a,{header:"Acquirente"},{body:S(({data:u})=>[U(C(u.user_name)+" "+C(u.user_surname)+" ",1),!u.user_name&&!u.user_surname?(_(),p("span",Zt,"-")):F("",!0)]),_:1}),s(a,{header:"Pagamento"},{body:S(({data:u})=>[u.status?(_(),p("span",eo,[s(i,{value:e.prettyPaymentStatus(u.status),class:Y([u.status,"px-3 border-round-lg"])},null,8,["value","class"])])):F("",!0)]),_:1}),s(a,{header:"Q.ta",field:"tickets_number"}),s(a,null,{header:S(()=>[to]),body:S(({data:u})=>[l("div",oo,[l("div",no,[s(w,{modelValue:u.check_in,"onUpdate:modelValue":O=>u.check_in=O,binary:!0,onChange:O=>e.checkAll(u,u.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",lo,C(e.showLabelCheckbox(u,!1)),1)])])]),_:1}),s(a,null,{header:S(()=>[so]),body:S(({data:u})=>[l("div",ao,[l("div",io,[s(w,{modelValue:u.no_show,"onUpdate:modelValue":O=>u.no_show=O,binary:!0,onChange:O=>e.noShowAll(u,u.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",ro,C(e.showLabelCheckbox(u,!0)),1)])])]),_:1}),s(a,{header:"Note"},{body:S(({data:u})=>[l("div",{class:"notes cursor-pointer",onClick:O=>e.showNotes(O,u.notes)},C(u.notes||"-"),9,co),s(r,{ref:"op"},{default:S(()=>[l("div",uo,C(e.op.note),1)]),_:1},512)]),_:1}),s(a,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:S(({data:u})=>[s(g,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:O=>e.showMenu(O,u)},null,8,["onClick"]),s(r,{ref:"visibleMenu"},{default:S(()=>[l("ul",mo,[l("li",{onClick:O=>e.openOrderDetailDialog(e.visibleMenu.data)},[fo,U("Dettaglio ordine ")],8,_o),l("li",{onClick:O=>e.printOrderPDF(e.visibleMenu.data,o.filters.location_permalink,e.toast)},[vo,U("Stampa ")],8,po),l("li",{onClick:O=>e.downloadPDF(e.visibleMenu.data)},[yo,U("Scarica PDF ")],8,ho),l("li",{onClick:O=>e.openNotesDialog(e.visibleMenu.data)},[ko,U("Modifica nota ")],8,go),l("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:O=>e.openPaymentStatusDialog(e.visibleMenu.data)},[xo,U("Cambia stato ")],8,bo),l("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:O=>e.confirmDeleteOrder(O,e.visibleMenu.data)},[Co,U("Elimina ")],8,wo)])]),_:2},1536)]),_:1}),s(a,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),c.data.orders&&c.data.orders.length>0?(_(),p("div",Lo,Uo)):F("",!0)]),default:S(()=>[s(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),s(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:S(({data:c})=>[l("div",Gt,[l("span",{class:Y(c.is_free_slot?"free":"")},C(c.start_at),3)])]),_:1},512),s(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:S(({data:c})=>[l("div",Kt,[l("p",Qt,[U(C(c.confirmed_seats)+"/"+C(c.remaing_seats+c.confirmed_seats)+" ",1),c.confirmed_seats>c.remaing_seats+c.confirmed_seats?me((_(),p("i",Wt,null,512)),[[y,c.confirmed_seats-(c.remaing_seats+c.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):F("",!0)]),s(d,{value:c.confirmed_seats*100/(c.remaing_seats+c.confirmed_seats),showValue:!1,style:{height:"10px"},class:Y(["available-progress",e.getProgressClass(c.confirmed_seats,c.remaing_seats)])},null,8,["value","class"])])]),_:1},512),s(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:S(({data:c})=>[l("div",Xt,[l("p",Yt,C(c.check_in_done)+"/"+C(c.confirmed_seats),1),s(d,{value:c.check_in_done*100/(c.remaing_seats+c.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),s(a,null,{body:S(({data:c})=>[me(s(g,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:u=>e.openDialog(c)},null,8,["onClick"]),[[y,"Prenota",void 0,{top:!0}]])]),_:1}),s(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),s(v,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=c=>e.visibleDialog=c),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:S(()=>[s(D,{location_permalink:o.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=c=>e.onClosePaymentStatusDialog(c))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),s(v,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=c=>e.visibleDetailDialog=c),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:S(()=>[s(T,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),s(v,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=c=>e.visibleNotesDialog=c),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:S(()=>[s(M,{order:e.currentOrder,location_permalink:o.filters.location_permalink,onCloseDialog:t[5]||(t[5]=c=>e.onClosePaymentStatusDialog(c))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const Bo=q($t,[["render",Po]]),Ro={props:["filters"],setup(n,t){$(()=>{x(),o.value=n.filters,o.value.date=new Date,T()});const o=b({}),e=oe(),h=Q(),f=G(),a=b([]),d=b(),g=Z.now().plus({months:5}).endOf("month"),i=N(()=>e.allLocations),w=N(()=>h.getCalendar),r=async function(c){await h.fetchCalendar(c).then(()=>{}).catch(u=>{P(f,u)})},x=async function(){await e.fetchAllLocations().then(()=>{}).catch(c=>{P(f,c)})},D=function(){if(n.filters.location_permalink){const c=i.value.find(u=>u.permalink===n.filters.location_permalink);a.value=c.courses}},v=function(c){let u={};u.month=Z.fromJSDate(new Date(c)).month,u.year=Z.fromJSDate(new Date(c)).year,u.location_permalink=n.filters.location_permalink,d.value={month:u.month,year:u.year},r(u)},T=function(){let c=Z.now(),u={location_permalink:"",month:"",year:""};u.location_permalink=n.filters.location_permalink,u.month=c.month+"",u.year=c.year+"",r(u)},M=function(c){if(w.value.web_dates&&w.value.web_dates.length!=0){let u=c.month+1;u=u<10?"0"+u:u;let O=c.day<10?"0"+c.day:c.day,j=c.year+"-"+u+"-"+O;return w.value.web_dates.find(H=>H==j)}},y=function(c){let u={location_permalink:n.filters.location_permalink,month:c.month,year:c.year};r(u)};return X(n.filters,()=>{if(d.value){let c={location_permalink:n.filters.location_permalink,month:d.value.month,year:d.value.year};r(c)}else T()}),{form:o,courses:a,maxAllowedDate:g,locations:i,calendar:w,getCourses:D,onDateChange:v,getDayFromDate:M,onMonthChange:y}}};const zo={class:"flex calendar-filter"},Eo={key:0,class:"special-day"};function jo(n,t,o,e,h,f){const a=k("Calendar");return _(),p("div",zo,[s(a,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.date=d),inline:"",onDateSelect:t[1]||(t[1]=d=>e.onDateChange(d)),onMonthChange:t[2]||(t[2]=d=>e.onMonthChange(d)),maxDate:e.maxAllowedDate.toJSDate()},{date:S(d=>[e.getDayFromDate(d.date)?(_(),p("div",Eo,[l("span",null,C(d.date.day),1)])):(_(),p(W,{key:1},[U(C(d.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const Io=q(Ro,[["render",jo]]);class qo{static async fetchAll(t){const o=t.location_permalink;return delete t.location_permalink,(await _e(`/ticket_office/${o}/search/courses`,t)).data}}const De=pe({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:n=>n.response_courses.tickets,responseCourses:n=>n.response_courses,getTotalCourses:n=>n.response_courses?n.response_courses.total:0,getCurrentCourse:n=>n.course},actions:{async fetchAllCourses(n){await qo.fetchAll(n).then(t=>this.response_courses=t)}}}),Ho={props:["filters"],setup(n,t){$(()=>{o.value=Object.assign({},n.filters),o.value.date=Z.now().toFormat("dd/MM/yyyy"),a.value=Ce(8,20),a.value.unshift("Tutti gli orari"),o.value.hour="Tutti gli orari"});const o=b({}),e=b([]),h=oe(),f=G(),a=b([]),d=Q(),g=De(),i=N(()=>h.allLocations),w=N(()=>d.responseOrders),r=N(()=>g.allCourses),x=function(){o.value.name=null,o.value.course=e.value[0].name,o.value.hour=a.value[0],t.emit("onSubmit",o.value)},D=async function(){const v={location_permalink:o.value.location_permalink,api_version:"v2"};await g.fetchAllCourses(v).then(()=>{}).catch(T=>{P(f,T)})};return X(i,()=>{n.filters.location_permalink&&i.value&&(o.value=Object.assign({},n.filters),o.value.hour||(o.value.hour="Tutti gli orari"),D())}),X(n.filters,()=>{n.filters.location_permalink&&i.value&&o.value.location_permalink&&o.value.location_permalink!=n.filters.location_permalink&&(o.value=Object.assign({},n.filters),o.value.hour||(o.value.hour="Tutti gli orari"))}),X(r,()=>{var v;e.value=Object.assign([],r.value),e.value&&((v=e.value[0])==null?void 0:v.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),o.value.course=e.value[0].name}),{form:o,courses:e,hours:a,locations:i,responseOrders:w,resetField:x}}},$o={class:"formgrid grid px-0 align-items-center"},Jo={key:0,class:"field col-4 flex flex-column"},Go=l("label",{for:"typology"},"Filtra per percorso",-1),Ko={key:1,class:"field col-3 flex flex-column"},Qo=l("label",{for:"typology"},"Filtra per orario (dalle)",-1),Wo=l("div",{class:"col-12"},null,-1),Xo={class:"field col-4 flex flex-column"},Yo=l("label",{for:"typology"},"Filtra per nome acquirente",-1),Zo={class:"flex col-12 justify-content-end pt-1"};function en(n,t,o,e,h,f){const a=k("Dropdown"),d=k("InputText"),g=k("Button"),i=k("AccordionTab"),w=k("Accordion");return _(),ee(w,{activeIndex:0},{default:S(()=>[s(i,{header:"FILTRI"},{default:S(()=>[l("div",$o,[e.form.location_permalink?(_(),p("div",Jo,[Go,s(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.course=r),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):F("",!0),e.responseOrders?(_(),p("div",Ko,[Qo,s(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.hour=r),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):F("",!0),Wo,l("div",Xo,[Yo,s(d,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.name=r),placeholder:""},null,8,["modelValue"])])]),l("div",Zo,[s(g,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=r=>n.$emit("onSubmit",e.form))}),s(g,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=r=>e.resetField())})])]),_:1})]),_:1})}const tn=q(Ho,[["render",en]]),on={props:["form","price","index","ticket"],setup(n,t){const o=b(0),e=function(){o.value++,f()},h=function(){o.value>0&&o.value--,f()},f=function(){o.value==null&&(o.value=0);const a={counter:o.value,price:n.price,index:n.index,ticket:n.ticket};t.emit("changeCounter",a)};return{counter:o,decrement:h,increment:e,emitEvent:f}}};const nn={class:"btn-plus-min flex align-items-center"},ln={class:"counter"};function sn(n,t,o,e,h,f){const a=k("Button"),d=k("InputNumber");return _(),p("div",nn,[s(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),l("div",ln,[s(d,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=g=>e.counter=g),t[1]||(t[1]=g=>e.emitEvent())],min:0},null,8,["modelValue"])]),s(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const an=q(on,[["render",sn]]),rn={props:["tickets","form"],setup(n,t){$(()=>{h.value=!1,a.discount={},f.value=null,n.form.max_seats&&n.form.max_seats<0?(i.value=!0,w.value=-n.form.max_seats):i.value=!1});const o=b(0),e=b([]),h=b(!1),f=b(),a=Q(),d=G(),g=b(!1),i=b(!1),w=b(),r=N(()=>a.getDiscount),x=function(y){e.value[y.index]={partial_total:y.price*y.counter,ticket:y.ticket,quantity:y.counter},o.value=0;let c=0;e.value.forEach(u=>{o.value+=u.partial_total,c+=u.quantity}),i.value||(n.form.max_seats&&c>+n.form.max_seats?(w.value=c-+n.form.max_seats,g.value=!0):(w.value=null,g.value=!1)),f.value&&v()},D=function(){v()},v=async function(){let y=[];e.value.forEach(u=>{y.push({id:u.ticket.id,quantity:u.quantity})});const c={discount_code:f.value,location_permalink:n.form.location_permalink,tickets:y};await a.cost(c).then(()=>{}).catch(u=>{P(d,u)})};return{total:o,partialTotals:e,showDiscount:h,discountCode:f,discount:r,showAlert:g,showAlert2:i,numOverbooking:w,onChangeCounter:x,applyDiscount:D,checkDisabled:function(){let y=!1;(!e.value||e.value.length==0)&&(y=!0);let c=0;return e.value.forEach(u=>{c+=u.quantity}),c==0&&(y=!0),t.emit("disableSecondoTab",!0),y},nextTab:function(){const y={discount_code:f.value,partial_total:e.value};t.emit("nextTab",y)}}},components:{PlusMinusButton:an}};const cn={key:0},dn={key:1},un={key:0},mn={key:1},_n={key:0,class:"flex justify-content-between align-items-center"},fn={class:"flex align-items-center col-9"},pn={class:"col-7 pl-0"},vn={class:"text-right col-2"},hn={class:"col-3 flex justify-content-end"},yn={key:2,class:"mt-3 mb-5"},gn=l("i",null,"Nessuna tipologia di biglietto trovata.",-1),kn=[gn],bn=l("hr",{class:"mt-3"},null,-1),xn={class:"flex align-items-center justify-content-between py-0"},wn={class:"col-9 flex"},Cn=l("b",null,"Totale",-1),Dn=[Cn],Sn={class:"col-2 text-right font-bold"},On={class:"col-3 flex justify-content-end"};function Tn(n,t,o,e,h,f){const a=k("Message"),d=k("PlusMinusButton"),g=k("Button");return _(),p(W,null,[e.showAlert?(_(),ee(a,{key:0,severity:"warn",closable:!1},{default:S(()=>[U("Attenzione! Si sta andando in overbooking di "+C(e.numOverbooking)+" ",1),e.numOverbooking==1?(_(),p("span",cn,"posto")):(_(),p("span",dn,"posti"))]),_:1})):F("",!0),e.showAlert2?(_(),ee(a,{key:1,severity:"warn",closable:!1},{default:S(()=>[U("Attenzione! Lo slot orario è già in overbooking di "+C(e.numOverbooking)+" ",1),e.numOverbooking==1?(_(),p("span",un,"posto")):(_(),p("span",mn,"posti"))]),_:1})):F("",!0),(_(!0),p(W,null,re(o.tickets,(i,w)=>{var r,x,D;return _(),p("div",{key:i.id},[((r=i.course)==null?void 0:r.id)==((x=o.form.course)==null?void 0:x.id)?(_(),p("div",_n,[l("div",fn,[l("b",pn,C(i.name),1),l("div",vn,"€ "+C((D=i.price)==null?void 0:D.toFixed(2)),1)]),l("div",hn,[s(d,{onChangeCounter:t[0]||(t[0]=v=>e.onChangeCounter(v)),price:i.price,index:w,ticket:i},null,8,["price","index","ticket"])])])):F("",!0)])}),128)),o.tickets&&o.tickets.length==0?(_(),p("div",yn,kn)):F("",!0),bn,l("div",xn,[l("div",wn,[l("div",{class:Y(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-7"])},Dn,2),l("div",Sn,"€ "+C(e.total.toFixed(2)),1)]),l("div",On,[s(g,{label:"Prosegui",onClick:t[1]||(t[1]=i=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Vn=q(rn,[["render",Tn]]);class An{static async fetchAll(){return(await $e("/countries")).data.countries}}const Fn=pe({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:n=>n.countries},actions:{async fetchAllCountries(){await An.fetchAll().then(n=>this.countries=n)}}}),Nn={props:["location_permalink"],setup(n,t){$(()=>{r()});const o=ue(),e=Fn(),h=Q(),f=b({}),a=b(),d=N(()=>e.allCountries),g=N(()=>o.allOpenTickets),i=N(()=>h.paymentStatus),w=N(()=>h.paymentModeList),r=async function(){await e.fetchAllCountries().then(()=>{f.value.country_id=88,f.value.status={id:"payed",name:"Pagato"}})};return{form:f,countries:d,paymentList:i,paymentModeList:w,errorMessage:a,open_tickets:g,fetchAllOpenTickets:async function(T){const M={code:T.query.toUpperCase(),location_permalink:n.location_permalink};await o.fetchAllOpenTickets(M)},onChangeStatus:function(){f.value.status.id&&(f.value.status.id=="free"||f.value.status.id=="to_pay")&&(f.value.payment_method=null)},onConfirm:function(){if(f.value.status&&f.value.status.id=="payed"&&!f.value.payment_method){a.value="Seleziona un metodo di pagamento";return}t.emit("nextTab",f.value)}}}},Ln={key:0,class:"formgrid grid"},Mn={class:"field col-6"},Un=l("label",{for:"user_name"},"Nome",-1),Pn={class:"field col-6"},Bn=l("label",{for:"user_surname"},"Cognome",-1),Rn={class:"field col-6"},zn=l("label",{for:"user_email"},"Email",-1),En={class:"field col-6"},jn=l("label",{for:"user_phone"},"Telefono",-1),In={class:"field col-6"},qn=l("label",{for:"country_id"},"Nazione",-1),Hn={class:"field col-6"},$n=l("label",{for:"user_zip"},"Cap",-1),Jn={class:"field col-6"},Gn=l("label",{for:"status"},"Stato pagamento",-1),Kn={class:"field col-6"},Qn={for:"payment_method"},Wn={key:0},Xn={class:"p-float-label"},Yn={class:"p-error",id:"dd-error"},Zn={key:0,class:"field col-6 flex flex-column"},el=l("label",{for:"user_zip"},"Codice biglietto",-1),tl={class:"field col-12"},ol={class:"field flex flex-column"},nl=l("label",{for:"notes"},"Note",-1),ll={class:"col-12 flex justify-content-end"};function sl(n,t,o,e,h,f){const a=k("InputText"),d=k("Dropdown"),g=k("AutoComplete"),i=k("Textarea"),w=k("Button");return e.form?(_(),p("div",Ln,[l("div",Mn,[Un,s(a,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.user_name=r),class:"w-full"},null,8,["modelValue"])]),l("div",Pn,[Bn,s(a,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.user_surname=r),class:"w-full"},null,8,["modelValue"])]),l("div",Rn,[zn,s(a,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.user_email=r),class:"w-full"},null,8,["modelValue"])]),l("div",En,[jn,s(a,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=r=>e.form.user_phone=r),class:"w-full"},null,8,["modelValue"])]),l("div",In,[qn,s(d,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=r=>e.form.country_id=r),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),l("div",Hn,[$n,s(a,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=r=>e.form.user_zip=r),class:"w-full"},null,8,["modelValue"])]),l("div",Jn,[Gn,s(d,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=r=>e.form.status=r),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=r=>e.onChangeStatus())},null,8,["modelValue","options"])]),l("div",Kn,[l("label",Qn,[U("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(_(),p("span",Wn,"*")):F("",!0)]),l("span",Xn,[s(d,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=r=>e.form.payment_method=r),options:e.paymentModeList,optionLabel:"label",class:Y(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=r=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),l("small",Yn,C(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.label=="Biglietto a data aperta (voucher)"?(_(),p("div",Zn,[el,s(g,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=r=>e.form.open_ticket_codes=r),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[11]||(t[11]=r=>e.fetchAllOpenTickets(r)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):F("",!0),l("div",tl,[l("div",ol,[nl,s(i,{modelValue:e.form.notes,"onUpdate:modelValue":t[12]||(t[12]=r=>e.form.notes=r),rows:"5",cols:"30"},null,8,["modelValue"])])]),l("div",ll,[s(w,{label:"Conferma",onClick:t[13]||(t[13]=r=>e.onConfirm())})])])):F("",!0)}const al=q(Nn,[["render",sl]]);var il=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,rl={root:function(t){var o=t.instance;return["p-contextmenu p-component",{"p-input-filled":o.$primevue.config.inputStyle==="filled","p-ripple-disabled":o.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var o=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":o.isItemActive(e),"p-focus":o.isItemFocused(e),"p-disabled":o.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var o=t.props,e=t.isActive,h=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":o.exact&&h}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Je.extend({name:"contextmenu",css:il,classes:rl});const cl={props:["form"],setup(n,t){$(()=>{T()});const o=b(0),e=b([]),h=b(!1),f=b(!0),a=b(),d=b([]),{showLoader:g,hideLoader:i}=de(),w=ue(),r=Q(),x=G(),D=N(()=>w.allTickets),v=N(()=>r.getCurrentOrder),T=async function(){const V={location_permalink:n.form.location_permalink,api_version:"v2",date:y(n.form.date),course_id:n.form.course.id};await w.fetchAllTickets(V).then(()=>{}).catch(R=>{P(x,R)})},M=function(V){o.value+=1,a.value=V.discount_code,e.value=Object.assign([],V.partial_total),f.value=!1},y=function(V){return ce(V).includes("Invalid")?be(V):ce(V)},c=function(V){u(V)},u=async function(V){var se,ae,ie;const R=[{start_at:n.form.hour,tickets:[]}];e.value.forEach(I=>{I.quantity!=0&&R[0].tickets.push({id:I.ticket.id,quantity:I.quantity})});let z=[];V.open_ticket_codes&&V.open_ticket_codes.forEach(I=>{z.push(I.code)});const le={location_permalink:n.form.location_permalink,country_id:V.country_id,status:V.status.id,user_email:V.user_email,user_name:V.user_name,user_phone:V.user_phone,user_surname:V.user_surname,user_zip:V.user_zip,api_version:"v2",date:n.form.date?y(n.form.date):"",notes:V.notes,time_slots:R,payment_method:(se=V.payment_method)==null?void 0:se.id,course_id:(ie=(ae=n.form)==null?void 0:ae.course)==null?void 0:ie.id,open_ticket_codes:z};a.value&&(le.discount_code=a.value),await r.createOrder(le).then(()=>{o.value+=1,f.value=!0,h.value=!0}).catch(I=>{P(x,I)})},O=function(){fe(v==null?void 0:v.value,n.form.location_permalink,x),t.emit("closeDialog",!0)},j=function(V){f.value=V},H=function(){fe(v==null?void 0:v.value,n.form.location_permalink,x),te()},te=async function(){let V=[];if(!v.value&&!n.form.location_permalink)return;for(let z of v.value.tickets)V.push(z.order_item_id);const R={check_in:!0,order_item_ids:V,location_permalink:n.form.location_permalink};await r.checkInOrder(R).then(()=>{K(x,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(z=>{P(x,z)})},ne=function(){g();const V={location_permalink:n.form.location_permalink,order_id:v.value.id};r.sendEmail(V).then(()=>{K(x,{message:"Email inviata correttamente al cliente",error:!1}),i(),t.emit("closeDialog",!0)}).catch(R=>{i(),P(x,R)})};return X(v,()=>{d.value=[],v.value.tickets.forEach(V=>{const R=d.value.find(z=>z.ticket_name===V.ticket_name);if(!R)V.quantity=1,d.value.push(V);else{let z=d.value.indexOf(R);d.value[z].quantity+=1}})}),{tickets:D,active:o,partialTotals:e,showOrderDetail:h,currentOrder:v,tmp_tickets:d,showSecondTab:f,formatExplicitDate:ke,formatDate:ve,onNextTab:M,onConfirmPayment:c,printPDF:we,onPrintPDF:O,onDisableSecondoTab:j,printAndCheckIn:H,sendEmail:ne}},components:{NewOrderTicketTab:Vn,NewOrderFormTab:al}};const dl={key:0,class:"info-box"},ul={class:"font-medium"},ml=l("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),_l={class:"font-medium"},fl=l("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),pl={key:0,class:"capitalize"},vl={key:0,class:"flex pb-4"},hl=l("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),yl={class:"flex flex-column"},gl={key:0,class:"pb-1 pr-1"},kl={key:1,class:"pb-1"},bl={class:"py-5"},xl={class:"m-0 text-center line-height-3"},wl=l("br",null,null,-1),Cl={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Dl=l("p",{class:"my-2"},[l("b",null,"Riepilogo ordine:")],-1),Sl={class:"flex flex-column col-12"},Ol={key:0,class:"pb-1",style:{"min-width":"8rem"}},Tl={key:1,class:"pb-1"},Vl={key:2},Al={class:"flex flex-column col-12"},Fl={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Nl=l("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),Ll={class:"pb-1"},Ml={class:"flex align-items-center justify-content-center mt-4"};function Ul(n,t,o,e,h,f){var r,x;const a=k("NewOrderTicketTab"),d=k("TabPanel"),g=k("NewOrderFormTab"),i=k("Button"),w=k("TabView");return _(),p(W,null,[o.form?(_(),p("div",dl,[l("p",ul,[ml,U(C((r=o.form.course)==null?void 0:r.name),1)]),l("p",_l,[fl,o.form.date?(_(),p("span",pl,C(e.formatDate((x=o.form)==null?void 0:x.date)),1)):F("",!0),U(" - "+C(o.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(_(),p("div",vl,[hl,l("div",yl,[(_(!0),p(W,null,re(e.partialTotals,D=>{var v;return _(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:D},[D&&D.quantity!=0?(_(),p("span",gl,C((v=D.ticket)==null?void 0:v.name),1)):F("",!0),D&&D.quantity!=0?(_(),p("span",kl," x "+C(D.quantity)+" "+C(D.price),1)):F("",!0)])}),128))])])):F("",!0)])):F("",!0),s(w,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=D=>e.active=D)},{default:S(()=>[s(d,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:S(()=>[s(a,{tickets:e.tickets,form:o.form,onNextTab:t[0]||(t[0]=D=>e.onNextTab(D)),onDisableSecondoTab:t[1]||(t[1]=D=>e.onDisableSecondoTab(D))},null,8,["tickets","form"])]),_:1},8,["disabled"]),s(d,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:S(()=>[s(g,{onNextTab:t[2]||(t[2]=D=>e.onConfirmPayment(D)),location_permalink:o.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(_(),ee(d,{key:0,header:"Ordine completato"},{default:S(()=>{var D,v;return[l("div",bl,[l("div",xl,[U(" Ordine "),l("b",null,C(e.currentOrder.reservation_number),1),U(" registrato correttamente!"),wl]),e.currentOrder?(_(),p("div",Cl,[Dl,l("div",Sl,[(_(!0),p(W,null,re(e.tmp_tickets,T=>(_(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:T},[T&&T.quantity!=0?(_(),p("span",Ol,C(T.ticket_name),1)):F("",!0),T&&T.quantity!=0?(_(),p("span",Tl," x "+C(T.quantity),1)):F("",!0),T.ticket_price?(_(),p("span",Vl," € "+C((+T.ticket_price).toFixed(2)),1)):F("",!0)]))),128))]),l("div",Al,[e.currentOrder.total?(_(),p("p",Fl,[Nl,l("span",Ll,[l("b",null,"€ "+C((+((D=e.currentOrder)==null?void 0:D.total)).toFixed(2)),1)])])):F("",!0)])])):F("",!0),l("div",Ml,[s(i,{icon:"pi pi-print",onClick:t[3]||(t[3]=T=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),s(i,{icon:"pi print-check-icon",onClick:t[4]||(t[4]=T=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"}),s(i,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[5]||(t[5]=T=>e.sendEmail()),disable:!((v=e.currentOrder)!=null&&v.user_email)},null,8,["disable"])])])]}),_:1})):F("",!0)]),_:1},8,["activeIndex"])],64)}const Pl=q(cl,[["render",Ul]]),Bl={props:["filters","date"],setup(n,t){$(()=>{f.value=Ce(8,20),o.value=Object.assign({},n.filters)});const o=b({}),e=De(),h=G(),f=b(),a=b(!1),d=he(),g=b(!1),i=N(()=>e.allCourses),w=N(()=>d.showNewOrderDialog),r=async function(){const T={location_permalink:n.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(T).then(()=>{}).catch(M=>{P(h,M)})},x=function(){d.setNewOrderDialogVisibility(!1),o.value.hour="",o.value.course=null,t.emit("onCloseDialog")},D=function(T){o.value.date=n.date,d.setNewOrderDialogVisibility(T)},v=function(){g.value=o.value.open_ticket};return X(n.filters,()=>{if(r(),o.value=Object.assign({},n.filters),n.filters.course&&!n.filters.course.id){let T=i.value.find(M=>M.name===n.filters.course.name);T&&(o.value.course=T)}}),{courses:i,form:o,hours:f,disableForm:g,visible:a,onCloseDialog:x,updateDialog:D,onChecked:v,dialogVisible:w,dialogStore:d}},components:{NewOrderDialog:Pl}},Rl=l("h2",{class:"mt-1"},"Nuova prenotazione",-1),zl={class:"formgrid grid px-0 align-items-center mt-4"},El={key:0,class:"field flex flex-column w-full col-12"},jl=l("label",{for:"typology"},"Scegli il percorso",-1),Il={key:1,class:"field flex flex-column w-full col-12"},ql=l("label",{for:"typology"},"Seleziona l'orario",-1),Hl={class:"flex justify-content-end align-items-center mt-2"},$l={class:"flex align-items-center justify-content-between w-full"},Jl=l("h2",null,"Nuova prenotazione",-1);function Gl(n,t,o,e,h,f){const a=k("Dropdown"),d=k("Button"),g=k("NewOrderDialog"),i=k("Dialog"),w=k("Card");return _(),ee(w,{class:"mt-4"},{content:S(()=>[Rl,l("div",zl,[o.filters.location_permalink?(_(),p("div",El,[jl,s(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.course=r),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):F("",!0),o.filters.location_permalink?(_(),p("div",Il,[ql,s(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.hour=r),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):F("",!0)]),l("div",Hl,[s(d,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=r=>e.updateDialog(!0))},null,8,["disabled"])]),s(i,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=r=>e.dialogVisible=r),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=r=>e.onCloseDialog())},{header:S(()=>[l("div",$l,[Jl,s(d,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=r=>e.updateDialog(!1))})])]),default:S(()=>[s(g,{form:e.form,onCloseDialog:t[4]||(t[4]=r=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const Kl=q(Bl,[["render",Gl]]),Ql={props:["location_permalink"],setup(n,t){$(()=>{let d=Z.now().toFormat("dd/MM/yyyy HH:mm");e.value.start_date=Z.local().startOf("day").toFormat("dd/MM/yyyy HH:mm"),e.value.end_date=d});const o=G(),e=b({}),h=oe(),f=function(){const d={from:ye(e.value.start_date),to:ye(e.value.end_date),location_permalink:n.location_permalink};a(d)},a=async function(d){await h.downloadReport(d).then(()=>{t.emit("onSubmit")}).catch(g=>{P(o,g)})};return{form:e,onSubmit:f}},components:{Form:Ye}},Wl={class:"formgrid grid mt-3"},Xl={class:"field col-6 flex flex-column"},Yl=l("label",{from:"start_date"},"Dal",-1),Zl={class:"field col-6 flex flex-column"},es=l("label",{from:"end_date"},"Al",-1),ts={class:"flex align-items-center justify-content-end mt-6"};function os(n,t,o,e,h,f){const a=k("Calendar"),d=k("Button"),g=k("Form");return _(),ee(g,{onSubmit:e.onSubmit},{default:S(()=>[l("div",Wl,[l("div",Xl,[Yl,s(a,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.start_date=i),dateFormat:"dd/mm/yy",manualInput:!1,showTime:"",hourFormat:"24"},null,8,["modelValue"])]),l("div",Zl,[es,s(a,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.end_date=i),dateFormat:"dd/mm/yy",manualInput:!1,showTime:"",hourFormat:"24"},null,8,["modelValue"])])]),l("div",ts,[s(d,{label:"Annulla",text:"",onClick:t[2]||(t[2]=i=>n.$emit("onSubmit"))}),s(d,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const ns=q(Ql,[["render",os]]),ls={setup(){$(()=>{w.value&&(n.value.location_permalink=w.value,t.value.location_permalink=w.value),r()});const n=b({}),t=b({}),o=b(),e=b(!1),h=Ge(),f=oe(),a=G(),d=he(),g=N(()=>h.currentUser),i=N(()=>f.allLocations),w=N(()=>f.getCurrentLocation),r=async function(){await f.fetchAllLocations().then(()=>{w.value||(n.value.location_permalink=i.value[0].permalink,t.value.location_permalink=i.value[0].permalink,f.updateCurrenLocation(i.value[0].permalink))}).catch(y=>{P(a,y)})};return{filters:n,orderTable:o,order_filters:t,visibleDialog:e,user:g,locations:i,fetchAllLocations:r,formatDate:ve,onUpdateFilters:function(y){y.course?n.value.course={id:y.course}:n.value.course="",y.name?n.value.name=y.name:n.value.name="",y.hour&&(y.hour.start_at?n.value.hour=y.hour.start_at:n.value.hour=y.hour)},onUpdateNewOrderFilters:function(y){y.start_at&&(t.value.hour=y.start_at),y.course_name&&(t.value.course={name:y.course_name}),y.date&&(t.value.date=y.date),y.hour&&(t.value.hour=y.hour),y.max_seats?t.value.max_seats=y.max_seats:t.value.max_seats=null,d.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){o.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=n.value.location_permalink,f.updateCurrenLocation(n.value.location_permalink)},onCloseReportDialog:function(){e.value=!1}}},components:{CalendarFilter:Io,OrderTable:Bo,OrderFilter:tn,NewOrderCard:Kl,SalesReportsDialog:ns}};const ss={class:"flex justify-content-between align-items-center"},as={class:"field flex flex-column mt-3"},is={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},rs=l("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),cs={class:"capitalize text-xl"},ds={class:"flex gap-4"},us={key:0,class:"col-3 mt-3"},ms={class:"col-9 mt-3"};function _s(n,t,o,e,h,f){const a=k("Dropdown"),d=k("Button"),g=k("SalesReportsDialog"),i=k("Dialog"),w=k("CalendarFilter"),r=k("NewOrderCard"),x=k("OrderFilter"),D=k("OrderTable");return _(),p("div",null,[l("div",ss,[l("div",as,[s(a,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":t[0]||(t[0]=v=>e.filters.location_permalink=v),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location",onChange:t[1]||(t[1]=v=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(_(),p("div",is,[l("div",null,[rs,l("span",cs,C(e.formatDate(e.filters.date)),1)]),s(d,{label:"Report vendite",link:"",class:"m-0 p-0 underline",onClick:t[2]||(t[2]=v=>e.visibleDialog=!0)}),s(i,{visible:e.visibleDialog,"onUpdate:visible":t[4]||(t[4]=v=>e.visibleDialog=v),modal:"",header:"Report vendite",style:{width:"35rem"}},{default:S(()=>[s(g,{onOnSubmit:t[3]||(t[3]=v=>e.onCloseReportDialog()),location_permalink:e.filters.location_permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):F("",!0)]),l("div",ds,[e.filters.location_permalink?(_(),p("div",us,[s(w,{filters:e.filters},null,8,["filters"]),s(r,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[5]||(t[5]=v=>e.onCloseDialog())},null,8,["date","filters"])])):F("",!0),l("div",ms,[s(x,{filters:e.filters,onOnSubmit:t[6]||(t[6]=v=>e.onUpdateFilters(v))},null,8,["filters"]),e.filters.date?(_(),ee(D,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[7]||(t[7]=v=>e.onUpdateNewOrderFilters(v))},null,8,["filters"])):F("",!0)])])])}const ys=q(ls,[["render",_s]]);export{ys as default};
