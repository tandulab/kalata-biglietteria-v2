import{o as B,x as C,a as I,c as A,_ as P,r as p,b as x,e as V,g as t,f as s,H as U,I as X,J as Te,i as j,K as Se,w as k,h as M,n as Q,t as O,L as Y,M as K,N as ne,u as Oe}from"../index56556.js";import{u as ee,a as R,b as le,f as G,c as se,d as Ae,e as oe,g as Fe,h as Ue,i as ae,j as Ne}from"./NewOrderDialog.vue_vue_type_style_index_0_lang56556.js";import{s as q,e as L,p as Le,D as $,a as ie,b as Me}from"./helpers56556.js";import{u as re}from"./loader56556.js";const Pe={props:["location_permalink","time_slot"],setup(n,o){B(()=>{l.value=Object.assign({},n.time_slot)});const l=C({}),e=ee(),g=R(),{showLoader:b,hideLoader:i}=re(),c=I(),h=A(()=>e.allOpenTickets),u=A(()=>g.paymentStatus),_=A(()=>g.paymentModeList),a=async function(m){const T={code:m.query.toUpperCase(),location_permalink:n.location_permalink};await e.fetchAllOpenTickets(T)},f=async function(){var T;const m={id:n.location_permalink,order_id:l.value.id,status:(T=l.value)==null?void 0:T.status,payment_method:l.value.payment_mode,open_ticket_codes:[],api_version:"v2"};if(l.value.open_ticket_codes&&l.value.open_ticket_codes.length>0){let w=[];l.value.open_ticket_codes.forEach(v=>{w.push(v.code)}),m.open_ticket_codes=w}S(m)},S=async function(m){b(),await g.updateOrder(m).then(()=>{i(),q(c,{message:"Stato aggiornato correttamente",error:!1}),o.emit("closeDialog",!0)}).catch(T=>{i(),L(c,T)})};return{form:l,open_tickets:h,paymentList:u,paymentModeList:_,changeStatus:f,fetchAllOpenTickets:a}}},ze={key:0,class:"formgrid grid flex-column mt-3"},je={class:"field col-12"},Be=t("label",{for:"status"},"Stato pagamento",-1),Ie={class:"field col-12"},Re=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Ee={key:0,class:"field col-12 flex flex-column"},qe=t("label",{for:"user_zip"},"Codice biglietto",-1),Xe={class:"flex align-items-center justify-content-end mt-3"};function He(n,o,l,e,g,b){const i=p("Dropdown"),c=p("AutoComplete"),h=p("Button");return x(),V(X,null,[e.form?(x(),V("div",ze,[t("div",je,[Be,s(i,{modelValue:e.form.status,"onUpdate:modelValue":o[0]||(o[0]=u=>e.form.status=u),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Ie,[Re,s(i,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[1]||(o[1]=u=>e.form.payment_mode=u),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode=="voucher"?(x(),V("div",Ee,[qe,s(c,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":o[2]||(o[2]=u=>e.form.open_ticket_codes=u),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:o[3]||(o[3]=u=>e.fetchAllOpenTickets(u)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):U("",!0)])):U("",!0),t("div",Xe,[s(h,{label:"Annulla",text:"",onClick:o[4]||(o[4]=u=>n.$emit("closeDialog",!1))}),s(h,{label:"Conferma",onClick:o[5]||(o[5]=u=>e.changeStatus())})])],64)}const Je=P(Pe,[["render",He]]),$e={props:["filters"],setup(n,o){B(()=>{v.value=!0,r.value={first:0,rows:f.value.rows,sortField:null,sortOrder:null},r.value.page=0,n.filters.location_permalink&&J()});const l=R(),e=le(),g=A(()=>l.responseOrders),b=A(()=>l.status),i=Te();A(()=>i.cancelDialog);const c=A(()=>i.submitDialog),h=A(()=>l.paymentStatus),{showLoader:u,hideLoader:_}=re(),a=I(),f=C(),S=C(),m=C(),T=C(),w=C(),v=C(!0),r=C(),D=C(0),z=C([]),Z=C([]),H=C(!1),W=C();function J(){v.value=!0;let d=new Map;for(const y in n.filters)y=="date"?G(n.filters.date)=="Invalid DateTime"?d.set("date",se(n.filters.date)):d.set("date",G(n.filters.date)):n.filters.location_permalink&&d.set("location_permalink",n.filters.location_permalink),y=="course"&&n.filters.course.id!="-1"&&d.set("course",n.filters.course.id),y=="hour"&&n.filters.hour!="Tutti gli orari"&&d.set("hour",n.filters.hour),y=="name"&&d.set("name",n.filters.name);setTimeout(()=>{ce(d)},Math.random()*1e3+250)}const ce=async function(d){await l.fetchAllOrders(d).then(()=>{v.value=!1}).catch(y=>{v.value=!1,L(a,y)})},de=d=>{m.value.toggle(d),W.value.toggle(d)},ue=(d,y)=>{if(d>=(d+y)/2)return"green";if(d<=(d+y)/3)return"red"},me=function(d,y){y&&(m.value.note=y,m.value.toggle(d))},_e=async function(d,y){const F={id:d.id,check_in:y,location_permalink:n.filters.location_permalink};await l.checkInOrder(F).then(()=>{te(d,y,"check_in"),q(a,{message:"Check-in registrato correttamente",error:!1})}).catch(N=>{L(a,N)})},fe=async function(d,y){const F={id:d.id,no_show:y,location_permalink:n.filters.location_permalink};await l.noShowOrder(F).then(()=>{te(d,y,"no_show"),q(a,{message:"No-show registrato correttamente",error:!1})}).catch(N=>{L(a,N)})},te=function(d,y,F){d&&d.order_item_tickets.forEach(N=>{N[F]=y})},pe=async function(d,y,F){const N={id:d,check_in:y,location_permalink:n.filters.location_permalink};await l.checkInTicket(N).then(()=>{if(q(a,{message:"Check-in registrato correttamente",error:!1}),!y)F.check_in=!1;else{let E=!0;F.order_item_tickets.forEach(Ve=>{Ve.check_in==!1&&(E=!1)}),E&&(F.check_in=!0)}}).catch(E=>{L(a,E)})},he=async function(d,y,F){const N={id:d,no_show:y,location_permalink:n.filters.location_permalink};await l.noShowTicket(N).then(()=>{q(a,{message:"No-show registrato correttamente",error:!1}),y||(F.check_in=!1)}).catch(E=>{L(a,E)})},ve=function(d){const y={course_name:d.course_name,start_at:d.start_at};o.emit("updateFilters",y),e.setNewOrderDialogVisibility(!0)},ye=function(d){H.value=!0,T.value=d},ke=function(d){d&&J(),H.value=!1},ge=function(d){return d!=null&&d.created_by?d.created_by:""},be=function(d){let y="https://petronas-adv.s3.eu-west-1.amazonaws.com/1ao15l08oc5azntg5u9yzjdktv0z?response-content-disposition=inline%3B%20filename%3D%22SPC.jpg%22%3B%20filename%2A%3DUTF-8%27%27SPC.jpg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIARDBLDGVIUP6XH36S%2F20231205%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20231205T085243Z&X-Amz-Expires=300&X-Amz-SignedHeaders=host&X-Amz-Signature=64af31ea1794a83536cf5252b538efc46edbf865af697592fb35514f444a9456";var F=window.open(y,"_blank");if(F){var N=document.createElement("button");N.textContent="Print PDF",N.onclick=function(){F&&F.print()},window.document.body.appendChild(N)}else alert("Popup blocked! Please allow popups to open the PDF.");setTimeout(()=>{debugger;N.click()},3e3)},xe=function(d){let y=0;if(d&&d.order_item_tickets){d.order_item_tickets.forEach(N=>{N.check_in&&(y+=1)});let F=d.order_item_tickets.length;if(y!=F&&y!=0)return y+"/"+F}},we=function(d,y){W.value.data=y,W.value.toggle(d)},Ce=function(d,y){w.value=y.id;let F="Sei sicuro di voler eliminare questa prenotazione?";i.setDialog("Elimina prenotazione","Elimina","Annulla",F),i.setDynamicDialogVisibility(!0)},De=function(){if(u(),w.value){const d={id:w.value,location_permalink:n.filters.location_permalink};l.deleteOrder(d).then(()=>{_(),q(a,{message:"La prenotazione è stata eliminata correttamente",error:!1}),J()}).catch(y=>{_(),L(a,y)})}};return j(c,d=>{De()}),j(n.filters,()=>{n.filters.location_permalink&&J()}),{dt:f,responseOrders:g,loading:v,totalRecords:D,lazyParams:r,currentOrder:S,status:b,expandedRows:z,expandedRows1:Z,op:m,dialogStore:e,paymentList:h,visibleDialog:H,currentTimeSlot:T,visibleMenu:W,loadLazyData:J,toggle:de,getProgressClass:ue,showNotes:me,checkAll:_e,noShowAll:fe,openDialog:ve,checkInSingleTicket:pe,noShowSingleTicket:he,prettyPaymentStatus:Le,openPaymentStatusDialog:ye,onClosePaymentStatusDialog:ke,getRowClass:ge,printPDF:be,showLabelCheckbox:xe,confirmDeleteOrder:Ce,showMenu:we,formatDataFromUnixTimestamps:Ae}},components:{PaymentStatusDialog:Je}};const Ge={class:"order-table"},Ke={style:{width:"15rem"}},We={class:"m-0 text-right",style:{"font-size":"12px"}},Qe={style:{width:"15rem"}},Ze={class:"m-0 text-right",style:{"font-size":"12px"}},Ye={key:0},eo=t("div",{class:"flex justify-content-center w-full"},"Check-in",-1),oo={class:"flex justify-content-center"},to={class:"flex flex-column",style:{"margin-top":"8px"}},no={class:"text-sm",style:{"min-height":"15px"}},lo=t("div",{class:"flex justify-content-center w-full"},"No-show",-1),so={class:"flex justify-content-center"},ao={class:"flex flex-column",style:{"margin-top":"8px"}},io=t("span",{class:"text-sm",style:{"min-height":"15px"}},null,-1),ro={class:"overlay-menu"},co=["onClick"],uo=t("i",{class:"pi pi-print mr-3"},null,-1),mo=["disabled","onClick"],_o=t("i",{class:"pi pi-pencil mr-3"},null,-1),fo=["disabled","onClick"],po=t("i",{class:"pi pi-trash mr-3"},null,-1),ho={key:0},vo={key:1},yo=t("div",{class:"flex justify-content-center w-full"},"Check-in",-1),ko={class:"flex justify-content-center"},go=t("div",{class:"flex justify-content-center w-full"},"No-show",-1),bo={class:"flex justify-content-center"},xo=t("div",{class:"flex justify-content-center w-full"},"PDF",-1),wo={class:"flex justify-content-center"},Co={key:0,class:"flex mx-4"},Do=t("div",null,[t("div",{class:"p-0 m-0 flex align-items-center"},[t("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),t("span",{class:"text-sm"},"WEB")]),t("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[t("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),t("span",{class:"text-sm"},"KALATA")])],-1),Vo=[Do],To=t("iframe",{id:"iFramePdf",src:"https://s3-eu-central-1.amazonaws.com/kalata-production/production/uploads/tickets/VIC_2023357405.pdf",style:{display:"none"}},null,-1);function So(n,o,l,e,g,b){const i=p("Column"),c=p("ProgressBar"),h=p("Button"),u=p("Badge"),_=p("Checkbox"),a=p("OverlayPanel"),f=p("DataTable"),S=p("PaymentStatusDialog"),m=p("Dialog"),T=Se("tooltip");return x(),V("div",Ge,[s(f,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":o[1]||(o[1]=w=>e.expandedRows=w)},{empty:k(()=>[M(" Nessuna prenotazione trovata. ")]),expansion:k(w=>[s(f,{value:w.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":o[0]||(o[0]=v=>e.expandedRows1=v),rowClass:e.getRowClass},{empty:k(()=>[M(" Nessuna prenotazione trovata. ")]),expansion:k(v=>[s(f,{value:v.data.order_item_tickets,class:"m-4 mx-5"},{default:k(()=>[s(i,{header:"Codice biglietto",field:"code"}),s(i,{header:"Tipo biglietto",field:"type"},{body:k(({data:r})=>[s(u,{value:r.ticket_name,class:Q([r.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),s(i,{header:"Prezzo"},{body:k(({data:r})=>[r.ticket_price?(x(),V("span",ho," € "+O(r.ticket_price),1)):(x(),V("span",vo,"-"))]),_:1}),s(i,null,{header:k(()=>[yo]),body:k(({data:r})=>[t("div",ko,[s(_,{modelValue:r.check_in,"onUpdate:modelValue":D=>r.check_in=D,binary:!0,onChange:D=>e.checkInSingleTicket(r.id,r.check_in,v.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),s(i,null,{header:k(()=>[go]),body:k(({data:r})=>[t("div",bo,[s(_,{modelValue:r.no_show,"onUpdate:modelValue":D=>r.no_show=D,binary:!0,onChange:D=>e.noShowSingleTicket(r.id,r.no_show,v.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),s(i,{field:"tickets_url"},{header:k(()=>[xo]),body:k(({data:r})=>[t("div",wo,[Y(s(h,{link:"",icon:"pi pi-print",href:r.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:""},null,8,["href"]),[[T,"Stampa PDF",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:k(()=>[s(i,{header:"Codice",field:"code"}),s(i,{header:"Acquirente"},{body:k(({data:v})=>[M(O(v.user_name)+" "+O(v.user_surname),1)]),_:1}),s(i,{header:"Q.ta",field:"quantity"}),s(i,{header:"Pagamento"},{body:k(({data:v})=>[v.status?(x(),V("span",Ye,[s(u,{value:e.prettyPaymentStatus(v.status),class:Q([v.status,"px-3 border-round-lg"])},null,8,["value","class"])])):U("",!0)]),_:1}),s(i,null,{header:k(()=>[eo]),body:k(({data:v})=>[t("div",oo,[t("div",to,[s(_,{modelValue:v.check_in,"onUpdate:modelValue":r=>v.check_in=r,binary:!0,onChange:r=>e.checkAll(v,v.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),t("span",no,O(e.showLabelCheckbox(v)),1)])])]),_:1}),s(i,null,{header:k(()=>[lo]),body:k(({data:v})=>[t("div",so,[t("div",ao,[s(_,{modelValue:v.no_show,"onUpdate:modelValue":r=>v.no_show=r,binary:!0,onChange:r=>e.noShowAll(v,v.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),io])])]),_:1}),s(i,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:k(({data:v})=>[Y(s(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-comment",text:"",rounded:"",onClick:r=>e.showNotes(r,v.notes),disabled:!v.notes},null,8,["onClick","disabled"]),[[T,"Note",void 0,{top:!0}]]),s(a,{ref:"op"},{default:k(()=>[M(O(e.op.note),1)]),_:1},512),s(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:r=>e.showMenu(r,v)},null,8,["onClick"]),s(a,{ref:"visibleMenu"},{default:k(()=>[t("ul",ro,[t("li",{onClick:r=>e.printPDF(e.visibleMenu.data.tickets_url)},[uo,M("Stampa PDF ")],8,co),t("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:r=>e.openPaymentStatusDialog(e.visibleMenu.data)},[_o,M("Cambia stato ")],8,mo),t("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:r=>e.confirmDeleteOrder(r,e.visibleMenu.data)},[po,M("Elimina ")],8,fo)])]),_:2},1536)]),_:1}),s(i,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass"]),w.data.orders&&w.data.orders.length>0?(x(),V("div",Co,Vo)):U("",!0)]),default:k(()=>[s(i,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),s(i,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),s(i,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:k(({data:w})=>[t("div",Ke,[t("p",We,O(w.confirmed_seats)+"/"+O(w.remaing_seats+w.confirmed_seats),1),s(c,{value:w.confirmed_seats*100/(w.remaing_seats+w.confirmed_seats),showValue:!1,style:{height:"10px"},class:Q(["available-progress",e.getProgressClass(w.confirmed_seats,w.remaing_seats)])},null,8,["value","class"])])]),_:1},512),s(i,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:k(({data:w})=>[t("div",Qe,[t("p",Ze," 0 /"+O(w.confirmed_seats),1),s(c,{value:w.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),s(i,null,{body:k(({data:w})=>[Y(s(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:v=>e.openDialog(w)},null,8,["onClick"]),[[T,"Prenota",void 0,{top:!0}]])]),_:1}),s(i,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"]),s(m,{visible:e.visibleDialog,"onUpdate:visible":o[3]||(o[3]=w=>e.visibleDialog=w),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:k(()=>[s(S,{location_permalink:l.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:o[2]||(o[2]=w=>e.onClosePaymentStatusDialog(w))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),To])}const Oo=P($e,[["render",So]]),Ao={props:["filters"],setup(n,o){B(()=>{f();let r=$.now();l.value=n.filters,l.value.date=r.toFormat("dd/MM/yyyy"),T()});const l=C({}),e=oe(),g=R(),b=I(),i=C([]),c=C(),h=A(()=>e.allLocations),u=A(()=>g.getCalendar),_=function(){},a=async function(r){await g.fetchCalendar(r).then(()=>{}).catch(D=>{L(b,D)})},f=async function(){await e.fetchAllLocations().then(()=>{S()}).catch(r=>{L(b,r)})},S=function(){if(n.filters.location_permalink){const r=h.value.find(D=>D.permalink===n.filters.location_permalink);i.value=r.courses}},m=function(r){let D={};D.month=$.fromJSDate(new Date(r)).month,D.year=$.fromJSDate(new Date(r)).year,D.location_permalink=n.filters.location_permalink,c.value={month:D.month,year:D.year},a(D)},T=function(){let r=$.now(),D={location_permalink:"",month:"",year:""};D.location_permalink=n.filters.location_permalink,D.month=r.month+"",D.year=r.year+"",a(D)},w=function(r){if(u.value.web_dates&&u.value.web_dates.length!=0){let D=r.month+1;D=r.month<10?"0"+D:D;let z=r.day<10?"0"+r.day:r.day,Z=r.year+"-"+D+"-"+z;return u.value.web_dates.find(H=>H==Z)}},v=function(r){let D={location_permalink:n.filters.location_permalink,month:r.month,year:r.year};a(D)};return j(n.filters,()=>{if(c.value){let r={location_permalink:n.filters.location_permalink,month:c.value.month,year:c.value.year};a(r)}else T()}),{form:l,courses:i,locations:h,calendar:u,resetField:_,getCourses:S,onDateChange:m,getDayFromDate:w,onMonthChange:v}}},Fo={class:"flex calendar-filter"},Uo={key:0,class:"special-day"};function No(n,o,l,e,g,b){const i=p("Calendar");return x(),V("div",Fo,[s(i,{modelValue:e.form.date,"onUpdate:modelValue":o[0]||(o[0]=c=>e.form.date=c),inline:"",onDateSelect:o[1]||(o[1]=c=>e.onDateChange(c)),onMonthChange:o[2]||(o[2]=c=>e.onMonthChange(c))},{date:k(c=>[e.getDayFromDate(c.date)?(x(),V("div",Uo,[t("span",null,O(c.date.day),1)])):(x(),V(X,{key:1},[M(O(c.date.day),1)],64))]),_:1},8,["modelValue"])])}const Lo=P(Ao,[["render",No]]),Mo={props:["filters"],setup(n,o){B(()=>{l.value=Object.assign({},n.filters),l.value.date=$.now().toFormat("dd/MM/yyyy"),b.value=ie(8,20),b.value.unshift("Tutti gli orari"),l.value.hour="Tutti gli orari"});const l=C({}),e=C([]),g=oe();I();const b=C([]),i=R(),c=A(()=>g.allLocations),h=A(()=>i.responseOrders),u=function(){l.value.name=null,l.value.course=e.value[0].name,l.value.hour=b.value[0],o.emit("onSubmit",l.value)},_=function(){if(e.value=[],l.value.location_permalink){const a=c.value.find(f=>f.permalink===l.value.location_permalink);e.value=a.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),l.value.course=e.value[0].name}};return j(c,()=>{n.filters.location_permalink&&c.value&&(l.value=Object.assign({},n.filters),l.value.hour||(l.value.hour="Tutti gli orari"),_())}),j(n.filters,()=>{n.filters.location_permalink&&c.value&&l.value.location_permalink&&l.value.location_permalink!=n.filters.location_permalink&&(l.value=Object.assign({},n.filters),l.value.hour||(l.value.hour="Tutti gli orari"),_())}),j(h,()=>{}),{form:l,courses:e,hours:b,locations:c,responseOrders:h,resetField:u,getCourses:_}}},Po={class:"formgrid grid px-0 align-items-center"},zo={key:0,class:"field col-4 flex flex-column"},jo=t("label",{for:"typology"},"Filtra per percorso",-1),Bo={key:1,class:"field col-3 flex flex-column"},Io=t("label",{for:"typology"},"Filtra per orario (dalle)",-1),Ro=t("div",{class:"col-12"},null,-1),Eo={class:"field col-4 flex flex-column"},qo=t("label",{for:"typology"},"Filtra per nome acquirente",-1),Xo={class:"flex col-12 justify-content-end pt-1"};function Ho(n,o,l,e,g,b){const i=p("Dropdown"),c=p("InputText"),h=p("Button"),u=p("AccordionTab"),_=p("Accordion");return x(),K(_,{activeIndex:0},{default:k(()=>[s(u,{header:"FILTRI"},{default:k(()=>[t("div",Po,[e.form.location_permalink?(x(),V("div",zo,[jo,s(i,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=a=>e.form.course=a),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):U("",!0),e.responseOrders?(x(),V("div",Bo,[Io,s(i,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=a=>e.form.hour=a),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):U("",!0),Ro,t("div",Eo,[qo,s(c,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])])]),t("div",Xo,[s(h,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=a=>n.$emit("onSubmit",e.form))}),s(h,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=a=>e.resetField())})])]),_:1})]),_:1})}const Jo=P(Mo,[["render",Ho]]),$o={props:["form","price","index","ticket"],setup(n,o){const l=C(0),e=function(){l.value++,b()},g=function(){l.value>0&&l.value--,b()},b=function(){const i={counter:l.value,price:n.price,index:n.index,ticket:n.ticket};o.emit("changeCounter",i)};return{counter:l,decrement:g,increment:e}}},Go={class:"btn-plus-min flex align-items-center"},Ko={class:"counter"};function Wo(n,o,l,e,g,b){const i=p("Button");return x(),V("div",Go,[s(i,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),t("div",Ko,O(e.counter),1),s(i,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const Qo=P($o,[["render",Wo]]),Zo={props:["tickets","form"],setup(n){const o=C(0),l=C([]),e=C(!1),g=C(),b=R(),i=I(),c=A(()=>b.getDiscount),h=function(f){l.value[f.index]={partial_total:f.price*f.counter,ticket:f.ticket,quantity:f.counter},o.value=0,l.value.forEach(S=>{S.partial_total==0&&l.value.splice(l.value.indexOf(S)),o.value+=S.partial_total})},u=function(){_()},_=async function(){let f=[];l.value.forEach(m=>{f.push({id:m.ticket.id,quantity:m.quantity})});const S={discount_code:g.value,location_permalink:n.form.location_permalink,tickets:f};await b.cost(S).then(()=>{}).catch(m=>{L(i,m)})};return{total:o,partialTotals:l,showDiscount:e,discountCode:g,discount:c,onChangeCounter:h,applyDiscount:u,checkDisabled:function(){return!l.value||l.value.length==0}}},components:{PlusMinusButton:Qo}},Yo={key:0,class:"flex justify-content-between align-items-center"},et={class:"flex align-items-center col-9"},ot={class:"col-4 pl-0"},tt={class:"text-right col-2"},nt={class:"col-3 flex justify-content-end"},lt=t("hr",{class:"mt-3"},null,-1),st={class:"col-12 m-0 py-0 flex flex-column align-items-start"},at={class:"flex align-items-center justify-content-between py-0"},it={class:"col-9 flex"},rt=t("b",null,"Totale",-1),ct=[rt],dt={key:0,class:"text-right col-4"},ut={class:"line-through text-sm mr-2"},mt={class:"font-bold"},_t={key:1,class:"col-2 text-right font-bold"},ft={class:"col-3 flex justify-content-end"};function pt(n,o,l,e,g,b){const i=p("PlusMinusButton"),c=p("Button"),h=p("InputText"),u=p("InputGroup");return x(),V(X,null,[(x(!0),V(X,null,ne(l.tickets,(_,a)=>{var f,S,m;return x(),V("div",{key:_.id},[((f=_.course)==null?void 0:f.id)==((S=l.form.course)==null?void 0:S.id)?(x(),V("div",Yo,[t("div",et,[t("b",ot,O(_.name),1),t("div",tt,"€ "+O((m=_.price)==null?void 0:m.toFixed(2)),1)]),t("div",nt,[s(i,{onChangeCounter:o[0]||(o[0]=T=>e.onChangeCounter(T)),price:_.price,index:a,ticket:_},null,8,["price","index","ticket"])])])):U("",!0)])}),128)),lt,t("div",st,[s(c,{label:"Codice sconto",link:"",onClick:o[1]||(o[1]=_=>e.showDiscount?e.showDiscount=!1:e.showDiscount=!0),class:"p-0"}),e.showDiscount?(x(),K(u,{key:0,class:"discount"},{default:k(()=>[s(h,{placeholder:"Inserisci codice",modelValue:e.discountCode,"onUpdate:modelValue":o[2]||(o[2]=_=>e.discountCode=_)},null,8,["modelValue"]),s(c,{label:"Applica",onClick:e.applyDiscount},null,8,["onClick"])]),_:1})):U("",!0)]),t("div",at,[t("div",it,[t("div",{class:Q(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},ct,2),e.discount&&e.discount.total_amount?(x(),V("div",dt,[t("span",ut,"€ "+O(e.total.toFixed(2)),1),t("span",mt,"€ "+O(e.discount.total_amount.toFixed(2)),1)])):(x(),V("div",_t,"€ "+O(e.total.toFixed(2)),1))]),t("div",ft,[s(c,{label:"Prosegui",onClick:o[3]||(o[3]=_=>n.$emit("nextTab",e.partialTotals)),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const ht=P(Zo,[["render",pt]]),vt={props:["location_permalink"],setup(n){B(()=>{u()});const o=ee(),l=Fe(),e=R(),g=C({}),b=A(()=>l.allCountries),i=A(()=>o.allOpenTickets),c=A(()=>e.paymentStatus),h=A(()=>e.paymentModeList),u=async function(){await l.fetchAllCountries().then(()=>{g.value.country_id=88,g.value.status={id:"to_pay",name:"Da pagare"}})};return{form:g,countries:b,paymentList:c,paymentModeList:h,open_tickets:i,fetchAllOpenTickets:async function(a){const f={code:a.query.toUpperCase(),location_permalink:n.location_permalink};await o.fetchAllOpenTickets(f)}}}},yt={key:0,class:"formgrid grid"},kt={class:"field col-6"},gt=t("label",{for:"user_name"},"Nome",-1),bt={class:"field col-6"},xt=t("label",{for:"user_surname"},"Cognome",-1),wt={class:"field col-6"},Ct=t("label",{for:"user_email"},"Email",-1),Dt={class:"field col-6"},Vt=t("label",{for:"user_phone"},"Telefono",-1),Tt={class:"field col-6"},St=t("label",{for:"country_id"},"Nazione",-1),Ot={class:"field col-6"},At=t("label",{for:"user_zip"},"Cap",-1),Ft={class:"field col-6"},Ut=t("label",{for:"status"},"Stato pagamento",-1),Nt={class:"field col-6"},Lt=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Mt={key:0,class:"field col-6 flex flex-column"},Pt=t("label",{for:"user_zip"},"Codice biglietto",-1),zt={class:"field col-12"},jt={class:"field flex flex-column"},Bt=t("label",{for:"notes"},"Note",-1),It={class:"col-12 flex justify-content-end"};function Rt(n,o,l,e,g,b){const i=p("InputText"),c=p("Dropdown"),h=p("AutoComplete"),u=p("Textarea"),_=p("Button");return e.form?(x(),V("div",yt,[t("div",kt,[gt,s(i,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":o[0]||(o[0]=a=>e.form.user_name=a),class:"w-full"},null,8,["modelValue"])]),t("div",bt,[xt,s(i,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":o[1]||(o[1]=a=>e.form.user_surname=a),class:"w-full"},null,8,["modelValue"])]),t("div",wt,[Ct,s(i,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":o[2]||(o[2]=a=>e.form.user_email=a),class:"w-full"},null,8,["modelValue"])]),t("div",Dt,[Vt,s(i,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":o[3]||(o[3]=a=>e.form.user_phone=a),class:"w-full"},null,8,["modelValue"])]),t("div",Tt,[St,s(c,{modelValue:e.form.country_id,"onUpdate:modelValue":o[4]||(o[4]=a=>e.form.country_id=a),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Ot,[At,s(i,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":o[5]||(o[5]=a=>e.form.user_zip=a),class:"w-full"},null,8,["modelValue"])]),t("div",Ft,[Ut,s(c,{modelValue:e.form.status,"onUpdate:modelValue":o[6]||(o[6]=a=>e.form.status=a),options:e.paymentList,optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])]),t("div",Nt,[Lt,s(c,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[7]||(o[7]=a=>e.form.payment_mode=a),options:e.paymentModeList,optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode&&e.form.payment_mode.label=="Biglietto a data aperta (voucher)"?(x(),V("div",Mt,[Pt,s(h,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":o[8]||(o[8]=a=>e.form.open_ticket_codes=a),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:o[9]||(o[9]=a=>e.fetchAllOpenTickets(a)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"id",multiple:""},null,8,["modelValue","suggestions"])])):U("",!0),t("div",zt,[t("div",jt,[Bt,s(u,{modelValue:e.form.notes,"onUpdate:modelValue":o[10]||(o[10]=a=>e.form.notes=a),rows:"5",cols:"30"},null,8,["modelValue"])])]),t("div",It,[s(_,{label:"Prosegui",onClick:o[11]||(o[11]=a=>n.$emit("nextTab",e.form))})])])):U("",!0)}const Et=P(vt,[["render",Rt]]),qt={props:["form"],setup(n){B(()=>{u()});const o=C(0),l=C([]),e=C(!1),g=ee(),b=R(),i=I(),c=A(()=>g.allTickets),h=A(()=>b.getCurrentOrder),u=async function(){const m={location_permalink:n.form.location_permalink,api_version:"v2",date:G(n.form.date),course_id:n.form.course.id};await g.fetchAllTickets(m).then(()=>{}).catch(T=>{L(i,T)})},_=function(m){o.value+=1,l.value=Object.assign([],m)},a=function(m){return G(m).includes("Invalid")?se(m):G(m)},f=function(m){S(m)},S=async function(m){var v,r,D;const T=[{start_at:n.form.hour,tickets:[]}];l.value.forEach(z=>{T[0].tickets.push({id:z.ticket.id,quantity:z.quantity})});const w={location_permalink:n.form.location_permalink,country_id:m.country_id,status:m.status.id,user_email:m.user_email,user_name:m.user_name,user_phone:m.user_phone,user_surname:m.user_surname,user_zip:m.user_zip,api_version:"v2",date:n.form.date?a(n.form.date):"",note:m.notes,time_slots:T,payment_method:(v=m.payment_mode)==null?void 0:v.id,course_id:(D=(r=n.form)==null?void 0:r.course)==null?void 0:D.id};await b.createOrder(w).then(()=>{o.value+=1,e.value=!0}).catch(z=>{L(i,z)})};return{tickets:c,active:o,partialTotals:l,showOrderDetail:e,currentOrder:h,formatExplicitDate:Ue,formatDate:ae,onNextTab:_,onConfirmPayment:f}},components:{NewOrderTicketTab:ht,NewOrderFormTab:Et}},Xt={key:0,class:"info-box"},Ht={class:"font-medium"},Jt=t("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),$t={class:"font-medium"},Gt=t("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Kt={class:"capitalize"},Wt={key:0,class:"flex pb-4"},Qt=t("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),Zt={class:"flex flex-column"},Yt={class:"py-5"},en={class:"m-0 text-center font-bold line-height-3"},on=t("br",null,null,-1),tn={class:"flex align-items-center justify-content-center mt-3"};function nn(n,o,l,e,g,b){var a;const i=p("NewOrderTicketTab"),c=p("TabPanel"),h=p("NewOrderFormTab"),u=p("Button"),_=p("TabView");return x(),V(X,null,[l.form?(x(),V("div",Xt,[t("p",Ht,[Jt,M(" "+O((a=l.form.course)==null?void 0:a.name),1)]),t("p",$t,[Gt,t("span",Kt,O(e.formatDate(l.form.date)),1),M(" - "+O(l.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(x(),V("div",Wt,[Qt,t("div",Zt,[(x(!0),V(X,null,ne(e.partialTotals,f=>{var S;return x(),V("p",{class:"p-0 m-0 pb-1 font-medium",key:f.id},O((S=f.ticket)==null?void 0:S.name)+" x "+O(f.quantity)+" "+O(f.price),1)}),128))])])):U("",!0)])):U("",!0),s(_,{activeIndex:e.active,"onUpdate:activeIndex":o[3]||(o[3]=f=>e.active=f)},{default:k(()=>[s(c,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:k(()=>[s(i,{tickets:e.tickets,form:l.form,onNextTab:o[0]||(o[0]=f=>e.onNextTab(f))},null,8,["tickets","form"])]),_:1},8,["disabled"]),s(c,{header:"Inserisci i dati",disabled:e.showOrderDetail},{default:k(()=>[s(h,{onNextTab:o[1]||(o[1]=f=>e.onConfirmPayment(f)),location_permalink:l.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(x(),K(c,{key:0,header:"Ordine completato"},{default:k(()=>[t("div",Yt,[t("div",en,[M(" Ordine "+O(e.currentOrder.reservation_number)+" registrato correttamente!",1),on,M(" Ti abbiamo inoltrato la conferma via mail. ")]),t("div",tn,[s(u,{label:"Stampa biglietti",outlined:"",onClick:o[2]||(o[2]=f=>n.$emit("closeDialog",f))})])])]),_:1})):U("",!0)]),_:1},8,["activeIndex"])],64)}const ln=P(qt,[["render",nn]]),sn={props:["filters"],setup(n){B(()=>{_(),g.value=ie(8,20),o.value=Object.assign({},n.filters),o.value.hour=Me(g.value)});const o=C({}),l=Ne(),e=I(),g=C(),b=C(!1),i=le(),c=C(!1),h=A(()=>l.allCourses),u=A(()=>i.showNewOrderDialog),_=async function(){const m={location_permalink:n.filters.location_permalink,api_version:"v2"};await l.fetchAllCourses(m).then(()=>{}).catch(T=>{L(e,T)})},a=function(){o.value={}},f=function(m){i.setNewOrderDialogVisibility(m)},S=function(){c.value=o.value.open_ticket};return j(n.filters,()=>{if((n.filters.location_permalink!=o.value.location_permalink||!o.value.course)&&_(),o.value.date=n.filters.date,o.value.location_permalink=n.filters.location_permalink,n.filters.hour&&n.filters.hour!="Tutti gli orari"&&(o.value.hour=n.filters.hour),n.filters.course&&!n.filters.course.id){let m=h.value.find(T=>T.name===n.filters.course.name);m&&(o.value.course=m)}}),j(h,()=>{o.value.course=h.value[0]}),{courses:h,form:o,hours:g,disableForm:c,visible:b,onCloseDialog:a,updateDialog:f,onChecked:S,dialogVisible:u,dialogStore:i}},components:{NewOrderDialog:ln}},an=t("h2",{class:"mt-1"},"Nuova prenotazione",-1),rn={class:"formgrid grid px-0 align-items-center mt-4"},cn={key:0,class:"field flex flex-column w-full col-12"},dn=t("label",{for:"typology"},"Scegli il percorso",-1),un={key:1,class:"field flex flex-column w-full col-12"},mn=t("label",{for:"typology"},"Seleziona l'orario",-1),_n={class:"flex justify-content-end align-items-center mt-2"},fn={class:"flex align-items-center justify-content-between w-full"},pn=t("h2",null,"Nuova prenotazione",-1);function hn(n,o,l,e,g,b){const i=p("Dropdown"),c=p("Button"),h=p("NewOrderDialog"),u=p("Dialog"),_=p("Card");return x(),K(_,{class:"mt-4"},{content:k(()=>[an,t("div",rn,[l.filters.location_permalink?(x(),V("div",cn,[dn,s(i,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=a=>e.form.course=a),options:e.courses,optionLabel:"name",disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):U("",!0),l.filters.location_permalink?(x(),V("div",un,[mn,s(i,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=a=>e.form.hour=a),options:e.hours,disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):U("",!0)]),t("div",_n,[s(c,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:o[2]||(o[2]=a=>e.updateDialog(!0))},null,8,["disabled"])]),s(u,{visible:e.dialogVisible,"onUpdate:visible":o[5]||(o[5]=a=>e.dialogVisible=a),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1},{header:k(()=>[t("div",fn,[pn,s(c,{icon:"pi pi-times",text:"",rounded:"",onClick:o[3]||(o[3]=a=>e.updateDialog(!1))})])]),default:k(()=>[s(h,{form:e.form,onCloseDialog:o[4]||(o[4]=a=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const vn=P(sn,[["render",hn]]),yn={setup(){B(()=>{b.value&&(n.value.location_permalink=b.value.location.permalink,c())});const n=C({}),o=C(),l=Oe(),e=oe(),g=I(),b=A(()=>l.currentUser),i=A(()=>e.allLocations),c=async function(){await e.fetchAllLocations().then(()=>{}).catch(u=>{L(g,u)})};return{filters:n,orderTable:o,user:b,locations:i,fetchAllLocations:c,formatDate:ae,onUpdateFilters:function(u){n.value.hour=u.start_at,n.value.course={name:u.course_name},u.course&&(n.value.course={id:u.course}),n.value.name=u.name,u.hour&&(u.hour.start_at?n.value.hour=u.hour.start_at:n.value.hour=u.hour)}}},components:{CalendarFilter:Lo,OrderTable:Oo,OrderFilter:Jo,NewOrderCard:vn}};const kn={class:"flex justify-content-between align-items-center"},gn={class:"field flex flex-column mt-3"},bn={key:0,style:{color:"#495057"}},xn=t("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),wn={class:"capitalize text-xl"},Cn={class:"flex gap-4"},Dn={key:0,class:"col-3 mt-3"},Vn={class:"col-9 mt-3"};function Tn(n,o,l,e,g,b){const i=p("Dropdown"),c=p("CalendarFilter"),h=p("NewOrderCard"),u=p("OrderFilter"),_=p("OrderTable");return x(),V("div",null,[t("div",kn,[t("div",gn,[s(i,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=a=>e.filters.location_permalink=a),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(x(),V("div",bn,[xn,t("span",wn,O(e.formatDate(e.filters.date)),1)])):U("",!0)]),t("div",Cn,[e.filters.location_permalink?(x(),V("div",Dn,[s(c,{filters:e.filters},null,8,["filters"]),s(h,{filters:e.filters},null,8,["filters"])])):U("",!0),t("div",Vn,[s(u,{filters:e.filters,onOnSubmit:o[1]||(o[1]=a=>e.onUpdateFilters(a))},null,8,["filters"]),e.filters.date?(x(),K(_,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:o[2]||(o[2]=a=>e.onUpdateFilters(a))},null,8,["filters"])):U("",!0)])])])}const Un=P(yn,[["render",Tn]]);export{Un as default};
