import{o as L,c as w,a as z,p as h,i as M,_ as C,r as v,b as k,e as b,f as s,w as _,h as D,t as F,g as r,F as U,s as S,n as j,z as q,u as E,q as W}from"../index41322.js";import{u as G,e as H,i as J,a as K,b as Q}from"./location41322.js";import{u as X,e as O,s as Y}from"./helpers41322.js";const Z={props:["filters"],setup(n,o){L(()=>{p.value=!0,y.value={first:0,rows:f.value.rows,sortField:null,sortOrder:null},y.value.page=0,n.filters.location&&T()});const i=G(),e=H(),g=w(()=>i.responseOrders),x=w(()=>i.status),{showLoader:l,hideLoader:u}=X(),m=z(),f=h(),t=h(),c=h(),p=h(!0),y=h(),$=h(0);function T(){p.value=!0;let a=new Map;for(const d in n.filters)n.filters[d]&&(d=="location"&&n.filters.location.permalink?a.set("location_permalink",n.filters.location.permalink.trim()):a.set(d,n.filters[d].trim()));a.set("page",y.value.page+1),a.set("per_page",y.value.rows),setTimeout(()=>{A(a)},Math.random()*1e3+250)}const A=async function(a){await i.fetchOrderWithOpenTicket(a).then(()=>{p.value=!1}).catch(d=>{p.value=!1,O(m,d)})},B=async function(a){p.value=!0;const d={ticket_id:a.id,location:n.filters.location.permalink,used:a.used};await i.useOpenTicket(d).then(()=>{p.value=!1,Y(m,{message:"Stato aggiornato correttamente",error:!1}),T()}).catch(V=>{p.value=!1,O(m,V)})},N=a=>{c.value.toggle(a)},P=function(a){const d={course_name:a.course_name,start_at:a.start_at};o.emit("updateFilters",d),e.setNewOrderDialogVisibility(!0)},R=function(a){const d=new Map;d.set("id",a.id),d.set("location_permalink",n.filters.location.permalink),l(),i.downloadTicket(d).then(()=>{u()}).catch(V=>{u(),O(m,V)})},I=a=>{y.value=a,T()};return M(n.filters,()=>{T()}),{dt:f,responseOrders:g,loading:p,totalRecords:$,lazyParams:y,currentOrder:t,status:x,op:c,dialogStore:e,loadLazyData:T,onChangeUsedStatus:B,toggle:N,openDialog:P,downloadPDF:R,onPage:I,formatDataFromUnixTimestamps:J}}};const ee={class:"order-table"},te=r("div",{class:"w-full text-center"},"Numero ticket",-1),oe={class:"flex flex-column align-items-center"},ne=r("div",{class:"w-full text-center"},"Utilizzato",-1),le=r("div",{class:"w-full text-center"},"PDF",-1),ae={class:"flex flex-column align-items-center"};function se(n,o,i,e,g,x){const l=v("Column"),u=v("Checkbox"),m=v("Button"),f=v("DataTable");return k(),b("div",ee,[s(f,{value:e.responseOrders.orders,totalRecords:e.responseOrders.total,lazy:!0,paginator:!0,ref:"dt",rows:30,loading:e.loading,stripedRows:"",onPage:o[0]||(o[0]=t=>e.onPage(t))},{empty:_(()=>[D(" Nessuna prenotazione trovata. ")]),default:_(()=>[s(l,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),s(l,{header:"Email",field:"email",ref:"email"},null,512),s(l,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:_(({data:t})=>[D(F(e.formatDataFromUnixTimestamps(t.created_at)),1)]),_:1},512),s(l,null,{header:_(()=>[te]),body:_(({data:t})=>[r("div",oe,F(t.tickets_number),1)]),_:1}),s(l,{header:"Codice ticket"},{body:_(({data:t})=>[(k(!0),b(U,null,S(t.codes,c=>(k(),b("div",{key:c.code,class:j(["py-1",c.used?"used":""])},F(c.code),3))),128))]),_:1}),s(l,null,{header:_(()=>[ne]),body:_(({data:t})=>[(k(!0),b(U,null,S(t.codes,c=>(k(),b("div",{key:c.code,class:"py-1 flex flex-column align-items-center"},[s(u,{modelValue:c.used,"onUpdate:modelValue":p=>c.used=p,binary:!0,onChange:p=>e.onChangeUsedStatus(c),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])]))),128))]),_:1}),s(l,null,{header:_(()=>[le]),body:_(({data:t})=>[r("div",ae,[s(m,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-download",text:"",rounded:"",onClick:c=>e.downloadPDF(t)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","totalRecords","loading"])])}const re=C(Z,[["render",se]]),ie={setup(n,o){const i=h({});return{form:i,resetField:function(){i.value.reservation_number=null,i.value.ticket_code=null,i.value.email=null,o.emit("onSubmit",i.value)}}}},ce={class:"formgrid grid px-0 align-items-center"},de={class:"field col-3 flex flex-column"},ue=r("label",{for:"typology"},"Filtra per codice prenotazione",-1),me={class:"field col-3 flex flex-column"},_e=r("label",{for:"typology"},"Filtra per codice ticket",-1),fe={class:"field col-3 flex flex-column"},pe=r("label",{for:"typology"},"Filtra per email",-1),ve={class:"flex col-12 justify-content-end mt-1"};function he(n,o,i,e,g,x){const l=v("InputText"),u=v("Button"),m=v("AccordionTab"),f=v("Accordion");return k(),q(f,{activeIndex:0},{default:_(()=>[s(m,{header:"FILTRI"},{default:_(()=>[r("div",ce,[r("div",de,[ue,s(l,{modelValue:e.form.reservation_number,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.reservation_number=t),placeholder:""},null,8,["modelValue"])]),r("div",me,[_e,s(l,{modelValue:e.form.ticket_code,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.ticket_code=t),placeholder:""},null,8,["modelValue"])]),r("div",fe,[pe,s(l,{modelValue:e.form.email,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.email=t),placeholder:""},null,8,["modelValue"])])]),r("div",ve,[s(u,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=t=>n.$emit("onSubmit",e.form))}),s(u,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=t=>e.resetField())})])]),_:1})]),_:1})}const ke=C(ie,[["render",he]]),be={setup(){L(()=>{u.value&&(n.value.location=u.value),m()});const n=h({}),o=h(),i=E(),e=K(),g=z(),x=w(()=>i.currentUser),l=w(()=>e.allLocations),u=w(()=>e.getCurrentLocation),m=async function(){await e.fetchAllLocations().then(()=>{u.value||(n.value.location=l.value[0],e.updateCurrenLocation(l.value[0]))}).catch(t=>{O(g,t)})};return{filters:n,orderTable:o,user:x,locations:l,fetchAllLocations:m,formatDate:Q,onUpdateFilters:function(t){let c=n.value.location.permalink;n.value.reservation_number=t.reservation_number,n.value.location.permalink=c,n.value.ticket_code=t.ticket_code,n.value.email=t.email}}},components:{OpenTicketTable:re,OpenTicketFilter:ke}};const ge={class:"flex justify-content-between align-items-center"},xe={class:"field flex flex-column mt-3"},ye={key:0,style:{color:"#495057"}},Te=r("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),we={class:"capitalize text-xl"},Fe={class:"flex gap-4"},Oe={class:"col-12 mt-3"};function Ve(n,o,i,e,g,x){const l=v("Dropdown"),u=v("OpenTicketFilter"),m=v("OpenTicketTable");return k(),b("div",null,[r("div",ge,[r("div",xe,[s(l,{modelValue:e.filters.location,"onUpdate:modelValue":o[0]||(o[0]=f=>e.filters.location=f),options:e.locations,optionLabel:"name",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(k(),b("div",ye,[Te,r("span",we,F(e.formatDate(e.filters.date)),1)])):W("",!0)]),r("div",Fe,[r("div",Oe,[s(u,{onOnSubmit:o[1]||(o[1]=f=>e.onUpdateFilters(f))}),s(m,{filters:e.filters,ref:"orderTable",class:"mt-4"},null,8,["filters"])])])])}const Se=C(be,[["render",Ve]]);export{Se as default};
