import{o as z,x as C,a as I,c as F,_ as M,r as p,b as x,e as V,g as o,f as s,H as A,I as $,J as ge,i as B,K as be,w as y,h as L,n as H,t as O,L as X,M as W,N as te,u as xe}from"../index43843.js";import{u as Y,a as R,b as oe,f as K,c as ne,d as we,e as Z,g as Ce,h as Ve,i as le,j as De}from"./NewOrderDialog.vue_vue_type_style_index_0_lang43843.js";import{s as J,e as U,p as Te,D as G,a as se,b as Se}from"./helpers43843.js";import{u as Oe}from"./loader43843.js";const Fe={props:["location_permalink","time_slot"],setup(n,t){z(()=>{l.value=Object.assign({},n.time_slot)});const l=C({}),e=Y(),k=R(),{showLoader:g,hideLoader:i}=Oe(),c=I(),h=F(()=>e.allOpenTickets),r=F(()=>k.paymentStatus),f=F(()=>k.paymentModeList),a=async function(u){const T={code:u.query.toUpperCase(),location_permalink:n.location_permalink};await e.fetchAllOpenTickets(T)},_=async function(){var T;const u={id:n.location_permalink,order_id:l.value.id,status:(T=l.value)==null?void 0:T.status,payment_method:l.value.payment_mode,open_ticket_codes:[],api_version:"v2"};if(l.value.open_ticket_codes&&l.value.open_ticket_codes.length>0){let D=[];l.value.open_ticket_codes.forEach(v=>{D.push(v.code)}),u.open_ticket_codes=D}S(u)},S=async function(u){g(),await k.updateOrder(u).then(()=>{i(),J(c,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(T=>{i(),U(c,T)})};return{form:l,open_tickets:h,paymentList:r,paymentModeList:f,changeStatus:_,fetchAllOpenTickets:a}}},Ne={key:0,class:"formgrid grid flex-column mt-3"},Ae={class:"field col-12"},Ue=o("label",{for:"status"},"Stato pagamento",-1),Le={class:"field col-12"},Pe=o("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Me={key:0,class:"field col-12 flex flex-column"},je=o("label",{for:"user_zip"},"Codice biglietto",-1),Be={class:"flex align-items-center justify-content-end mt-3"};function ze(n,t,l,e,k,g){const i=p("Dropdown"),c=p("AutoComplete"),h=p("Button");return x(),V($,null,[e.form?(x(),V("div",Ne,[o("div",Ae,[Ue,s(i,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.status=r),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),o("div",Le,[Pe,s(i,{modelValue:e.form.payment_mode,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.payment_mode=r),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode=="voucher"?(x(),V("div",Me,[je,s(c,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.open_ticket_codes=r),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[3]||(t[3]=r=>e.fetchAllOpenTickets(r)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):A("",!0)])):A("",!0),o("div",Be,[s(h,{label:"Annulla",text:"",onClick:t[4]||(t[4]=r=>n.$emit("closeDialog",!1))}),s(h,{label:"Conferma",onClick:t[5]||(t[5]=r=>e.changeStatus())})])],64)}const Ie=M(Fe,[["render",ze]]),Re={props:["filters"],setup(n,t){z(()=>{u.value=!0,T.value={first:0,rows:f.value.rows,sortField:null,sortOrder:null},T.value.page=0,n.filters.location_permalink&&E()});const l=R(),e=oe(),k=F(()=>l.responseOrders),g=F(()=>l.status),i=ge();F(()=>i.submitDialog);const c=F(()=>i.cancelDialog),h=F(()=>l.paymentStatus),r=I(),f=C(),a=C(),_=C(),S=C(),u=C(!0),T=C(),D=C(0),v=C([]),d=C([]),w=C(!1),j=C();function E(){u.value=!0;let m=new Map;for(const b in n.filters)b=="date"?K(n.filters.date)=="Invalid DateTime"?m.set("date",ne(n.filters.date)):m.set("date",K(n.filters.date)):n.filters.location_permalink&&m.set("location_permalink",n.filters.location_permalink),b=="course"&&n.filters.course.id!="-1"&&m.set("course",n.filters.course.id),b=="hour"&&n.filters.hour!="Tutti gli orari"&&m.set("hour",n.filters.hour),b=="name"&&m.set("name",n.filters.name);setTimeout(()=>{Q(m)},Math.random()*1e3+250)}const Q=async function(m){await l.fetchAllOrders(m).then(()=>{u.value=!1}).catch(b=>{u.value=!1,U(r,b)})},ae=m=>{_.value.toggle(m)},ie=(m,b)=>{if(m>=(m+b)/2)return"green";if(m<=(m+b)/3)return"red"},re=function(m,b){b&&(_.value.note=b,_.value.toggle(m))},ce=async function(m,b){const N={id:m.id,check_in:b,location_permalink:n.filters.location_permalink};await l.checkInOrder(N).then(()=>{ee(m,b,"check_in"),J(r,{message:"Check-in registrato correttamente",error:!1})}).catch(P=>{U(r,P)})},de=async function(m,b){const N={id:m.id,no_show:b,location_permalink:n.filters.location_permalink};await l.noShowOrder(N).then(()=>{ee(m,b,"no_show"),J(r,{message:"No-show registrato correttamente",error:!1})}).catch(P=>{U(r,P)})},ee=function(m,b,N){m&&m.order_item_tickets.forEach(P=>{P[N]=b})},ue=async function(m,b,N){const P={id:m,check_in:b,location_permalink:n.filters.location_permalink};await l.checkInTicket(P).then(()=>{if(J(r,{message:"Check-in registrato correttamente",error:!1}),!b)N.check_in=!1;else{let q=!0;N.order_item_tickets.forEach(ke=>{ke.check_in==!1&&(q=!1)}),q&&(N.check_in=!0)}}).catch(q=>{U(r,q)})},me=async function(m,b,N){const P={id:m,no_show:b,location_permalink:n.filters.location_permalink};await l.noShowTicket(P).then(()=>{J(r,{message:"No-show registrato correttamente",error:!1}),b||(N.check_in=!1)}).catch(q=>{U(r,q)})},_e=function(m){const b={course_name:m.course_name,start_at:m.start_at};t.emit("updateFilters",b),e.setNewOrderDialogVisibility(!0)},fe=function(m){w.value=!0,S.value=m},pe=function(m){m&&E(),w.value=!1},he=function(m){return m!=null&&m.created_by?m.created_by:""},ve=function(m){var b=window.open(m,"_blank"),N=document.createElement("button");N.textContent="Print PDF",N.onclick=function(){b&&b.print()},b&&b.document.body.appendChild(N),setTimeout(()=>{N.click()},5e3)},ye=function(m){let b=0;if(m&&m.order_item_tickets){m.order_item_tickets.forEach(P=>{P.check_in&&(b+=1)});let N=m.order_item_tickets.length;if(b!=N&&b!=0)return b+"/"+N}};return B(c,()=>{a.value.enabled?a.value.enabled=!1:a.value.enabled=!0}),B(n.filters,()=>{n.filters.location_permalink&&E()}),{dt:f,responseOrders:k,loading:u,totalRecords:D,lazyParams:T,currentOrder:a,status:g,expandedRows:v,expandedRows1:d,op:_,dialogStore:e,paymentList:h,visibleDialog:w,currentTimeSlot:S,visibleMenu:j,loadLazyData:E,toggle:ae,getProgressClass:ie,showNotes:re,checkAll:ce,noShowAll:de,openDialog:_e,checkInSingleTicket:ue,noShowSingleTicket:me,prettyPaymentStatus:Te,openPaymentStatusDialog:fe,onClosePaymentStatusDialog:pe,getRowClass:he,printPDF:ve,showLabelCheckbox:ye,formatDataFromUnixTimestamps:we}},components:{PaymentStatusDialog:Ie}};const Ee={class:"order-table"},qe={style:{width:"15rem"}},$e={class:"m-0 text-right",style:{"font-size":"12px"}},Je={style:{width:"15rem"}},Ge={class:"m-0 text-right",style:{"font-size":"12px"}},Ke={key:0},We=o("div",{class:"flex justify-content-center w-full"},"Check-in",-1),He={class:"flex justify-content-center"},Qe={class:"flex flex-column",style:{"margin-top":"8px"}},Xe={class:"text-sm",style:{"min-height":"15px"}},Ye=o("div",{class:"flex justify-content-center w-full"},"No-show",-1),Ze={class:"flex justify-content-center"},et={class:"flex flex-column",style:{"margin-top":"8px"}},tt=o("span",{class:"text-sm",style:{"min-height":"15px"}},null,-1),ot={class:"overlay-menu"},nt=["onClick"],lt=o("i",{class:"pi pi-print mr-3"},null,-1),st=["disabled","onClick"],at=o("i",{class:"pi pi-pencil mr-3"},null,-1),it=["disabled"],rt=o("i",{class:"pi pi-trash mr-3"},null,-1),ct={key:0},dt={key:1},ut=o("div",{class:"flex justify-content-center w-full"},"Check-in",-1),mt={class:"flex justify-content-center"},_t=o("div",{class:"flex justify-content-center w-full"},"No-show",-1),ft={class:"flex justify-content-center"},pt=o("div",{class:"flex justify-content-center w-full"},"PDF",-1),ht={class:"flex justify-content-center"},vt=o("div",{class:"flex mx-4"},[o("div",null,[o("div",{class:"p-0 m-0 flex align-items-center"},[o("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),o("span",{class:"text-sm"},"WEB")]),o("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[o("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),o("span",{class:"text-sm"},"KALATA")])])],-1);function yt(n,t,l,e,k,g){const i=p("Column"),c=p("ProgressBar"),h=p("Button"),r=p("Badge"),f=p("Checkbox"),a=p("OverlayPanel"),_=p("DataTable"),S=p("PaymentStatusDialog"),u=p("Dialog"),T=be("tooltip");return x(),V("div",Ee,[s(_,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[2]||(t[2]=D=>e.expandedRows=D)},{empty:y(()=>[L(" Nessuna prenotazione trovata. ")]),expansion:y(D=>[s(_,{value:D.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[1]||(t[1]=v=>e.expandedRows1=v),rowClass:e.getRowClass},{empty:y(()=>[L(" Nessuna prenotazione trovata. ")]),expansion:y(v=>[s(_,{value:v.data.order_item_tickets,class:"m-4 mx-5"},{default:y(()=>[s(i,{header:"Codice biglietto",field:"code"}),s(i,{header:"Tipo biglietto",field:"type"},{body:y(({data:d})=>[s(r,{value:d.ticket_name,class:H([d.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),s(i,{header:"Prezzo"},{body:y(({data:d})=>[d.ticket_price?(x(),V("span",ct," € "+O(d.ticket_price),1)):(x(),V("span",dt,"-"))]),_:1}),s(i,null,{header:y(()=>[ut]),body:y(({data:d})=>[o("div",mt,[s(f,{modelValue:d.check_in,"onUpdate:modelValue":w=>d.check_in=w,binary:!0,onChange:w=>e.checkInSingleTicket(d.id,d.check_in,v.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),s(i,null,{header:y(()=>[_t]),body:y(({data:d})=>[o("div",ft,[s(f,{modelValue:d.no_show,"onUpdate:modelValue":w=>d.no_show=w,binary:!0,onChange:w=>e.noShowSingleTicket(d.id,d.no_show,v.data)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),s(i,{field:"tickets_url"},{header:y(()=>[pt]),body:y(({data:d})=>[o("div",ht,[X(s(h,{link:"",icon:"pi pi-print",href:d.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:""},null,8,["href"]),[[T,"Stampa PDF",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:y(()=>[s(i,{header:"Codice",field:"code"}),s(i,{header:"Acquirente"},{body:y(({data:v})=>[L(O(v.user_name)+" "+O(v.user_surname),1)]),_:1}),s(i,{header:"Q.ta",field:"quantity"}),s(i,{header:"Pagamento"},{body:y(({data:v})=>[v.status?(x(),V("span",Ke,[s(r,{value:e.prettyPaymentStatus(v.status),class:H([v.status,"px-3 border-round-lg"])},null,8,["value","class"])])):A("",!0)]),_:1}),s(i,null,{header:y(()=>[We]),body:y(({data:v})=>[o("div",He,[o("div",Qe,[s(f,{modelValue:v.check_in,"onUpdate:modelValue":d=>v.check_in=d,binary:!0,onChange:d=>e.checkAll(v,v.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),o("span",Xe,O(e.showLabelCheckbox(v)),1)])])]),_:1}),s(i,null,{header:y(()=>[Ye]),body:y(({data:v})=>[o("div",Ze,[o("div",et,[s(f,{modelValue:v.no_show,"onUpdate:modelValue":d=>v.no_show=d,binary:!0,onChange:d=>e.noShowAll(v,v.no_show)},null,8,["modelValue","onUpdate:modelValue","onChange"]),tt])])]),_:1}),s(i,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:y(({data:v})=>[X(s(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-comment",text:"",rounded:"",onClick:d=>e.showNotes(d,v.notes),disabled:!v.notes},null,8,["onClick","disabled"]),[[T,"Note",void 0,{top:!0}]]),s(a,{ref:"op"},{default:y(()=>[L(O(e.op.note),1)]),_:1},512),s(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:t[0]||(t[0]=d=>e.visibleMenu.toggle(d))}),s(a,{ref:"visibleMenu"},{default:y(()=>[o("ul",ot,[o("li",{onClick:d=>e.printPDF(v.tickets_url)},[lt,L("Stampa PDF ")],8,nt),o("li",{disabled:!v.can_change_status,onClick:d=>e.openPaymentStatusDialog(v)},[at,L("Cambia stato ")],8,st),o("li",{disabled:!v.can_cancel},[rt,L("Elimina ")],8,it)])]),_:2},1536)]),_:1}),s(i,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass"]),vt]),default:y(()=>[s(i,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),s(i,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),s(i,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:y(({data:D})=>[o("div",qe,[o("p",$e,O(D.confirmed_seats)+"/"+O(D.remaing_seats+D.confirmed_seats),1),s(c,{value:D.confirmed_seats*100/(D.remaing_seats+D.confirmed_seats),showValue:!1,style:{height:"10px"},class:H(["available-progress",e.getProgressClass(D.confirmed_seats,D.remaing_seats)])},null,8,["value","class"])])]),_:1},512),s(i,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:y(({data:D})=>[o("div",Je,[o("p",Ge," 0 /"+O(D.confirmed_seats),1),s(c,{value:D.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),s(i,null,{body:y(({data:D})=>[X(s(h,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:v=>e.openDialog(D)},null,8,["onClick"]),[[T,"Prenota",void 0,{top:!0}]])]),_:1}),s(i,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"]),s(u,{visible:e.visibleDialog,"onUpdate:visible":t[4]||(t[4]=D=>e.visibleDialog=D),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:y(()=>[s(S,{location_permalink:l.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[3]||(t[3]=D=>e.onClosePaymentStatusDialog(D))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"])])}const kt=M(Re,[["render",yt]]),gt={props:["filters"],setup(n,t){z(()=>{_();let d=G.now();l.value=n.filters,l.value.date=d.toFormat("dd/MM/yyyy"),T()});const l=C({}),e=Z(),k=R(),g=I(),i=C([]),c=C(),h=F(()=>e.allLocations),r=F(()=>k.getCalendar),f=function(){},a=async function(d){await k.fetchCalendar(d).then(()=>{}).catch(w=>{U(g,w)})},_=async function(){await e.fetchAllLocations().then(()=>{S()}).catch(d=>{U(g,d)})},S=function(){if(n.filters.location_permalink){const d=h.value.find(w=>w.permalink===n.filters.location_permalink);i.value=d.courses}},u=function(d){let w={};w.month=G.fromJSDate(new Date(d)).month,w.year=G.fromJSDate(new Date(d)).year,w.location_permalink=n.filters.location_permalink,c.value={month:w.month,year:w.year},a(w)},T=function(){let d=G.now(),w={location_permalink:"",month:"",year:""};w.location_permalink=n.filters.location_permalink,w.month=d.month+"",w.year=d.year+"",a(w)},D=function(d){if(r.value.web_dates&&r.value.web_dates.length!=0){let w=d.month+1;w=d.month<10?"0"+w:w;let j=d.day<10?"0"+d.day:d.day,E=d.year+"-"+w+"-"+j;return r.value.web_dates.find(Q=>Q==E)}},v=function(d){let w={location_permalink:n.filters.location_permalink,month:d.month,year:d.year};a(w)};return B(n.filters,()=>{if(c.value){let d={location_permalink:n.filters.location_permalink,month:c.value.month,year:c.value.year};a(d)}else T()}),{form:l,courses:i,locations:h,calendar:r,resetField:f,getCourses:S,onDateChange:u,getDayFromDate:D,onMonthChange:v}}},bt={class:"flex calendar-filter"},xt={key:0,class:"special-day"};function wt(n,t,l,e,k,g){const i=p("Calendar");return x(),V("div",bt,[s(i,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.date=c),inline:"",onDateSelect:t[1]||(t[1]=c=>e.onDateChange(c)),onMonthChange:t[2]||(t[2]=c=>e.onMonthChange(c))},{date:y(c=>[e.getDayFromDate(c.date)?(x(),V("div",xt,[o("span",null,O(c.date.day),1)])):(x(),V($,{key:1},[L(O(c.date.day),1)],64))]),_:1},8,["modelValue"])])}const Ct=M(gt,[["render",wt]]),Vt={props:["filters"],setup(n,t){z(()=>{l.value=Object.assign({},n.filters),l.value.date=G.now().toFormat("dd/MM/yyyy"),g.value=se(8,20),g.value.unshift("Tutti gli orari"),l.value.hour="Tutti gli orari"});const l=C({}),e=C([]),k=Z();I();const g=C([]),i=R(),c=F(()=>k.allLocations),h=F(()=>i.responseOrders),r=function(){l.value.name=null,l.value.course=e.value[0].name,l.value.hour=g.value[0],t.emit("onSubmit",l.value)},f=function(){if(e.value=[],l.value.location_permalink){const a=c.value.find(_=>_.permalink===l.value.location_permalink);e.value=a.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),l.value.course=e.value[0].name}};return B(c,()=>{n.filters.location_permalink&&c.value&&(l.value=Object.assign({},n.filters),l.value.hour||(l.value.hour="Tutti gli orari"),f())}),B(n.filters,()=>{n.filters.location_permalink&&c.value&&l.value.location_permalink&&l.value.location_permalink!=n.filters.location_permalink&&(l.value=Object.assign({},n.filters),l.value.hour||(l.value.hour="Tutti gli orari"),f())}),B(h,()=>{}),{form:l,courses:e,hours:g,locations:c,responseOrders:h,resetField:r,getCourses:f}}},Dt={class:"formgrid grid px-0 align-items-center"},Tt={key:0,class:"field col-4 flex flex-column"},St=o("label",{for:"typology"},"Filtra per percorso",-1),Ot={key:1,class:"field col-3 flex flex-column"},Ft=o("label",{for:"typology"},"Filtra per orario (dalle)",-1),Nt=o("div",{class:"col-12"},null,-1),At={class:"field col-4 flex flex-column"},Ut=o("label",{for:"typology"},"Filtra per nome acquirente",-1),Lt={class:"flex col-12 justify-content-end pt-1"};function Pt(n,t,l,e,k,g){const i=p("Dropdown"),c=p("InputText"),h=p("Button"),r=p("AccordionTab"),f=p("Accordion");return x(),W(f,{activeIndex:0},{default:y(()=>[s(r,{header:"FILTRI"},{default:y(()=>[o("div",Dt,[e.form.location_permalink?(x(),V("div",Tt,[St,s(i,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.course=a),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):A("",!0),e.responseOrders?(x(),V("div",Ot,[Ft,s(i,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.hour=a),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):A("",!0),Nt,o("div",At,[Ut,s(c,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.name=a),placeholder:""},null,8,["modelValue"])])]),o("div",Lt,[s(h,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=a=>n.$emit("onSubmit",e.form))}),s(h,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=a=>e.resetField())})])]),_:1})]),_:1})}const Mt=M(Vt,[["render",Pt]]),jt={props:["form","price","index","ticket"],setup(n,t){const l=C(0),e=function(){l.value++,g()},k=function(){l.value>0&&l.value--,g()},g=function(){const i={counter:l.value,price:n.price,index:n.index,ticket:n.ticket};t.emit("changeCounter",i)};return{counter:l,decrement:k,increment:e}}},Bt={class:"btn-plus-min flex align-items-center"},zt={class:"counter"};function It(n,t,l,e,k,g){const i=p("Button");return x(),V("div",Bt,[s(i,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),o("div",zt,O(e.counter),1),s(i,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const Rt=M(jt,[["render",It]]),Et={props:["tickets","form"],setup(n){const t=C(0),l=C([]),e=C(!1),k=C(),g=R(),i=I(),c=F(()=>g.getDiscount),h=function(_){l.value[_.index]={partial_total:_.price*_.counter,ticket:_.ticket,quantity:_.counter},t.value=0,l.value.forEach(S=>{S.partial_total==0&&l.value.splice(l.value.indexOf(S)),t.value+=S.partial_total})},r=function(){f()},f=async function(){let _=[];l.value.forEach(u=>{_.push({id:u.ticket.id,quantity:u.quantity})});const S={discount_code:k.value,location_permalink:n.form.location_permalink,tickets:_};await g.cost(S).then(()=>{}).catch(u=>{U(i,u)})};return{total:t,partialTotals:l,showDiscount:e,discountCode:k,discount:c,onChangeCounter:h,applyDiscount:r,checkDisabled:function(){return!l.value||l.value.length==0}}},components:{PlusMinusButton:Rt}},qt={key:0,class:"flex justify-content-between align-items-center"},$t={class:"flex align-items-center col-9"},Jt={class:"col-4 pl-0"},Gt={class:"text-right col-2"},Kt={class:"col-3 flex justify-content-end"},Wt=o("hr",{class:"mt-3"},null,-1),Ht={class:"col-12 m-0 py-0 flex flex-column align-items-start"},Qt={class:"flex align-items-center justify-content-between py-0"},Xt={class:"col-9 flex"},Yt=o("b",null,"Totale",-1),Zt=[Yt],eo={key:0,class:"text-right col-4"},to={class:"line-through text-sm mr-2"},oo={class:"font-bold"},no={key:1,class:"col-2 text-right font-bold"},lo={class:"col-3 flex justify-content-end"};function so(n,t,l,e,k,g){const i=p("PlusMinusButton"),c=p("Button"),h=p("InputText"),r=p("InputGroup");return x(),V($,null,[(x(!0),V($,null,te(l.tickets,(f,a)=>{var _,S,u;return x(),V("div",{key:f.id},[((_=f.course)==null?void 0:_.id)==((S=l.form.course)==null?void 0:S.id)?(x(),V("div",qt,[o("div",$t,[o("b",Jt,O(f.name),1),o("div",Gt,"€ "+O((u=f.price)==null?void 0:u.toFixed(2)),1)]),o("div",Kt,[s(i,{onChangeCounter:t[0]||(t[0]=T=>e.onChangeCounter(T)),price:f.price,index:a,ticket:f},null,8,["price","index","ticket"])])])):A("",!0)])}),128)),Wt,o("div",Ht,[s(c,{label:"Codice sconto",link:"",onClick:t[1]||(t[1]=f=>e.showDiscount?e.showDiscount=!1:e.showDiscount=!0),class:"p-0"}),e.showDiscount?(x(),W(r,{key:0,class:"discount"},{default:y(()=>[s(h,{placeholder:"Inserisci codice",modelValue:e.discountCode,"onUpdate:modelValue":t[2]||(t[2]=f=>e.discountCode=f)},null,8,["modelValue"]),s(c,{label:"Applica",onClick:e.applyDiscount},null,8,["onClick"])]),_:1})):A("",!0)]),o("div",Qt,[o("div",Xt,[o("div",{class:H(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},Zt,2),e.discount&&e.discount.total_amount?(x(),V("div",eo,[o("span",to,"€ "+O(e.total.toFixed(2)),1),o("span",oo,"€ "+O(e.discount.total_amount.toFixed(2)),1)])):(x(),V("div",no,"€ "+O(e.total.toFixed(2)),1))]),o("div",lo,[s(c,{label:"Prosegui",onClick:t[3]||(t[3]=f=>n.$emit("nextTab",e.partialTotals)),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const ao=M(Et,[["render",so]]),io={props:["location_permalink"],setup(n){z(()=>{r()});const t=Y(),l=Ce(),e=R(),k=C({}),g=F(()=>l.allCountries),i=F(()=>t.allOpenTickets),c=F(()=>e.paymentStatus),h=F(()=>e.paymentModeList),r=async function(){await l.fetchAllCountries().then(()=>{k.value.country_id=88,k.value.status={id:"to_pay",name:"Da pagare"}})};return{form:k,countries:g,paymentList:c,paymentModeList:h,open_tickets:i,fetchAllOpenTickets:async function(a){const _={code:a.query.toUpperCase(),location_permalink:n.location_permalink};await t.fetchAllOpenTickets(_)}}}},ro={key:0,class:"formgrid grid"},co={class:"field col-6"},uo=o("label",{for:"user_name"},"Nome",-1),mo={class:"field col-6"},_o=o("label",{for:"user_surname"},"Cognome",-1),fo={class:"field col-6"},po=o("label",{for:"user_email"},"Email",-1),ho={class:"field col-6"},vo=o("label",{for:"user_phone"},"Telefono",-1),yo={class:"field col-6"},ko=o("label",{for:"country_id"},"Nazione",-1),go={class:"field col-6"},bo=o("label",{for:"user_zip"},"Cap",-1),xo={class:"field col-6"},wo=o("label",{for:"status"},"Stato pagamento",-1),Co={class:"field col-6"},Vo=o("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Do={key:0,class:"field col-6 flex flex-column"},To=o("label",{for:"user_zip"},"Codice biglietto",-1),So={class:"field col-12"},Oo={class:"field flex flex-column"},Fo=o("label",{for:"notes"},"Note",-1),No={class:"col-12 flex justify-content-end"};function Ao(n,t,l,e,k,g){const i=p("InputText"),c=p("Dropdown"),h=p("AutoComplete"),r=p("Textarea"),f=p("Button");return e.form?(x(),V("div",ro,[o("div",co,[uo,s(i,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.user_name=a),class:"w-full"},null,8,["modelValue"])]),o("div",mo,[_o,s(i,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.user_surname=a),class:"w-full"},null,8,["modelValue"])]),o("div",fo,[po,s(i,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.user_email=a),class:"w-full"},null,8,["modelValue"])]),o("div",ho,[vo,s(i,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=a=>e.form.user_phone=a),class:"w-full"},null,8,["modelValue"])]),o("div",yo,[ko,s(c,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=a=>e.form.country_id=a),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),o("div",go,[bo,s(i,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=a=>e.form.user_zip=a),class:"w-full"},null,8,["modelValue"])]),o("div",xo,[wo,s(c,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=a=>e.form.status=a),options:e.paymentList,optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])]),o("div",Co,[Vo,s(c,{modelValue:e.form.payment_mode,"onUpdate:modelValue":t[7]||(t[7]=a=>e.form.payment_mode=a),options:e.paymentModeList,optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode&&e.form.payment_mode.label=="Biglietto a data aperta (voucher)"?(x(),V("div",Do,[To,s(h,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[8]||(t[8]=a=>e.form.open_ticket_codes=a),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[9]||(t[9]=a=>e.fetchAllOpenTickets(a)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"id",multiple:""},null,8,["modelValue","suggestions"])])):A("",!0),o("div",So,[o("div",Oo,[Fo,s(r,{modelValue:e.form.notes,"onUpdate:modelValue":t[10]||(t[10]=a=>e.form.notes=a),rows:"5",cols:"30"},null,8,["modelValue"])])]),o("div",No,[s(f,{label:"Prosegui",onClick:t[11]||(t[11]=a=>n.$emit("nextTab",e.form))})])])):A("",!0)}const Uo=M(io,[["render",Ao]]),Lo={props:["form"],setup(n){z(()=>{r()});const t=C(0),l=C([]),e=C(!1),k=Y(),g=R(),i=I(),c=F(()=>k.allTickets),h=F(()=>g.getCurrentOrder),r=async function(){const u={location_permalink:n.form.location_permalink,api_version:"v2",date:K(n.form.date),course_id:n.form.course.id};await k.fetchAllTickets(u).then(()=>{}).catch(T=>{U(i,T)})},f=function(u){t.value+=1,l.value=Object.assign([],u)},a=function(u){return K(u).includes("Invalid")?ne(u):K(u)},_=function(u){S(u)},S=async function(u){var v,d,w;const T=[{start_at:n.form.hour,tickets:[]}];l.value.forEach(j=>{T[0].tickets.push({id:j.ticket.id,quantity:j.quantity})});const D={location_permalink:n.form.location_permalink,country_id:u.country_id,status:u.status.id,user_email:u.user_email,user_name:u.user_name,user_phone:u.user_phone,user_surname:u.user_surname,user_zip:u.user_zip,api_version:"v2",date:n.form.date?a(n.form.date):"",note:u.notes,time_slots:T,payment_method:(v=u.payment_mode)==null?void 0:v.id,course_id:(w=(d=n.form)==null?void 0:d.course)==null?void 0:w.id};await g.createOrder(D).then(()=>{t.value+=1,e.value=!0}).catch(j=>{U(i,j)})};return{tickets:c,active:t,partialTotals:l,showOrderDetail:e,currentOrder:h,formatExplicitDate:Ve,formatDate:le,onNextTab:f,onConfirmPayment:_}},components:{NewOrderTicketTab:ao,NewOrderFormTab:Uo}},Po={key:0,class:"info-box"},Mo={class:"font-medium"},jo=o("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),Bo={class:"font-medium"},zo=o("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Io={class:"capitalize"},Ro={key:0,class:"flex pb-4"},Eo=o("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),qo={class:"flex flex-column"},$o={class:"py-5"},Jo={class:"m-0 text-center font-bold line-height-3"},Go=o("br",null,null,-1),Ko={class:"flex align-items-center justify-content-center mt-3"};function Wo(n,t,l,e,k,g){var a;const i=p("NewOrderTicketTab"),c=p("TabPanel"),h=p("NewOrderFormTab"),r=p("Button"),f=p("TabView");return x(),V($,null,[l.form?(x(),V("div",Po,[o("p",Mo,[jo,L(" "+O((a=l.form.course)==null?void 0:a.name),1)]),o("p",Bo,[zo,o("span",Io,O(e.formatDate(l.form.date)),1),L(" - "+O(l.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(x(),V("div",Ro,[Eo,o("div",qo,[(x(!0),V($,null,te(e.partialTotals,_=>{var S;return x(),V("p",{class:"p-0 m-0 pb-1 font-medium",key:_.id},O((S=_.ticket)==null?void 0:S.name)+" x "+O(_.quantity)+" "+O(_.price),1)}),128))])])):A("",!0)])):A("",!0),s(f,{activeIndex:e.active,"onUpdate:activeIndex":t[3]||(t[3]=_=>e.active=_)},{default:y(()=>[s(c,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:y(()=>[s(i,{tickets:e.tickets,form:l.form,onNextTab:t[0]||(t[0]=_=>e.onNextTab(_))},null,8,["tickets","form"])]),_:1},8,["disabled"]),s(c,{header:"Inserisci i dati",disabled:e.showOrderDetail},{default:y(()=>[s(h,{onNextTab:t[1]||(t[1]=_=>e.onConfirmPayment(_)),location_permalink:l.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(x(),W(c,{key:0,header:"Ordine completato"},{default:y(()=>[o("div",$o,[o("div",Jo,[L(" Ordine "+O(e.currentOrder.reservation_number)+" registrato correttamente!",1),Go,L(" Ti abbiamo inoltrato la conferma via mail. ")]),o("div",Ko,[s(r,{label:"Stampa biglietti",outlined:"",onClick:t[2]||(t[2]=_=>n.$emit("closeDialog",_))})])])]),_:1})):A("",!0)]),_:1},8,["activeIndex"])],64)}const Ho=M(Lo,[["render",Wo]]),Qo={props:["filters"],setup(n){z(()=>{f(),k.value=se(8,20),t.value=Object.assign({},n.filters),t.value.hour=Se(k.value)});const t=C({}),l=De(),e=I(),k=C(),g=C(!1),i=oe(),c=C(!1),h=F(()=>l.allCourses),r=F(()=>i.showNewOrderDialog),f=async function(){const u={location_permalink:n.filters.location_permalink,api_version:"v2"};await l.fetchAllCourses(u).then(()=>{}).catch(T=>{U(e,T)})},a=function(){t.value={}},_=function(u){i.setNewOrderDialogVisibility(u)},S=function(){c.value=t.value.open_ticket};return B(n.filters,()=>{if((n.filters.location_permalink!=t.value.location_permalink||!t.value.course)&&f(),t.value.date=n.filters.date,t.value.location_permalink=n.filters.location_permalink,n.filters.hour&&n.filters.hour!="Tutti gli orari"&&(t.value.hour=n.filters.hour),n.filters.course&&!n.filters.course.id){let u=h.value.find(T=>T.name===n.filters.course.name);u&&(t.value.course=u)}}),B(h,()=>{t.value.course=h.value[0]}),{courses:h,form:t,hours:k,disableForm:c,visible:g,onCloseDialog:a,updateDialog:_,onChecked:S,dialogVisible:r,dialogStore:i}},components:{NewOrderDialog:Ho}},Xo=o("h2",{class:"mt-1"},"Nuova prenotazione",-1),Yo={class:"formgrid grid px-0 align-items-center mt-4"},Zo={key:0,class:"field flex flex-column w-full col-12"},en=o("label",{for:"typology"},"Scegli il percorso",-1),tn={key:1,class:"field flex flex-column w-full col-12"},on=o("label",{for:"typology"},"Seleziona l'orario",-1),nn={class:"flex justify-content-end align-items-center mt-2"},ln={class:"flex align-items-center justify-content-between w-full"},sn=o("h2",null,"Nuova prenotazione",-1);function an(n,t,l,e,k,g){const i=p("Dropdown"),c=p("Button"),h=p("NewOrderDialog"),r=p("Dialog"),f=p("Card");return x(),W(f,{class:"mt-4"},{content:y(()=>[Xo,o("div",Yo,[l.filters.location_permalink?(x(),V("div",Zo,[en,s(i,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.course=a),options:e.courses,optionLabel:"name",disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):A("",!0),l.filters.location_permalink?(x(),V("div",tn,[on,s(i,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.hour=a),options:e.hours,disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):A("",!0)]),o("div",nn,[s(c,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=a=>e.updateDialog(!0))},null,8,["disabled"])]),s(r,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=a=>e.dialogVisible=a),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1},{header:y(()=>[o("div",ln,[sn,s(c,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=a=>e.updateDialog(!1))})])]),default:y(()=>[s(h,{form:e.form,onCloseDialog:t[4]||(t[4]=a=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const rn=M(Qo,[["render",an]]),cn={setup(){z(()=>{g.value&&(n.value.location_permalink=g.value.location.permalink,c())});const n=C({}),t=C(),l=xe(),e=Z(),k=I(),g=F(()=>l.currentUser),i=F(()=>e.allLocations),c=async function(){await e.fetchAllLocations().then(()=>{}).catch(r=>{U(k,r)})};return{filters:n,orderTable:t,user:g,locations:i,fetchAllLocations:c,formatDate:le,onUpdateFilters:function(r){n.value.hour=r.start_at,n.value.course={name:r.course_name},r.course&&(n.value.course={id:r.course}),n.value.name=r.name,r.hour&&(r.hour.start_at?n.value.hour=r.hour.start_at:n.value.hour=r.hour)}}},components:{CalendarFilter:Ct,OrderTable:kt,OrderFilter:Mt,NewOrderCard:rn}};const dn={class:"flex justify-content-between align-items-center"},un={class:"field flex flex-column mt-3"},mn={key:0,style:{color:"#495057"}},_n=o("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),fn={class:"capitalize text-xl"},pn={class:"flex gap-4"},hn={key:0,class:"col-3 mt-3"},vn={class:"col-9 mt-3"};function yn(n,t,l,e,k,g){const i=p("Dropdown"),c=p("CalendarFilter"),h=p("NewOrderCard"),r=p("OrderFilter"),f=p("OrderTable");return x(),V("div",null,[o("div",dn,[o("div",un,[s(i,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":t[0]||(t[0]=a=>e.filters.location_permalink=a),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(x(),V("div",mn,[_n,o("span",fn,O(e.formatDate(e.filters.date)),1)])):A("",!0)]),o("div",pn,[e.filters.location_permalink?(x(),V("div",hn,[s(c,{filters:e.filters},null,8,["filters"]),s(h,{filters:e.filters},null,8,["filters"])])):A("",!0),o("div",vn,[s(r,{filters:e.filters,onOnSubmit:t[1]||(t[1]=a=>e.onUpdateFilters(a))},null,8,["filters"]),e.filters.date?(x(),W(f,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[2]||(t[2]=a=>e.onUpdateFilters(a))},null,8,["filters"])):A("",!0)])])])}const wn=M(cn,[["render",yn]]);export{wn as default};
