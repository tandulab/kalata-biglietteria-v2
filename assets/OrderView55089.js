import{o as R,x as C,a as E,c as O,_ as B,r as h,b as k,e as D,g as t,f as i,H as A,I as K,J as Te,i as I,K as Se,w as g,h as L,n as Z,t as S,L as ee,M as Y,N as se,u as Oe}from"../index55089.js";import{u as te,a as q,b as ie,f as X,c as ae,d as Fe,e as ne,g as Ae,h as Ne,i as re,j as Ue}from"./NewOrderDialog.vue_vue_type_style_index_0_lang55089.js";import{s as H,e as U,p as Le,a as oe,D as W,b as ce,c as Me}from"./helpers55089.js";import{u as de}from"./loader55089.js";const Pe={props:["location_permalink","time_slot"],setup(l,o){R(()=>{n.value=Object.assign({},l.time_slot)});const n=C({}),e=te(),w=q(),{showLoader:f,hideLoader:a}=de(),c=E(),v=O(()=>e.allOpenTickets),u=O(()=>w.paymentStatus),_=O(()=>w.paymentModeList),s=async function(b){const T={code:b.query.toUpperCase(),location_permalink:l.location_permalink};await e.fetchAllOpenTickets(T)},y=async function(){var T;const b={id:l.location_permalink,order_id:n.value.id,status:(T=n.value)==null?void 0:T.status,payment_method:n.value.payment_mode,open_ticket_codes:[],api_version:"v2"};if(n.value.open_ticket_codes&&n.value.open_ticket_codes.length>0){let p=[];n.value.open_ticket_codes.forEach(d=>{p.push(d.code)}),b.open_ticket_codes=p}N(b)},N=async function(b){f(),await w.updateOrder(b).then(()=>{a(),H(c,{message:"Stato aggiornato correttamente",error:!1}),o.emit("closeDialog",!0)}).catch(T=>{a(),U(c,T)})};return{form:n,open_tickets:v,paymentList:u,paymentModeList:_,changeStatus:y,fetchAllOpenTickets:s}}},je={key:0,class:"formgrid grid flex-column mt-3"},Be={class:"field col-12"},ze=t("label",{for:"status"},"Stato pagamento",-1),Ie={class:"field col-12"},Re=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Ee={key:0,class:"field col-12 flex flex-column"},qe=t("label",{for:"user_zip"},"Codice biglietto",-1),Je={class:"flex align-items-center justify-content-end mt-3"};function Ge(l,o,n,e,w,f){const a=h("Dropdown"),c=h("AutoComplete"),v=h("Button");return k(),D(K,null,[e.form?(k(),D("div",je,[t("div",Be,[ze,i(a,{modelValue:e.form.status,"onUpdate:modelValue":o[0]||(o[0]=u=>e.form.status=u),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Ie,[Re,i(a,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[1]||(o[1]=u=>e.form.payment_mode=u),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode=="voucher"?(k(),D("div",Ee,[qe,i(c,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":o[2]||(o[2]=u=>e.form.open_ticket_codes=u),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:o[3]||(o[3]=u=>e.fetchAllOpenTickets(u)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):A("",!0)])):A("",!0),t("div",Je,[i(v,{label:"Annulla",text:"",onClick:o[4]||(o[4]=u=>l.$emit("closeDialog",!1))}),i(v,{label:"Conferma",onClick:o[5]||(o[5]=u=>e.changeStatus())})])],64)}const He=B(Pe,[["render",Ge]]),Ke={props:["filters"],setup(l,o){R(()=>{d.value=!0,r.value={first:0,rows:y.value.rows,sortField:null,sortOrder:null},r.value.page=0,l.filters.location_permalink&&Q()});const n=q(),e=ie(),w=O(()=>n.responseOrders),f=O(()=>n.status),a=Te();O(()=>a.cancelDialog);const c=O(()=>a.submitDialog),v=O(()=>n.paymentStatus),{showLoader:u,hideLoader:_}=de(),s=E(),y=C(),N=C(),b=C(),T=C(),p=C(),d=C(!0),r=C(),V=C(0),J=C([]),G=C([]),z=C(!1),j=C();function Q(){d.value=!0;let m=new Map;for(const x in l.filters)x=="date"?X(l.filters.date)=="Invalid DateTime"?m.set("date",ae(l.filters.date)):m.set("date",X(l.filters.date)):l.filters.location_permalink&&m.set("location_permalink",l.filters.location_permalink),x=="course"&&l.filters.course.id!="-1"&&m.set("course",l.filters.course.id),x=="hour"&&l.filters.hour!="Tutti gli orari"&&m.set("hour",l.filters.hour),x=="name"&&m.set("name",l.filters.name);setTimeout(()=>{ue(m)},Math.random()*1e3+250)}const ue=async function(m){await n.fetchAllOrders(m).then(()=>{d.value=!1}).catch(x=>{d.value=!1,U(s,x)})},me=m=>{b.value.toggle(m),j.value.toggle(m)},_e=(m,x)=>{if(m>=(m+x)/2)return"green";if(m<=(m+x)/3)return"red"},fe=function(m,x){x&&(b.value.note=x,b.value.toggle(m))},he=async function(m,x){const F={id:m.id,check_in:x,location_permalink:l.filters.location_permalink};await n.checkInOrder(F).then(()=>{le(m,x,"check_in"),H(s,{message:"Check-in registrato correttamente",error:!1})}).catch(M=>{U(s,M)})},pe=async function(m,x){const F={id:m.id,no_show:x,location_permalink:l.filters.location_permalink};await n.noShowOrder(F).then(()=>{le(m,x,"no_show"),H(s,{message:"No-show registrato correttamente",error:!1})}).catch(M=>{U(s,M)})},le=function(m,x,F){m&&m.order_item_tickets.forEach(M=>{M[F]=x})},ve=async function(m,x,F){const M={id:m,check_in:x,location_permalink:l.filters.location_permalink};await n.checkInTicket(M).then(()=>{if(H(s,{message:"Check-in registrato correttamente",error:!1}),!x)F.check_in=!1;else{let P=!0;F.order_item_tickets.forEach($=>{$.check_in==!1&&(P=!1)}),P&&(F.check_in=!0)}}).catch(P=>{U(s,P)})},ye=async function(m,x,F){const M={id:m,no_show:x,location_permalink:l.filters.location_permalink};await n.noShowTicket(M).then(()=>{if(H(s,{message:"No-show registrato correttamente",error:!1}),!x)F.no_show=!1;else{let P=!0;F.order_item_tickets.forEach($=>{$.no_show==!1&&(P=!1)}),P&&(F.no_show=!0)}}).catch(P=>{U(s,P)})},ke=function(m){const x={course_name:m.course_name,start_at:m.start_at};o.emit("updateFilters",x),e.setNewOrderDialogVisibility(!0)},ge=function(m){z.value=!0,T.value=m},be=function(m){m&&Q(),z.value=!1},xe=function(m){return m!=null&&m.created_by?m.created_by:""},we=function(m,x){let F=0;if(m&&m.order_item_tickets){m.order_item_tickets.forEach(P=>{x?P.no_show&&(F+=1):P.check_in&&(F+=1)});let M=m.order_item_tickets.length;if(F!=M&&F!=0)return F+"/"+M}},Ce=function(m,x){j.value.data=x,j.value.toggle(m)},De=function(m,x){p.value=x.id;let F="Sei sicuro di voler eliminare questa prenotazione?";a.setDialog("Elimina prenotazione","Elimina","Annulla",F),a.setDynamicDialogVisibility(!0)},Ve=function(){if(u(),p.value){const m={id:p.value,location_permalink:l.filters.location_permalink};n.deleteOrder(m).then(()=>{_(),H(s,{message:"La prenotazione è stata eliminata correttamente",error:!1}),Q()}).catch(x=>{_(),U(s,x)})}};return I(c,m=>{Ve()}),I(l.filters,()=>{debugger;l.filters.location_permalink&&Q()}),{dt:y,responseOrders:w,loading:d,totalRecords:V,lazyParams:r,currentOrder:N,status:f,expandedRows:J,expandedRows1:G,op:b,dialogStore:e,paymentList:v,visibleDialog:z,currentTimeSlot:T,visibleMenu:j,loadLazyData:Q,toggle:me,getProgressClass:_e,showNotes:fe,checkAll:he,noShowAll:pe,openDialog:ke,checkInSingleTicket:ve,noShowSingleTicket:ye,prettyPaymentStatus:Le,openPaymentStatusDialog:ge,onClosePaymentStatusDialog:be,getRowClass:xe,printPDF:oe,showLabelCheckbox:we,confirmDeleteOrder:De,showMenu:Ce,formatDataFromUnixTimestamps:Fe}},components:{PaymentStatusDialog:He}};const Qe={class:"order-table"},We={style:{width:"15rem"}},Xe={class:"m-0 text-right",style:{"font-size":"12px"}},Ye={style:{width:"15rem"}},Ze={class:"m-0 text-right",style:{"font-size":"12px"}},$e={key:0},eo={key:0},oo=t("div",{class:"flex justify-content-center w-full"},"Check-in",-1),to={class:"flex justify-content-center"},no={class:"flex flex-column",style:{"margin-top":"8px"}},lo={class:"text-sm",style:{"min-height":"15px"}},so=t("div",{class:"flex justify-content-center w-full"},"No-show",-1),io={class:"flex justify-content-center"},ao={class:"flex flex-column",style:{"margin-top":"8px"}},ro={class:"text-sm",style:{"min-height":"15px"}},co={class:"overlay-menu"},uo=["onClick"],mo=t("i",{class:"pi pi-print mr-3"},null,-1),_o=["disabled","onClick"],fo=t("i",{class:"pi pi-pencil mr-3"},null,-1),ho=["disabled","onClick"],po=t("i",{class:"pi pi-trash mr-3"},null,-1),vo={key:0},yo={key:1},ko=t("div",{class:"flex justify-content-center w-full"},"Check-in",-1),go={class:"flex justify-content-center"},bo=t("div",{class:"flex justify-content-center w-full"},"No-show",-1),xo={class:"flex justify-content-center"},wo=t("div",{class:"flex justify-content-center w-full"},"PDF",-1),Co={class:"flex justify-content-center"},Do={key:0,class:"flex mx-4"},Vo=t("div",null,[t("div",{class:"p-0 m-0 flex align-items-center"},[t("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),t("span",{class:"text-sm"},"WEB")]),t("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[t("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),t("span",{class:"text-sm"},"KALATA")])],-1),To=[Vo];function So(l,o,n,e,w,f){const a=h("Column"),c=h("ProgressBar"),v=h("Button"),u=h("Badge"),_=h("Checkbox"),s=h("OverlayPanel"),y=h("DataTable"),N=h("PaymentStatusDialog"),b=h("Dialog"),T=Se("tooltip");return k(),D("div",Qe,[i(y,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":o[1]||(o[1]=p=>e.expandedRows=p)},{empty:g(()=>[L(" Nessuna prenotazione trovata. ")]),expansion:g(p=>[i(y,{value:p.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":o[0]||(o[0]=d=>e.expandedRows1=d),rowClass:e.getRowClass},{empty:g(()=>[L(" Nessuna prenotazione trovata. ")]),expansion:g(d=>[i(y,{value:d.data.order_item_tickets,class:"m-4 mx-5"},{default:g(()=>[i(a,{header:"Codice biglietto",field:"code"}),i(a,{header:"Tipo biglietto",field:"type"},{body:g(({data:r})=>[i(u,{value:r.ticket_name,class:Z([r.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),i(a,{header:"Prezzo"},{body:g(({data:r})=>[r.ticket_price?(k(),D("span",vo," € "+S((+r.ticket_price).toFixed(2)),1)):(k(),D("span",yo,"-"))]),_:1}),i(a,null,{header:g(()=>[ko]),body:g(({data:r})=>[t("div",go,[i(_,{modelValue:r.check_in,"onUpdate:modelValue":V=>r.check_in=V,binary:!0,onChange:V=>e.checkInSingleTicket(r.id,r.check_in,d.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),i(a,null,{header:g(()=>[bo]),body:g(({data:r})=>[t("div",xo,[i(_,{modelValue:r.no_show,"onUpdate:modelValue":V=>r.no_show=V,binary:!0,onChange:V=>e.noShowSingleTicket(r.id,r.no_show,d.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),i(a,{field:"tickets_url"},{header:g(()=>[wo]),body:g(({data:r})=>[t("div",Co,[ee(i(v,{link:"",icon:"pi pi-print",href:r.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:V=>e.printPDF(r.id,n.filters.location_permalink,!0)},null,8,["href","onClick"]),[[T,"Stampa PDF",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:g(()=>[i(a,{header:"Codice",field:"reservation_number"}),i(a,{header:"Acquirente"},{body:g(({data:d})=>[L(S(d.user_name)+" "+S(d.user_surname)+" ",1),!d.user_name&&!d.user_surname?(k(),D("span",$e,"-")):A("",!0)]),_:1}),i(a,{header:"Q.ta",field:"quantity"}),i(a,{header:"Pagamento"},{body:g(({data:d})=>[d.status?(k(),D("span",eo,[i(u,{value:e.prettyPaymentStatus(d.status),class:Z([d.status,"px-3 border-round-lg"])},null,8,["value","class"])])):A("",!0)]),_:1}),i(a,null,{header:g(()=>[oo]),body:g(({data:d})=>[t("div",to,[t("div",no,[i(_,{modelValue:d.check_in,"onUpdate:modelValue":r=>d.check_in=r,binary:!0,onChange:r=>e.checkAll(d,d.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),t("span",lo,S(e.showLabelCheckbox(d,!1)),1)])])]),_:1}),i(a,null,{header:g(()=>[so]),body:g(({data:d})=>[t("div",io,[t("div",ao,[i(_,{modelValue:d.no_show,"onUpdate:modelValue":r=>d.no_show=r,binary:!0,onChange:r=>e.noShowAll(d,d.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),t("span",ro,S(e.showLabelCheckbox(d,!0)),1)])])]),_:1}),i(a,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:g(({data:d})=>[ee(i(v,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-comment",text:"",rounded:"",onClick:r=>e.showNotes(r,d.notes),disabled:!d.notes},null,8,["onClick","disabled"]),[[T,"Note",void 0,{top:!0}]]),i(s,{ref:"op"},{default:g(()=>[L(S(e.op.note),1)]),_:1},512),i(v,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:r=>e.showMenu(r,d)},null,8,["onClick"]),i(s,{ref:"visibleMenu"},{default:g(()=>[t("ul",co,[t("li",{onClick:r=>e.printPDF(e.visibleMenu.data.id,n.filters.location_permalink,!1)},[mo,L("Stampa PDF ")],8,uo),t("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:r=>e.openPaymentStatusDialog(e.visibleMenu.data)},[fo,L("Cambia stato ")],8,_o),t("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:r=>e.confirmDeleteOrder(r,e.visibleMenu.data)},[po,L("Elimina ")],8,ho)])]),_:2},1536)]),_:1}),i(a,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass"]),p.data.orders&&p.data.orders.length>0?(k(),D("div",Do,To)):A("",!0)]),default:g(()=>[i(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),i(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),i(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:g(({data:p})=>[t("div",We,[t("p",Xe,S(p.confirmed_seats)+"/"+S(p.remaing_seats+p.confirmed_seats),1),i(c,{value:p.confirmed_seats*100/(p.remaing_seats+p.confirmed_seats),showValue:!1,style:{height:"10px"},class:Z(["available-progress",e.getProgressClass(p.confirmed_seats,p.remaing_seats)])},null,8,["value","class"])])]),_:1},512),i(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:g(({data:p})=>[t("div",Ye,[t("p",Ze," 0 /"+S(p.confirmed_seats),1),i(c,{value:p.availabe_tickets,showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),i(a,null,{body:g(({data:p})=>[ee(i(v,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:d=>e.openDialog(p)},null,8,["onClick"]),[[T,"Prenota",void 0,{top:!0}]])]),_:1}),i(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"]),i(b,{visible:e.visibleDialog,"onUpdate:visible":o[3]||(o[3]=p=>e.visibleDialog=p),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:g(()=>[i(N,{location_permalink:n.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:o[2]||(o[2]=p=>e.onClosePaymentStatusDialog(p))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"])])}const Oo=B(Ke,[["render",So]]),Fo={props:["filters"],setup(l,o){R(()=>{y();let r=W.now();n.value=l.filters,n.value.date=r.toFormat("dd/MM/yyyy"),T()});const n=C({}),e=ne(),w=q(),f=E(),a=C([]),c=C(),v=O(()=>e.allLocations),u=O(()=>w.getCalendar),_=function(){},s=async function(r){await w.fetchCalendar(r).then(()=>{}).catch(V=>{U(f,V)})},y=async function(){await e.fetchAllLocations().then(()=>{N()}).catch(r=>{U(f,r)})},N=function(){if(l.filters.location_permalink){const r=v.value.find(V=>V.permalink===l.filters.location_permalink);a.value=r.courses}},b=function(r){let V={};V.month=W.fromJSDate(new Date(r)).month,V.year=W.fromJSDate(new Date(r)).year,V.location_permalink=l.filters.location_permalink,c.value={month:V.month,year:V.year},s(V)},T=function(){let r=W.now(),V={location_permalink:"",month:"",year:""};V.location_permalink=l.filters.location_permalink,V.month=r.month+"",V.year=r.year+"",s(V)},p=function(r){if(u.value.web_dates&&u.value.web_dates.length!=0){let V=r.month+1;V=r.month<10?"0"+V:V;let J=r.day<10?"0"+r.day:r.day,G=r.year+"-"+V+"-"+J;return u.value.web_dates.find(z=>z==G)}},d=function(r){let V={location_permalink:l.filters.location_permalink,month:r.month,year:r.year};s(V)};return I(l.filters,()=>{if(c.value){let r={location_permalink:l.filters.location_permalink,month:c.value.month,year:c.value.year};s(r)}else T()}),{form:n,courses:a,locations:v,calendar:u,resetField:_,getCourses:N,onDateChange:b,getDayFromDate:p,onMonthChange:d}}},Ao={class:"flex calendar-filter"},No={key:0,class:"special-day"};function Uo(l,o,n,e,w,f){const a=h("Calendar");return k(),D("div",Ao,[i(a,{modelValue:e.form.date,"onUpdate:modelValue":o[0]||(o[0]=c=>e.form.date=c),inline:"",onDateSelect:o[1]||(o[1]=c=>e.onDateChange(c)),onMonthChange:o[2]||(o[2]=c=>e.onMonthChange(c))},{date:g(c=>[e.getDayFromDate(c.date)?(k(),D("div",No,[t("span",null,S(c.date.day),1)])):(k(),D(K,{key:1},[L(S(c.date.day),1)],64))]),_:1},8,["modelValue"])])}const Lo=B(Fo,[["render",Uo]]),Mo={props:["filters"],setup(l,o){R(()=>{n.value=Object.assign({},l.filters),n.value.date=W.now().toFormat("dd/MM/yyyy"),f.value=ce(8,20),f.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=C({}),e=C([]),w=ne();E();const f=C([]),a=q(),c=O(()=>w.allLocations),v=O(()=>a.responseOrders),u=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=f.value[0],o.emit("onSubmit",n.value)},_=function(){if(e.value=[],n.value.location_permalink){const s=c.value.find(y=>y.permalink===n.value.location_permalink);e.value=s.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}};return I(c,()=>{l.filters.location_permalink&&c.value&&(n.value=Object.assign({},l.filters),n.value.hour||(n.value.hour="Tutti gli orari"),_())}),I(l.filters,()=>{l.filters.location_permalink&&c.value&&n.value.location_permalink&&n.value.location_permalink!=l.filters.location_permalink&&(n.value=Object.assign({},l.filters),n.value.hour||(n.value.hour="Tutti gli orari"),_())}),I(v,()=>{}),{form:n,courses:e,hours:f,locations:c,responseOrders:v,resetField:u,getCourses:_}}},Po={class:"formgrid grid px-0 align-items-center"},jo={key:0,class:"field col-4 flex flex-column"},Bo=t("label",{for:"typology"},"Filtra per percorso",-1),zo={key:1,class:"field col-3 flex flex-column"},Io=t("label",{for:"typology"},"Filtra per orario (dalle)",-1),Ro=t("div",{class:"col-12"},null,-1),Eo={class:"field col-4 flex flex-column"},qo=t("label",{for:"typology"},"Filtra per nome acquirente",-1),Jo={class:"flex col-12 justify-content-end pt-1"};function Go(l,o,n,e,w,f){const a=h("Dropdown"),c=h("InputText"),v=h("Button"),u=h("AccordionTab"),_=h("Accordion");return k(),Y(_,{activeIndex:0},{default:g(()=>[i(u,{header:"FILTRI"},{default:g(()=>[t("div",Po,[e.form.location_permalink?(k(),D("div",jo,[Bo,i(a,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.course=s),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):A("",!0),e.responseOrders?(k(),D("div",zo,[Io,i(a,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.hour=s),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):A("",!0),Ro,t("div",Eo,[qo,i(c,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.name=s),placeholder:""},null,8,["modelValue"])])]),t("div",Jo,[i(v,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=s=>l.$emit("onSubmit",e.form))}),i(v,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=s=>e.resetField())})])]),_:1})]),_:1})}const Ho=B(Mo,[["render",Go]]),Ko={props:["form","price","index","ticket"],setup(l,o){const n=C(0),e=function(){n.value++,f()},w=function(){n.value>0&&n.value--,f()},f=function(){const a={counter:n.value,price:l.price,index:l.index,ticket:l.ticket};o.emit("changeCounter",a)};return{counter:n,decrement:w,increment:e}}},Qo={class:"btn-plus-min flex align-items-center"},Wo={class:"counter"};function Xo(l,o,n,e,w,f){const a=h("Button");return k(),D("div",Qo,[i(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),t("div",Wo,S(e.counter),1),i(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const Yo=B(Ko,[["render",Xo]]),Zo={props:["tickets","form"],setup(l,o){const n=C(0),e=C([]),w=C(!1),f=C(),a=q(),c=E(),v=O(()=>a.getDiscount),u=function(b){e.value[b.index]={partial_total:b.price*b.counter,ticket:b.ticket,quantity:b.counter},n.value=0,e.value.forEach(T=>{n.value+=T.partial_total}),f.value&&s()},_=function(){s()},s=async function(){let b=[];e.value.forEach(p=>{b.push({id:p.ticket.id,quantity:p.quantity})});const T={discount_code:f.value,location_permalink:l.form.location_permalink,tickets:b};await a.cost(T).then(()=>{}).catch(p=>{U(c,p)})};return{total:n,partialTotals:e,showDiscount:w,discountCode:f,discount:v,onChangeCounter:u,applyDiscount:_,checkDisabled:function(){if(!e.value||e.value.length==0)return!0;let b=0;return e.value.forEach(T=>{b+=T.quantity}),b==0},nextTab:function(){const b={discount_code:f.value,partial_total:e.value};o.emit("nextTab",b)}}},components:{PlusMinusButton:Yo}},$o={key:0,class:"flex justify-content-between align-items-center"},et={class:"flex align-items-center col-9"},ot={class:"col-4 pl-0"},tt={class:"text-right col-2"},nt={class:"col-3 flex justify-content-end"},lt=t("hr",{class:"mt-3"},null,-1),st={class:"col-12 m-0 py-0 flex flex-column align-items-start"},it={class:"flex align-items-center justify-content-between py-0"},at={class:"col-9 flex"},rt=t("b",null,"Totale",-1),ct=[rt],dt={key:0,class:"text-right col-4"},ut={class:"line-through text-sm mr-2"},mt={class:"font-bold"},_t={key:1,class:"col-2 text-right font-bold"},ft={class:"col-3 flex justify-content-end"};function ht(l,o,n,e,w,f){const a=h("PlusMinusButton"),c=h("Button"),v=h("InputText"),u=h("InputGroup");return k(),D(K,null,[(k(!0),D(K,null,se(n.tickets,(_,s)=>{var y,N,b;return k(),D("div",{key:_.id},[((y=_.course)==null?void 0:y.id)==((N=n.form.course)==null?void 0:N.id)?(k(),D("div",$o,[t("div",et,[t("b",ot,S(_.name),1),t("div",tt,"€ "+S((b=_.price)==null?void 0:b.toFixed(2)),1)]),t("div",nt,[i(a,{onChangeCounter:o[0]||(o[0]=T=>e.onChangeCounter(T)),price:_.price,index:s,ticket:_},null,8,["price","index","ticket"])])])):A("",!0)])}),128)),lt,t("div",st,[i(c,{label:"Codice sconto",link:"",onClick:o[1]||(o[1]=_=>e.showDiscount?e.showDiscount=!1:e.showDiscount=!0),class:"p-0"}),e.showDiscount?(k(),Y(u,{key:0,class:"discount"},{default:g(()=>[i(v,{placeholder:"Inserisci codice",modelValue:e.discountCode,"onUpdate:modelValue":o[2]||(o[2]=_=>e.discountCode=_)},null,8,["modelValue"]),i(c,{label:"Applica",onClick:e.applyDiscount},null,8,["onClick"])]),_:1})):A("",!0)]),t("div",it,[t("div",at,[t("div",{class:Z(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},ct,2),e.discount&&e.discount.total_amount?(k(),D("div",dt,[t("span",ut,"€ "+S(e.total.toFixed(2)),1),t("span",mt,"€ "+S(e.discount.total_amount.toFixed(2)),1)])):(k(),D("div",_t,"€ "+S(e.total.toFixed(2)),1))]),t("div",ft,[i(c,{label:"Prosegui",onClick:o[3]||(o[3]=_=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const pt=B(Zo,[["render",ht]]),vt={props:["location_permalink"],setup(l){R(()=>{u()});const o=te(),n=Ae(),e=q(),w=C({}),f=O(()=>n.allCountries),a=O(()=>o.allOpenTickets),c=O(()=>e.paymentStatus),v=O(()=>e.paymentModeList),u=async function(){await n.fetchAllCountries().then(()=>{w.value.country_id=88,w.value.status={id:"to_pay",name:"Da pagare"}})};return{form:w,countries:f,paymentList:c,paymentModeList:v,open_tickets:a,fetchAllOpenTickets:async function(s){const y={code:s.query.toUpperCase(),location_permalink:l.location_permalink};await o.fetchAllOpenTickets(y)}}}},yt={key:0,class:"formgrid grid"},kt={class:"field col-6"},gt=t("label",{for:"user_name"},"Nome",-1),bt={class:"field col-6"},xt=t("label",{for:"user_surname"},"Cognome",-1),wt={class:"field col-6"},Ct=t("label",{for:"user_email"},"Email",-1),Dt={class:"field col-6"},Vt=t("label",{for:"user_phone"},"Telefono",-1),Tt={class:"field col-6"},St=t("label",{for:"country_id"},"Nazione",-1),Ot={class:"field col-6"},Ft=t("label",{for:"user_zip"},"Cap",-1),At={class:"field col-6"},Nt=t("label",{for:"status"},"Stato pagamento",-1),Ut={class:"field col-6"},Lt=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Mt={key:0,class:"field col-6 flex flex-column"},Pt=t("label",{for:"user_zip"},"Codice biglietto",-1),jt={class:"field col-12"},Bt={class:"field flex flex-column"},zt=t("label",{for:"notes"},"Note",-1),It={class:"col-12 flex justify-content-end"};function Rt(l,o,n,e,w,f){const a=h("InputText"),c=h("Dropdown"),v=h("AutoComplete"),u=h("Textarea"),_=h("Button");return e.form?(k(),D("div",yt,[t("div",kt,[gt,i(a,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.user_name=s),class:"w-full"},null,8,["modelValue"])]),t("div",bt,[xt,i(a,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.user_surname=s),class:"w-full"},null,8,["modelValue"])]),t("div",wt,[Ct,i(a,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.user_email=s),class:"w-full"},null,8,["modelValue"])]),t("div",Dt,[Vt,i(a,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":o[3]||(o[3]=s=>e.form.user_phone=s),class:"w-full"},null,8,["modelValue"])]),t("div",Tt,[St,i(c,{modelValue:e.form.country_id,"onUpdate:modelValue":o[4]||(o[4]=s=>e.form.country_id=s),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Ot,[Ft,i(a,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":o[5]||(o[5]=s=>e.form.user_zip=s),class:"w-full"},null,8,["modelValue"])]),t("div",At,[Nt,i(c,{modelValue:e.form.status,"onUpdate:modelValue":o[6]||(o[6]=s=>e.form.status=s),options:e.paymentList,optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])]),t("div",Ut,[Lt,i(c,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[7]||(o[7]=s=>e.form.payment_mode=s),options:e.paymentModeList,optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode&&e.form.payment_mode.label=="Biglietto a data aperta (voucher)"?(k(),D("div",Mt,[Pt,i(v,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":o[8]||(o[8]=s=>e.form.open_ticket_codes=s),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:o[9]||(o[9]=s=>e.fetchAllOpenTickets(s)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"id",multiple:""},null,8,["modelValue","suggestions"])])):A("",!0),t("div",jt,[t("div",Bt,[zt,i(u,{modelValue:e.form.notes,"onUpdate:modelValue":o[10]||(o[10]=s=>e.form.notes=s),rows:"5",cols:"30"},null,8,["modelValue"])])]),t("div",It,[i(_,{label:"Prosegui",onClick:o[11]||(o[11]=s=>l.$emit("nextTab",e.form))})])])):A("",!0)}const Et=B(vt,[["render",Rt]]),qt={props:["form"],setup(l,o){R(()=>{s()});const n=C(0),e=C([]),w=C(!1),f=C(),a=te(),c=q(),v=E(),u=O(()=>a.allTickets),_=O(()=>c.getCurrentOrder),s=async function(){const d={location_permalink:l.form.location_permalink,api_version:"v2",date:X(l.form.date),course_id:l.form.course.id};await a.fetchAllTickets(d).then(()=>{}).catch(r=>{U(v,r)})},y=function(d){n.value+=1,f.value=d.discount_code,e.value=Object.assign([],d.partial_total)},N=function(d){return X(d).includes("Invalid")?ae(d):X(d)},b=function(d){T(d)},T=async function(d){var J,G,z;const r=[{start_at:l.form.hour,tickets:[]}];e.value.forEach(j=>{j.quantity!=0&&r[0].tickets.push({id:j.ticket.id,quantity:j.quantity})});const V={location_permalink:l.form.location_permalink,country_id:d.country_id,status:d.status.id,user_email:d.user_email,user_name:d.user_name,user_phone:d.user_phone,user_surname:d.user_surname,user_zip:d.user_zip,api_version:"v2",date:l.form.date?N(l.form.date):"",note:d.notes,time_slots:r,payment_method:(J=d.payment_mode)==null?void 0:J.id,course_id:(z=(G=l.form)==null?void 0:G.course)==null?void 0:z.id};f.value&&(V.discount_code=f.value),await c.createOrder(V).then(()=>{n.value+=1,w.value=!0}).catch(j=>{U(v,j)})};return{tickets:u,active:n,partialTotals:e,showOrderDetail:w,currentOrder:_,formatExplicitDate:Ne,formatDate:re,onNextTab:y,onConfirmPayment:b,printPDF:oe,onPrintPDF:function(){oe(_==null?void 0:_.value.order_items[0].id,l.form.location_permalink,!1),o.emit("closeDialog",!0)}}},components:{NewOrderTicketTab:pt,NewOrderFormTab:Et}},Jt={key:0,class:"info-box"},Gt={class:"font-medium"},Ht=t("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),Kt={class:"font-medium"},Qt=t("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Wt={class:"capitalize"},Xt={key:0,class:"flex pb-4"},Yt=t("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),Zt={class:"flex flex-column"},$t={key:0,class:"pb-1 pr-1"},en={key:1,class:"pb-1"},on={class:"py-5"},tn={class:"m-0 text-center font-bold line-height-3"},nn=t("br",null,null,-1),ln=t("br",null,null,-1),sn={class:"flex align-items-center justify-content-center mt-3"};function an(l,o,n,e,w,f){var s;const a=h("NewOrderTicketTab"),c=h("TabPanel"),v=h("NewOrderFormTab"),u=h("Button"),_=h("TabView");return k(),D(K,null,[n.form?(k(),D("div",Jt,[t("p",Gt,[Ht,L(S((s=n.form.course)==null?void 0:s.name),1)]),t("p",Kt,[Qt,t("span",Wt,S(e.formatDate(n.form.date)),1),L(" - "+S(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(k(),D("div",Xt,[Yt,t("div",Zt,[(k(!0),D(K,null,se(e.partialTotals,y=>{var N;return k(),D("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:y},[y&&y.quantity!=0?(k(),D("span",$t,S((N=y.ticket)==null?void 0:N.name),1)):A("",!0),y&&y.quantity!=0?(k(),D("span",en," x "+S(y.quantity)+" "+S(y.price),1)):A("",!0)])}),128))])])):A("",!0)])):A("",!0),i(_,{activeIndex:e.active,"onUpdate:activeIndex":o[3]||(o[3]=y=>e.active=y)},{default:g(()=>[i(c,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:g(()=>[i(a,{tickets:e.tickets,form:n.form,onNextTab:o[0]||(o[0]=y=>e.onNextTab(y))},null,8,["tickets","form"])]),_:1},8,["disabled"]),i(c,{header:"Inserisci i dati",disabled:e.showOrderDetail},{default:g(()=>[i(v,{onNextTab:o[1]||(o[1]=y=>e.onConfirmPayment(y)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(k(),Y(c,{key:0,header:"Ordine completato"},{default:g(()=>{var y;return[t("div",on,[t("div",tn,[L(" Ordine "+S(e.currentOrder.reservation_number)+" registrato correttamente!",1),nn,L(" Ti abbiamo inoltrato la conferma via mail."),ln,L(" Totale ordine: € "+S((+((y=e.currentOrder)==null?void 0:y.total)).toFixed(2)),1)]),t("div",sn,[i(u,{label:"Stampa biglietti",outlined:"",onClick:o[2]||(o[2]=N=>e.onPrintPDF())})])])]}),_:1})):A("",!0)]),_:1},8,["activeIndex"])],64)}const rn=B(qt,[["render",an]]),cn={props:["filters"],setup(l,o){R(()=>{s(),f.value=ce(8,20),n.value=Object.assign({},l.filters),n.value.hour=Me(f.value)});const n=C({}),e=Ue(),w=E(),f=C(),a=C(!1),c=ie(),v=C(!1),u=O(()=>e.allCourses),_=O(()=>c.showNewOrderDialog),s=async function(){const T={location_permalink:l.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(T).then(()=>{}).catch(p=>{U(w,p)})},y=function(){c.setNewOrderDialogVisibility(!1),n.value={},o.emit("onCloseDialog",l.filters)},N=function(T){c.setNewOrderDialogVisibility(T)},b=function(){v.value=n.value.open_ticket};return I(l.filters,()=>{if((l.filters.location_permalink!=n.value.location_permalink||!n.value.course)&&s(),n.value.date=l.filters.date,n.value.location_permalink=l.filters.location_permalink,l.filters.hour&&l.filters.hour!="Tutti gli orari"&&(n.value.hour=l.filters.hour),l.filters.course&&!l.filters.course.id){let T=u.value.find(p=>p.name===l.filters.course.name);T&&(n.value.course=T)}}),I(u,()=>{n.value.course=u.value[0]}),{courses:u,form:n,hours:f,disableForm:v,visible:a,onCloseDialog:y,updateDialog:N,onChecked:b,dialogVisible:_,dialogStore:c}},components:{NewOrderDialog:rn}},dn=t("h2",{class:"mt-1"},"Nuova prenotazione",-1),un={class:"formgrid grid px-0 align-items-center mt-4"},mn={key:0,class:"field flex flex-column w-full col-12"},_n=t("label",{for:"typology"},"Scegli il percorso",-1),fn={key:1,class:"field flex flex-column w-full col-12"},hn=t("label",{for:"typology"},"Seleziona l'orario",-1),pn={class:"flex justify-content-end align-items-center mt-2"},vn={class:"flex align-items-center justify-content-between w-full"},yn=t("h2",null,"Nuova prenotazione",-1);function kn(l,o,n,e,w,f){const a=h("Dropdown"),c=h("Button"),v=h("NewOrderDialog"),u=h("Dialog"),_=h("Card");return k(),Y(_,{class:"mt-4"},{content:g(()=>[dn,t("div",un,[n.filters.location_permalink?(k(),D("div",mn,[_n,i(a,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.course=s),options:e.courses,optionLabel:"name",disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):A("",!0),n.filters.location_permalink?(k(),D("div",fn,[hn,i(a,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.hour=s),options:e.hours,disabled:e.disableForm},null,8,["modelValue","options","disabled"])])):A("",!0)]),t("div",pn,[i(c,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:o[2]||(o[2]=s=>e.updateDialog(!0))},null,8,["disabled"])]),i(u,{visible:e.dialogVisible,"onUpdate:visible":o[5]||(o[5]=s=>e.dialogVisible=s),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:o[6]||(o[6]=s=>e.onCloseDialog())},{header:g(()=>[t("div",vn,[yn,i(c,{icon:"pi pi-times",text:"",rounded:"",onClick:o[3]||(o[3]=s=>e.updateDialog(!1))})])]),default:g(()=>[i(v,{form:e.form,onCloseDialog:o[4]||(o[4]=s=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const gn=B(cn,[["render",kn]]),bn={setup(){R(()=>{f.value&&(l.value.location_permalink=f.value.location.permalink,c())});const l=C({}),o=C(),n=Oe(),e=ne(),w=E(),f=O(()=>n.currentUser),a=O(()=>e.allLocations),c=async function(){await e.fetchAllLocations().then(()=>{}).catch(u=>{U(w,u)})};return{filters:l,orderTable:o,user:f,locations:a,fetchAllLocations:c,formatDate:re,onUpdateFilters:function(u){debugger;u.start_at&&(l.value.hour=u.start_at),u.course_name&&(l.value.course={name:u.course_name}),u.course&&(l.value.course={id:u.course}),u.name&&(l.value.name=u.name),u.hour&&(u.hour.start_at?l.value.hour=u.hour.start_at:l.value.hour=u.hour)}}},components:{CalendarFilter:Lo,OrderTable:Oo,OrderFilter:Ho,NewOrderCard:gn}};const xn={class:"flex justify-content-between align-items-center"},wn={class:"field flex flex-column mt-3"},Cn={key:0,style:{color:"#495057"}},Dn=t("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Vn={class:"capitalize text-xl"},Tn={class:"flex gap-4"},Sn={key:0,class:"col-3 mt-3"},On={class:"col-9 mt-3"};function Fn(l,o,n,e,w,f){const a=h("Dropdown"),c=h("CalendarFilter"),v=h("NewOrderCard"),u=h("OrderFilter"),_=h("OrderTable");return k(),D("div",null,[t("div",xn,[t("div",wn,[i(a,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=s=>e.filters.location_permalink=s),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(k(),D("div",Cn,[Dn,t("span",Vn,S(e.formatDate(e.filters.date)),1)])):A("",!0)]),t("div",Tn,[e.filters.location_permalink?(k(),D("div",Sn,[i(c,{filters:e.filters},null,8,["filters"]),i(v,{filters:e.filters,onOnCloseDialog:o[1]||(o[1]=s=>e.onUpdateFilters(s))},null,8,["filters"])])):A("",!0),t("div",On,[i(u,{filters:e.filters,onOnSubmit:o[2]||(o[2]=s=>e.onUpdateFilters(s))},null,8,["filters"]),e.filters.date?(k(),Y(_,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:o[3]||(o[3]=s=>e.onUpdateFilters(s))},null,8,["filters"])):A("",!0)])])])}const Mn=B(bn,[["render",Fn]]);export{Mn as default};
