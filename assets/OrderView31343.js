import{o as R,x,a as I,c as F,_ as j,r as h,b as y,e as C,g as t,f as a,H as N,I as K,J as Ve,i as W,K as Te,w as b,h as U,n as Z,t as O,L as ee,M as X,N as le,u as Oe}from"../index31343.js";import{u as te,a as q,b as se,f as $,c as ae,d as Se,D as Q,e as ne,g as Fe,h as Ne,i as ie,j as Le}from"./NewOrderDialog.vue_vue_type_style_index_0_lang31343.js";import{s as H,e as A,p as Ue,a as oe,b as Ae,c as re}from"./helpers31343.js";import{u as ce}from"./loader31343.js";const Me={props:["location_permalink","time_slot"],setup(l,o){R(()=>{n.value=Object.assign({},l.time_slot)});const n=x({}),e=te(),w=q(),{showLoader:g,hideLoader:i}=ce(),c=I(),v=F(()=>e.allOpenTickets),f=F(()=>w.paymentStatus),_=F(()=>w.paymentModeList),s=async function(k){const V={code:k.query.toUpperCase(),location_permalink:l.location_permalink};await e.fetchAllOpenTickets(V)},S=async function(){var V;const k={id:l.location_permalink,order_id:n.value.id,status:(V=n.value)==null?void 0:V.status,payment_method:n.value.payment_mode,open_ticket_codes:[],api_version:"v2"};if(n.value.open_ticket_codes&&n.value.open_ticket_codes.length>0){let p=[];n.value.open_ticket_codes.forEach(d=>{p.push(d.code)}),k.open_ticket_codes=p}u(k)},u=async function(k){g(),await w.updateOrder(k).then(()=>{i(),H(c,{message:"Stato aggiornato correttamente",error:!1}),o.emit("closeDialog",!0)}).catch(V=>{i(),A(c,V)})};return{form:n,open_tickets:v,paymentList:f,paymentModeList:_,changeStatus:S,fetchAllOpenTickets:s}}},Pe={key:0,class:"formgrid grid flex-column mt-3"},je={class:"field col-12"},ze=t("label",{for:"status"},"Stato pagamento",-1),Be={class:"field col-12"},Re=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),Ie={key:0,class:"field col-12 flex flex-column"},qe=t("label",{for:"user_zip"},"Codice biglietto",-1),Ee={class:"flex align-items-center justify-content-end mt-3"};function Je(l,o,n,e,w,g){const i=h("Dropdown"),c=h("AutoComplete"),v=h("Button");return y(),C(K,null,[e.form?(y(),C("div",Pe,[t("div",je,[ze,a(i,{modelValue:e.form.status,"onUpdate:modelValue":o[0]||(o[0]=f=>e.form.status=f),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Be,[Re,a(i,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[1]||(o[1]=f=>e.form.payment_mode=f),options:e.paymentModeList,optionLabel:"label",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode=="voucher"?(y(),C("div",Ie,[qe,a(c,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":o[2]||(o[2]=f=>e.form.open_ticket_codes=f),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:o[3]||(o[3]=f=>e.fetchAllOpenTickets(f)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):N("",!0)])):N("",!0),t("div",Ee,[a(v,{label:"Annulla",text:"",onClick:o[4]||(o[4]=f=>l.$emit("closeDialog",!1))}),a(v,{label:"Conferma",onClick:o[5]||(o[5]=f=>e.changeStatus())})])],64)}const Ge=j(Me,[["render",Je]]),He={props:["filters"],setup(l,o){R(()=>{d.value=!0,r.value={first:0,rows:S.value.rows,sortField:null,sortOrder:null},r.value.page=0,l.filters.location_permalink&&B()});const n=q(),e=se(),w=F(()=>n.responseOrders),g=F(()=>n.status),i=Ve();F(()=>i.cancelDialog);const c=F(()=>i.submitDialog),v=F(()=>n.paymentStatus),{showLoader:f,hideLoader:_}=ce(),s=I(),S=x(),u=x(),k=x(),V=x(),p=x(),d=x(!0),r=x(),D=x(0),E=x([]),J=x([]),G=x([]),z=x(!1),Y=x();function B(){d.value=!0;let m=new Map;for(const T in l.filters)T=="date"?$(l.filters.date)=="Invalid DateTime"?m.set("date",ae(l.filters.date)):m.set("date",$(l.filters.date)):l.filters.location_permalink&&m.set("location_permalink",l.filters.location_permalink),T=="course"&&l.filters.course.id!="-1"&&m.set("course",l.filters.course.id),T=="hour"&&l.filters.hour!="Tutti gli orari"&&m.set("hour",l.filters.hour),T=="name"&&m.set("name",l.filters.name);setTimeout(()=>{de(m)},Math.random()*1e3+250)}const de=async function(m){await n.fetchAllOrders(m).then(()=>{d.value=!1}).catch(T=>{d.value=!1,A(s,T)})},ue=m=>{k.value.toggle(m),Y.value.toggle(m)},me=(m,T)=>{if(m>=(m+T)/2)return"green";if(m<=Math.round((m+T)/3))return"red"},_e=function(m,T){T&&(k.value.note=T,k.value.toggle(m))},fe=async function(m,T){let L=[];for(let P of m.tickets)L.push(P.order_item_id);const M={check_in:T,order_item_ids:L,location_permalink:l.filters.location_permalink};await n.checkInOrder(M).then(()=>{B(),H(s,{message:"Check-in registrato correttamente",error:!1})}).catch(P=>{A(s,P)})},pe=async function(m,T){const L={id:m.id,no_show:T,location_permalink:l.filters.location_permalink};await n.noShowOrder(L).then(()=>{B(),H(s,{message:"No-show registrato correttamente",error:!1})}).catch(M=>{A(s,M)})},he=async function(m,T,L){const M={id:m,check_in:T,location_permalink:l.filters.location_permalink};await n.checkInTicket(M).then(()=>{H(s,{message:"Check-in registrato correttamente",error:!1}),B()}).catch(P=>{A(s,P)})},ve=async function(m,T,L){const M={id:m,no_show:T,location_permalink:l.filters.location_permalink};await n.noShowTicket(M).then(()=>{H(s,{message:"No-show registrato correttamente",error:!1}),B()}).catch(P=>{A(s,P)})},ye=function(m){const T={course_name:m.course_name,start_at:m.start_at};o.emit("updateFilters",T),e.setNewOrderDialogVisibility(!0)},ge=function(m){z.value=!0,V.value=m},ke=function(m){m&&B(),z.value=!1},be=function(m){return m!=null&&m.created_by?m.created_by:""},xe=function(m,T){let L=0;if(m&&m.tickets){m.tickets.forEach(P=>{T?P.no_show&&(L+=1):P.check_in&&(L+=1)});let M=m.tickets.length;if(L!=M&&L!=0)return L+"/"+M}},we=function(m,T){Y.value.data=T,Y.value.toggle(m)},Ce=function(m,T){p.value=T.id;let L="Sei sicuro di voler eliminare questa prenotazione?";i.setDialog("Elimina prenotazione","Elimina","Annulla",L),i.setDynamicDialogVisibility(!0)},De=function(){if(f(),p.value){const m={id:p.value,location_permalink:l.filters.location_permalink};n.deleteOrder(m).then(()=>{_(),H(s,{message:"La prenotazione è stata eliminata correttamente",error:!1}),B()}).catch(T=>{_(),A(s,T)})}};return W(c,m=>{De()}),W(l.filters,()=>{l.filters.location_permalink&&B()}),{dt:S,responseOrders:w,loading:d,totalRecords:D,lazyParams:r,currentOrder:u,status:g,expandedRows:E,expandedRows1:J,expandedRows2:G,op:k,dialogStore:e,paymentList:v,visibleDialog:z,currentTimeSlot:V,visibleMenu:Y,loadLazyData:B,toggle:ue,getProgressClass:me,showNotes:_e,checkAll:fe,noShowAll:pe,openDialog:ye,checkInSingleTicket:he,noShowSingleTicket:ve,prettyPaymentStatus:Ue,openPaymentStatusDialog:ge,onClosePaymentStatusDialog:ke,getRowClass:be,printPDF:oe,showLabelCheckbox:xe,confirmDeleteOrder:Ce,showMenu:we,formatDataFromUnixTimestamps:Se,printOrderPDF:Ae}},components:{PaymentStatusDialog:Ge}};const Ke={class:"order-table"},We={style:{width:"15rem"}},Qe={class:"m-0 text-right",style:{"font-size":"12px"}},Xe={style:{width:"15rem"}},Ye={class:"m-0 text-right",style:{"font-size":"12px"}},Ze={key:0},$e={key:0},eo=t("div",{class:"flex justify-content-center w-full"},"Check-in",-1),oo={class:"flex justify-content-center"},to={class:"flex flex-column",style:{"margin-top":"8px"}},no={class:"text-sm",style:{"min-height":"15px"}},lo=t("div",{class:"flex justify-content-center w-full"},"No-show",-1),so={class:"flex justify-content-center"},ao={class:"flex flex-column",style:{"margin-top":"8px"}},io={class:"text-sm",style:{"min-height":"15px"}},ro={class:"overlay-menu"},co=["onClick"],uo=t("i",{class:"pi pi-print mr-3"},null,-1),mo=["disabled","onClick"],_o=t("i",{class:"pi pi-pencil mr-3"},null,-1),fo=["disabled","onClick"],po=t("i",{class:"pi pi-trash mr-3"},null,-1),ho={key:0},vo={key:1},yo=t("div",{class:"flex justify-content-center w-full"},"Check-in",-1),go={class:"flex justify-content-center"},ko=t("div",{class:"flex justify-content-center w-full"},"No-show",-1),bo={class:"flex justify-content-center"},xo=t("div",{class:"flex justify-content-center w-full"},"PDF",-1),wo={class:"flex justify-content-center"},Co={key:0,class:"flex mx-4"},Do=t("div",null,[t("div",{class:"p-0 m-0 flex align-items-center"},[t("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),t("span",{class:"text-sm"},"WEB")]),t("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[t("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),t("span",{class:"text-sm"},"KALATA")])],-1),Vo=[Do];function To(l,o,n,e,w,g){const i=h("Column"),c=h("ProgressBar"),v=h("Button"),f=h("Badge"),_=h("Checkbox"),s=h("OverlayPanel"),S=h("DataTable"),u=h("PaymentStatusDialog"),k=h("Dialog"),V=Te("tooltip");return y(),C("div",Ke,[a(S,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":o[2]||(o[2]=p=>e.expandedRows=p)},{empty:b(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:b(p=>[a(S,{value:p.data.orders,class:"m-4 mx-4",expandedRows:e.expandedRows1,"onUpdate:expandedRows":o[1]||(o[1]=d=>e.expandedRows1=d),rowClass:e.getRowClass},{empty:b(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:b(d=>[a(S,{value:d.data.tickets,class:"m-4 mx-5",expandedRows:e.expandedRows2,"onUpdate:expandedRows":o[0]||(o[0]=r=>e.expandedRows2=r)},{default:b(()=>[a(i,{header:"Codice biglietto",field:"code"}),a(i,{header:"Tipo biglietto",field:"type"},{body:b(({data:r})=>[a(f,{value:r.ticket_name,class:Z([r.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(i,{header:"Prezzo"},{body:b(({data:r})=>[r.ticket_price?(y(),C("span",ho," € "+O((+r.ticket_price).toFixed(2)),1)):(y(),C("span",vo,"-"))]),_:1}),a(i,null,{header:b(()=>[yo]),body:b(({data:r})=>[t("div",go,[a(_,{modelValue:r.check_in,"onUpdate:modelValue":D=>r.check_in=D,binary:!0,onChange:D=>e.checkInSingleTicket(r.id,r.check_in,d.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(i,null,{header:b(()=>[ko]),body:b(({data:r})=>[t("div",bo,[a(_,{modelValue:r.no_show,"onUpdate:modelValue":D=>r.no_show=D,binary:!0,onChange:D=>e.noShowSingleTicket(r.id,r.no_show,d.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(i,{field:"tickets_url"},{header:b(()=>[xo]),body:b(({data:r})=>[t("div",wo,[ee(a(v,{link:"",icon:"pi pi-print",href:r.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:D=>e.printPDF(r.id,n.filters.location_permalink,!0)},null,8,["href","onClick"]),[[V,"Stampa PDF",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value","expandedRows"])]),default:b(()=>[a(i,{header:"Codice",field:"reservation_number"}),a(i,{header:"Acquirente"},{body:b(({data:d})=>[U(O(d.user_name)+" "+O(d.user_surname)+" ",1),!d.user_name&&!d.user_surname?(y(),C("span",Ze,"-")):N("",!0)]),_:1}),a(i,{header:"Pagamento"},{body:b(({data:d})=>[d.status?(y(),C("span",$e,[a(f,{value:e.prettyPaymentStatus(d.status),class:Z([d.status,"px-3 border-round-lg"])},null,8,["value","class"])])):N("",!0)]),_:1}),a(i,null,{header:b(()=>[eo]),body:b(({data:d})=>[t("div",oo,[t("div",to,[a(_,{modelValue:d.check_in,"onUpdate:modelValue":r=>d.check_in=r,binary:!0,onChange:r=>e.checkAll(d,d.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),t("span",no,O(e.showLabelCheckbox(d,!1)),1)])])]),_:1}),a(i,null,{header:b(()=>[lo]),body:b(({data:d})=>[t("div",so,[t("div",ao,[a(_,{modelValue:d.no_show,"onUpdate:modelValue":r=>d.no_show=r,binary:!0,onChange:r=>e.noShowAll(d,d.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),t("span",io,O(e.showLabelCheckbox(d,!0)),1)])])]),_:1}),a(i,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:b(({data:d})=>[ee(a(v,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-comment",text:"",rounded:"",onClick:r=>e.showNotes(r,d.notes),disabled:!d.notes},null,8,["onClick","disabled"]),[[V,"Note",void 0,{top:!0}]]),a(s,{ref:"op"},{default:b(()=>[U(O(e.op.note),1)]),_:1},512),a(v,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:r=>e.showMenu(r,d)},null,8,["onClick"]),a(s,{ref:"visibleMenu"},{default:b(()=>[t("ul",ro,[t("li",{onClick:r=>e.printOrderPDF(e.visibleMenu.data,n.filters.location_permalink,!1)},[uo,U("Stampa PDF ")],8,co),t("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:r=>e.openPaymentStatusDialog(e.visibleMenu.data)},[_o,U("Cambia stato ")],8,mo),t("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:r=>e.confirmDeleteOrder(r,e.visibleMenu.data)},[po,U("Elimina ")],8,fo)])]),_:2},1536)]),_:1}),a(i,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass"]),p.data.orders&&p.data.orders.length>0?(y(),C("div",Co,Vo)):N("",!0)]),default:b(()=>[a(i,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(i,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},null,512),a(i,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:b(({data:p})=>[t("div",We,[t("p",Qe,O(p.confirmed_seats)+"/"+O(p.remaing_seats+p.confirmed_seats),1),a(c,{value:p.confirmed_seats*100/(p.remaing_seats+p.confirmed_seats),showValue:!1,style:{height:"10px"},class:Z(["available-progress",e.getProgressClass(p.confirmed_seats,p.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(i,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:b(({data:p})=>[t("div",Xe,[t("p",Ye,O(p.check_in_done)+"/"+O(p.confirmed_seats),1),a(c,{value:p.check_in_done*100/(p.remaing_seats+p.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(i,null,{body:b(({data:p})=>[ee(a(v,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:d=>e.openDialog(p)},null,8,["onClick"]),[[V,"Prenota",void 0,{top:!0}]])]),_:1}),a(i,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"]),a(k,{visible:e.visibleDialog,"onUpdate:visible":o[4]||(o[4]=p=>e.visibleDialog=p),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:b(()=>[a(u,{location_permalink:n.filters.location_permalink,time_slot:e.currentTimeSlot,onCloseDialog:o[3]||(o[3]=p=>e.onClosePaymentStatusDialog(p))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"])])}const Oo=j(He,[["render",To]]),So={props:["filters"],setup(l,o){R(()=>{S();let r=Q.now();n.value=l.filters,n.value.date=r.toFormat("dd/MM/yyyy"),V()});const n=x({}),e=ne(),w=q(),g=I(),i=x([]),c=x(),v=F(()=>e.allLocations),f=F(()=>w.getCalendar),_=function(){},s=async function(r){await w.fetchCalendar(r).then(()=>{}).catch(D=>{A(g,D)})},S=async function(){await e.fetchAllLocations().then(()=>{u()}).catch(r=>{A(g,r)})},u=function(){if(l.filters.location_permalink){const r=v.value.find(D=>D.permalink===l.filters.location_permalink);i.value=r.courses}},k=function(r){let D={};D.month=Q.fromJSDate(new Date(r)).month,D.year=Q.fromJSDate(new Date(r)).year,D.location_permalink=l.filters.location_permalink,c.value={month:D.month,year:D.year},s(D)},V=function(){let r=Q.now(),D={location_permalink:"",month:"",year:""};D.location_permalink=l.filters.location_permalink,D.month=r.month+"",D.year=r.year+"",s(D)},p=function(r){if(f.value.web_dates&&f.value.web_dates.length!=0){let D=r.month+1;D=r.month<10?"0"+D:D;let E=r.day<10?"0"+r.day:r.day,J=r.year+"-"+D+"-"+E;return f.value.web_dates.find(G=>G==J)}},d=function(r){let D={location_permalink:l.filters.location_permalink,month:r.month,year:r.year};s(D)};return W(l.filters,()=>{if(c.value){let r={location_permalink:l.filters.location_permalink,month:c.value.month,year:c.value.year};s(r)}else V()}),{form:n,courses:i,locations:v,calendar:f,resetField:_,getCourses:u,onDateChange:k,getDayFromDate:p,onMonthChange:d}}},Fo={class:"flex calendar-filter"},No={key:0,class:"special-day"};function Lo(l,o,n,e,w,g){const i=h("Calendar");return y(),C("div",Fo,[a(i,{modelValue:e.form.date,"onUpdate:modelValue":o[0]||(o[0]=c=>e.form.date=c),inline:"",onDateSelect:o[1]||(o[1]=c=>e.onDateChange(c)),onMonthChange:o[2]||(o[2]=c=>e.onMonthChange(c))},{date:b(c=>[e.getDayFromDate(c.date)?(y(),C("div",No,[t("span",null,O(c.date.day),1)])):(y(),C(K,{key:1},[U(O(c.date.day),1)],64))]),_:1},8,["modelValue"])])}const Uo=j(So,[["render",Lo]]),Ao={props:["filters"],setup(l,o){R(()=>{n.value=Object.assign({},l.filters),n.value.date=Q.now().toFormat("dd/MM/yyyy"),g.value=re(8,20),g.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=x({}),e=x([]),w=ne();I();const g=x([]),i=q(),c=F(()=>w.allLocations),v=F(()=>i.responseOrders),f=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=g.value[0],o.emit("onSubmit",n.value)},_=function(){if(e.value=[],n.value.location_permalink){const s=c.value.find(S=>S.permalink===n.value.location_permalink);e.value=s.courses,e.value[0].id!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}};return W(c,()=>{l.filters.location_permalink&&c.value&&(n.value=Object.assign({},l.filters),n.value.hour||(n.value.hour="Tutti gli orari"),_())}),W(l.filters,()=>{l.filters.location_permalink&&c.value&&n.value.location_permalink&&n.value.location_permalink!=l.filters.location_permalink&&(n.value=Object.assign({},l.filters),n.value.hour||(n.value.hour="Tutti gli orari"),_())}),{form:n,courses:e,hours:g,locations:c,responseOrders:v,resetField:f,getCourses:_}}},Mo={class:"formgrid grid px-0 align-items-center"},Po={key:0,class:"field col-4 flex flex-column"},jo=t("label",{for:"typology"},"Filtra per percorso",-1),zo={key:1,class:"field col-3 flex flex-column"},Bo=t("label",{for:"typology"},"Filtra per orario (dalle)",-1),Ro=t("div",{class:"col-12"},null,-1),Io={class:"field col-4 flex flex-column"},qo=t("label",{for:"typology"},"Filtra per nome acquirente",-1),Eo={class:"flex col-12 justify-content-end pt-1"};function Jo(l,o,n,e,w,g){const i=h("Dropdown"),c=h("InputText"),v=h("Button"),f=h("AccordionTab"),_=h("Accordion");return y(),X(_,{activeIndex:0},{default:b(()=>[a(f,{header:"FILTRI"},{default:b(()=>[t("div",Mo,[e.form.location_permalink?(y(),C("div",Po,[jo,a(i,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.course=s),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):N("",!0),e.responseOrders?(y(),C("div",zo,[Bo,a(i,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.hour=s),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):N("",!0),Ro,t("div",Io,[qo,a(c,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.name=s),placeholder:""},null,8,["modelValue"])])]),t("div",Eo,[a(v,{label:"Ricerca",class:"mr-2",onClick:o[3]||(o[3]=s=>l.$emit("onSubmit",e.form))}),a(v,{label:"Annulla",class:"p-button-outlined",onClick:o[4]||(o[4]=s=>e.resetField())})])]),_:1})]),_:1})}const Go=j(Ao,[["render",Jo]]),Ho={props:["form","price","index","ticket"],setup(l,o){const n=x(0),e=function(){n.value++,g()},w=function(){n.value>0&&n.value--,g()},g=function(){const i={counter:n.value,price:l.price,index:l.index,ticket:l.ticket};o.emit("changeCounter",i)};return{counter:n,decrement:w,increment:e}}},Ko={class:"btn-plus-min flex align-items-center"},Wo={class:"counter"};function Qo(l,o,n,e,w,g){const i=h("Button");return y(),C("div",Ko,[a(i,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),t("div",Wo,O(e.counter),1),a(i,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const Xo=j(Ho,[["render",Qo]]),Yo={props:["tickets","form"],setup(l,o){const n=x(0),e=x([]),w=x(!1),g=x(),i=q(),c=I(),v=F(()=>i.getDiscount),f=function(k){e.value[k.index]={partial_total:k.price*k.counter,ticket:k.ticket,quantity:k.counter},n.value=0,e.value.forEach(V=>{n.value+=V.partial_total}),g.value&&s()},_=function(){s()},s=async function(){let k=[];e.value.forEach(p=>{k.push({id:p.ticket.id,quantity:p.quantity})});const V={discount_code:g.value,location_permalink:l.form.location_permalink,tickets:k};await i.cost(V).then(()=>{}).catch(p=>{A(c,p)})};return{total:n,partialTotals:e,showDiscount:w,discountCode:g,discount:v,onChangeCounter:f,applyDiscount:_,checkDisabled:function(){if(!e.value||e.value.length==0)return!0;let k=0;return e.value.forEach(V=>{k+=V.quantity}),k==0},nextTab:function(){const k={discount_code:g.value,partial_total:e.value};o.emit("nextTab",k)}}},components:{PlusMinusButton:Xo}},Zo={key:0,class:"flex justify-content-between align-items-center"},$o={class:"flex align-items-center col-9"},et={class:"col-4 pl-0"},ot={class:"text-right col-2"},tt={class:"col-3 flex justify-content-end"},nt=t("hr",{class:"mt-3"},null,-1),lt={class:"col-12 m-0 py-0 flex flex-column align-items-start"},st={class:"flex align-items-center justify-content-between py-0"},at={class:"col-9 flex"},it=t("b",null,"Totale",-1),rt=[it],ct={key:0,class:"text-right col-4"},dt={class:"line-through text-sm mr-2"},ut={class:"font-bold"},mt={key:1,class:"col-2 text-right font-bold"},_t={class:"col-3 flex justify-content-end"};function ft(l,o,n,e,w,g){const i=h("PlusMinusButton"),c=h("Button"),v=h("InputText"),f=h("InputGroup");return y(),C(K,null,[(y(!0),C(K,null,le(n.tickets,(_,s)=>{var S,u,k;return y(),C("div",{key:_.id},[((S=_.course)==null?void 0:S.id)==((u=n.form.course)==null?void 0:u.id)?(y(),C("div",Zo,[t("div",$o,[t("b",et,O(_.name),1),t("div",ot,"€ "+O((k=_.price)==null?void 0:k.toFixed(2)),1)]),t("div",tt,[a(i,{onChangeCounter:o[0]||(o[0]=V=>e.onChangeCounter(V)),price:_.price,index:s,ticket:_},null,8,["price","index","ticket"])])])):N("",!0)])}),128)),nt,t("div",lt,[a(c,{label:"Codice sconto",link:"",onClick:o[1]||(o[1]=_=>e.showDiscount?e.showDiscount=!1:e.showDiscount=!0),class:"p-0"}),e.showDiscount?(y(),X(f,{key:0,class:"discount"},{default:b(()=>[a(v,{placeholder:"Inserisci codice",modelValue:e.discountCode,"onUpdate:modelValue":o[2]||(o[2]=_=>e.discountCode=_)},null,8,["modelValue"]),a(c,{label:"Applica",onClick:e.applyDiscount},null,8,["onClick"])]),_:1})):N("",!0)]),t("div",st,[t("div",at,[t("div",{class:Z(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-4"])},rt,2),e.discount&&e.discount.total_amount?(y(),C("div",ct,[t("span",dt,"€ "+O(e.total.toFixed(2)),1),t("span",ut,"€ "+O(e.discount.total_amount.toFixed(2)),1)])):(y(),C("div",mt,"€ "+O(e.total.toFixed(2)),1))]),t("div",_t,[a(c,{label:"Prosegui",onClick:o[3]||(o[3]=_=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const pt=j(Yo,[["render",ft]]),ht={props:["location_permalink"],setup(l){R(()=>{f()});const o=te(),n=Fe(),e=q(),w=x({}),g=F(()=>n.allCountries),i=F(()=>o.allOpenTickets),c=F(()=>e.paymentStatus),v=F(()=>e.paymentModeList),f=async function(){await n.fetchAllCountries().then(()=>{w.value.country_id=88,w.value.status={id:"to_pay",name:"Da pagare"}})};return{form:w,countries:g,paymentList:c,paymentModeList:v,open_tickets:i,fetchAllOpenTickets:async function(s){const S={code:s.query.toUpperCase(),location_permalink:l.location_permalink};await o.fetchAllOpenTickets(S)}}}},vt={key:0,class:"formgrid grid"},yt={class:"field col-6"},gt=t("label",{for:"user_name"},"Nome",-1),kt={class:"field col-6"},bt=t("label",{for:"user_surname"},"Cognome",-1),xt={class:"field col-6"},wt=t("label",{for:"user_email"},"Email",-1),Ct={class:"field col-6"},Dt=t("label",{for:"user_phone"},"Telefono",-1),Vt={class:"field col-6"},Tt=t("label",{for:"country_id"},"Nazione",-1),Ot={class:"field col-6"},St=t("label",{for:"user_zip"},"Cap",-1),Ft={class:"field col-6"},Nt=t("label",{for:"status"},"Stato pagamento",-1),Lt={class:"field col-6"},Ut=t("label",{for:"spayment_modetatus"},"Modalità pagamento",-1),At={key:0,class:"field col-6 flex flex-column"},Mt=t("label",{for:"user_zip"},"Codice biglietto",-1),Pt={class:"field col-12"},jt={class:"field flex flex-column"},zt=t("label",{for:"notes"},"Note",-1),Bt={class:"col-12 flex justify-content-end"};function Rt(l,o,n,e,w,g){const i=h("InputText"),c=h("Dropdown"),v=h("AutoComplete"),f=h("Textarea"),_=h("Button");return e.form?(y(),C("div",vt,[t("div",yt,[gt,a(i,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.user_name=s),class:"w-full"},null,8,["modelValue"])]),t("div",kt,[bt,a(i,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.user_surname=s),class:"w-full"},null,8,["modelValue"])]),t("div",xt,[wt,a(i,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.user_email=s),class:"w-full"},null,8,["modelValue"])]),t("div",Ct,[Dt,a(i,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":o[3]||(o[3]=s=>e.form.user_phone=s),class:"w-full"},null,8,["modelValue"])]),t("div",Vt,[Tt,a(c,{modelValue:e.form.country_id,"onUpdate:modelValue":o[4]||(o[4]=s=>e.form.country_id=s),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),t("div",Ot,[St,a(i,{type:"text",modelValue:e.form.user_zip,"onUpdate:modelValue":o[5]||(o[5]=s=>e.form.user_zip=s),class:"w-full"},null,8,["modelValue"])]),t("div",Ft,[Nt,a(c,{modelValue:e.form.status,"onUpdate:modelValue":o[6]||(o[6]=s=>e.form.status=s),options:e.paymentList,optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])]),t("div",Lt,[Ut,a(c,{modelValue:e.form.payment_mode,"onUpdate:modelValue":o[7]||(o[7]=s=>e.form.payment_mode=s),options:e.paymentModeList,optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),e.form.payment_mode&&e.form.payment_mode.label=="Biglietto a data aperta (voucher)"?(y(),C("div",At,[Mt,a(v,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":o[8]||(o[8]=s=>e.form.open_ticket_codes=s),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:o[9]||(o[9]=s=>e.fetchAllOpenTickets(s)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"id",multiple:""},null,8,["modelValue","suggestions"])])):N("",!0),t("div",Pt,[t("div",jt,[zt,a(f,{modelValue:e.form.notes,"onUpdate:modelValue":o[10]||(o[10]=s=>e.form.notes=s),rows:"5",cols:"30"},null,8,["modelValue"])])]),t("div",Bt,[a(_,{label:"Prosegui",onClick:o[11]||(o[11]=s=>l.$emit("nextTab",e.form))})])])):N("",!0)}const It=j(ht,[["render",Rt]]),qt={props:["form"],setup(l,o){R(()=>{s()});const n=x(0),e=x([]),w=x(!1),g=x(),i=te(),c=q(),v=I(),f=F(()=>i.allTickets),_=F(()=>c.getCurrentOrder),s=async function(){const d={location_permalink:l.form.location_permalink,api_version:"v2",date:u(l.form.date),course_id:l.form.course.id};await i.fetchAllTickets(d).then(()=>{}).catch(r=>{A(v,r)})},S=function(d){n.value+=1,g.value=d.discount_code,e.value=Object.assign([],d.partial_total)},u=function(d){return $(d).includes("Invalid")?ae(d):$(d)},k=function(d){V(d)},V=async function(d){var E,J,G;const r=[{start_at:l.form.hour,tickets:[]}];e.value.forEach(z=>{z.quantity!=0&&r[0].tickets.push({id:z.ticket.id,quantity:z.quantity})});const D={location_permalink:l.form.location_permalink,country_id:d.country_id,status:d.status.id,user_email:d.user_email,user_name:d.user_name,user_phone:d.user_phone,user_surname:d.user_surname,user_zip:d.user_zip,api_version:"v2",date:l.form.date?u(l.form.date):"",note:d.notes,time_slots:r,payment_method:(E=d.payment_mode)==null?void 0:E.id,course_id:(G=(J=l.form)==null?void 0:J.course)==null?void 0:G.id};g.value&&(D.discount_code=g.value),await c.createOrder(D).then(()=>{n.value+=1,w.value=!0}).catch(z=>{A(v,z)})};return{tickets:f,active:n,partialTotals:e,showOrderDetail:w,currentOrder:_,formatExplicitDate:Ne,formatDate:ie,onNextTab:S,onConfirmPayment:k,printPDF:oe,onPrintPDF:function(){oe(_==null?void 0:_.value.order_items[0].id,l.form.location_permalink,!1),o.emit("closeDialog",!0)}}},components:{NewOrderTicketTab:pt,NewOrderFormTab:It}},Et={key:0,class:"info-box"},Jt={class:"font-medium"},Gt=t("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),Ht={class:"font-medium"},Kt=t("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Wt={key:0,class:"capitalize"},Qt={key:0,class:"flex pb-4"},Xt=t("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),Yt={class:"flex flex-column"},Zt={key:0,class:"pb-1 pr-1"},$t={key:1,class:"pb-1"},en={class:"py-5"},on={class:"m-0 text-center font-bold line-height-3"},tn=t("br",null,null,-1),nn=t("br",null,null,-1),ln={class:"flex align-items-center justify-content-center mt-3"};function sn(l,o,n,e,w,g){var s,S;const i=h("NewOrderTicketTab"),c=h("TabPanel"),v=h("NewOrderFormTab"),f=h("Button"),_=h("TabView");return y(),C(K,null,[n.form?(y(),C("div",Et,[U(O(n.form)+" ",1),t("p",Jt,[Gt,U(O((s=n.form.course)==null?void 0:s.name),1)]),t("p",Ht,[Kt,n.form.date?(y(),C("span",Wt,O(e.formatDate((S=n.form)==null?void 0:S.date)),1)):N("",!0),U(" - "+O(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(y(),C("div",Qt,[Xt,t("div",Yt,[(y(!0),C(K,null,le(e.partialTotals,u=>{var k;return y(),C("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:u},[u&&u.quantity!=0?(y(),C("span",Zt,O((k=u.ticket)==null?void 0:k.name),1)):N("",!0),u&&u.quantity!=0?(y(),C("span",$t," x "+O(u.quantity)+" "+O(u.price),1)):N("",!0)])}),128))])])):N("",!0)])):N("",!0),a(_,{activeIndex:e.active,"onUpdate:activeIndex":o[3]||(o[3]=u=>e.active=u)},{default:b(()=>[a(c,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:b(()=>[a(i,{tickets:e.tickets,form:n.form,onNextTab:o[0]||(o[0]=u=>e.onNextTab(u))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(c,{header:"Inserisci i dati",disabled:e.showOrderDetail},{default:b(()=>[a(v,{onNextTab:o[1]||(o[1]=u=>e.onConfirmPayment(u)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(y(),X(c,{key:0,header:"Ordine completato"},{default:b(()=>{var u;return[t("div",en,[t("div",on,[U(" Ordine "+O(e.currentOrder.reservation_number)+" registrato correttamente!",1),tn,U(" Ti abbiamo inoltrato la conferma via mail."),nn,U(" Totale ordine: € "+O((+((u=e.currentOrder)==null?void 0:u.total)).toFixed(2)),1)]),t("div",ln,[a(f,{label:"Stampa biglietti",outlined:"",onClick:o[2]||(o[2]=k=>e.onPrintPDF())})])])]}),_:1})):N("",!0)]),_:1},8,["activeIndex"])],64)}const an=j(qt,[["render",sn]]),rn={props:["filters","date"],setup(l,o){R(()=>{s(),g.value=re(8,20),n.value=Object.assign({},l.filters)});const n=x({}),e=Le(),w=I(),g=x(),i=x(!1),c=se(),v=x(!1),f=F(()=>e.allCourses),_=F(()=>c.showNewOrderDialog),s=async function(){const V={location_permalink:l.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(V).then(()=>{}).catch(p=>{A(w,p)})},S=function(){c.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,o.emit("onCloseDialog")},u=function(V){n.value.date=l.date,c.setNewOrderDialogVisibility(V)},k=function(){v.value=n.value.open_ticket};return W(l.filters,()=>{if(s(),n.value=Object.assign({},l.filters),l.filters.course&&!l.filters.course.id){let V=f.value.find(p=>p.name===l.filters.course.name);V&&(n.value.course=V)}}),{courses:f,form:n,hours:g,disableForm:v,visible:i,onCloseDialog:S,updateDialog:u,onChecked:k,dialogVisible:_,dialogStore:c}},components:{NewOrderDialog:an}},cn=t("h2",{class:"mt-1"},"Nuova prenotazione",-1),dn={class:"formgrid grid px-0 align-items-center mt-4"},un={key:0,class:"field flex flex-column w-full col-12"},mn=t("label",{for:"typology"},"Scegli il percorso",-1),_n={key:1,class:"field flex flex-column w-full col-12"},fn=t("label",{for:"typology"},"Seleziona l'orario",-1),pn={class:"flex justify-content-end align-items-center mt-2"},hn={class:"flex align-items-center justify-content-between w-full"},vn=t("h2",null,"Nuova prenotazione",-1);function yn(l,o,n,e,w,g){const i=h("Dropdown"),c=h("Button"),v=h("NewOrderDialog"),f=h("Dialog"),_=h("Card");return y(),X(_,{class:"mt-4"},{content:b(()=>[cn,t("div",dn,[n.filters.location_permalink?(y(),C("div",un,[mn,a(i,{modelValue:e.form.course,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.course=s),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):N("",!0),n.filters.location_permalink?(y(),C("div",_n,[fn,a(i,{modelValue:e.form.hour,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.hour=s),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):N("",!0)]),t("div",pn,[a(c,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:o[2]||(o[2]=s=>e.updateDialog(!0))},null,8,["disabled"])]),a(f,{visible:e.dialogVisible,"onUpdate:visible":o[5]||(o[5]=s=>e.dialogVisible=s),modal:"",header:"Nuova prenotazione",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:o[6]||(o[6]=s=>e.onCloseDialog())},{header:b(()=>[t("div",hn,[vn,a(c,{icon:"pi pi-times",text:"",rounded:"",onClick:o[3]||(o[3]=s=>e.updateDialog(!1))})])]),default:b(()=>[a(v,{form:e.form,onCloseDialog:o[4]||(o[4]=s=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const gn=j(rn,[["render",yn]]),kn={setup(){R(()=>{i.value&&(l.value.location_permalink=i.value.location.permalink,o.value.location_permalink=i.value.location.permalink,v())});const l=x({}),o=x({}),n=x(),e=Oe(),w=ne(),g=I(),i=F(()=>e.currentUser),c=F(()=>w.allLocations),v=async function(){await w.fetchAllLocations().then(()=>{}).catch(u=>{A(g,u)})};return{filters:l,orderTable:n,order_filters:o,user:i,locations:c,fetchAllLocations:v,formatDate:ie,onUpdateFilters:function(u){u.course&&(l.value.course={id:u.course}),u.name&&(l.value.name=u.name),u.hour&&(u.hour.start_at?l.value.hour=u.hour.start_at:l.value.hour=u.hour)},onUpdateNewOrderFilters:function(u){u.start_at&&(o.value.hour=u.start_at),u.course_name&&(o.value.course={name:u.course_name}),o.value.date=l.value.date},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){o.value.location_permalink=l.value.location_permalink}}},components:{CalendarFilter:Uo,OrderTable:Oo,OrderFilter:Go,NewOrderCard:gn}};const bn={class:"flex justify-content-between align-items-center"},xn={class:"field flex flex-column mt-3"},wn={key:0,style:{color:"#495057"}},Cn=t("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Dn={class:"capitalize text-xl"},Vn={class:"flex gap-4"},Tn={key:0,class:"col-3 mt-3"},On={class:"col-9 mt-3"};function Sn(l,o,n,e,w,g){const i=h("Dropdown"),c=h("CalendarFilter"),v=h("NewOrderCard"),f=h("OrderFilter"),_=h("OrderTable");return y(),C("div",null,[t("div",bn,[t("div",xn,[a(i,{modelValue:e.filters.location_permalink,"onUpdate:modelValue":o[0]||(o[0]=s=>e.filters.location_permalink=s),options:e.locations,optionLabel:"name",optionValue:"permalink",placeholder:"Filtra per location",class:"location",onChange:o[1]||(o[1]=s=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(y(),C("div",wn,[Cn,t("span",Dn,O(e.formatDate(e.filters.date)),1)])):N("",!0)]),t("div",Vn,[e.filters.location_permalink?(y(),C("div",Tn,[a(c,{filters:e.filters},null,8,["filters"]),a(v,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:o[2]||(o[2]=s=>e.onCloseDialog())},null,8,["date","filters"])])):N("",!0),t("div",On,[a(f,{filters:e.filters,onOnSubmit:o[3]||(o[3]=s=>e.onUpdateFilters(s))},null,8,["filters"]),e.filters.date?(y(),X(_,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:o[4]||(o[4]=s=>e.onUpdateNewOrderFilters(s))},null,8,["filters"])):N("",!0)])])])}const An=j(kn,[["render",Sn]]);export{An as default};
