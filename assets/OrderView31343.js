import{l as ve,m as me,o as J,p as x,a as K,c as M,_ as H,r as k,b as f,e as y,g as l,f as a,n as $,t as C,q as A,F as X,h as B,s as de,v as We,i as Y,x as Ke,w as S,y as fe,z as te,A as be,B as Ge,u as Qe}from"../index31343.js";import{u as G,a as oe,f as xe,b as pe,c as $e,d as Xe,e as ye,g as ue,h as we,i as Ye,D as ee,j as ge}from"./location31343.js";import{u as ne,s as Q,e as L,p as Ce,a as Ze,b as De,c as he,d as Se}from"./helpers31343.js";import{F as et}from"./vee-validate.esm31343.js";class ke{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/orders/search_codes`,t)).data}}const _e=me({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await ke.fetchAll(o).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(o){await ke.fetchAllOpenTickets(o).then(t=>this.open_tickets_codes=t)}}}),tt={props:["location_permalink","time_slot"],setup(o,t){J(()=>{n.value=Object.assign({},o.time_slot)});const n=x({}),e=_e(),p=G(),{showLoader:w,hideLoader:s}=ne(),d=K(),g=x(),u=M(()=>e.allOpenTickets),v=M(()=>p.paymentStatus),i=M(()=>p.paymentModeList),b=M(()=>{const r=p.getPaymentMethods;return Object.entries(r).map(([c,_])=>({id:c,label:_}))}),D=M(()=>p.getCurrentOrder),h=async function(r){const c={code:r.query.toUpperCase(),location_permalink:o.location_permalink};await e.fetchAllOpenTickets(c)},O=async function(){var c,_;const r={id:o.location_permalink,order_id:n.value.id,status:(c=n.value)==null?void 0:c.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(_=n.value)==null?void 0:_.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){g.value="Seleziona un metodo di pagamento";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let N=[];n.value.open_tickets_used.forEach(U=>{N.push(U.code)}),r.open_ticket_codes=N}I(r)},I=async function(r){w(),await p.updateOrder(r).then(()=>{s(),Q(d,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",D.value)}).catch(c=>{s(),L(d,c)})};return{form:n,open_tickets:u,paymentList:v,paymentModeList:i,changeStatus:O,errorMessage:g,dynamicPaymentMethods:b,fetchAllOpenTickets:h,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},ot={key:0,class:"formgrid grid flex-column mt-3"},nt={class:"field col-12"},lt=l("label",{for:"status"},"Stato pagamento",-1),st={class:"field col-12"},at=l("label",{for:"payment_method"},"Modalità pagamento",-1),it={class:"p-error",id:"dd-error"},rt={key:0,class:"field col-12 flex flex-column"},ct=l("label",{for:"user_zip"},"Codice biglietto",-1),dt={class:"flex align-items-center justify-content-end mt-3"};function ut(o,t,n,e,p,w){const s=k("Dropdown"),d=k("AutoComplete"),g=k("Button");return f(),y(X,null,[e.form?(f(),y("div",ot,[l("div",nt,[lt,a(s,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=u=>e.form.status=u),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=u=>e.onChangeStatus())},null,8,["modelValue","options"])]),l("div",st,[at,a(s,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=u=>e.form.payment_method=u),options:e.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:$(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status!="payed",onChange:t[3]||(t[3]=u=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),l("small",it,C(e.errorMessage||" "),1)]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(f(),y("div",rt,[ct,a(d,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[4]||(t[4]=u=>e.form.open_tickets_used=u),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[5]||(t[5]=u=>e.fetchAllOpenTickets(u)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):A("",!0)])):A("",!0),l("div",dt,[a(g,{label:"Annulla",text:"",onClick:t[6]||(t[6]=u=>o.$emit("closeDialog",null))}),a(g,{label:"Conferma",onClick:t[7]||(t[7]=u=>e.changeStatus())})])],64)}const mt=H(tt,[["render",ut]]),_t={props:["order"],setup(o){J(()=>{b.value&&i.value&&b.value.forEach(h=>{h.permalink===i.value&&(w.value=h.name)})});const t=x(0),n=x([]),e=x(!1),p=x(!0),w=x(),s=_e(),d=G();K();const g=oe(),u=M(()=>s.allTickets),v=M(()=>d.getCurrentOrder),i=M(()=>g.getCurrentLocation),b=M(()=>g.allLocations),D=M(()=>{const h=o.order.payment_method,O=d.getPaymentMethods;return h?O[h]:"-"});return{tickets:u,active:t,partialTotals:n,showOrderDetail:e,currentOrder:v,showSecondTab:p,currentLocation:i,selectedLocation:w,formatExplicitDate:xe,formatDate:pe,prettyPaymentStatus:Ce,formatPrettyDate:$e,formatDataAndHourFromUnixTimestamps:Xe,prettyPaymentMethod:Ze,methodLabel:D}},components:{}};const ft={class:"mt-3 line-height-3"},vt={class:"flex gap-3"},ht=l("i",{class:"pi pi-user mt-1"},null,-1),pt={class:"m-0 mb-1"},yt={class:"m-0 mb-1"},gt={class:"m-0 mb-1"},kt={class:"m-0 mb-1"},bt={key:0},xt={class:"flex gap-3 mt-4"},wt=l("i",{class:"pi pi-map-marker mt-1"},null,-1),Ct={class:"m-0 mb-1"},Dt={class:"m-0 mb-1"},St={key:0,class:"m-0 mb-1"},Ot={class:"flex gap-3 mt-4"},Tt=l("i",{class:"pi pi-shopping-cart mt-1"},null,-1),Vt={class:"m-0 mb-1"},At={class:"m-0 mb-1"},Mt={class:"m-0 mb-1"},Pt={key:0,class:"m-0 mb-1"},Ft={key:1,class:"m-0 mb-1"},Nt={key:2,class:"m-0 mb-1"},Lt={class:"m-0 mb-1"},Ut={class:"m-0 mb-1"},Bt={key:0},It={key:1},Et={key:0,class:"flex gap-3 mt-4"},Rt=l("i",{class:"pi pi-comment mt-1"},null,-1);function jt(o,t,n,e,p,w){const s=k("Badge");return f(),y("div",ft,[l("div",vt,[ht,l("div",null,[l("p",pt,C(n.order.user_name)+" "+C(n.order.user_surname||"-"),1),l("p",yt,C(n.order.user_email),1),l("p",gt,C(n.order.user_phone),1),l("p",kt,[B(C(n.order.country)+" ",1),n.order.user_zip?(f(),y("span",bt," - "+C(n.order.user_zip),1)):A("",!0)])])]),l("div",xt,[wt,l("div",null,[l("p",Ct,C(e.selectedLocation),1),l("p",Dt,C(n.order.course_name),1),n.order.date?(f(),y("p",St,C(e.formatPrettyDate(n.order.date))+" "+C(n.order.start_at),1)):A("",!0)])]),l("div",Ot,[Tt,l("div",null,[l("p",Vt,C(n.order.reservation_number),1),l("p",At,C(e.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),l("p",Mt,C(n.order.created_by),1),n.order.status?(f(),y("p",Pt,[a(s,{value:e.prettyPaymentStatus(n.order.status),class:$([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):A("",!0),n.order.status=="payed"?(f(),y("p",Ft,C(e.methodLabel),1)):A("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(f(),y("p",Nt,[(f(!0),y(X,null,de(n.order.open_tickets_used,d=>(f(),y("span",{key:d},[a(s,{value:d.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):A("",!0),l("p",Lt,"Codice sconto utilizzato: "+C(n.order.discount_code||"-"),1),l("p",Ut,[B(" Totale ordine: "),n.order.total?(f(),y("span",Bt,"€ "+C((+n.order.total).toFixed(2)),1)):(f(),y("span",It,"-"))])])]),n.order.notes?(f(),y("div",Et,[Rt,l("div",null,C(n.order.notes),1)])):A("",!0)])}const zt=H(_t,[["render",jt]]),qt={props:["order","location_permalink"],setup(o,t){J(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=x(),{showLoader:e,hideLoader:p}=ne(),w=K(),s=G(),d=M(()=>s.getCurrentOrder);return{notes:n,updateOrder:async function(){const u={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};e(),await s.updateOrder(u).then(()=>{p(),Q(w,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",d.value)}).catch(v=>{p(),L(w,v)})}}}},Ht={class:"pt-5 px-2"},Jt={class:"flex align-items-center justify-content-end mt-3"};function Wt(o,t,n,e,p,w){const s=k("Textarea"),d=k("Button");return f(),y("div",Ht,[a(s,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=g=>e.notes=g),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",Jt,[a(d,{label:"Annulla",text:"",onClick:t[1]||(t[1]=g=>o.$emit("closeDialog",null))}),a(d,{label:"Conferma",onClick:t[2]||(t[2]=g=>e.updateOrder())})])])}const Kt=H(qt,[["render",Wt]]),Gt={props:["filters"],setup(o,t){J(()=>{r.value=!0,c.value={first:0,rows:D.value.rows,sortField:null,sortOrder:null},c.value.page=0,o.filters.location&&j()});const n=G(),e=ye(),p=M(()=>n.responseOrders),w=M(()=>n.status),s=We(),d=M(()=>s.submitDialog),g=M(()=>n.paymentStatus),u=M(()=>n.getDeleteResponse),{showLoader:v,hideLoader:i}=ne(),b=K(),D=x(),h=x(),O=x(),I=x(),F=x(),r=x(!0),c=x(),_=x(0),N=x([]),U=x([]),Z=x(!1),le=x(!1),V=x(),R=x(!1);function j(){r.value=!0;let m=new Map;for(const T in o.filters)T=="date"?ue(o.filters.date)=="Invalid DateTime"?m.set("date",we(o.filters.date)):m.set("date",ue(o.filters.date)):o.filters.location&&m.set("location_permalink",o.filters.location.permalink),T=="course"&&o.filters.course.id!="-1"&&m.set("course",o.filters.course.id),T=="hour"&&o.filters.hour!="Tutti gli orari"&&m.set("hour",o.filters.hour),T=="name"&&m.set("name",o.filters.name);setTimeout(()=>{se(m)},Math.random()*1e3+250)}const se=async function(m){await n.fetchAllOrders(m).then(()=>{r.value=!1}).catch(T=>{r.value=!1,L(b,T)})},ae=m=>{O.value.toggle(m),V.value.toggle(m)},ie=(m,T)=>m>m+T?"red":"green",re=function(m,T){T&&(O.value.note=T,O.value.toggle(m))},q=function(m){m.order&&p.value.time_slots&&p.value.time_slots.forEach((T,P)=>{T.orders.forEach((E,z)=>{E.id==m.order.id&&(p.value.time_slots[P].orders[z]=m.order,m.check_in_done!=null&&(p.value.time_slots[P].check_in_done+=m.check_in_done))})})},Te=async function(m,T){let P=[],E=!1;U.value.forEach(W=>{if(W.id==m.id){E=!0;return}});for(let W of m.tickets)P.push(W.order_item_id);const z={check_in:T,order_item_ids:P,location_permalink:o.filters.location};await n.checkInOrder(z).then(()=>{q(u.value),Q(b,{message:"Check-in registrato correttamente",error:!1}),E&&ce(U.value,u.value.order)}).catch(W=>{L(b,W)})},Ve=async function(m,T){let P=[],E=!1;U.value.forEach(W=>{if(W.id==m.id){E=!0;return}});for(let W of m.tickets)P.push(W.order_item_id);const z={order_item_ids:P,no_show:T,location_permalink:o.filters.location.permalink};await n.noShowOrder(z).then(()=>{q(u.value),Q(b,{message:"No-show registrato correttamente",error:!1}),E&&ce(U.value,u.value.order)}).catch(W=>{L(b,W)})},Ae=async function(m,T,P){const E={id:m,check_in:T,location_permalink:o.filters.location.permalink};await n.checkInTicket(E).then(()=>{Q(b,{message:"Check-in registrato correttamente",error:!1}),q(u.value),ce(U.value,u.value.order)}).catch(z=>{L(b,z)})},Me=async function(m,T,P){const E={id:m,no_show:T,location_permalink:o.filters.location.permalink};await n.noShowTicket(E).then(()=>{Q(b,{message:"No-show registrato correttamente",error:!1}),q(u.value),ce(U.value,u.value.order)}).catch(z=>{L(b,z)})},ce=function(m,T){let P=Pe(U.value,u.value.order.id);P!=-1&&U.value.splice(P,1),U.value.push(u.value.order)},Pe=function(m,T){for(let P=0;P<m.length;P++)if(m[P].id===T)return P;return-1},Fe=function(m){const T={course_name:m.course_name,start_at:m.start_at,date:o.filters.date,hour:m.start_at,max_seats:m.is_free_slot?null:m.remaing_seats+""};t.emit("updateFilters",T)},Ne=function(m){Z.value=!0,I.value=m},Le=function(m){q({order:m}),Z.value=!1,R.value=!1},Ue=function(m){return m!=null&&m.created_by&&(m==null?void 0:m.created_by)=="WEB"?"WEB":"KALATA"},Be=function(m,T){let P=0;if(m&&m.tickets){m.tickets.forEach(z=>{T?z.no_show&&(P+=1):z.check_in&&(P+=1)});let E=m.tickets.length;if(P!=E&&P!=0)return P+"/"+E}},Ie=function(m,T){V.value.data=T,V.value.toggle(m)},Ee=function(m,T){F.value=T.id;let P="Sei sicuro di voler eliminare questa prenotazione?";P+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',s.setDialog("Elimina prenotazione","Elimina","Annulla",P),s.setBtnSubmit(!1),s.setDynamicDialogVisibility(!0)},Re=function(){if(v(),F.value){const m={id:F.value,location_permalink:o.filters.location.permalink};n.deleteOrder(m).then(()=>{i(),Q(b,{message:"La prenotazione è stata eliminata correttamente",error:!1}),p.value.time_slots&&p.value.time_slots.forEach((T,P)=>{T.orders.forEach((E,z)=>{E.id==F.value&&(p.value.time_slots[P].orders.splice(z,1),u.value,p.value.time_slots[P].check_in_done+=u.value.check_in_done,p.value.time_slots[P].confirmed_seats+=u.value.confirmed_seats,p.value.time_slots[P].remaing_seats-=u.value.confirmed_seats)})})}).catch(T=>{i(),L(b,T)})}},je=function(m){N.value=m.data?[m.data]:[]},ze=function(m){U.value=m.data?[m.data]:[]},qe=function(m){le.value=!0,h.value=m},He=function(m){R.value=!0,h.value=m},Je=function(m){const T=new Map;T.set("id",m.id),T.set("location_permalink",o.filters.location.permalink),v(),n.downloadTicket(T).then(()=>{i()}).catch(P=>{i(),L(b,P)})};return Y(d,m=>{m&&Re()}),Y(o.filters,()=>{o.filters.location&&j()}),{dt:D,responseOrders:p,loading:r,totalRecords:_,lazyParams:c,currentOrder:h,status:w,expandedRows:N,expandedRows1:U,op:O,dialogStore:e,paymentList:g,visibleDialog:Z,currentTimeSlot:I,visibleMenu:V,visibleDetailDialog:le,visibleNotesDialog:R,toast:b,loadLazyData:j,toggle:ae,getProgressClass:ie,showNotes:re,checkAll:Te,noShowAll:Ve,openDialog:Fe,checkInSingleTicket:Ae,noShowSingleTicket:Me,prettyPaymentStatus:Ce,openPaymentStatusDialog:Ne,onClosePaymentStatusDialog:Le,getRowClass:Ue,printPDF:De,showLabelCheckbox:Be,confirmDeleteOrder:Ee,showMenu:Ie,openOrderDetailDialog:qe,openNotesDialog:He,downloadPDF:Je,handleRowToggle:je,handleRowToggle1:ze,formatDataFromUnixTimestamps:Ye,printOrderPDF:he}},components:{PaymentStatusDialog:mt,OrderDetailDialog:zt,NotesDialog:Kt}};const Qt={class:"order-table"},$t={class:""},Xt={style:{width:"15rem"}},Yt={class:"m-0 text-right",style:{"font-size":"12px"}},Zt={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},eo={style:{width:"15rem"}},to={class:"m-0 text-right",style:{"font-size":"12px"}},oo={key:0},no={key:0},lo=l("div",{class:"flex justify-content-center w-full"},"Check-in",-1),so={class:"flex justify-content-center"},ao={class:"flex flex-column",style:{"margin-top":"8px"}},io={class:"text-sm",style:{"min-height":"15px"}},ro=l("div",{class:"flex justify-content-center w-full"},"No-show",-1),co={class:"flex justify-content-center"},uo={class:"flex flex-column",style:{"margin-top":"8px"}},mo={class:"text-sm",style:{"min-height":"15px"}},_o=["onClick"],fo={style:{"max-width":"50rem"},class:"p-3"},vo={class:"overlay-menu"},ho=["onClick"],po=l("i",{class:"pi pi-eye mr-3"},null,-1),yo=["onClick"],go=l("i",{class:"pi pi-print mr-3"},null,-1),ko=["onClick"],bo=l("i",{class:"pi pi-download mr-3"},null,-1),xo=["onClick"],wo=l("i",{class:"pi pi-comment mr-3"},null,-1),Co=["disabled","onClick"],Do=l("i",{class:"pi pi-pencil mr-3"},null,-1),So=["disabled","onClick"],Oo=l("i",{class:"pi pi-trash mr-3"},null,-1),To={key:0},Vo={key:1},Ao=l("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Mo={class:"flex justify-content-center"},Po=l("div",{class:"flex justify-content-center w-full"},"No-show",-1),Fo={class:"flex justify-content-center"},No=l("div",{class:"flex justify-content-center w-full"},null,-1),Lo={class:"flex justify-content-center"},Uo={key:0,class:"flex mx-4"},Bo=l("div",null,[l("div",{class:"p-0 m-0 flex align-items-center"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),l("span",{class:"text-sm"},"WEB")]),l("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),l("span",{class:"text-sm"},"KALATA")])],-1),Io=[Bo];function Eo(o,t,n,e,p,w){const s=k("Column"),d=k("ProgressBar"),g=k("Button"),u=k("Badge"),v=k("Checkbox"),i=k("OverlayPanel"),b=k("DataTable"),D=k("PaymentStatusDialog"),h=k("Dialog"),O=k("OrderDetailDialog"),I=k("NotesDialog"),F=Ke("tooltip");return f(),y("div",Qt,[a(b,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=r=>e.expandedRows=r),onRowExpand:e.handleRowToggle},{empty:S(()=>[B(" Nessuna prenotazione trovata. ")]),expansion:S(r=>[a(b,{value:r.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=c=>e.expandedRows1=c),rowClass:e.getRowClass,onRowExpand:e.handleRowToggle1},{empty:S(()=>[B(" Nessuna prenotazione trovata. ")]),expansion:S(c=>[a(b,{value:c.data.tickets,class:"m-4 mx-5"},{default:S(()=>[a(s,{header:"Codice biglietto",field:"code"}),a(s,{header:"Tipo biglietto",field:"type"},{body:S(({data:_})=>[a(u,{value:_.ticket_name,class:$([_.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(s,{header:"Prezzo"},{body:S(({data:_})=>[_.ticket_price?(f(),y("span",To," € "+C((+_.ticket_price).toFixed(2)),1)):(f(),y("span",Vo,"-"))]),_:1}),a(s,null,{header:S(()=>[Ao]),body:S(({data:_})=>[l("div",Mo,[a(v,{modelValue:_.check_in,"onUpdate:modelValue":N=>_.check_in=N,binary:!0,onChange:N=>e.checkInSingleTicket(_.id,_.check_in,c.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(s,null,{header:S(()=>[Po]),body:S(({data:_})=>[l("div",Fo,[a(v,{modelValue:_.no_show,"onUpdate:modelValue":N=>_.no_show=N,binary:!0,onChange:N=>e.noShowSingleTicket(_.id,_.no_show,c.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(s,{field:"tickets_url"},{header:S(()=>[No]),body:S(({data:_})=>[l("div",Lo,[fe(a(g,{link:"",icon:"pi pi-print",href:_.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:N=>e.printPDF(_.id,n.filters.location.permalink,e.toast)},null,8,["href","onClick"]),[[F,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:S(()=>[a(s,{header:"Codice",field:"reservation_number"}),a(s,{header:"Acquirente"},{body:S(({data:c})=>[B(C(c.user_name)+" "+C(c.user_surname)+" ",1),!c.user_name&&!c.user_surname?(f(),y("span",oo,"-")):A("",!0)]),_:1}),a(s,{header:"Pagamento"},{body:S(({data:c})=>[c.status?(f(),y("span",no,[a(u,{value:e.prettyPaymentStatus(c.status),class:$([c.status,"px-3 border-round-lg"])},null,8,["value","class"])])):A("",!0)]),_:1}),a(s,{header:"Q.ta",field:"tickets_number"}),a(s,null,{header:S(()=>[lo]),body:S(({data:c})=>[l("div",so,[l("div",ao,[a(v,{modelValue:c.check_in,"onUpdate:modelValue":_=>c.check_in=_,binary:!0,onChange:_=>e.checkAll(c,c.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",io,C(e.showLabelCheckbox(c,!1)),1)])])]),_:1}),a(s,null,{header:S(()=>[ro]),body:S(({data:c})=>[l("div",co,[l("div",uo,[a(v,{modelValue:c.no_show,"onUpdate:modelValue":_=>c.no_show=_,binary:!0,onChange:_=>e.noShowAll(c,c.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",mo,C(e.showLabelCheckbox(c,!0)),1)])])]),_:1}),a(s,{header:"Note"},{body:S(({data:c})=>[l("div",{class:"notes cursor-pointer",onClick:_=>e.showNotes(_,c.notes)},C(c.notes||"-"),9,_o),a(i,{ref:"op"},{default:S(()=>[l("div",fo,C(e.op.note),1)]),_:1},512)]),_:1}),a(s,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:S(({data:c})=>[a(g,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:_=>e.showMenu(_,c)},null,8,["onClick"]),a(i,{ref:"visibleMenu"},{default:S(()=>[l("ul",vo,[l("li",{onClick:_=>e.openOrderDetailDialog(e.visibleMenu.data)},[po,B("Dettaglio ordine ")],8,ho),l("li",{onClick:_=>e.printOrderPDF(e.visibleMenu.data,n.filters.location.permalink,e.toast)},[go,B("Stampa ")],8,yo),l("li",{onClick:_=>e.downloadPDF(e.visibleMenu.data)},[bo,B("Scarica PDF ")],8,ko),l("li",{onClick:_=>e.openNotesDialog(e.visibleMenu.data)},[wo,B("Modifica nota ")],8,xo),l("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:_=>e.openPaymentStatusDialog(e.visibleMenu.data)},[Do,B("Cambia stato ")],8,Co),l("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:_=>e.confirmDeleteOrder(_,e.visibleMenu.data)},[Oo,B("Elimina ")],8,So)])]),_:2},1536)]),_:1}),a(s,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),r.data.orders&&r.data.orders.length>0?(f(),y("div",Uo,Io)):A("",!0)]),default:S(()=>[a(s,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(s,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:S(({data:r})=>[l("div",$t,[l("span",{class:$(r.is_free_slot?"free":"")},C(r.start_at),3)])]),_:1},512),a(s,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:S(({data:r})=>[l("div",Xt,[l("p",Yt,[B(C(r.confirmed_seats)+"/"+C(r.remaing_seats+r.confirmed_seats)+" ",1),r.confirmed_seats>r.remaing_seats+r.confirmed_seats?fe((f(),y("i",Zt,null,512)),[[F,r.confirmed_seats-(r.remaing_seats+r.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):A("",!0)]),a(d,{value:r.confirmed_seats*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:$(["available-progress",e.getProgressClass(r.confirmed_seats,r.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(s,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:S(({data:r})=>[l("div",eo,[l("p",to,C(r.check_in_done)+"/"+C(r.confirmed_seats),1),a(d,{value:r.check_in_done*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(s,null,{body:S(({data:r})=>[fe(a(g,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:c=>e.openDialog(r)},null,8,["onClick"]),[[F,"Prenota",void 0,{top:!0}]])]),_:1}),a(s,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),a(h,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=r=>e.visibleDialog=r),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:S(()=>[a(D,{location_permalink:n.filters.location.permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=r=>e.onClosePaymentStatusDialog(r))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),a(h,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=r=>e.visibleDetailDialog=r),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:S(()=>[a(O,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),a(h,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=r=>e.visibleNotesDialog=r),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:S(()=>[a(I,{order:e.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:t[5]||(t[5]=r=>e.onClosePaymentStatusDialog(r))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const Ro=H(Gt,[["render",Eo]]),jo={props:["filters"],setup(o,t){J(()=>{b(),n.value=o.filters,n.value.date=new Date,O()});const n=x({}),e=oe(),p=G(),w=K(),s=x([]),d=x(),g=ee.now().plus({years:1}),u=M(()=>e.allLocations),v=M(()=>p.getCalendar),i=async function(r){await p.fetchCalendar(r).then(()=>{}).catch(c=>{L(w,c)})},b=async function(){await e.fetchAllLocations().then(()=>{}).catch(r=>{L(w,r)})},D=function(){if(o.filters.location){const r=u.value.find(c=>c.permalink===o.filters.location);s.value=r.courses}},h=function(r){let c={};c.month=ee.fromJSDate(new Date(r)).month,c.year=ee.fromJSDate(new Date(r)).year,c.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,d.value={month:c.month,year:c.year},i(c)},O=function(){let r=ee.now(),c={location_permalink:"",month:"",year:""};c.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,c.month=r.month+"",c.year=r.year+"",i(c)},I=function(r){if(v.value.web_dates&&v.value.web_dates.length!=0){let c=r.month+1;c=c<10?"0"+c:c;let _=r.day<10?"0"+r.day:r.day,N=r.year+"-"+c+"-"+_;return v.value.web_dates.find(U=>U==N)}},F=function(r){let c={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:r.month,year:r.year};i(c)};return Y(o.filters,()=>{if(d.value){let r={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:d.value.month,year:d.value.year};i(r)}else O()}),{form:n,courses:s,maxAllowedDate:g,locations:u,calendar:v,getCourses:D,onDateChange:h,getDayFromDate:I,onMonthChange:F}}};const zo={class:"flex calendar-filter"},qo={key:0,class:"special-day"};function Ho(o,t,n,e,p,w){const s=k("Calendar");return f(),y("div",zo,[a(s,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.date=d),inline:"",onDateSelect:t[1]||(t[1]=d=>e.onDateChange(d)),onMonthChange:t[2]||(t[2]=d=>e.onMonthChange(d)),maxDate:e.maxAllowedDate.toJSDate()},{date:S(d=>[e.getDayFromDate(d.date)?(f(),y("div",qo,[l("span",null,C(d.date.day),1)])):(f(),y(X,{key:1},[B(C(d.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const Jo=H(jo,[["render",Ho]]);class Wo{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/search/courses`,t)).data}}const Oe=me({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await Wo.fetchAll(o).then(t=>this.response_courses=t)}}}),Ko={props:["filters"],setup(o,t){J(()=>{n.value=Object.assign({},o.filters),n.value.date=ee.now().toFormat("dd/MM/yyyy"),s.value=Se(8,20),s.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=x({}),e=x([]),p=oe(),w=K(),s=x([]),d=G(),g=Oe(),u=M(()=>p.allLocations),v=M(()=>d.responseOrders),i=M(()=>g.allCourses),b=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=s.value[0],t.emit("onSubmit",n.value)},D=async function(){const h={location_permalink:n.value.location.permalink,api_version:"v2"};await g.fetchAllCourses(h).then(()=>{}).catch(O=>{L(w,O)})};return Y(u,()=>{o.filters.location&&u.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),D())}),Y(o.filters,()=>{o.filters.location&&u.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),Y(i,()=>{var h;e.value=Object.assign([],i.value),e.value&&((h=e.value[0])==null?void 0:h.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}),{form:n,courses:e,hours:s,locations:u,responseOrders:v,resetField:b}}},Go={class:"formgrid grid px-0 align-items-center"},Qo={key:0,class:"field col-4 flex flex-column"},$o=l("label",{for:"typology"},"Filtra per percorso",-1),Xo={key:1,class:"field col-3 flex flex-column"},Yo=l("label",{for:"typology"},"Filtra per orario (dalle)",-1),Zo=l("div",{class:"col-12"},null,-1),en={class:"field col-4 flex flex-column"},tn=l("label",{for:"typology"},"Filtra per acquirente",-1),on={class:"flex col-12 justify-content-end pt-1"};function nn(o,t,n,e,p,w){const s=k("Dropdown"),d=k("InputText"),g=k("Button"),u=k("AccordionTab"),v=k("Accordion");return f(),te(v,{activeIndex:0},{default:S(()=>[a(u,{header:"FILTRI"},{default:S(()=>[l("div",Go,[e.form.location&&e.courses?(f(),y("div",Qo,[$o,a(s,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.course=i),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):A("",!0),e.responseOrders?(f(),y("div",Xo,[Yo,a(s,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.hour=i),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):A("",!0),Zo,l("div",en,[tn,a(d,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.name=i),placeholder:""},null,8,["modelValue"])])]),l("div",on,[a(g,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=i=>o.$emit("onSubmit",e.form))}),a(g,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=i=>e.resetField())})])]),_:1})]),_:1})}const ln=H(Ko,[["render",nn]]),sn={props:["form","price","index","ticket"],setup(o,t){const n=x(0),e=function(){n.value++,w()},p=function(){n.value>0&&n.value--,w()},w=function(){n.value==null&&(n.value=0);const s={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};t.emit("changeCounter",s)};return{counter:n,decrement:p,increment:e,emitEvent:w}}};const an={class:"btn-plus-min flex align-items-center"},rn={class:"counter"};function cn(o,t,n,e,p,w){const s=k("Button"),d=k("InputNumber");return f(),y("div",an,[a(s,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),l("div",rn,[a(d,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=g=>e.counter=g),t[1]||(t[1]=g=>e.emitEvent())],min:0},null,8,["modelValue"])]),a(s,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const dn=H(sn,[["render",cn]]),un={props:["tickets","form"],setup(o,t){J(()=>{p.value=!1,s.discount={},w.value=null,o.form.max_seats&&o.form.max_seats<0?(u.value=!0,v.value=-o.form.max_seats):u.value=!1});const n=x(0),e=x([]),p=x(!1),w=x(),s=G(),d=K(),g=x(!1),u=x(!1),v=x(),i=M(()=>s.getDiscount),b=function(F){e.value[F.index]={partial_total:F.price*F.counter,ticket:F.ticket,quantity:F.counter},n.value=0;let r=0;e.value.forEach(c=>{n.value+=c.partial_total,r+=c.quantity}),u.value||(o.form.max_seats&&r>+o.form.max_seats?(v.value=r-+o.form.max_seats,g.value=!0):(v.value=null,g.value=!1)),w.value&&h()},D=function(){h()},h=async function(){let F=[];e.value.forEach(c=>{F.push({id:c.ticket.id,quantity:c.quantity})});const r={discount_code:w.value,location_permalink:o.form.location_permalink,tickets:F};await s.cost(r).then(()=>{}).catch(c=>{L(d,c)})};return{total:n,partialTotals:e,showDiscount:p,discountCode:w,discount:i,showAlert:g,showAlert2:u,numOverbooking:v,onChangeCounter:b,applyDiscount:D,checkDisabled:function(){let F=!1;(!e.value||e.value.length==0)&&(F=!0);let r=0;return e.value.forEach(c=>{r+=c.quantity}),r==0&&(F=!0),t.emit("disableSecondoTab",!0),F},nextTab:function(){const F={discount_code:w.value,partial_total:e.value};t.emit("nextTab",F)}}},components:{PlusMinusButton:dn}};const mn={key:0},_n={key:1},fn={key:0},vn={key:1},hn={key:0,class:"flex justify-content-between align-items-center"},pn={class:"flex align-items-center col-9"},yn={class:"col-7 pl-0"},gn={class:"text-right col-2"},kn={class:"col-3 flex justify-content-end"},bn={key:2,class:"mt-3 mb-5"},xn=l("i",null,"Nessuna tipologia di biglietto trovata.",-1),wn=[xn],Cn=l("hr",{class:"mt-3"},null,-1),Dn={class:"flex align-items-center justify-content-between py-0"},Sn={class:"col-9 flex"},On=l("b",null,"Totale",-1),Tn=[On],Vn={class:"col-2 text-right font-bold"},An={class:"col-3 flex justify-content-end"};function Mn(o,t,n,e,p,w){const s=k("Message"),d=k("PlusMinusButton"),g=k("Button");return f(),y(X,null,[e.showAlert?(f(),te(s,{key:0,severity:"warn",closable:!1},{default:S(()=>[B("Attenzione! Si sta andando in overbooking di "+C(e.numOverbooking)+" ",1),e.numOverbooking==1?(f(),y("span",mn,"posto")):(f(),y("span",_n,"posti"))]),_:1})):A("",!0),e.showAlert2?(f(),te(s,{key:1,severity:"warn",closable:!1},{default:S(()=>[B("Attenzione! Lo slot orario è già in overbooking di "+C(e.numOverbooking)+" ",1),e.numOverbooking==1?(f(),y("span",fn,"posto")):(f(),y("span",vn,"posti"))]),_:1})):A("",!0),(f(!0),y(X,null,de(n.tickets,(u,v)=>{var i,b,D;return f(),y("div",{key:u.id},[((i=u.course)==null?void 0:i.id)==((b=n.form.course)==null?void 0:b.id)?(f(),y("div",hn,[l("div",pn,[l("b",yn,C(u.name),1),l("div",gn,"€ "+C((D=u.price)==null?void 0:D.toFixed(2)),1)]),l("div",kn,[a(d,{onChangeCounter:t[0]||(t[0]=h=>e.onChangeCounter(h)),price:u.price,index:v,ticket:u},null,8,["price","index","ticket"])])])):A("",!0)])}),128)),n.tickets&&n.tickets.length==0?(f(),y("div",bn,wn)):A("",!0),Cn,l("div",Dn,[l("div",Sn,[l("div",{class:$(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-7"])},Tn,2),l("div",Vn,"€ "+C(e.total.toFixed(2)),1)]),l("div",An,[a(g,{label:"Prosegui",onClick:t[1]||(t[1]=u=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Pn=H(un,[["render",Mn]]);class Fn{static async fetchAll(){return(await be("/countries")).data.countries}}const Nn=me({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Fn.fetchAll().then(o=>this.countries=o)}}});class Ln{static async fetchAll(){return(await be("/provinces")).data.provinces}}const Un=me({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await Ln.fetchAll().then(o=>this.provinces=o)}}}),Bn={props:["location_permalink"],setup(o,t){J(()=>{h(),O()});const n=_e(),e=Nn(),p=G(),w=Un(),s=x({}),d=x(),g=M(()=>e.allCountries),u=M(()=>n.allOpenTickets),v=M(()=>p.paymentStatus),i=M(()=>p.paymentModeList),b=M(()=>w.allProvinces),D=M(()=>{const c=p.getPaymentMethods;return Object.entries(c).map(([_,N])=>({id:_,label:N}))}),h=async function(){await e.fetchAllCountries().then(()=>{s.value.country_id=88,s.value.status={id:"payed",name:"Pagato"}})},O=async function(){await w.fetchAllProvinces()};return{form:s,countries:g,paymentList:v,paymentModeList:i,errorMessage:d,open_tickets:u,provinces:b,dynamicPaymentMethods:D,fetchAllOpenTickets:async function(c){const _={code:c.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(_)},onChangeStatus:function(){s.value.status.id&&(s.value.status.id=="free"||s.value.status.id=="to_pay")&&(s.value.payment_method=null)},onConfirm:function(){if(s.value.status&&s.value.status.id=="payed"&&!s.value.payment_method){d.value="Seleziona un metodo di pagamento";return}t.emit("nextTab",s.value)}}}},In={key:0,class:"formgrid grid"},En={class:"field col-6"},Rn=l("label",{for:"user_name"},"Nome",-1),jn={class:"field col-6"},zn=l("label",{for:"user_surname"},"Cognome",-1),qn={class:"field col-6"},Hn=l("label",{for:"user_email"},"Email",-1),Jn={class:"field col-6"},Wn=l("label",{for:"user_phone"},"Telefono",-1),Kn={class:"field col-6"},Gn=l("label",{for:"country_id"},"Nazione",-1),Qn={class:"field col-6"},$n=l("label",{for:"province"},"Provincia",-1),Xn={class:"field col-6"},Yn=l("label",{for:"status"},"Stato pagamento",-1),Zn={class:"field col-6"},el={for:"payment_method"},tl={key:0},ol={class:"p-float-label"},nl={class:"p-error",id:"dd-error"},ll={key:0,class:"field col-6 flex flex-column"},sl=l("label",{for:"user_zip"},"Codice biglietto",-1),al={class:"field col-12"},il={class:"field flex flex-column"},rl=l("label",{for:"notes"},"Note",-1),cl={class:"col-12 flex justify-content-end"};function dl(o,t,n,e,p,w){const s=k("InputText"),d=k("Dropdown"),g=k("AutoComplete"),u=k("Textarea"),v=k("Button");return e.form?(f(),y("div",In,[l("div",En,[Rn,a(s,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.user_name=i),class:"w-full"},null,8,["modelValue"])]),l("div",jn,[zn,a(s,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.user_surname=i),class:"w-full"},null,8,["modelValue"])]),l("div",qn,[Hn,a(s,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.user_email=i),class:"w-full"},null,8,["modelValue"])]),l("div",Jn,[Wn,a(s,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=i=>e.form.user_phone=i),class:"w-full"},null,8,["modelValue"])]),l("div",Kn,[Gn,a(d,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=i=>e.form.country_id=i),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),l("div",Qn,[$n,a(d,{modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=i=>e.form.user_zip=i),options:e.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),l("div",Xn,[Yn,a(d,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=i=>e.form.status=i),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=i=>e.onChangeStatus())},null,8,["modelValue","options"])]),l("div",Zn,[l("label",el,[B("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(f(),y("span",tl,"*")):A("",!0)]),l("span",ol,[a(d,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=i=>e.form.payment_method=i),options:e.dynamicPaymentMethods,optionLabel:"label",class:$(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=i=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),l("small",nl,C(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.id=="voucher"?(f(),y("div",ll,[sl,a(g,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=i=>e.form.open_ticket_codes=i),suggestions:e.open_tickets,class:"uppercase w-full",onComplete:t[11]||(t[11]=i=>e.fetchAllOpenTickets(i)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:""},null,8,["modelValue","suggestions"])])):A("",!0),l("div",al,[l("div",il,[rl,a(u,{modelValue:e.form.notes,"onUpdate:modelValue":t[12]||(t[12]=i=>e.form.notes=i),rows:"5",cols:"30"},null,8,["modelValue"])])]),l("div",cl,[a(v,{label:"Conferma",onClick:t[13]||(t[13]=i=>e.onConfirm())})])])):A("",!0)}const ul=H(Bn,[["render",dl]]);var ml=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,_l={root:function(t){var n=t.instance;return["p-contextmenu p-component",{"p-input-filled":n.$primevue.config.inputStyle==="filled","p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var n=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(e),"p-focus":n.isItemFocused(e),"p-disabled":n.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var n=t.props,e=t.isActive,p=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":n.exact&&p}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Ge.extend({name:"contextmenu",css:ml,classes:_l});const fl={props:["form"],setup(o,t){J(()=>{O()});const n=x(0),e=x([]),p=x(!1),w=x(!0),s=x(),d=x([]),{showLoader:g,hideLoader:u}=ne(),v=_e(),i=G(),b=K(),D=M(()=>v.allTickets),h=M(()=>i.getCurrentOrder),O=async function(){const V={location_permalink:o.form.location_permalink,api_version:"v2",date:F(o.form.date),course_id:o.form.course.id};await v.fetchAllTickets(V).then(()=>{}).catch(R=>{L(b,R)})},I=function(V){n.value+=1,s.value=V.discount_code,e.value=Object.assign([],V.partial_total),w.value=!1},F=function(V){return ue(V).includes("Invalid")?we(V):ue(V)},r=function(V){c(V)},c=async function(V){var ae,ie,re;const R=[{start_at:o.form.hour,tickets:[]}];e.value.forEach(q=>{q.quantity!=0&&R[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let j=[];V.open_ticket_codes&&V.open_ticket_codes.forEach(q=>{j.push(q.code)});const se={location_permalink:o.form.location_permalink,country_id:V.country_id,status:V.status.id,user_email:V.user_email,user_name:V.user_name,user_phone:V.user_phone,user_surname:V.user_surname,user_zip:V.user_zip,api_version:"v2",date:o.form.date?F(o.form.date):"",notes:V.notes,time_slots:R,payment_method:(ae=V.payment_method)==null?void 0:ae.id,course_id:(re=(ie=o.form)==null?void 0:ie.course)==null?void 0:re.id,open_ticket_codes:j};s.value&&(se.discount_code=s.value),await i.createOrder(se).then(()=>{n.value+=1,w.value=!0,p.value=!0}).catch(q=>{L(b,q)})},_=function(){he(h==null?void 0:h.value,o.form.location_permalink,b),t.emit("closeDialog",!0)},N=function(V){w.value=V},U=function(){he(h==null?void 0:h.value,o.form.location_permalink,b),Z()},Z=async function(){let V=[];if(!h.value&&!o.form.location_permalink)return;for(let j of h.value.tickets)V.push(j.order_item_id);const R={check_in:!0,order_item_ids:V,location_permalink:o.form.location_permalink};await i.checkInOrder(R).then(()=>{Q(b,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(j=>{L(b,j)})},le=function(){g();const V={location_permalink:o.form.location_permalink,order_id:h.value.id};i.sendEmail(V).then(()=>{Q(b,{message:"Email inviata correttamente al cliente",error:!1}),u(),t.emit("closeDialog",!0)}).catch(R=>{u(),L(b,R)})};return Y(h,()=>{d.value=[],h.value.tickets.forEach(V=>{const R=d.value.find(j=>j.ticket_name===V.ticket_name);if(!R)V.quantity=1,d.value.push(V);else{let j=d.value.indexOf(R);d.value[j].quantity+=1}})}),{tickets:D,active:n,partialTotals:e,showOrderDetail:p,currentOrder:h,tmp_tickets:d,showSecondTab:w,formatExplicitDate:xe,formatDate:pe,onNextTab:I,onConfirmPayment:r,printPDF:De,onPrintPDF:_,onDisableSecondoTab:N,printAndCheckIn:U,sendEmail:le}},components:{NewOrderTicketTab:Pn,NewOrderFormTab:ul}};const vl={key:0,class:"info-box"},hl={class:"font-medium"},pl=l("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),yl={class:"font-medium"},gl=l("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),kl={key:0,class:"capitalize"},bl={key:0,class:"flex pb-4"},xl=l("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),wl={class:"flex flex-column"},Cl={key:0,class:"pb-1 pr-1"},Dl={key:1,class:"pb-1"},Sl={class:"py-5"},Ol={class:"m-0 text-center line-height-3"},Tl=l("br",null,null,-1),Vl={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Al=l("p",{class:"my-2"},[l("b",null,"Riepilogo ordine:")],-1),Ml={class:"flex flex-column col-12"},Pl={key:0,class:"pb-1",style:{"min-width":"8rem"}},Fl={key:1,class:"pb-1"},Nl={key:2},Ll={class:"flex flex-column col-12"},Ul={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Bl=l("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),Il={class:"pb-1"},El={class:"flex align-items-center justify-content-center mt-4"};function Rl(o,t,n,e,p,w){var i,b;const s=k("NewOrderTicketTab"),d=k("TabPanel"),g=k("NewOrderFormTab"),u=k("Button"),v=k("TabView");return f(),y(X,null,[n.form?(f(),y("div",vl,[l("p",hl,[pl,B(C((i=n.form.course)==null?void 0:i.name),1)]),l("p",yl,[gl,n.form.date?(f(),y("span",kl,C(e.formatDate((b=n.form)==null?void 0:b.date)),1)):A("",!0),B(" - "+C(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(f(),y("div",bl,[xl,l("div",wl,[(f(!0),y(X,null,de(e.partialTotals,D=>{var h;return f(),y("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:D},[D&&D.quantity!=0?(f(),y("span",Cl,C((h=D.ticket)==null?void 0:h.name),1)):A("",!0),D&&D.quantity!=0?(f(),y("span",Dl," x "+C(D.quantity)+" "+C(D.price),1)):A("",!0)])}),128))])])):A("",!0)])):A("",!0),a(v,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=D=>e.active=D)},{default:S(()=>[a(d,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:S(()=>[a(s,{tickets:e.tickets,form:n.form,onNextTab:t[0]||(t[0]=D=>e.onNextTab(D)),onDisableSecondoTab:t[1]||(t[1]=D=>e.onDisableSecondoTab(D))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(d,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:S(()=>[a(g,{onNextTab:t[2]||(t[2]=D=>e.onConfirmPayment(D)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(f(),te(d,{key:0,header:"Ordine completato"},{default:S(()=>{var D,h;return[l("div",Sl,[l("div",Ol,[B(" Ordine "),l("b",null,C(e.currentOrder.reservation_number),1),B(" registrato correttamente!"),Tl]),e.currentOrder?(f(),y("div",Vl,[Al,l("div",Ml,[(f(!0),y(X,null,de(e.tmp_tickets,O=>(f(),y("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:O},[O&&O.quantity!=0?(f(),y("span",Pl,C(O.ticket_name),1)):A("",!0),O&&O.quantity!=0?(f(),y("span",Fl," x "+C(O.quantity),1)):A("",!0),O.ticket_price?(f(),y("span",Nl," € "+C((+O.ticket_price).toFixed(2)),1)):A("",!0)]))),128))]),l("div",Ll,[e.currentOrder.total?(f(),y("p",Ul,[Bl,l("span",Il,[l("b",null,"€ "+C((+((D=e.currentOrder)==null?void 0:D.total)).toFixed(2)),1)])])):A("",!0)])])):A("",!0),l("div",El,[a(u,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[3]||(t[3]=O=>e.sendEmail()),disable:!((h=e.currentOrder)!=null&&h.user_email)},null,8,["disable"]),a(u,{icon:"pi pi-print",onClick:t[4]||(t[4]=O=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),a(u,{icon:"pi print-check-icon",onClick:t[5]||(t[5]=O=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):A("",!0)]),_:1},8,["activeIndex"])],64)}const jl=H(fl,[["render",Rl]]),zl={props:["filters","date"],setup(o,t){J(()=>{w.value=Se(8,20),n.value=Object.assign({},o.filters)});const n=x({}),e=Oe(),p=K(),w=x(),s=x(!1),d=ye(),g=x(!1),u=M(()=>e.allCourses),v=M(()=>d.showNewOrderDialog),i=async function(){const O={location_permalink:o.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(O).catch(I=>{L(p,I)})},b=function(){d.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,t.emit("onCloseDialog")},D=function(O){n.value.date=o.date,d.setNewOrderDialogVisibility(O)},h=function(){g.value=n.value.open_ticket};return Y(o.filters,()=>{if(i(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let O=u.value.find(I=>I.name===o.filters.course.name);O&&(n.value.course=O)}}),{courses:u,form:n,hours:w,disableForm:g,visible:s,onCloseDialog:b,updateDialog:D,onChecked:h,dialogVisible:v,dialogStore:d}},components:{NewOrderDialog:jl}},ql=l("h2",{class:"mt-1"},"Nuova prenotazione",-1),Hl={class:"formgrid grid px-0 align-items-center mt-4"},Jl={key:0,class:"field flex flex-column w-full col-12"},Wl=l("label",{for:"typology"},"Scegli il percorso",-1),Kl={key:1,class:"field flex flex-column w-full col-12"},Gl=l("label",{for:"typology"},"Seleziona l'orario",-1),Ql={class:"flex justify-content-end align-items-center mt-2"},$l={class:"flex align-items-center justify-content-between w-full"},Xl=l("h2",null,"Nuova prenotazione",-1);function Yl(o,t,n,e,p,w){const s=k("Dropdown"),d=k("Button"),g=k("NewOrderDialog"),u=k("Dialog"),v=k("Card");return f(),te(v,{class:"mt-4"},{content:S(()=>[ql,l("div",Hl,[n.filters.location_permalink?(f(),y("div",Jl,[Wl,a(s,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.course=i),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):A("",!0),n.filters.location_permalink?(f(),y("div",Kl,[Gl,a(s,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.hour=i),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):A("",!0)]),l("div",Ql,[a(d,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=i=>e.updateDialog(!0))},null,8,["disabled"])]),a(u,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=i=>e.dialogVisible=i),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=i=>e.onCloseDialog())},{header:S(()=>[l("div",$l,[Xl,a(d,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=i=>e.updateDialog(!1))})])]),default:S(()=>[a(g,{form:e.form,onCloseDialog:t[4]||(t[4]=i=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const Zl=H(zl,[["render",Yl]]),es={props:["location_permalink"],setup(o,t){J(()=>{e.value.start_date=ee.local().startOf("day").toFormat("dd/MM/yyyy"),e.value.end_date=ee.local().endOf("day").toFormat("dd/MM/yyyy"),e.value.created_at="false",e.value.start_hour="00:00",e.value.end_hour="23:59"});const n=K(),e=x({}),p=oe(),{showLoader:w,hideLoader:s}=ne(),d=function(){let v=ge(e.value.start_date)+" "+e.value.start_hour,i=ge(e.value.end_date)+" "+e.value.end_hour;const b={from:v,to:i,location_permalink:o.location_permalink,created_at:"false"};g(b)},g=async function(v){w(),await p.downloadReport(v).then(()=>{s(),t.emit("onSubmit")}).catch(i=>{s(),L(n,i)})};return{form:e,onSubmit:d,setDefaultIfBlank:function(){(!e.value.start_hour||e.value.start_hour=="")&&(e.value.start_hour="00:00"),(!e.value.end_hour||e.value.end_hour=="")&&(e.value.end_hour="23:59")}}},components:{Form:et}},ts={class:"formgrid grid mt-3"},os={class:"field col-6 flex flex-column"},ns=l("label",{from:"start_date"},"Dal",-1),ls=l("label",{from:"start_hour",class:"mt-3"},"Dalle",-1),ss={class:"field col-6 flex flex-column"},as=l("label",{from:"end_date"},"Al",-1),is=l("label",{from:"end_hour",class:"mt-3"},"Alle",-1),rs={class:"flex align-items-center justify-content-end mt-6"};function cs(o,t,n,e,p,w){const s=k("Calendar"),d=k("InputMask"),g=k("Button"),u=k("Form");return f(),te(u,{onSubmit:e.onSubmit},{default:S(()=>[l("div",ts,[l("div",os,[ns,a(s,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=v=>e.form.start_date=v),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),ls,a(d,{id:"start_hour",modelValue:e.form.start_hour,"onUpdate:modelValue":t[1]||(t[1]=v=>e.form.start_hour=v),mask:"99:99",placeholder:"HH:mm",onBlur:t[2]||(t[2]=v=>e.setDefaultIfBlank())},null,8,["modelValue"])]),l("div",ss,[as,a(s,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[3]||(t[3]=v=>e.form.end_date=v),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),is,a(d,{id:"end_hour",modelValue:e.form.end_hour,"onUpdate:modelValue":t[4]||(t[4]=v=>e.form.end_hour=v),mask:"99:99",placeholder:"HH:mm",onBlur:t[5]||(t[5]=v=>e.setDefaultIfBlank())},null,8,["modelValue"])])]),l("div",rs,[a(g,{label:"Annulla",text:"",onClick:t[6]||(t[6]=v=>o.$emit("onSubmit"))}),a(g,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const ds=H(es,[["render",cs]]),us={setup(){const o=x({}),t=x({}),n=x(),e=x(!1),p=G(),w=Qe(),s=oe(),d=K(),g=ye(),u=M(()=>w.currentUser),v=M(()=>s.allLocations),i=M(()=>s.getCurrentLocation),b=M(()=>p.getPaymentMethods);J(()=>{i.value&&(o.value.location=i.value,t.value.location_permalink=i.value.permalink),h().then(()=>{D()})});const D=async function(){var U;let _={};const N=((U=i==null?void 0:i.value)==null?void 0:U.permalink)??null;N?_.location_permalink=N:_.location_permalink=v.value[0].permalink,await p.fetchPaymentMethods(_).then(()=>{}).catch(Z=>{L(d,Z)})},h=async function(){await s.fetchAllLocations().then(()=>{i.value||(o.value.location=v.value[0],t.value.location_permalink=v.value[0].permalink,s.updateCurrenLocation(v.value[0]))}).catch(_=>{L(d,_)})};return{filters:o,orderTable:n,order_filters:t,visibleDialog:e,user:u,locations:v,newPaymentMethods:b,fetchAllLocations:h,formatDate:pe,onUpdateFilters:function(_){_.course?o.value.course={id:_.course}:o.value.course="",_.name?o.value.name=_.name:o.value.name="",_.hour&&(_.hour.start_at?o.value.hour=_.hour.start_at:o.value.hour=_.hour)},onUpdateNewOrderFilters:function(_){_.start_at&&(t.value.hour=_.start_at),_.course_name&&(t.value.course={name:_.course_name}),_.date&&(t.value.date=_.date),_.hour&&(t.value.hour=_.hour),_.max_seats?t.value.max_seats=_.max_seats:t.value.max_seats=null,g.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=o.value.location.permalink,s.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){e.value=!1}}},components:{CalendarFilter:Jo,OrderTable:Ro,OrderFilter:ln,NewOrderCard:Zl,SalesReportsDialog:ds}};const ms={class:"flex justify-content-between align-items-center"},_s={class:"field flex flex-column mt-3"},fs={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},vs=l("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),hs={class:"capitalize text-xl"},ps={class:"flex gap-4"},ys={key:0,class:"col-3 mt-3"},gs={class:"col-9 mt-3"};function ks(o,t,n,e,p,w){const s=k("Dropdown"),d=k("Button"),g=k("SalesReportsDialog"),u=k("Dialog"),v=k("CalendarFilter"),i=k("NewOrderCard"),b=k("OrderFilter"),D=k("OrderTable");return f(),y("div",null,[l("div",ms,[l("div",_s,[a(s,{modelValue:e.filters.location,"onUpdate:modelValue":t[0]||(t[0]=h=>e.filters.location=h),options:e.locations,optionLabel:"name",placeholder:"Filtra per location",class:"location",onChange:t[1]||(t[1]=h=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(f(),y("div",fs,[l("div",null,[vs,l("span",hs,C(e.formatDate(e.filters.date)),1)]),a(d,{label:"Report visite",link:"",class:"m-0 p-0",onClick:t[2]||(t[2]=h=>e.visibleDialog=!0),icon:"pi pi-download"}),a(u,{visible:e.visibleDialog,"onUpdate:visible":t[4]||(t[4]=h=>e.visibleDialog=h),modal:"",header:"Report visite",style:{width:"35rem"}},{default:S(()=>[a(g,{onOnSubmit:t[3]||(t[3]=h=>e.onCloseReportDialog()),location_permalink:e.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):A("",!0)]),l("div",ps,[e.filters.location?(f(),y("div",ys,[a(v,{filters:e.filters},null,8,["filters"]),a(i,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[5]||(t[5]=h=>e.onCloseDialog())},null,8,["date","filters"])])):A("",!0),l("div",gs,[a(b,{filters:e.filters,onOnSubmit:t[6]||(t[6]=h=>e.onUpdateFilters(h))},null,8,["filters"]),e.filters.date?(f(),te(D,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[7]||(t[7]=h=>e.onUpdateNewOrderFilters(h))},null,8,["filters"])):A("",!0)])])])}const Ds=H(us,[["render",ks]]);export{Ds as default};
